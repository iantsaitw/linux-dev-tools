From patchwork Thu Jan 15 16:32:40 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184687
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=Gq6HEzRu;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=hc+HbI6X;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=jab+eZQA;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsT8L2rmzz1xtG
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:34:10 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=OkTaG1hSJ1X9BVAry1fHgMXzyhpORBlf4PqXMaoMPpw=; b=Gq6HEzRu0X2HM2
	n1umRJAJKlX7f8tEzcGeu+yWR757r9PsC5aD0YbcdAuHh1ATYsq0PU0r/7M0Bbw6UQXGA6vQdvdz+
	QE53Rpy+3KtDpkPpt8v9YPlIBI5pxEsGBF+p6UlTCnQUsBufGXNz1VfU7Qf2440EbJmN3dEd/SgRa
	6N2M7m2iuYHqaArBRIOvX5O/3BDH01L4/KJ6k0tOTXcz9zLjynqq1Tgh72IG7UzPp0SxQVsFRFyfv
	/tsWdHH8yZT2zR9uop5kuknhL8IgIXWkZJNpcbMe575uSR8a9ZGyLZZVIAPn0tmzQJESdOnkQOWQl
	FRsysZnIV3efViDXYaEw==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQHw-0000000ChTQ-2KhK;
	Thu, 15 Jan 2026 16:33:36 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQHu-0000000ChSt-2DZT
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:33:35 +0000
Received: from pps.filterd (m0279870.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFY9l12673513
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:33 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:content-type:date:from:in-reply-to
	:message-id:mime-version:references:subject:to; s=qcppdkim1; bh=
	61vSSkw3K1AX2SWYL+CWTlzdtIV0jxtmKZq4Rly6avo=; b=hc+HbI6XPMwM7veI
	jWVE0XY5935IRCcXdENDnWPKdONJcvT1Q7ZcrsfL2gyDKE8RBfgESz8G2BEd3JKg
	3f78h5Qk18yUVJXNUDRRDShDbrQ97GeUIJuGdT6980XOD5ybF1LV3wPEwuBLPEUi
	bj5XC/78RbXeWO8+BiuMsk0sIGT7bOrCnmza6C0FsErwvqih6p/g5Kdc6aBXHGut
	KklEX6qFU7FrvmuZN9DhfJMiRyJJY4wrXlw2SxH5yPxG3S7UsxiS8tYZsp3K4AY4
	9eLpmia95Vf6MMcnKUPuA1S8zH2f3cK+bPHbEOD2qAy4guqJMOB+BR6TXJGM+JL5
	I2DdMw==
Received: from mail-pl1-f198.google.com (mail-pl1-f198.google.com
 [209.85.214.198])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bpydugtfm-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:33 +0000 (GMT)
Received: by mail-pl1-f198.google.com with SMTP id
 d9443c01a7336-2a0a4b748a0so24353785ad.1
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:33:33 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494812; x=1769099612;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=61vSSkw3K1AX2SWYL+CWTlzdtIV0jxtmKZq4Rly6avo=;
        b=jab+eZQAJx9EBslYGw766r2bi4qctnMbe7rjk1aTb4X1fC56y92lw7wjiWZWRmlUBj
         s4N7Uyjz8uayYqKsChlF9dABCSgRTaiYJ3WOjUxzF/4lmLEJiRDNpdNkU5D4n1yGRZ+Z
         UL5gGym0D6e6zZlBJexTYMb+IBMpWJUtFvWA/TIw1KMFYo3FzWluv7cn9h8aJN8n1ZYl
         taRfAcrgW9+gAaM3eYgsoLyV1b2Po0moQup0GeJ0Ts+YxSClb0VxeWNyR2kYS27n2G0/
         z/js6jbkV/TPf3rGNxMT8RDDp8xNPwK4r3rs+7AZR7x41BNZLuayJgiurd7ik8G3PEng
         lynA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494812; x=1769099612;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=61vSSkw3K1AX2SWYL+CWTlzdtIV0jxtmKZq4Rly6avo=;
        b=il/2lBJ830/tUM+k0EdQr/Y97Un9c6saJY7IAIdUEgQjFDstRYAH8SWfCtwNP1O38x
         CICiNvGK3fKohZOyJa9nUVJZgCCn//mFaGx42zJp1BWkZI50FWVJzBBZdozxiP1PCTpA
         gQjTeltqSkNIi2Cn9BMEgg4f3WmuNmVk0soq1WyT6tGFJ0BYjyfIR1f49XSDfHl3HzFF
         PmUjl6Reixpp0pOSmGWlLgI738ocBO6mX6vD9QDXFs2wMJlo6NiL5Dbc8jvKu7XVy3HH
         XXTNLuzv6Xjbi/oN1H8fk5Jtf+GBaNMFt8vs8s2g40P6n/PZ/NB3720NE6NBY7YjbPGn
         sRAA==
X-Gm-Message-State: AOJu0Yw/uxaqPpjmiZWNUO6JFB8Ws2R5EYpgr/t1KzYUMCflZ8JMsNRM
	atTZShnGsyBLBE4oOnBIqotTlckz8DEF/hwtlpnLyLRJsELNQNFyao36AZuMd94gmke7sEI1tbv
	nvLpvZl2wXKxhklPslTeKnr0gGlNRA3S+2hIbcS/8bTCeu+D48P/UdWFfDfCZnDxRQcRi6Kn+
X-Gm-Gg: AY/fxX7tUjQ6jvP6c7uDGkB1sKDYvcddI0kRmyoSXR9CQYXQH185OAgIO/2U7scjPPm
	sxLVN8IAMs7sjRr3/R0KVwsqLeA3zSqR0SwxdQNdZ7JZZzmikHvVX8nYZbyAI5S6h/4qgNuhZD4
	E6MfdZ7btVG9hm2WLs/KrMaJbWpbFVEc9nU8HNRM5WDBDTjR6LevKdMg3Yf6iqeNDwEFG3yZ5Hk
	nBtmi1c8yiA10nwZr8h+2dRyyFLE68ecW0Qq+p0FK6IHYGm0BxpsoLYq+7HfhYo8v1RJG5VCi0R
	ABKebEfDBjvvDW6ztMoXEIY/rJqlcrgj8fVclDL88Zu/aOXqv4pXRXxH67Gcoe/kxh7Uep3oIUy
	pT8f4rhTucER7GjHgCBNnXrlwKQazZ8onhk1Rfba4
X-Received: by 2002:a17:903:90b:b0:295:6122:5c42 with SMTP id
 d9443c01a7336-2a717532ca6mr952985ad.24.1768494811719;
        Thu, 15 Jan 2026 08:33:31 -0800 (PST)
X-Received: by 2002:a17:903:90b:b0:295:6122:5c42 with SMTP id
 d9443c01a7336-2a717532ca6mr952675ad.24.1768494811004;
        Thu, 15 Jan 2026 08:33:31 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.33.29
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:33:30 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 01/27] Sync nl80211_copy.h with wireless-next
 linux/nl80211.h
Date: Thu, 15 Jan 2026 22:02:40 +0530
Message-Id: <20260115163306.367753-2-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX6rd6gyidUGNo
 L1xIKA3eqFDJyHpVAUPmnaw/T2bcqRd5a7lo80CYCx7bxxmnosWDU/DaVTG9pCpP3QsXm28hi8r
 /zuViXDXboKUqBnpYxr8DAaRd+6jQAcyDB0IT3ODEEczKoLkXO+ZzN7Sb/uSTveOVUA0DMxouab
 iWIfv0hUoW819U++hJFSwse67GSuHfMOB1lN765xjtcQ3z4ifUQUWo40vqKVd7ukAq+XMBRxNkd
 6eUFKs49VJ+koC0rzLCl8fILsV4DqisBUL7VR3wUni4KhF3gWJMsRtkf3GtaJDonFLjrfUoScvT
 GWA3aBsWnV6opCxbHXY/kR9i1mjQiVRtoBXgbfqPl0gmsgqcZEwdEzoRf5rsjrmdaopvHQZwLn6
 7QdsDxe36WKvYgiTaRDkICCiomSznK4qJojwZv1z8AICHIaFlEhHLS6G/+Lg4LL0ggnxj/UVrfZ
 0H+ZQKxgs5Qimae1iQg==
X-Proofpoint-ORIG-GUID: WUTSkvivMd3UKxEZdvePLFJvnTxpPaTi
X-Authority-Analysis: v=2.4 cv=NafrFmD4 c=1 sm=1 tr=0 ts=696916dd cx=c_pps
 a=MTSHoo12Qbhz2p7MsH1ifg==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=IkcTkHD0fZMA:10 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10
 a=VkNPw1HP01LnGYTKEx00:22 a=EUspDBNiAAAA:8 a=ECiVajudmbMai59eoo4A:9
 a=3ZKOabzyN94A:10 a=QEXdDO2ut3YA:10 a=GvdueXVYPmCkWapjIL-Q:22
X-Proofpoint-GUID: WUTSkvivMd3UKxEZdvePLFJvnTxpPaTi
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 spamscore=0 impostorscore=0 bulkscore=0 lowpriorityscore=0 suspectscore=0
 phishscore=0 clxscore=1015 priorityscore=1501 malwarescore=0 adultscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_083334_715929_F5563D68 
X-CRM114-Status: GOOD (  32.22  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
   Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com> ---
 src/drivers/nl80211_copy.h
    | 355 ++++++++++++++++++++++++++++++++++++- 1 file [...]
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.0 SPF_PASS               SPF: sender matches SPF record
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
---
 src/drivers/nl80211_copy.h | 355 ++++++++++++++++++++++++++++++++++++-
 1 file changed, 349 insertions(+), 6 deletions(-)

diff --git a/src/drivers/nl80211_copy.h b/src/drivers/nl80211_copy.h
index e9ccf43fe..81ada0c3a 100644
--- a/src/drivers/nl80211_copy.h
+++ b/src/drivers/nl80211_copy.h
@@ -1085,8 +1085,9 @@
  *	%NL80211_ATTR_NAN_MASTER_PREF attribute and optional
  *	%NL80211_ATTR_BANDS attributes.  If %NL80211_ATTR_BANDS is
  *	omitted or set to 0, it means don't-care and the device will
- *	decide what to use.  After this command NAN functions can be
- *	added.
+ *	decide what to use. Additional cluster configuration may be
+ *	optionally provided with %NL80211_ATTR_NAN_CONFIG.
+ *	After this command NAN functions can be added.
  * @NL80211_CMD_STOP_NAN: Stop the NAN operation, identified by
  *	its %NL80211_ATTR_WDEV interface.
  * @NL80211_CMD_ADD_NAN_FUNCTION: Add a NAN function. The function is defined
@@ -1115,6 +1116,10 @@
  *	current configuration is not changed.  If it is present but
  *	set to zero, the configuration is changed to don't-care
  *	(i.e. the device can decide what to do).
+ *	Additional parameters may be provided with
+ *	%NL80211_ATTR_NAN_CONFIG. User space should provide all previously
+ *	configured nested attributes under %NL80211_ATTR_NAN_CONFIG, even if
+ *	only a subset was changed.
  * @NL80211_CMD_NAN_MATCH: Notification sent when a match is reported.
  *	This will contain a %NL80211_ATTR_NAN_MATCH nested attribute and
  *	%NL80211_ATTR_COOKIE.
@@ -1330,12 +1335,32 @@
  *      TID to Link mapping for downlink/uplink traffic.
  *
  * @NL80211_CMD_ASSOC_MLO_RECONF: For a non-AP MLD station, request to
- *      add/remove links to/from the association.
+ *      add/remove links to/from the association. To indicate link
+ *      reconfiguration request results from the driver, this command is also
+ *      used as an event to notify userspace about the added links information.
+ *      For notifying the removed links information, the existing
+ *      %NL80211_CMD_LINKS_REMOVED command is used. This command is also used to
+ *      notify userspace about newly added links for the current connection in
+ *      case of AP-initiated link recommendation requests, received via
+ *      a BTM (BSS Transition Management) request or a link reconfig notify
+ *      frame, where the driver handles the link recommendation offload.
  *
  * @NL80211_CMD_EPCS_CFG: EPCS configuration for a station. Used by userland to
  *	control EPCS configuration. Used to notify userland on the current state
  *	of EPCS.
  *
+ * @NL80211_CMD_NAN_NEXT_DW_NOTIFICATION: This command is used to notify
+ *	user space about the next NAN Discovery Window (DW). User space may use
+ *	it to prepare frames to be sent in the next DW.
+ *	%NL80211_ATTR_WIPHY_FREQ is used to indicate the frequency of the next
+ *	DW. SDF transmission should be requested with %NL80211_CMD_FRAME and
+ *	the device/driver shall take care of the actual transmission timing.
+ *	This notification is only sent to the NAN interface owning socket
+ *	(see %NL80211_ATTR_SOCKET_OWNER flag).
+ * @NL80211_CMD_NAN_CLUSTER_JOINED: This command is used to notify
+ *	user space that the NAN new cluster has been joined. The cluster ID is
+ *	indicated by %NL80211_ATTR_MAC.
+ *
  * @NL80211_CMD_MAX: highest used command number
  * @__NL80211_CMD_AFTER_LAST: internal use
  */
@@ -1596,6 +1621,9 @@ enum nl80211_commands {
 	NL80211_CMD_ASSOC_MLO_RECONF,
 	NL80211_CMD_EPCS_CFG,
 
+	NL80211_CMD_NAN_NEXT_DW_NOTIFICATION,
+	NL80211_CMD_NAN_CLUSTER_JOINED,
+
 	/* add new commands above here */
 
 	/* used to define NL80211_CMD_MAX below */
@@ -1935,8 +1963,9 @@ enum nl80211_commands {
  *	The driver must also specify support for this with the extended
  *	features NL80211_EXT_FEATURE_BEACON_RATE_LEGACY,
  *	NL80211_EXT_FEATURE_BEACON_RATE_HT,
- *	NL80211_EXT_FEATURE_BEACON_RATE_VHT and
- *	NL80211_EXT_FEATURE_BEACON_RATE_HE.
+ *	NL80211_EXT_FEATURE_BEACON_RATE_VHT,
+ *	NL80211_EXT_FEATURE_BEACON_RATE_HE and
+ *	NL80211_EXT_FEATURE_BEACON_RATE_EHT.
  *
  * @NL80211_ATTR_FRAME_MATCH: A binary attribute which typically must contain
  *	at least one byte, currently used with @NL80211_CMD_REGISTER_FRAME.
@@ -2275,7 +2304,8 @@ enum nl80211_commands {
  * @NL80211_ATTR_PEER_AID: Association ID for the peer TDLS station (u16).
  *	This is similar to @NL80211_ATTR_STA_AID but with a difference of being
  *	allowed to be used with the first @NL80211_CMD_SET_STATION command to
- *	update a TDLS peer STA entry.
+ *	update a TDLS peer STA entry. For S1G interfaces, this is limited to
+ *	1600 for the current mac80211 implementation.
  *
  * @NL80211_ATTR_COALESCE_RULE: Coalesce rule information.
  *
@@ -2899,6 +2929,57 @@ enum nl80211_commands {
  *	APs Support". Drivers may set additional flags that they support
  *	in the kernel or device.
  *
+ * @NL80211_ATTR_WIPHY_RADIO_INDEX: (int) Integer attribute denoting the index
+ *	of the radio in interest. Internally a value of -1 is used to
+ *	indicate that the radio id is not given in user-space. This means
+ *	that all the attributes are applicable to all the radios. If there is
+ *	a radio index provided in user-space, the attributes will be
+ *	applicable to that specific radio only. If the radio id is greater
+ *	thank the number of radios, error denoting invalid value is returned.
+ *
+ * @NL80211_ATTR_S1G_LONG_BEACON_PERIOD: (u8) Integer attribute that represents
+ *	the number of beacon intervals between each long beacon transmission
+ *	for an S1G BSS with short beaconing enabled. This is a required
+ *	attribute for initialising an S1G short beaconing BSS. When updating
+ *	the short beacon data, this is not required. It has a minimum value of
+ *	2 (i.e 2 beacon intervals).
+ *
+ * @NL80211_ATTR_S1G_SHORT_BEACON: Nested attribute containing the short beacon
+ *	head and tail used to set or update the short beacon templates. When
+ *	bringing up a new interface, %NL80211_ATTR_S1G_LONG_BEACON_PERIOD is
+ *	required alongside this attribute. Refer to
+ *	@enum nl80211_s1g_short_beacon_attrs for the attribute definitions.
+ *
+ * @NL80211_ATTR_BSS_PARAM: nested attribute used with %NL80211_CMD_GET_WIPHY
+ *	which indicates which BSS parameters can be modified. The attribute can
+ *	also be used as flag attribute by user-space in %NL80211_CMD_SET_BSS to
+ *	indicate that it wants strict checking on the BSS parameters to be
+ *	modified.
+ *
+ * @NL80211_ATTR_NAN_CONFIG: Nested attribute for
+ *	extended NAN cluster configuration. This is used with
+ *	%NL80211_CMD_START_NAN and %NL80211_CMD_CHANGE_NAN_CONFIG.
+ *	See &enum nl80211_nan_conf_attributes for details.
+ *	This attribute is optional.
+ * @NL80211_ATTR_NAN_NEW_CLUSTER: Flag attribute indicating that a new
+ *	NAN cluster has been created. This is used with
+ *	%NL80211_CMD_NAN_CLUSTER_JOINED
+ * @NL80211_ATTR_NAN_CAPABILITIES: Nested attribute for NAN capabilities.
+ *	This is used with %NL80211_CMD_GET_WIPHY to indicate the NAN
+ *	capabilities supported by the driver. See &enum nl80211_nan_capabilities
+ *	for details.
+ *
+ * @NL80211_ATTR_S1G_PRIMARY_2MHZ: flag attribute indicating that the S1G
+ *	primary channel is 2 MHz wide, and the control channel designates
+ *	the 1 MHz primary subchannel within that 2 MHz primary.
+ *
+ * @NL80211_ATTR_EPP_PEER: A flag attribute to indicate if the peer is an EPP
+ *	STA. Used with %NL80211_CMD_NEW_STA and %NL80211_CMD_ADD_LINK_STA
+ *
+ * @NL80211_ATTR_EPP_FLAGS: A (u32) bitmap attribute to indicate the negotiated
+ *	EPP capabilities of an EPP AP and an EPP non-AP STA. See
+ *	&enum nl80211_epp_flags for details. Used with %NL80211_CMD_SET_STATION
+ *
  * @NUM_NL80211_ATTR: total number of nl80211_attrs available
  * @NL80211_ATTR_MAX: highest attribute number currently defined
  * @__NL80211_ATTR_AFTER_LAST: internal use
@@ -3456,6 +3537,21 @@ enum nl80211_attrs {
 
 	NL80211_ATTR_ASSOC_MLD_EXT_CAPA_OPS,
 
+	NL80211_ATTR_WIPHY_RADIO_INDEX,
+
+	NL80211_ATTR_S1G_LONG_BEACON_PERIOD,
+	NL80211_ATTR_S1G_SHORT_BEACON,
+	NL80211_ATTR_BSS_PARAM,
+	NL80211_ATTR_NAN_CONFIG,
+	NL80211_ATTR_NAN_NEW_CLUSTER,
+	NL80211_ATTR_NAN_CAPABILITIES,
+
+	NL80211_ATTR_S1G_PRIMARY_2MHZ,
+
+	NL80211_ATTR_EPP_PEER,
+
+	NL80211_ATTR_EPP_FLAGS,
+
 	/* add attributes here, update the policy in nl80211.c */
 
 	__NL80211_ATTR_AFTER_LAST,
@@ -3617,6 +3713,21 @@ enum nl80211_sta_flags {
 	NL80211_STA_FLAG_MAX = __NL80211_STA_FLAG_AFTER_LAST - 1
 };
 
+/**
+ * enum nl80211_epp_flags - EPP Flags
+ *
+ * Negotiated EPP capabilities of an EPP STA
+ *
+ * @NL80211_EPP_FLAG_ASSOC_FRAME_ENCRYPTION: (Re)Association
+ *	Request/Response frame encryption support
+ * @NL80211_EPP_FLAG_1X_UTILIZING_AUTHENTICATION_FRAMES:
+ *	IEEE 802.1X (EAP) Authentication utilizing Authentication frames
+ */
+enum nl80211_epp_flags {
+	NL80211_EPP_FLAG_ASSOC_FRAME_ENCRYPTION = 0,
+	NL80211_EPP_FLAG_1X_UTILIZING_AUTHENTICATION_FRAMES,
+};
+
 /**
  * enum nl80211_sta_p2p_ps_status - station support of P2P PS
  *
@@ -3701,6 +3812,22 @@ enum nl80211_eht_gi {
 	NL80211_RATE_INFO_EHT_GI_3_2,
 };
 
+/**
+ * enum nl80211_eht_ltf - EHT long training field
+ * @NL80211_RATE_INFO_EHT_1XLTF: 3.2 usec
+ * @NL80211_RATE_INFO_EHT_2XLTF: 6.4 usec
+ * @NL80211_RATE_INFO_EHT_4XLTF: 12.8 usec
+ * @NL80211_RATE_INFO_EHT_6XLTF: 19.2 usec
+ * @NL80211_RATE_INFO_EHT_8XLTF: 25.6 usec
+ */
+enum nl80211_eht_ltf {
+	NL80211_RATE_INFO_EHT_1XLTF,
+	NL80211_RATE_INFO_EHT_2XLTF,
+	NL80211_RATE_INFO_EHT_4XLTF,
+	NL80211_RATE_INFO_EHT_6XLTF,
+	NL80211_RATE_INFO_EHT_8XLTF,
+};
+
 /**
  * enum nl80211_eht_ru_alloc - EHT RU allocation values
  * @NL80211_RATE_INFO_EHT_RU_ALLOC_26: 26-tone RU allocation
@@ -4337,6 +4464,12 @@ enum nl80211_wmm_rule {
  *	very low power (VLP) AP, despite being NO_IR.
  * @NL80211_FREQUENCY_ATTR_ALLOW_20MHZ_ACTIVITY: This channel can be active in
  *	20 MHz bandwidth, despite being NO_IR.
+ * @NL80211_FREQUENCY_ATTR_NO_4MHZ: 4 MHz operation is not allowed on this
+ *	channel in current regulatory domain.
+ * @NL80211_FREQUENCY_ATTR_NO_8MHZ: 8 MHz operation is not allowed on this
+ *	channel in current regulatory domain.
+ * @NL80211_FREQUENCY_ATTR_NO_16MHZ: 16 MHz operation is not allowed on this
+ *	channel in current regulatory domain.
  * @NL80211_FREQUENCY_ATTR_MAX: highest frequency attribute number
  *	currently defined
  * @__NL80211_FREQUENCY_ATTR_AFTER_LAST: internal use
@@ -4382,6 +4515,9 @@ enum nl80211_frequency_attr {
 	NL80211_FREQUENCY_ATTR_CAN_MONITOR,
 	NL80211_FREQUENCY_ATTR_ALLOW_6GHZ_VLP_AP,
 	NL80211_FREQUENCY_ATTR_ALLOW_20MHZ_ACTIVITY,
+	NL80211_FREQUENCY_ATTR_NO_4MHZ,
+	NL80211_FREQUENCY_ATTR_NO_8MHZ,
+	NL80211_FREQUENCY_ATTR_NO_16MHZ,
 
 	/* keep last */
 	__NL80211_FREQUENCY_ATTR_AFTER_LAST,
@@ -5315,6 +5451,7 @@ enum nl80211_bss_status {
  * @NL80211_AUTHTYPE_FILS_SK: Fast Initial Link Setup shared key
  * @NL80211_AUTHTYPE_FILS_SK_PFS: Fast Initial Link Setup shared key with PFS
  * @NL80211_AUTHTYPE_FILS_PK: Fast Initial Link Setup public key
+ * @NL80211_AUTHTYPE_EPPKE: Enhanced Privacy Protection Key Exchange
  * @__NL80211_AUTHTYPE_NUM: internal
  * @NL80211_AUTHTYPE_MAX: maximum valid auth algorithm
  * @NL80211_AUTHTYPE_AUTOMATIC: determine automatically (if necessary by
@@ -5330,6 +5467,7 @@ enum nl80211_auth_type {
 	NL80211_AUTHTYPE_FILS_SK,
 	NL80211_AUTHTYPE_FILS_SK_PFS,
 	NL80211_AUTHTYPE_FILS_PK,
+	NL80211_AUTHTYPE_EPPKE,
 
 	/* keep last */
 	__NL80211_AUTHTYPE_NUM,
@@ -5447,6 +5585,10 @@ enum nl80211_key_attributes {
  *	see &struct nl80211_txrate_he
  * @NL80211_TXRATE_HE_GI: configure HE GI, 0.8us, 1.6us and 3.2us.
  * @NL80211_TXRATE_HE_LTF: configure HE LTF, 1XLTF, 2XLTF and 4XLTF.
+ * @NL80211_TXRATE_EHT: EHT rates allowed for TX rate selection,
+ *	see &struct nl80211_txrate_eht
+ * @NL80211_TXRATE_EHT_GI: configure EHT GI, (u8, see &enum nl80211_eht_gi)
+ * @NL80211_TXRATE_EHT_LTF: configure EHT LTF, (u8, see &enum nl80211_eht_ltf)
  * @__NL80211_TXRATE_AFTER_LAST: internal
  * @NL80211_TXRATE_MAX: highest TX rate attribute
  */
@@ -5459,6 +5601,9 @@ enum nl80211_tx_rate_attributes {
 	NL80211_TXRATE_HE,
 	NL80211_TXRATE_HE_GI,
 	NL80211_TXRATE_HE_LTF,
+	NL80211_TXRATE_EHT,
+	NL80211_TXRATE_EHT_GI,
+	NL80211_TXRATE_EHT_LTF,
 
 	/* keep last */
 	__NL80211_TXRATE_AFTER_LAST,
@@ -5491,6 +5636,15 @@ enum nl80211_txrate_gi {
 	NL80211_TXRATE_FORCE_LGI,
 };
 
+#define NL80211_EHT_NSS_MAX             16
+/**
+ * struct nl80211_txrate_eht - EHT MCS/NSS txrate bitmap
+ * @mcs: MCS bitmap table for each NSS (array index 0 for 1 stream, etc.)
+ */
+struct nl80211_txrate_eht {
+	__u16 mcs[NL80211_EHT_NSS_MAX];
+};
+
 /**
  * enum nl80211_band - Frequency band
  * @NL80211_BAND_2GHZ: 2.4 GHz ISM band
@@ -6615,6 +6769,18 @@ enum nl80211_feature_flags {
  *	(signaling and payload protected) A-MSDUs and this shall be advertised
  *	in the RSNXE.
  *
+ * @NL80211_EXT_FEATURE_BEACON_RATE_EHT: Driver supports beacon rate
+ *	configuration (AP/mesh) with EHT rates.
+ *
+ * @NL80211_EXT_FEATURE_EPPKE: Driver supports Enhanced Privacy Protection
+ *	Key Exchange (EPPKE) with user space SME (NL80211_CMD_AUTHENTICATE)
+ *	in non-AP STA mode.
+ *
+ * @NL80211_EXT_FEATURE_ASSOC_FRAME_ENCRYPTION: This specifies that the
+ *	driver supports encryption of (Re)Association Request and Response
+ *	frames in both nonâ€‘AP STA and AP mode as specified in
+ *	"IEEE P802.11bi/D3.0, 12.16.6".
+ *
  * @NUM_NL80211_EXT_FEATURES: number of extended features.
  * @MAX_NL80211_EXT_FEATURES: highest extended feature index.
  */
@@ -6690,6 +6856,9 @@ enum nl80211_ext_feature_index {
 	NL80211_EXT_FEATURE_OWE_OFFLOAD_AP,
 	NL80211_EXT_FEATURE_DFS_CONCURRENT,
 	NL80211_EXT_FEATURE_SPP_AMSDU_SUPPORT,
+	NL80211_EXT_FEATURE_BEACON_RATE_EHT,
+	NL80211_EXT_FEATURE_EPPKE,
+	NL80211_EXT_FEATURE_ASSOC_FRAME_ENCRYPTION,
 
 	/* add new features before the definition below */
 	NUM_NL80211_EXT_FEATURES,
@@ -7244,6 +7413,105 @@ enum nl80211_nan_match_attributes {
 	NL80211_NAN_MATCH_ATTR_MAX = NUM_NL80211_NAN_MATCH_ATTR - 1
 };
 
+/**
+ * enum nl80211_nan_band_conf_attributes - NAN band configuration attributes
+ * @__NL80211_NAN_BAND_CONF_INVALID: Invalid.
+ * @NL80211_NAN_BAND_CONF_BAND: Band for which the configuration is
+ *	being set. The value is according to &enum nl80211_band (u8).
+ * @NL80211_NAN_BAND_CONF_FREQ: Discovery frequency. This attribute shall not
+ *	be present on 2.4 GHZ band. On 5 GHz band its presence is optional.
+ *	The allowed values are 5220 (channel 44) or 5745 (channel 149).
+ *	If not present, channel 149 is used if allowed, otherwise channel 44
+ *	will be selected. The value is in MHz (u16).
+ * @NL80211_NAN_BAND_CONF_RSSI_CLOSE: RSSI close threshold used for NAN state
+ *	transition algorithm as described in chapters 3.3.6 and 3.3.7 "NAN
+ *	Device Role and State Transition" of Wi-Fi Aware (TM) Specification
+ *	v4.0. If not specified, default device value is used. The value should
+ *	be greater than -60 dBm (s8).
+ * @NL80211_NAN_BAND_CONF_RSSI_MIDDLE: RSSI middle threshold used for NAN state
+ *	transition algorithm as described in chapters 3.3.6 and 3.3.7 "NAN
+ *	Device Role and State Transition" of Wi-Fi Aware (TM) Specification
+ *	v4.0. If not present, default device value is used. The value should be
+ *	greater than -75 dBm and less than %NL80211_NAN_BAND_CONF_RSSI_CLOSE
+ *	(s8).
+ * @NL80211_NAN_BAND_CONF_WAKE_DW: Committed DW information (values 0-5).
+ *	Value 0 means that the device will not wake up during the
+ *	discovery window. Values 1-5 mean that the device will wake up
+ *	during each 2^(n - 1) discovery window, where n is the value of
+ *	this attribute. Setting this attribute to 0 is not allowed on
+ *	2.4 GHz band (u8). This is an optional parameter (default is 1).
+ * @NL80211_NAN_BAND_CONF_DISABLE_SCAN: Optional flag attribute to disable
+ *	scanning (for cluster merge) on the band. If set, the device will not
+ *	scan on this band anymore. Disabling scanning on 2.4 GHz band is not
+ *	allowed.
+ * @NUM_NL80211_NAN_BAND_CONF_ATTR: Internal.
+ * @NL80211_NAN_BAND_CONF_ATTR_MAX: Highest NAN band configuration attribute.
+ *
+ * These attributes are used to configure NAN band-specific parameters. Note,
+ * that both RSSI attributes should be configured (or both left unset).
+ */
+enum nl80211_nan_band_conf_attributes {
+	__NL80211_NAN_BAND_CONF_INVALID,
+	NL80211_NAN_BAND_CONF_BAND,
+	NL80211_NAN_BAND_CONF_FREQ,
+	NL80211_NAN_BAND_CONF_RSSI_CLOSE,
+	NL80211_NAN_BAND_CONF_RSSI_MIDDLE,
+	NL80211_NAN_BAND_CONF_WAKE_DW,
+	NL80211_NAN_BAND_CONF_DISABLE_SCAN,
+
+	/* keep last */
+	NUM_NL80211_NAN_BAND_CONF_ATTR,
+	NL80211_NAN_BAND_CONF_ATTR_MAX = NUM_NL80211_NAN_BAND_CONF_ATTR - 1,
+};
+
+/**
+ * enum nl80211_nan_conf_attributes - NAN configuration attributes
+ * @__NL80211_NAN_CONF_INVALID: Invalid attribute, used for validation.
+ * @NL80211_NAN_CONF_CLUSTER_ID: ID for the NAN cluster. This is a MAC
+ *	address that can take values from 50-6F-9A-01-00-00 to
+ *	50-6F-9A-01-FF-FF. This attribute is optional. If not present,
+ *	a random Cluster ID will be chosen.
+ * @NL80211_NAN_CONF_EXTRA_ATTRS: Additional NAN attributes to be
+ *	published in the beacons. This is an optional byte array.
+ * @NL80211_NAN_CONF_VENDOR_ELEMS: Vendor-specific elements that will
+ *	be published in the beacons. This is an optional byte array.
+ * @NL80211_NAN_CONF_BAND_CONFIGS: This is a nested array attribute,
+ *	containing multiple entries for each supported band. Each band
+ *	configuration consists of &enum nl80211_nan_band_conf_attributes.
+ * @NL80211_NAN_CONF_SCAN_PERIOD: Scan period in seconds. If not configured,
+ *	device default is used. Zero value will disable scanning.
+ *	This is u16 (optional).
+ * @NL80211_NAN_CONF_SCAN_DWELL_TIME: Scan dwell time in TUs per channel.
+ *	Only non-zero values are valid. If not configured the device default
+ *	value is used. This is u16 (optional)
+ * @NL80211_NAN_CONF_DISCOVERY_BEACON_INTERVAL: Discovery beacon interval
+ *	in TUs. Valid range is 50-200 TUs. If not configured the device default
+ *	value is used. This is u8 (optional)
+ * @NL80211_NAN_CONF_NOTIFY_DW: If set, the driver will notify userspace about
+ *	the upcoming discovery window with
+ *	%NL80211_CMD_NAN_NEXT_DW_NOTIFICATION.
+ *	This is a flag attribute.
+ * @NUM_NL80211_NAN_CONF_ATTR: Internal.
+ * @NL80211_NAN_CONF_ATTR_MAX: Highest NAN configuration attribute.
+ *
+ * These attributes are used to configure NAN-specific parameters.
+ */
+enum nl80211_nan_conf_attributes {
+	__NL80211_NAN_CONF_INVALID,
+	NL80211_NAN_CONF_CLUSTER_ID,
+	NL80211_NAN_CONF_EXTRA_ATTRS,
+	NL80211_NAN_CONF_VENDOR_ELEMS,
+	NL80211_NAN_CONF_BAND_CONFIGS,
+	NL80211_NAN_CONF_SCAN_PERIOD,
+	NL80211_NAN_CONF_SCAN_DWELL_TIME,
+	NL80211_NAN_CONF_DISCOVERY_BEACON_INTERVAL,
+	NL80211_NAN_CONF_NOTIFY_DW,
+
+	/* keep last */
+	NUM_NL80211_NAN_CONF_ATTR,
+	NL80211_NAN_CONF_ATTR_MAX = NUM_NL80211_NAN_CONF_ATTR - 1,
+};
+
 /**
  * enum nl80211_external_auth_action - Action to perform with external
  *     authentication request. Used by NL80211_ATTR_EXTERNAL_AUTH_ACTION.
@@ -8088,6 +8356,7 @@ enum nl80211_ap_settings_flags {
  *	and contains attributes defined in &enum nl80211_if_combination_attrs.
  * @NL80211_WIPHY_RADIO_ATTR_ANTENNA_MASK: bitmask (u32) of antennas
  *	connected to this radio.
+ * @NL80211_WIPHY_RADIO_ATTR_RTS_THRESHOLD: RTS threshold (u32) of this radio.
  *
  * @__NL80211_WIPHY_RADIO_ATTR_LAST: Internal
  * @NL80211_WIPHY_RADIO_ATTR_MAX: Highest attribute
@@ -8099,6 +8368,7 @@ enum nl80211_wiphy_radio_attrs {
 	NL80211_WIPHY_RADIO_ATTR_FREQ_RANGE,
 	NL80211_WIPHY_RADIO_ATTR_INTERFACE_COMBINATION,
 	NL80211_WIPHY_RADIO_ATTR_ANTENNA_MASK,
+	NL80211_WIPHY_RADIO_ATTR_RTS_THRESHOLD,
 
 	/* keep last */
 	__NL80211_WIPHY_RADIO_ATTR_LAST,
@@ -8128,4 +8398,77 @@ enum nl80211_wiphy_radio_freq_range {
 	NL80211_WIPHY_RADIO_FREQ_ATTR_MAX = __NL80211_WIPHY_RADIO_FREQ_ATTR_LAST - 1,
 };
 
+/**
+ * enum nl80211_s1g_short_beacon_attrs - S1G short beacon data
+ *
+ * @__NL80211_S1G_SHORT_BEACON_ATTR_INVALID: Invalid
+ *
+ * @NL80211_S1G_SHORT_BEACON_ATTR_HEAD: Short beacon head (binary).
+ * @NL80211_S1G_SHORT_BEACON_ATTR_TAIL: Short beacon tail (binary).
+ *
+ * @__NL80211_S1G_SHORT_BEACON_ATTR_LAST: Internal
+ * @NL80211_S1G_SHORT_BEACON_ATTR_MAX: Highest attribute
+ */
+enum nl80211_s1g_short_beacon_attrs {
+	__NL80211_S1G_SHORT_BEACON_ATTR_INVALID,
+
+	NL80211_S1G_SHORT_BEACON_ATTR_HEAD,
+	NL80211_S1G_SHORT_BEACON_ATTR_TAIL,
+
+	/* keep last */
+	__NL80211_S1G_SHORT_BEACON_ATTR_LAST,
+	NL80211_S1G_SHORT_BEACON_ATTR_MAX =
+		__NL80211_S1G_SHORT_BEACON_ATTR_LAST - 1
+};
+
+/**
+ * enum nl80211_nan_capabilities - NAN (Neighbor Aware Networking)
+ *	capabilities.
+ *
+ * @__NL80211_NAN_CAPABILITIES_INVALID: Invalid.
+ * @NL80211_NAN_CAPA_CONFIGURABLE_SYNC: Flag attribute indicating that
+ *	the device supports configurable synchronization. If set, the device
+ *	should be able to handle %NL80211_ATTR_NAN_CONFIG
+ *	attribute in the %NL80211_CMD_START_NAN (and change) command.
+ * @NL80211_NAN_CAPA_USERSPACE_DE: Flag attribute indicating that
+ *	NAN Discovery Engine (DE) is not offloaded and the driver assumes
+ *	user space DE implementation. When set, %NL80211_CMD_ADD_NAN_FUNCTION,
+ *	%NL80211_CMD_DEL_NAN_FUNCTION and %NL80211_CMD_NAN_MATCH commands
+ *	should not be used. In addition, the device/driver should support
+ *	sending discovery window (DW) notifications using
+ *	%NL80211_CMD_NAN_NEXT_DW_NOTIFICATION and handling transmission and
+ *	reception of NAN SDF frames on NAN device interface during DW windows.
+ *	(%NL80211_CMD_FRAME is used to transmit SDFs)
+ * @NL80211_NAN_CAPA_OP_MODE: u8 attribute indicating the supported operation
+ *	modes as defined in Wi-Fi Aware (TM) specification Table 81 (Operation
+ *	Mode field format).
+ * @NL80211_NAN_CAPA_NUM_ANTENNAS: u8 attribute indicating the number of
+ *	TX and RX antennas supported by the device. Lower nibble indicates
+ *	the number of TX antennas and upper nibble indicates the number of RX
+ *	antennas. Value 0 indicates the information is not available.
+ *	See table 79 of Wi-Fi Aware (TM) specification (Number of
+ *	Antennas field).
+ * @NL80211_NAN_CAPA_MAX_CHANNEL_SWITCH_TIME: u16 attribute indicating the
+ *	maximum time in microseconds that the device requires to switch
+ *	channels.
+ * @NL80211_NAN_CAPA_CAPABILITIES: u8 attribute containing the
+ *	capabilities of the device as defined in Wi-Fi Aware (TM)
+ *	specification Table 79 (Capabilities field).
+ * @__NL80211_NAN_CAPABILITIES_LAST: Internal
+ * @NL80211_NAN_CAPABILITIES_MAX: Highest NAN capability attribute.
+ */
+enum nl80211_nan_capabilities {
+	__NL80211_NAN_CAPABILITIES_INVALID,
+
+	NL80211_NAN_CAPA_CONFIGURABLE_SYNC,
+	NL80211_NAN_CAPA_USERSPACE_DE,
+	NL80211_NAN_CAPA_OP_MODE,
+	NL80211_NAN_CAPA_NUM_ANTENNAS,
+	NL80211_NAN_CAPA_MAX_CHANNEL_SWITCH_TIME,
+	NL80211_NAN_CAPA_CAPABILITIES,
+	/* keep last */
+	__NL80211_NAN_CAPABILITIES_LAST,
+	NL80211_NAN_CAPABILITIES_MAX = __NL80211_NAN_CAPABILITIES_LAST - 1,
+};
+
 #endif /* __LINUX_NL80211_H */

From patchwork Thu Jan 15 16:32:41 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184688
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=d3zOd5HJ;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=enDssthJ;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=YRMaTCIw;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsT8M199Nz1xt4
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:34:11 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=+mOiCpSMo99BIs/vr0cVkZEH0AvjPNKe/Y7Qm3Wm3X4=; b=d3zOd5HJpxDPlb
	phBB59RFF6QiYtThdT+JDNRjge8tMi68KLm8bS8ipBKlVWbDKU6+KLh5fb1WCxilgsiUh2pZuU8nw
	8iJJmWXxQ5m4iUOXRf6GfduER4wMTAsn0Ddr5Jj33GrSSri243FMJxEvbwl/RnZkuq6zmtexq4UyC
	AnCmq7DZrRTWBUBktiYHPM9BTe030IGPTzWtcgla0SmTt2YKltbXJnzVj9YGxvNU0OFQy9v9HzXK9
	hqngoU7Bscfy6ybrjP7BaBFYz1YN7397hPpEpW8slMrmUhYtcSTy94755yrTEqK+Ci3q6hRMFDspE
	sebvnOCO780licKzp9og==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQHy-0000000ChUh-2YFH;
	Thu, 15 Jan 2026 16:33:38 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQHw-0000000ChTL-2O6r
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:33:37 +0000
Received: from pps.filterd (m0279871.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFYGnQ2866272
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:35 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=zIbPKbzpouP
	HZKucAsQferBk6WC+xurMHwNPO24wlcA=; b=enDssthJaoiiPjSEuza+8U0QxjK
	h45qN76kMVJFKUQP+aFZW+nnD5YnUWIpiI8H8j1I7F8mb0NWvXECaMeirVCrwNbo
	mFnsy/OSzShJJjenY+ViXWT2OSZ6UezoJvH99uzqsVjngZABypwgW9DtE0C08iU3
	XfMWbl05J4WFgn4SjmJUtT8TI8KSGnw5vuy0+ouqQnrF4IcpdQ2/4WCj1ar60yuC
	XSmkhHClVjdQBOxMs5uYPiDCfAtxSVYRv5Jyokctu4Y7hHfrE+HGNWS53zv21WSS
	EGe/7ahi/Ux6uiaG0vJs4zONvUPel7DNpSh5WjHPjnTaPsb3s7e3X4QvMdA==
Received: from mail-pg1-f199.google.com (mail-pg1-f199.google.com
 [209.85.215.199])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bptu2hp4f-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:35 +0000 (GMT)
Received: by mail-pg1-f199.google.com with SMTP id
 41be03b00d2f7-c5e56644646so1069875a12.0
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:33:35 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494814; x=1769099614;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=zIbPKbzpouPHZKucAsQferBk6WC+xurMHwNPO24wlcA=;
        b=YRMaTCIwAXFvgB9zJ7qTdUvYD1slVsADZQ7tnB13hK507Euox70N5SWJA2O5Vnv4W4
         7gqIBhbYXpOrNLVARWPF1SmAawyk1BC7DfYDM0GFCuo5iAdQFuMyHuKR9X58JZ6vuewn
         eKqBMGNiQy87TLXuIfVdOilR8DIxtaaa/Ue0npOJKVdCgwuMH41KSJsU5sZGcf5WTLu2
         XZY28o2WGydGlNVq3Egd16Qz9y8+DxMPFj75qebm8ejk21G3rixm1/K1ApE1L+bOb56E
         7ctauoQSIKSVbSoPWsy9/3CGcXv0I7Q2DoEfD2mJU5jOLHh36kEIb4pksG0yNexKjvuD
         kivw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494814; x=1769099614;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=zIbPKbzpouPHZKucAsQferBk6WC+xurMHwNPO24wlcA=;
        b=mlMWmMuAgBTpElMf2v7T2kUIZteWNT3GAAV7uRhsBf3z8MYPw6H15qzwsR0t4apdGY
         g7rlCKIMq/X4VGzBkFrBGRYh8/HwUci3SlKE+Ob2OEqb8rdILy5F+ODWt/hhqZRhydkC
         zAbenIjAAL+VuSfgeOrBqkKjrUMDp0uEaRGeSJ0ENcOdVHvCpIqGtcergZEPTpjl96Pq
         XXX/iGehgncPWWjZwVRI2hpkmA6QwM4iHaSlXpj5daXVJgO7owxCkYPbMyMJszTgsu7w
         LNRPGZUpB3pcCXXQd+w4kuqkSvcPlL5LNWHpujEgZvZvGKEyoUxx+NTBklClqFfjJ/I3
         LxrA==
X-Gm-Message-State: AOJu0YwzhjVqVaTI1P1bfxFCCD9pZ+OpVXN8iOuaF9NwWUywhmqxPcIX
	WKZicvZ1M7ESvsBuuTWTJAXDEbtkehPxOE2T9eK8VHU0u76dmnfRjqP4ZlQDnsd7b8y682s5BlN
	lA2gDVCE/h0jes7eOrfwHLOv3Taqugcb0INHF6LsmR7woG5dXHelOcOGQ8fAAUzXHrtFTJMhW
X-Gm-Gg: AY/fxX4hQD5EsBJfKqFFHvx5Ek8RcTCmWolor7M28EbHhsZz9z6jSfREBnOcTK1JYn4
	ypsOemIcV7ViZf/GMjrG1qfhQgmnkrAl2R3jcvrGJ3eZ2MSeiO19zOhRyAPBkpP/LlYufhTjMNi
	XUNNSEudJ7cCtGE92qYVlvJjRJVZ7l7AKWXv/pnLgueY4wPC6ShCIIxjRI3gyaoq76ZkUztQ2/D
	DrLdfC+uhcnghOL2IlJRxQSJQtElVoOZIXJJZQTLit8DrKZ/WTxkTYNRQbsWMhAwKlnhK2wBZwV
	mycM8EoCzPn0UZs/7UMTno5EM48aZeqpbaq5mLZeI/dVtZmLEptdp/3mUH78r+rfCZOl9Fu+/wN
	X2xyqbXg9UhbECsYLHdwrIFQR4Tf9K+cnZ8RPNeau
X-Received: by 2002:a17:902:f650:b0:2a3:ccfc:4de5 with SMTP id
 d9443c01a7336-2a700978f8bmr39207265ad.5.1768494813991;
        Thu, 15 Jan 2026 08:33:33 -0800 (PST)
X-Received: by 2002:a17:902:f650:b0:2a3:ccfc:4de5 with SMTP id
 d9443c01a7336-2a700978f8bmr39206875ad.5.1768494813096;
        Thu, 15 Jan 2026 08:33:33 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.33.31
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:33:32 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 02/27] 11bi: Rename FILS nonce element and related
 constants to generic 'nonce'
Date: Thu, 15 Jan 2026 22:02:41 +0530
Message-Id: <20260115163306.367753-3-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX8o69snRZ3Kbt
 UUkWIvMgFPf7eGOI2iAmJ5sW/VJb07TH/ej1Tk5egXmv2oqEVqHPpaA6zQVBpzhnVLQfV6wv4+8
 0svIP6V7DfRYA6/GDrbhmtwdbwTUfAzbOyEzjh4BcTWbHezsMTaSXPyhu9/465NHTwW0Gflc0fF
 uHS3Ux6Bo9BX4D47zBgtqwK9p1MclDM5U5AwaRCgT5qOP13y9MbEUv2Dt6vbXPltZ+Y6QJoQaZ2
 JgRSqAWsZOJlcwfxtDC1G24/bGN+63BCt4iZBDVkP59tkMZtQBkvMVcbdkDBV6F06KaF6ZQdYrO
 pRZso9S3k5LlSiRiuhnwMXzUnKgkAR/zNdh3F8NsveZzfcFdc/TjCdcG/9wXQ/GcRmuALMazzOG
 UcOE2mfmCkwiwANRJrwcqzDwd89LYHG1RluhT3GMPbkB4NjUEg4c5HG92Xx2v0ahoOzelYR/bKQ
 ow7mpXf/eABF/4hV7AA==
X-Proofpoint-ORIG-GUID: ItGxRawnSPiQxSly-r3_vJ32AxLxcBJV
X-Authority-Analysis: v=2.4 cv=W6Y1lBWk c=1 sm=1 tr=0 ts=696916df cx=c_pps
 a=Oh5Dbbf/trHjhBongsHeRQ==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=G8hjbcGCKmAzj2wXGVcA:9 a=_Vgx9l1VpLgwpw_dHYaR:22
X-Proofpoint-GUID: ItGxRawnSPiQxSly-r3_vJ32AxLxcBJV
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 adultscore=0 priorityscore=1501 phishscore=0 suspectscore=0
 lowpriorityscore=0 spamscore=0 impostorscore=0 malwarescore=0 clxscore=1015
 bulkscore=0 classifier=typeunknown authscore=0 authtc= authcc= route=outbound
 adjust=0 reason=mlx scancount=1 engine=8.22.0-2512120000
 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_083336_780772_36FCCEFF 
X-CRM114-Status: GOOD (  23.11  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  Previously,
 the nonce element and related constants were used
    exclusively in FILS authentication frames. Rename the nonce element and
 related
    constants to reflect their broader usage beyond FILS authentication
 frames,
    as specified in P802.11bi/D2.1,9.4.2.188.
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.0 SPF_PASS               SPF: sender matches SPF record
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

Previously, the nonce element and related constants were used
exclusively in FILS authentication frames.

Rename the nonce element and related constants to reflect their
broader usage beyond FILS authentication frames, as specified in
P802.11bi/D2.1,9.4.2.188.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/ap/ieee802_11.c            | 32 +++++++++++++++---------------
 src/ap/sta_info.h              |  2 +-
 src/ap/wpa_auth.c              | 12 ++++++------
 src/common/ieee802_11_common.c | 10 +++++-----
 src/common/ieee802_11_common.h |  2 +-
 src/common/ieee802_11_defs.h   |  4 ++--
 src/common/wpa_common.c        | 36 +++++++++++++++++-----------------
 src/drivers/driver_atheros.c   |  8 ++++----
 src/pasn/pasn_common.h         |  4 ++--
 src/pasn/pasn_initiator.c      | 20 +++++++++----------
 src/pasn/pasn_responder.c      |  6 +++---
 src/rsn_supp/wpa.c             | 20 +++++++++----------
 src/rsn_supp/wpa_i.h           |  4 ++--
 wlantest/rx_mgmt.c             | 14 ++++++-------
 wpa_supplicant/sme.c           |  6 +++---
 15 files changed, 90 insertions(+), 90 deletions(-)

diff --git a/src/ap/ieee802_11.c b/src/ap/ieee802_11.c
index 24ef8b75f..611017da1 100644
--- a/src/ap/ieee802_11.c
+++ b/src/ap/ieee802_11.c
@@ -2299,14 +2299,14 @@ void handle_auth_fils(struct hostapd_data *hapd, struct sta_info *sta,
 	if (resp != WLAN_STATUS_SUCCESS)
 		goto fail;
 
-	if (!elems.fils_nonce) {
+	if (!elems.nonce) {
 		wpa_printf(MSG_DEBUG, "FILS: No FILS Nonce field");
 		resp = WLAN_STATUS_UNSPECIFIED_FAILURE;
 		goto fail;
 	}
-	wpa_hexdump(MSG_DEBUG, "FILS: SNonce", elems.fils_nonce,
-		    FILS_NONCE_LEN);
-	os_memcpy(sta->fils_snonce, elems.fils_nonce, FILS_NONCE_LEN);
+	wpa_hexdump(MSG_DEBUG, "FILS: SNonce", elems.nonce,
+		    NONCE_LEN);
+	os_memcpy(sta->fils_snonce, elems.nonce, NONCE_LEN);
 
 	/* PMKID List */
 	if (rsn.pmkid && rsn.num_pmkid > 0) {
@@ -2414,7 +2414,7 @@ prepare_auth_resp_fils(struct hostapd_data *hapd,
 		       const u8 *msk, size_t msk_len,
 		       int *is_pub)
 {
-	u8 fils_nonce[FILS_NONCE_LEN];
+	u8 fils_nonce[NONCE_LEN];
 	size_t ielen;
 	struct wpabuf *data = NULL;
 	const u8 *ie;
@@ -2449,12 +2449,12 @@ prepare_auth_resp_fils(struct hostapd_data *hapd,
 		ie = ie_buf;
 	}
 
-	if (random_get_bytes(fils_nonce, FILS_NONCE_LEN) < 0) {
+	if (random_get_bytes(fils_nonce, NONCE_LEN) < 0) {
 		*resp = WLAN_STATUS_UNSPECIFIED_FAILURE;
 		goto fail;
 	}
 	wpa_hexdump(MSG_DEBUG, "RSN: Generated FILS Nonce",
-		    fils_nonce, FILS_NONCE_LEN);
+		    fils_nonce, NONCE_LEN);
 
 #ifdef CONFIG_FILS_SK_PFS
 	if (sta->fils_dh_ss && sta->fils_ecdh) {
@@ -2506,10 +2506,10 @@ prepare_auth_resp_fils(struct hostapd_data *hapd,
 
 	/* FILS Nonce */
 	wpabuf_put_u8(data, WLAN_EID_EXTENSION); /* Element ID */
-	wpabuf_put_u8(data, 1 + FILS_NONCE_LEN); /* Length */
+	wpabuf_put_u8(data, 1 + NONCE_LEN); /* Length */
 	/* Element ID Extension */
-	wpabuf_put_u8(data, WLAN_EID_EXT_FILS_NONCE);
-	wpabuf_put_data(data, fils_nonce, FILS_NONCE_LEN);
+	wpabuf_put_u8(data, WLAN_EID_EXT_NONCE);
+	wpabuf_put_data(data, fils_nonce, NONCE_LEN);
 
 	/* FILS Session */
 	wpabuf_put_u8(data, WLAN_EID_EXTENSION); /* Element ID */
@@ -2795,13 +2795,13 @@ static void pasn_fils_auth_resp(struct hostapd_data *hapd,
 		goto fail;
 	}
 
-	if (random_get_bytes(fils->anonce, FILS_NONCE_LEN) < 0) {
+	if (random_get_bytes(fils->anonce, NONCE_LEN) < 0) {
 		wpa_printf(MSG_DEBUG, "PASN: FILS: Failed to get ANonce");
 		goto fail;
 	}
 
 	wpa_hexdump(MSG_DEBUG, "RSN: Generated FILS ANonce",
-		    fils->anonce, FILS_NONCE_LEN);
+		    fils->anonce, NONCE_LEN);
 
 	ret = fils_rmsk_to_pmk(pasn_get_akmp(pasn), msk, msk_len, fils->nonce,
 			       fils->anonce, NULL, 0, pmk, &pmk_len);
@@ -2913,7 +2913,7 @@ static int pasn_wd_handle_fils(struct hostapd_data *hapd, struct sta_info *sta,
 		return -1;
 	}
 
-	if (!elems.rsn_ie || !elems.fils_nonce || !elems.fils_nonce ||
+	if (!elems.rsn_ie || !elems.nonce || !elems.nonce ||
 	    !elems.wrapped_data || !elems.fils_session) {
 		wpa_printf(MSG_DEBUG, "PASN: FILS: Missing IEs");
 		return -1;
@@ -2938,9 +2938,9 @@ static int pasn_wd_handle_fils(struct hostapd_data *hapd, struct sta_info *sta,
 		return -1;
 	}
 
-	wpa_hexdump(MSG_DEBUG, "PASN: FILS: Nonce", elems.fils_nonce,
-		    FILS_NONCE_LEN);
-	os_memcpy(fils->nonce, elems.fils_nonce, FILS_NONCE_LEN);
+	wpa_hexdump(MSG_DEBUG, "PASN: FILS: Nonce", elems.nonce,
+		    NONCE_LEN);
+	os_memcpy(fils->nonce, elems.nonce, NONCE_LEN);
 
 	wpa_hexdump(MSG_DEBUG, "PASN: FILS: Session", elems.fils_session,
 		    FILS_SESSION_LEN);
diff --git a/src/ap/sta_info.h b/src/ap/sta_info.h
index 4f41f7028..3fb97edd5 100644
--- a/src/ap/sta_info.h
+++ b/src/ap/sta_info.h
@@ -262,7 +262,7 @@ struct sta_info {
 #endif /* CONFIG_TAXONOMY */
 
 #ifdef CONFIG_FILS
-	u8 fils_snonce[FILS_NONCE_LEN];
+	u8 fils_snonce[NONCE_LEN];
 	u8 fils_session[FILS_SESSION_LEN];
 	u8 fils_erp_pmkid[PMKID_LEN];
 	u8 *fils_pending_assoc_req;
diff --git a/src/ap/wpa_auth.c b/src/ap/wpa_auth.c
index 49268b21e..620e55387 100644
--- a/src/ap/wpa_auth.c
+++ b/src/ap/wpa_auth.c
@@ -3131,8 +3131,8 @@ int fils_auth_pmk_to_ptk(struct wpa_state_machine *sm, const u8 *pmk,
 	forced_memzero(ick, sizeof(ick));
 
 	/* Store nonces for (Re)Association Request/Response frame processing */
-	os_memcpy(sm->SNonce, snonce, FILS_NONCE_LEN);
-	os_memcpy(sm->ANonce, anonce, FILS_NONCE_LEN);
+	os_memcpy(sm->SNonce, snonce, NONCE_LEN);
+	os_memcpy(sm->ANonce, anonce, NONCE_LEN);
 
 	return res;
 }
@@ -3349,10 +3349,10 @@ int fils_decrypt_assoc(struct wpa_state_machine *sm, const u8 *fils_session,
 	aad_len[1] = ETH_ALEN;
 	/* The STA's nonce */
 	aad[2] = sm->SNonce;
-	aad_len[2] = FILS_NONCE_LEN;
+	aad_len[2] = NONCE_LEN;
 	/* The AP's nonce */
 	aad[3] = sm->ANonce;
-	aad_len[3] = FILS_NONCE_LEN;
+	aad_len[3] = NONCE_LEN;
 	/*
 	 * The (Re)Association Request frame from the Capability Information
 	 * field to the FILS Session element (both inclusive).
@@ -3408,10 +3408,10 @@ int fils_encrypt_assoc(struct wpa_state_machine *sm, u8 *buf,
 	aad_len[1] = ETH_ALEN;
 	/* The AP's nonce */
 	aad[2] = sm->ANonce;
-	aad_len[2] = FILS_NONCE_LEN;
+	aad_len[2] = NONCE_LEN;
 	/* The STA's nonce */
 	aad[3] = sm->SNonce;
-	aad_len[3] = FILS_NONCE_LEN;
+	aad_len[3] = NONCE_LEN;
 	/*
 	 * The (Re)Association Response frame from the Capability Information
 	 * field (the same offset in both Association and Reassociation
diff --git a/src/common/ieee802_11_common.c b/src/common/ieee802_11_common.c
index 5d1e02f81..451f6eb3a 100644
--- a/src/common/ieee802_11_common.c
+++ b/src/common/ieee802_11_common.c
@@ -362,10 +362,10 @@ static int ieee802_11_parse_extension(const u8 *pos, size_t elen,
 		elems->fils_pk = pos;
 		elems->fils_pk_len = elen;
 		break;
-	case WLAN_EID_EXT_FILS_NONCE:
-		if (elen != FILS_NONCE_LEN)
+	case WLAN_EID_EXT_NONCE:
+		if (elen != NONCE_LEN)
 			break;
-		elems->fils_nonce = pos;
+		elems->nonce = pos;
 		break;
 	case WLAN_EID_EXT_OWE_DH_PARAM:
 		if (elen < 2)
@@ -941,8 +941,8 @@ void ieee802_11_elems_clear_ext_ids(struct ieee802_11_elems *elems,
 			elems->fils_pk = NULL;
 			elems->fils_pk_len = 0;
 			break;
-		case WLAN_EID_EXT_FILS_NONCE:
-			elems->fils_nonce = NULL;
+		case WLAN_EID_EXT_NONCE:
+			elems->nonce = NULL;
 			break;
 		case WLAN_EID_EXT_OWE_DH_PARAM:
 			elems->owe_dh = NULL;
diff --git a/src/common/ieee802_11_common.h b/src/common/ieee802_11_common.h
index 09bd0675a..7f6f387c2 100644
--- a/src/common/ieee802_11_common.h
+++ b/src/common/ieee802_11_common.h
@@ -94,7 +94,7 @@ struct ieee802_11_elems {
 	const u8 *key_delivery;
 	const u8 *wrapped_data;
 	const u8 *fils_pk;
-	const u8 *fils_nonce;
+	const u8 *nonce;
 	const u8 *owe_dh;
 	const u8 *power_capab;
 	const u8 *roaming_cons_sel;
diff --git a/src/common/ieee802_11_defs.h b/src/common/ieee802_11_defs.h
index 89f0a1bf8..1b964439b 100644
--- a/src/common/ieee802_11_defs.h
+++ b/src/common/ieee802_11_defs.h
@@ -504,7 +504,7 @@
 #define WLAN_EID_EXT_EXTENDED_REQUEST 10
 #define WLAN_EID_EXT_ESTIMATED_SERVICE_PARAMS 11
 #define WLAN_EID_EXT_FILS_PUBLIC_KEY 12
-#define WLAN_EID_EXT_FILS_NONCE 13
+#define WLAN_EID_EXT_NONCE 13
 #define WLAN_EID_EXT_FUTURE_CHANNEL_GUIDANCE 14
 #define WLAN_EID_EXT_OWE_DH_PARAM 32
 #define WLAN_EID_EXT_PASSWORD_IDENTIFIER 33
@@ -974,7 +974,7 @@ enum lci_req_subelem {
 	LCI_REQ_SUBELEM_MAX_AGE = 4,
 };
 
-#define FILS_NONCE_LEN 16
+#define NONCE_LEN 16
 #define FILS_SESSION_LEN 8
 #define FILS_CACHE_ID_LEN 2
 #define FILS_MAX_KEY_AUTH_LEN 48
diff --git a/src/common/wpa_common.c b/src/common/wpa_common.c
index 8b0d92201..d1a6e86a4 100644
--- a/src/common/wpa_common.c
+++ b/src/common/wpa_common.c
@@ -681,7 +681,7 @@ int fils_rmsk_to_pmk(int akmp, const u8 *rmsk, size_t rmsk_len,
 		     const u8 *snonce, const u8 *anonce, const u8 *dh_ss,
 		     size_t dh_ss_len, u8 *pmk, size_t *pmk_len)
 {
-	u8 nonces[2 * FILS_NONCE_LEN];
+	u8 nonces[2 * NONCE_LEN];
 	const u8 *addr[2];
 	size_t len[2];
 	size_t num_elem;
@@ -698,12 +698,12 @@ int fils_rmsk_to_pmk(int akmp, const u8 *rmsk, size_t rmsk_len,
 		return -1;
 
 	wpa_hexdump_key(MSG_DEBUG, "FILS: rMSK", rmsk, rmsk_len);
-	wpa_hexdump(MSG_DEBUG, "FILS: SNonce", snonce, FILS_NONCE_LEN);
-	wpa_hexdump(MSG_DEBUG, "FILS: ANonce", anonce, FILS_NONCE_LEN);
+	wpa_hexdump(MSG_DEBUG, "FILS: SNonce", snonce, NONCE_LEN);
+	wpa_hexdump(MSG_DEBUG, "FILS: ANonce", anonce, NONCE_LEN);
 	wpa_hexdump(MSG_DEBUG, "FILS: DHss", dh_ss, dh_ss_len);
 
-	os_memcpy(nonces, snonce, FILS_NONCE_LEN);
-	os_memcpy(&nonces[FILS_NONCE_LEN], anonce, FILS_NONCE_LEN);
+	os_memcpy(nonces, snonce, NONCE_LEN);
+	os_memcpy(&nonces[NONCE_LEN], anonce, NONCE_LEN);
 	addr[0] = rmsk;
 	len[0] = rmsk_len;
 	num_elem = 1;
@@ -713,10 +713,10 @@ int fils_rmsk_to_pmk(int akmp, const u8 *rmsk, size_t rmsk_len,
 		num_elem++;
 	}
 	if (wpa_key_mgmt_sha384(akmp))
-		res = hmac_sha384_vector(nonces, 2 * FILS_NONCE_LEN, num_elem,
+		res = hmac_sha384_vector(nonces, 2 * NONCE_LEN, num_elem,
 					 addr, len, pmk);
 	else
-		res = hmac_sha256_vector(nonces, 2 * FILS_NONCE_LEN, num_elem,
+		res = hmac_sha256_vector(nonces, 2 * NONCE_LEN, num_elem,
 					 addr, len, pmk);
 	if (res == 0)
 		wpa_hexdump_key(MSG_DEBUG, "FILS: PMK", pmk, *pmk_len);
@@ -779,7 +779,7 @@ int fils_pmk_to_ptk(const u8 *pmk, size_t pmk_len, const u8 *spa, const u8 *aa,
 	 * KDK = L(FILS-Key-Data, ICK_bits + KEK_bits + TK_bits + FILS-FT_bits,
 	 *	   KDK_bits)
 	 */
-	data_len = 2 * ETH_ALEN + 2 * FILS_NONCE_LEN + dhss_len;
+	data_len = 2 * ETH_ALEN + 2 * NONCE_LEN + dhss_len;
 	data = os_malloc(data_len);
 	if (!data)
 		goto err;
@@ -788,10 +788,10 @@ int fils_pmk_to_ptk(const u8 *pmk, size_t pmk_len, const u8 *spa, const u8 *aa,
 	pos += ETH_ALEN;
 	os_memcpy(pos, aa, ETH_ALEN);
 	pos += ETH_ALEN;
-	os_memcpy(pos, snonce, FILS_NONCE_LEN);
-	pos += FILS_NONCE_LEN;
-	os_memcpy(pos, anonce, FILS_NONCE_LEN);
-	pos += FILS_NONCE_LEN;
+	os_memcpy(pos, snonce, NONCE_LEN);
+	pos += NONCE_LEN;
+	os_memcpy(pos, anonce, NONCE_LEN);
+	pos += NONCE_LEN;
 	if (dhss)
 		os_memcpy(pos, dhss, dhss_len);
 
@@ -845,8 +845,8 @@ int fils_pmk_to_ptk(const u8 *pmk, size_t pmk_len, const u8 *spa, const u8 *aa,
 
 	wpa_printf(MSG_DEBUG, "FILS: PTK derivation - SPA=" MACSTR
 		   " AA=" MACSTR, MAC2STR(spa), MAC2STR(aa));
-	wpa_hexdump(MSG_DEBUG, "FILS: SNonce", snonce, FILS_NONCE_LEN);
-	wpa_hexdump(MSG_DEBUG, "FILS: ANonce", anonce, FILS_NONCE_LEN);
+	wpa_hexdump(MSG_DEBUG, "FILS: SNonce", snonce, NONCE_LEN);
+	wpa_hexdump(MSG_DEBUG, "FILS: ANonce", anonce, NONCE_LEN);
 	if (dhss)
 		wpa_hexdump_key(MSG_DEBUG, "FILS: DHss", dhss, dhss_len);
 	wpa_hexdump_key(MSG_DEBUG, "FILS: PMK", pmk, pmk_len);
@@ -902,8 +902,8 @@ int fils_key_auth_sk(const u8 *ick, size_t ick_len, const u8 *snonce,
 	wpa_printf(MSG_DEBUG, "FILS: Key-Auth derivation: STA-MAC=" MACSTR
 		   " AP-BSSID=" MACSTR, MAC2STR(sta_addr), MAC2STR(bssid));
 	wpa_hexdump_key(MSG_DEBUG, "FILS: ICK", ick, ick_len);
-	wpa_hexdump(MSG_DEBUG, "FILS: SNonce", snonce, FILS_NONCE_LEN);
-	wpa_hexdump(MSG_DEBUG, "FILS: ANonce", anonce, FILS_NONCE_LEN);
+	wpa_hexdump(MSG_DEBUG, "FILS: SNonce", snonce, NONCE_LEN);
+	wpa_hexdump(MSG_DEBUG, "FILS: ANonce", anonce, NONCE_LEN);
 	wpa_hexdump(MSG_DEBUG, "FILS: gSTA", g_sta, g_sta_len);
 	wpa_hexdump(MSG_DEBUG, "FILS: gAP", g_ap, g_ap_len);
 
@@ -913,9 +913,9 @@ int fils_key_auth_sk(const u8 *ick, size_t ick_len, const u8 *snonce,
 	 *                      [ || gSTA || gAP ])
 	 */
 	addr[0] = snonce;
-	len[0] = FILS_NONCE_LEN;
+	len[0] = NONCE_LEN;
 	addr[1] = anonce;
-	len[1] = FILS_NONCE_LEN;
+	len[1] = NONCE_LEN;
 	addr[2] = sta_addr;
 	len[2] = ETH_ALEN;
 	addr[3] = bssid;
diff --git a/src/drivers/driver_atheros.c b/src/drivers/driver_atheros.c
index 94db413eb..eec0adc70 100644
--- a/src/drivers/driver_atheros.c
+++ b/src/drivers/driver_atheros.c
@@ -1083,17 +1083,17 @@ atheros_sta_auth(void *priv, struct wpa_driver_sta_auth_params *params)
 		wpa_printf(MSG_DEBUG, "%s: im_op IEEE80211_MLME_AUTH_FILS",
 			   __func__);
 		os_memcpy(mlme.fils_aad.ANonce, params->fils_anonce,
-			  IEEE80211_FILS_NONCE_LEN);
+			  IEEE80211_NONCE_LEN);
 		os_memcpy(mlme.fils_aad.SNonce, params->fils_snonce,
-			  IEEE80211_FILS_NONCE_LEN);
+			  IEEE80211_NONCE_LEN);
 		os_memcpy(mlme.fils_aad.kek, params->fils_kek,
 			  IEEE80211_MAX_WPA_KEK_LEN);
 		mlme.fils_aad.kek_len = params->fils_kek_len;
 		mlme.im_op = IEEE80211_MLME_AUTH_FILS;
 		wpa_hexdump(MSG_DEBUG, "FILS: ANonce",
-			    mlme.fils_aad.ANonce, FILS_NONCE_LEN);
+			    mlme.fils_aad.ANonce, NONCE_LEN);
 		wpa_hexdump(MSG_DEBUG, "FILS: SNonce",
-			    mlme.fils_aad.SNonce, FILS_NONCE_LEN);
+			    mlme.fils_aad.SNonce, NONCE_LEN);
 		wpa_hexdump_key(MSG_DEBUG, "FILS: KEK",
 				mlme.fils_aad.kek, mlme.fils_aad.kek_len);
 	} else {
diff --git a/src/pasn/pasn_common.h b/src/pasn/pasn_common.h
index 578e7b122..ded679a4d 100644
--- a/src/pasn/pasn_common.h
+++ b/src/pasn/pasn_common.h
@@ -29,8 +29,8 @@ enum pasn_fils_state {
 
 struct pasn_fils {
 	u8 state;
-	u8 nonce[FILS_NONCE_LEN];
-	u8 anonce[FILS_NONCE_LEN];
+	u8 nonce[NONCE_LEN];
+	u8 anonce[NONCE_LEN];
 	u8 session[FILS_SESSION_LEN];
 	u8 erp_pmkid[PMKID_LEN];
 	bool completed;
diff --git a/src/pasn/pasn_initiator.c b/src/pasn/pasn_initiator.c
index 445ac17ae..74dde993b 100644
--- a/src/pasn/pasn_initiator.c
+++ b/src/pasn/pasn_initiator.c
@@ -273,12 +273,12 @@ static struct wpabuf * wpas_pasn_fils_build_auth(struct pasn_data *pasn)
 		return NULL;
 	}
 
-	if (random_get_bytes(pasn->fils.nonce, FILS_NONCE_LEN) < 0 ||
+	if (random_get_bytes(pasn->fils.nonce, NONCE_LEN) < 0 ||
 	    random_get_bytes(pasn->fils.session, FILS_SESSION_LEN) < 0)
 		goto fail;
 
 	wpa_hexdump(MSG_DEBUG, "PASN: FILS: Nonce", pasn->fils.nonce,
-		    FILS_NONCE_LEN);
+		    NONCE_LEN);
 
 	wpa_hexdump(MSG_DEBUG, "PASN: FILS: Session", pasn->fils.session,
 		    FILS_SESSION_LEN);
@@ -301,9 +301,9 @@ static struct wpabuf * wpas_pasn_fils_build_auth(struct pasn_data *pasn)
 
 	/* FILS Nonce */
 	wpabuf_put_u8(buf, WLAN_EID_EXTENSION);
-	wpabuf_put_u8(buf, 1 + FILS_NONCE_LEN);
-	wpabuf_put_u8(buf, WLAN_EID_EXT_FILS_NONCE);
-	wpabuf_put_data(buf, pasn->fils.nonce, FILS_NONCE_LEN);
+	wpabuf_put_u8(buf, 1 + NONCE_LEN);
+	wpabuf_put_u8(buf, WLAN_EID_EXT_NONCE);
+	wpabuf_put_data(buf, pasn->fils.nonce, NONCE_LEN);
 
 	/* FILS Session */
 	wpabuf_put_u8(buf, WLAN_EID_EXTENSION);
@@ -366,7 +366,7 @@ static int wpas_pasn_wd_fils_rx(struct pasn_data *pasn, struct wpabuf *wd)
 	struct wpa_ie_data rsne_data;
 	u8 rmsk[ERP_MAX_KEY_LEN];
 	size_t rmsk_len;
-	u8 anonce[FILS_NONCE_LEN];
+	u8 anonce[NONCE_LEN];
 	const u8 *data;
 	size_t buf_len;
 	struct wpabuf *fils_wd = NULL;
@@ -410,7 +410,7 @@ static int wpas_pasn_wd_fils_rx(struct pasn_data *pasn, struct wpabuf *wd)
 		return -1;
 	}
 
-	if (!elems.rsn_ie || !elems.fils_nonce || !elems.fils_nonce ||
+	if (!elems.rsn_ie || !elems.nonce || !elems.nonce ||
 	    !elems.wrapped_data) {
 		wpa_printf(MSG_DEBUG, "PASN: FILS: Missing IEs");
 		return -1;
@@ -435,9 +435,9 @@ static int wpas_pasn_wd_fils_rx(struct pasn_data *pasn, struct wpabuf *wd)
 		return -1;
 	}
 
-	wpa_hexdump(MSG_DEBUG, "PASN: FILS: ANonce", elems.fils_nonce,
-		    FILS_NONCE_LEN);
-	os_memcpy(anonce, elems.fils_nonce, FILS_NONCE_LEN);
+	wpa_hexdump(MSG_DEBUG, "PASN: FILS: ANonce", elems.nonce,
+		    NONCE_LEN);
+	os_memcpy(anonce, elems.nonce, NONCE_LEN);
 
 	wpa_hexdump(MSG_DEBUG, "PASN: FILS: FILS Session", elems.fils_session,
 		    FILS_SESSION_LEN);
diff --git a/src/pasn/pasn_responder.c b/src/pasn/pasn_responder.c
index 8a09a7a88..568442e28 100644
--- a/src/pasn/pasn_responder.c
+++ b/src/pasn/pasn_responder.c
@@ -305,9 +305,9 @@ static struct wpabuf * pasn_get_fils_wd(struct pasn_data *pasn)
 
 	/* FILS Nonce */
 	wpabuf_put_u8(buf, WLAN_EID_EXTENSION);
-	wpabuf_put_u8(buf, 1 + FILS_NONCE_LEN);
-	wpabuf_put_u8(buf, WLAN_EID_EXT_FILS_NONCE);
-	wpabuf_put_data(buf, fils->anonce, FILS_NONCE_LEN);
+	wpabuf_put_u8(buf, 1 + NONCE_LEN);
+	wpabuf_put_u8(buf, WLAN_EID_EXT_NONCE);
+	wpabuf_put_data(buf, fils->anonce, NONCE_LEN);
 
 	/* FILS Session */
 	wpabuf_put_u8(buf, WLAN_EID_EXTENSION);
diff --git a/src/rsn_supp/wpa.c b/src/rsn_supp/wpa.c
index 70812f4b1..01ca1679d 100644
--- a/src/rsn_supp/wpa.c
+++ b/src/rsn_supp/wpa.c
@@ -6059,12 +6059,12 @@ struct wpabuf * fils_build_auth(struct wpa_sm *sm, int dh_group, const u8 *md)
 		goto fail;
 	}
 
-	if (random_get_bytes(sm->fils_nonce, FILS_NONCE_LEN) < 0 ||
+	if (random_get_bytes(sm->fils_nonce, NONCE_LEN) < 0 ||
 	    random_get_bytes(sm->fils_session, FILS_SESSION_LEN) < 0)
 		goto fail;
 
 	wpa_hexdump(MSG_DEBUG, "FILS: Generated FILS Nonce",
-		    sm->fils_nonce, FILS_NONCE_LEN);
+		    sm->fils_nonce, NONCE_LEN);
 	wpa_hexdump(MSG_DEBUG, "FILS: Generated FILS Session",
 		    sm->fils_session, FILS_SESSION_LEN);
 
@@ -6129,10 +6129,10 @@ struct wpabuf * fils_build_auth(struct wpa_sm *sm, int dh_group, const u8 *md)
 
 	/* FILS Nonce */
 	wpabuf_put_u8(buf, WLAN_EID_EXTENSION); /* Element ID */
-	wpabuf_put_u8(buf, 1 + FILS_NONCE_LEN); /* Length */
+	wpabuf_put_u8(buf, 1 + NONCE_LEN); /* Length */
 	/* Element ID Extension */
-	wpabuf_put_u8(buf, WLAN_EID_EXT_FILS_NONCE);
-	wpabuf_put_data(buf, sm->fils_nonce, FILS_NONCE_LEN);
+	wpabuf_put_u8(buf, WLAN_EID_EXT_NONCE);
+	wpabuf_put_data(buf, sm->fils_nonce, NONCE_LEN);
 
 	/* FILS Session */
 	wpabuf_put_u8(buf, WLAN_EID_EXTENSION); /* Element ID */
@@ -6257,12 +6257,12 @@ int fils_process_auth(struct wpa_sm *sm, const u8 *bssid, const u8 *data,
 		goto fail;
 	}
 
-	if (!elems.fils_nonce) {
+	if (!elems.nonce) {
 		wpa_printf(MSG_DEBUG, "FILS: No FILS Nonce field");
 		goto fail;
 	}
-	os_memcpy(sm->fils_anonce, elems.fils_nonce, FILS_NONCE_LEN);
-	wpa_hexdump(MSG_DEBUG, "FILS: ANonce", sm->fils_anonce, FILS_NONCE_LEN);
+	os_memcpy(sm->fils_anonce, elems.nonce, NONCE_LEN);
+	wpa_hexdump(MSG_DEBUG, "FILS: ANonce", sm->fils_anonce, NONCE_LEN);
 
 #ifdef CONFIG_IEEE80211R
 	if (wpa_key_mgmt_ft(sm->key_mgmt)) {
@@ -6722,10 +6722,10 @@ struct wpabuf * fils_build_assoc_req(struct wpa_sm *sm, const u8 **kek,
 	wpa_hexdump_key(MSG_DEBUG, "FILS: KEK for AEAD", *kek, *kek_len);
 	*snonce = sm->fils_nonce;
 	wpa_hexdump(MSG_DEBUG, "FILS: SNonce for AEAD AAD",
-		    *snonce, FILS_NONCE_LEN);
+		    *snonce, NONCE_LEN);
 	*anonce = sm->fils_anonce;
 	wpa_hexdump(MSG_DEBUG, "FILS: ANonce for AEAD AAD",
-		    *anonce, FILS_NONCE_LEN);
+		    *anonce, NONCE_LEN);
 
 	return buf;
 }
diff --git a/src/rsn_supp/wpa_i.h b/src/rsn_supp/wpa_i.h
index 9f9a032f1..d0c3541b5 100644
--- a/src/rsn_supp/wpa_i.h
+++ b/src/rsn_supp/wpa_i.h
@@ -205,9 +205,9 @@ struct wpa_sm {
 #endif /* CONFIG_TESTING_OPTIONS */
 
 #ifdef CONFIG_FILS
-	u8 fils_nonce[FILS_NONCE_LEN];
+	u8 fils_nonce[NONCE_LEN];
 	u8 fils_session[FILS_SESSION_LEN];
-	u8 fils_anonce[FILS_NONCE_LEN];
+	u8 fils_anonce[NONCE_LEN];
 	u8 fils_key_auth_ap[FILS_MAX_KEY_AUTH_LEN];
 	u8 fils_key_auth_sta[FILS_MAX_KEY_AUTH_LEN];
 	size_t fils_key_auth_len;
diff --git a/wlantest/rx_mgmt.c b/wlantest/rx_mgmt.c
index be4d53c6d..b27946b27 100644
--- a/wlantest/rx_mgmt.c
+++ b/wlantest/rx_mgmt.c
@@ -987,16 +987,16 @@ static void process_fils_auth(struct wlantest *wt, struct wlantest_bss *bss,
 		sta->pairwise_cipher = data.pairwise_cipher;
 	}
 
-	if (!elems.fils_nonce) {
+	if (!elems.nonce) {
 		add_note(wt, MSG_INFO,
 			 "FILS Authentication frame missing nonce");
 		return;
 	}
 
 	if (ether_addr_equal(mgmt->sa, mgmt->bssid))
-		os_memcpy(sta->anonce, elems.fils_nonce, FILS_NONCE_LEN);
+		os_memcpy(sta->anonce, elems.nonce, NONCE_LEN);
 	else
-		os_memcpy(sta->snonce, elems.fils_nonce, FILS_NONCE_LEN);
+		os_memcpy(sta->snonce, elems.nonce, NONCE_LEN);
 }
 
 
@@ -1365,10 +1365,10 @@ static int try_rmsk(struct wlantest *wt, struct wlantest_bss *bss,
 	aad_len[1] = ETH_ALEN;
 	/* The STA's nonce */
 	aad[2] = sta->snonce;
-	aad_len[2] = FILS_NONCE_LEN;
+	aad_len[2] = NONCE_LEN;
 	/* The AP's nonce */
 	aad[3] = sta->anonce;
-	aad_len[3] = FILS_NONCE_LEN;
+	aad_len[3] = NONCE_LEN;
 	/*
 	 * The (Re)Association Request frame from the Capability Information
 	 * field to the FILS Session element (both inclusive).
@@ -1586,10 +1586,10 @@ static void decrypt_fils_assoc_resp(struct wlantest *wt,
 	aad_len[1] = ETH_ALEN;
 	/* The AP's nonce */
 	aad[2] = sta->anonce;
-	aad_len[2] = FILS_NONCE_LEN;
+	aad_len[2] = NONCE_LEN;
 	/* The STA's nonce */
 	aad[3] = sta->snonce;
-	aad_len[3] = FILS_NONCE_LEN;
+	aad_len[3] = NONCE_LEN;
 	/*
 	 * The (Re)Association Response frame from the Capability Information
 	 * field to the FILS Session element (both inclusive).
diff --git a/wpa_supplicant/sme.c b/wpa_supplicant/sme.c
index 860b75f92..fba6508bc 100644
--- a/wpa_supplicant/sme.c
+++ b/wpa_supplicant/sme.c
@@ -2291,7 +2291,7 @@ void sme_associate(struct wpa_supplicant *wpa_s, enum wpas_mode mode,
 	struct ieee802_11_elems elems;
 	struct wpa_ssid *ssid = wpa_s->current_ssid;
 #ifdef CONFIG_FILS
-	u8 nonces[2 * FILS_NONCE_LEN];
+	u8 nonces[2 * NONCE_LEN];
 #endif /* CONFIG_FILS */
 #ifdef CONFIG_HT_OVERRIDES
 	struct ieee80211_ht_capabilities htcaps;
@@ -2383,8 +2383,8 @@ void sme_associate(struct wpa_supplicant *wpa_s, enum wpas_mode mode,
 			    wpa_s->sme.assoc_req_ie,
 			    wpa_s->sme.assoc_req_ie_len);
 
-		os_memcpy(nonces, snonce, FILS_NONCE_LEN);
-		os_memcpy(nonces + FILS_NONCE_LEN, anonce, FILS_NONCE_LEN);
+		os_memcpy(nonces, snonce, NONCE_LEN);
+		os_memcpy(nonces + NONCE_LEN, anonce, NONCE_LEN);
 		params.fils_nonces = nonces;
 		params.fils_nonces_len = sizeof(nonces);
 	}

From patchwork Thu Jan 15 16:32:42 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184683
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=j2rlHHA9;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=lbz3axeX;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=aXiUDpz9;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsT8K1TWlz1xtG
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:34:09 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=QTGO6/BBRL5kc2eIlXzh8kNVfkfyduWblnkkqP2cAyo=; b=j2rlHHA9tto8GQ
	heLNOQp4ArSoDI+CfQ1vuIQxwYKtBkoJG2fAtkb8YyHpkid6k4clUqvzkcLo1FbFvOTL9HaQfEt+8
	MCFT1OtitdsTSpbL/44sG5rKdnWx9irQ/si3BIBB5AfZK1BIR8sBxpmvup6MeR5r28JKDfPFhR2tr
	C9aa4MlAgWE+P+w4BCbteY8Vjh2EwKwGLfLZ8pNkuwhNXHEiAo/CIVcg1bzPGQxJ5KVzX2POEmY+V
	qH7zUG3JpwtRigqroU/rzbemGQ3G6mik4ORRsYo/mRNZRz3SYB8LnbLJGu8CleV6LhTm0Ds4CvdXt
	C6iek1VaA17xPDxdWDlQ==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQI0-0000000ChVn-2QI0;
	Thu, 15 Jan 2026 16:33:40 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQHy-0000000ChTx-0Kje
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:33:39 +0000
Received: from pps.filterd (m0279872.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFYBSR1910032
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:37 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=L4KUGx8nbnl
	EvJ/1mHDWWueM0tNr/gD2lmU+Jd3F9i4=; b=lbz3axeXGuqTn+ZvFLfcMnDn9Lt
	QJtFvVPGDIFHSbAFUrUjMIR9JUpJB2ihh/eeiqP9+ghKc5O8/w6Tzof56Ue15WlM
	mVuW1B9Bn50E6oIQllTnl3DLLrL9vM+i8fGnSIcCOCXDoIVUQbRjBj/CIqTmawyB
	UmoQYcswjT7rAVHtyq34W+XgH3WJ8w7hLt2Mzw3mYzXPIBUhLHGP2asYnoRtWpbM
	rCzi0jPsmlRvmUt91It1Hg2joY3z2KN1tQGej+o4bzOUPbpP46QTWoludYcN4hKl
	SxFVFd00zh/zOlXnlgAyPaUcOZXg8tnqCpjf7PZdeTPBGNErX3jCRWqwuxQ==
Received: from mail-pl1-f198.google.com (mail-pl1-f198.google.com
 [209.85.214.198])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bpxgn0yna-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:36 +0000 (GMT)
Received: by mail-pl1-f198.google.com with SMTP id
 d9443c01a7336-2a351686c17so10886645ad.0
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:33:36 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494816; x=1769099616;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=L4KUGx8nbnlEvJ/1mHDWWueM0tNr/gD2lmU+Jd3F9i4=;
        b=aXiUDpz9su+dN8gxxwLX//TKv+7wTJ9vfFJx3szLhc/lwq+zP2nliBSwRX5MKWZaYA
         /8PlpO5BXOYutV4F7oSWUnQGOA1C97x/gyXBCxeJCSpfBeywhOdQZhpcX4jH+IvEhH+K
         WQfINvCW4Z2VRuTJqPmue//s92RoIuU3BXHxl1QRIIMQQsiA6pnGrv5Ir5YuVjPmZhlk
         mJx+rfDu44PYJ6DBLx03vvQWrv+1mnlqbif7B5OiO+rXHOGCjNDmGVrHj5KoKk0Is3LQ
         A4A7oCU5fiYQHRLMc+hK1lSETMEQ5yx9x2Rqf3K3X3tsnKUi3Fy1j3Ld64jgAHeABPMn
         h8SA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494816; x=1769099616;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=L4KUGx8nbnlEvJ/1mHDWWueM0tNr/gD2lmU+Jd3F9i4=;
        b=QrByoiY3I4iDmFs9W8WxST7/oLtPHzO3NBrcX36YDS3JtBAHaKNKFCH9auXjZex7Ic
         gAPH1uwtpwEr60OppAKDe4bb/Bt9+u5VKUj07mkWuMoFaXC6ttkypupLmV4TsLw8VQIh
         EnYDdO8nNfvyIFFfmJ35VLW5CoYMd2WOfl8p+xeo3XKruLYiB/nVU9f3wGye+BSlkZ56
         qJRYzV8Dkx5m+B9NNRMrxvLQTjfgrTukIH/Q61hiOfdRkniYsGUmI7WCQ6cz/Wy7625s
         g+LIA8lhswh+yJr85icLBm5mbP57vKYwTiGy0JYIplR8YF9QTL0Gc2sDNLiQ66ZayIkw
         J6Sw==
X-Gm-Message-State: AOJu0YwImqUsPrUemKE3TWyd3wwfNnpdy6sYg05Pi5WlDwN+fLfnVSE6
	wc2Y1Wn2w+Z9TZBaWICca1lNCa9+4EvUKqlLhbASl6IC8UVnLM1jXFEgAcxAxlBAg5PlswAUx06
	rRECMtN3xLjm8wN9CF/WcSEoPzTjdXOaKOuhE1OK77UevIkBIWOTsjKb705U5AntB1Eyzs589
X-Gm-Gg: AY/fxX4uwPOhQFrXxd13084tvg9SfS+DO6yGCEXrqEjrCbgNH+rh1VQvpRbKG3OgYhv
	JennvOFJOjJ2pzlFZvyHjNKG+QiUiOrgIPYqpgLxYQey5c6txxDm75Y3R8wGLzN4SuBUF3Jt0oB
	pmVV7QR97yURqQGyqdJLsmp9zptSxOMYKw8n3n1uzOe3qFyzxze0MfOPMxFmnz8xZSre0LZaPp7
	TsAZuBA4T5Vm24B9XCQ+bcekKq7/j6I7OoKZb3S3R6+pWTaCjxtOtz0+o1MEwKNIik+EPA9SQrz
	A33i206CrrnxnRdKHwG79ya6nML7vK+lKMf1JleMgFSnwVrPoJwGESs6I3Vw3qSfmuxQbfV3ira
	S+LZpw6MQfBnPu0jSxBHIq+0mcNmKNG8UJa+C5r/L
X-Received: by 2002:a17:902:ce8b:b0:29f:301a:f6cf with SMTP id
 d9443c01a7336-2a7175c30damr484035ad.35.1768494815775;
        Thu, 15 Jan 2026 08:33:35 -0800 (PST)
X-Received: by 2002:a17:902:ce8b:b0:29f:301a:f6cf with SMTP id
 d9443c01a7336-2a7175c30damr483785ad.35.1768494815261;
        Thu, 15 Jan 2026 08:33:35 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.33.33
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:33:35 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 03/27] 11bi: Add wiphy capability flag for (Re)Association
 frame encryption support
Date: Thu, 15 Jan 2026 22:02:42 +0530
Message-Id: <20260115163306.367753-4-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-GUID: u-6e6UfGa8P9ItWmJFMf7NojB_3J5Ayi
X-Proofpoint-ORIG-GUID: u-6e6UfGa8P9ItWmJFMf7NojB_3J5Ayi
X-Authority-Analysis: v=2.4 cv=ANDFHcx+ c=1 sm=1 tr=0 ts=696916e0 cx=c_pps
 a=MTSHoo12Qbhz2p7MsH1ifg==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=YeHZmkfSTWfftN-zYOIA:9 a=GvdueXVYPmCkWapjIL-Q:22
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX2D/0xoENlZ/Q
 pZuUfQ8JtproCtIx5rt9/fD9WXvxvXalIhfV9ZK/d5GkRmQti5HN0rXti7kFzDK9cn0i/XnBaRC
 2NSHuHGnAfS1Aa3FbGndVEif8I2RX5XImQf1OJtXXRJDnf5wrt3S1lL137aGevRUxj6iUa0o/Rz
 zCaCAsEEmZZGC5VrbORDiLcrkQjB0irqC8x2qv4ELRlAF/ubCvf5SOQFIrsdZa+uXb15o+IB4st
 upxtFnFa4pPMGzUvc5OPynWD6N4eHA3pnChGWESvvip0W9h3BwRDs+zwFukUaCwfUrYGp0njnd3
 oMrUVqjaAepTT3sueEi64nNts08V6iGsGfSq2/CFa+L+2Y970D38mzLw87o3ZM39u938IXi/9+K
 gCMXl5IYnQyxd4Vq5cH9R6rONtHn6/e3TV9vTZjSId5A5/9WqnCInAZYJFo5p6y5l5U7jrN9cRR
 Aqs7yAG+CxEEs1HWBhA==
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 impostorscore=0 phishscore=0 clxscore=1015 bulkscore=0 malwarescore=0
 spamscore=0 lowpriorityscore=0 adultscore=0 priorityscore=1501 suspectscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_083338_236051_1275F1B0 
X-CRM114-Status: GOOD (  14.55  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
 Introduce
    a new wiphy capability flag to allow AP/STA to fetch driver support for
 (Re)Association
    request/response frame encryption via the netlink interface
 NL80211_CMD_GET_WIPHY.    
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.0 SPF_PASS               SPF: sender matches SPF record
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

Introduce a new wiphy capability flag to allow AP/STA to
fetch driver support for (Re)Association request/response frame
encryption via the netlink interface NL80211_CMD_GET_WIPHY.

Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
Signed-off-by: Rohan Dutta <drohan@qti.qualcomm.com>
Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/drivers/driver.h              | 2 ++
 src/drivers/driver_nl80211_capa.c | 4 ++++
 2 files changed, 6 insertions(+)

diff --git a/src/drivers/driver.h b/src/drivers/driver.h
index 69f1158f4..172a89aa3 100644
--- a/src/drivers/driver.h
+++ b/src/drivers/driver.h
@@ -2433,6 +2433,8 @@ struct wpa_driver_capa {
 #define WPA_DRIVER_FLAGS2_NON_TRIGGER_BASED_RESPONDER   0x0000000020000000ULL
 /** Driver supports non-trigger based ranging initiator functionality */
 #define WPA_DRIVER_FLAGS2_NON_TRIGGER_BASED_INITIATOR	0x0000000040000000ULL
+/** Driver supports (Re)Association Request/Response frame encryption */
+#define WPA_DRIVER_FLAGS2_ASSOCIATION_FRAME_ENCRYPTION	0x0000000080000000ULL
 
 	u64 flags2;
 
diff --git a/src/drivers/driver_nl80211_capa.c b/src/drivers/driver_nl80211_capa.c
index aed2774dc..7b5b87496 100644
--- a/src/drivers/driver_nl80211_capa.c
+++ b/src/drivers/driver_nl80211_capa.c
@@ -722,6 +722,10 @@ static void wiphy_info_ext_feature_flags(struct wiphy_info_data *info,
 	if (ext_feature_isset(ext_features, len,
 			      NL80211_EXT_FEATURE_SPP_AMSDU_SUPPORT))
 		capa->flags2 |= WPA_DRIVER_FLAGS2_SPP_AMSDU;
+
+	if (ext_feature_isset(ext_features, len,
+			      NL80211_EXT_FEATURE_ASSOC_FRAME_ENCRYPTION))
+		capa->flags2 |= WPA_DRIVER_FLAGS2_ASSOCIATION_FRAME_ENCRYPTION;
 }
 
 

From patchwork Thu Jan 15 16:32:43 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184685
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=EdEpMs3R;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=a/0PjWNO;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=YJZMWa3I;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsT8K2n2Bz1y2g
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:34:09 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=w23nIKWSuiHPl3xPSQcIm159xZiLIEzBkIWJZVzk6gg=; b=EdEpMs3RslmTew
	QrgkC86d462n2PfdepfdcDipmXy9iWw1z8SokLl/YzfQRwZ6Vl9yBUyAjufJGc40GinjztyqgMkg3
	3tSMWq6tk5E/oFgjG7IfB5sfEQU3ahl1v/9uNSWA7bdP7aOn5DDuEdk2gleLl82XUYuFsN+Zkchmp
	g2YJSuKkTxkJkqq5KRn6Dd1VjjXHS7gy7vb6D41fa6Gj9tQSnZVPJUHhLmJoJi+ucosMgg86Al0ki
	erWcGcuavq99BUEsvOm56en3/7pUbtGKn6qGRxrKuq44qjfc7I9+zn2i9P6uAuZ5v3Ziayqw4l5Ym
	KDIeaH2k6beF005HSIcQ==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQI2-0000000ChXK-4371;
	Thu, 15 Jan 2026 16:33:42 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQI0-0000000ChVN-0s4R
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:33:41 +0000
Received: from pps.filterd (m0279871.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFYGnR2866272
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:39 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=kP0XWwGUykO
	IAPhILKBgAQSOvkhp2xSvCy8W4DuqIVk=; b=a/0PjWNO/PFANS+BoqnWdEevWAj
	OzL0yohZM88DthEqMLTq0efVIwZMLJtsCo9o2OGOkdhZVI+7yJDD4ZvFc+jPjQOS
	TcrbGWGzz1oLfCMJ9QjumFQ4R+sXZzyw6alu4MRo3VJjFL9tvIcFjAATUPZpNa3v
	mwq0gpCKbQMRYbSdz43vk6XBBVYvspZBZJBSeNvEkwabxqmogtn3hECGKKTWoAdt
	1elMj/Am+v+CV4s65njR9O9ZHp0VT1CpzYmvBQzlr+Vi3+jKQjgB4E2t05j5ZNv4
	Vxsc9DaiqNL6sT5Fbi0AkHcCW9zmEce1GsfZnxJQ3TXB+6zuCUjZ/4v7uRQ==
Received: from mail-pl1-f197.google.com (mail-pl1-f197.google.com
 [209.85.214.197])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bptu2hp4p-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:39 +0000 (GMT)
Received: by mail-pl1-f197.google.com with SMTP id
 d9443c01a7336-29f25a008dbso7596125ad.1
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:33:39 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494818; x=1769099618;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=kP0XWwGUykOIAPhILKBgAQSOvkhp2xSvCy8W4DuqIVk=;
        b=YJZMWa3I5CJekSeMtjlXgZMgSTHPWfKZQ3fHKlqtFDn/GD3RZ23FBjx/PEYIXtGikj
         RXfmqkDAWHFZuwTMR88MaaUX/YxmkF+6VFGLPn1tP6nBDfjD82+bnUCnCRmmiMjgsyli
         e8A5Fs2uA+pqerraQAVGyEy9fAoM0O/Yz5M+A7u+IjDL7NgYiXQq128V9WNyVE2HiS/e
         niN5JfdlydbMTxeAQFoJ0325F2jlu6b7U6QI/tySo3bfmH0RVoottt4TtAKI7ghIiFnY
         I5Jv2xodXTCz8b+dNdMyk6YwT6GKAawu9gGYuVvj8iaNvwtj9SGSjRXNbpD7oa33Wlqv
         PwOw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494818; x=1769099618;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=kP0XWwGUykOIAPhILKBgAQSOvkhp2xSvCy8W4DuqIVk=;
        b=XN2dm//2TznYYvxK4FJTEUEdZ1Yd+mdBy63XiKg0gAZ0fkCz+NiOFAZY/fQRNu6HwQ
         AE2vCgDE7wx7BPLy4vrWpdlYTbJ4xdAfGZcudXb8PqeeBIGSx04ok8RZERrGIFT4HVql
         d1sYVAzKgm7L5k8RWVpGE8dAPiqQpKKB6XvIGep1/J/NbM4gvcMEF5S/3qLdDhQUVcWm
         WzqJt78tzeXHp9ZR5I+zQz76FbeYVXpkw8+nj4cadEE7FfqxQpDLvisT9+2kewvHqdfu
         VmYkLMOeQC2yEnDtZj+iy4T1jGxGWLomqug3oDq+esNmouVAZA/S3MuXXSG5tXgfHhDs
         60tQ==
X-Gm-Message-State: AOJu0Yx9AG3LJiazd9z5QWqM97w8bOzSC+hhegi4omnTnuebukutp0NF
	pUFwphy9aCCsGiAQZOveVqpVXatCMLmdXcE146GzL8cZeVrClHGbMadLaa+iNxJEJGMcw7fbF/L
	fvChwMni9+zZ/tTdHFabZy6M/THLWlIZsjj3dZsDUVrOiG0YXw1oWtloX/f9nzVRS9Nvbjk0A
X-Gm-Gg: AY/fxX4IhUge7M9udGgoHD63uTnjUuXlWtV9mvpuqW3XhAow+Hb1TkEIm836KulRp8z
	Qn4pKuT8EbZkpObVk8JLjkbk9zMGJzAOoroo8APzqSaTgb4NbB/mArUmKayde2Lo2ZVEDZGmjJZ
	+j9f3gI+4VBIl21SAnHVBs6Yw40QbMdSge+GQNPX2hkpr7Ua4Bx+YUYSwSLHGuL6QXHz683iAVs
	9zvnBW/T0grx7QBxMwrf8EKZa+vNcEVSEINnVw48tKzFFzDx6S22hG7vn5yP7pdJYIq7EDndVJD
	16y54AzOsc71PQ3GwaSdDCIqncd8pML/TUm3fXXB9/ywn9qo0uo7Tqx3OmlQgAjQEhYxZBI8cTX
	2fUHnyPcv6/t7+B3VxxHpxnMnTlyNcU8tHL3WjnuH
X-Received: by 2002:a17:903:fa4:b0:29f:1fad:8e56 with SMTP id
 d9443c01a7336-2a71752af6emr893705ad.6.1768494817945;
        Thu, 15 Jan 2026 08:33:37 -0800 (PST)
X-Received: by 2002:a17:903:fa4:b0:29f:1fad:8e56 with SMTP id
 d9443c01a7336-2a71752af6emr893525ad.6.1768494817442;
        Thu, 15 Jan 2026 08:33:37 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.33.35
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:33:37 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 04/27] PASN: Extend RSNXE capability field to 32 bits
Date: Thu, 15 Jan 2026 22:02:43 +0530
Message-Id: <20260115163306.367753-5-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX7w/66mbUDfK0
 FhGf4coNbi4xyQvwIf9d+NWsBQxvpcWTVFSsCRGacvmT6SyCv0jH+vl2nEXMT0w8VxCZod+BIZQ
 44i7drRh9Nl8m5kY4sWOhpqOnFwjgnUaf2tJKHqs9j26AEU9+HpVrvGiOGwoAPg4qH/25zW6XHh
 Ih/MQ+m9P4+CaQYfAn9Ap0r686ii7tdL5I5kxcUInrTYrm6vJe+UnAt0H5EXexSYU+w2VrLiW2t
 XRQAI9g/CAGRsyzYB4LAqHMl48CupcAnXqxIrMnuxB5zYqDuzUYoxtXrjueg3qUscW1wbd/iSaJ
 cahnJLjAcri7HF/eKULCkWZlbpWWEk0+OzftgTdajEjk3R4kM9ZaUHtOdMjuJUUTBJttICFCXXr
 zFWdKDFn8t17Dl+EX5/wiJzfNLfO195NJj5b8KN//Tm+v1mcggyHAWd+RvDjRjjJBxd+wr+C6xm
 rUvPVWkXM/u6zaVl3gQ==
X-Proofpoint-ORIG-GUID: 1lHkeeIwQMReACqJf2eoQgrt3Wd1LhB-
X-Authority-Analysis: v=2.4 cv=W6Y1lBWk c=1 sm=1 tr=0 ts=696916e3 cx=c_pps
 a=cmESyDAEBpBGqyK7t0alAg==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=SsaMQA-KyUgChBRtuhYA:9 a=1OuFwYUASf3TG4hYMiVC:22
X-Proofpoint-GUID: 1lHkeeIwQMReACqJf2eoQgrt3Wd1LhB-
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 adultscore=0 priorityscore=1501 phishscore=0 suspectscore=0
 lowpriorityscore=0 spamscore=0 impostorscore=0 malwarescore=0 clxscore=1015
 bulkscore=0 classifier=typeunknown authscore=0 authtc= authcc= route=outbound
 adjust=0 reason=mlx scancount=1 engine=8.22.0-2512120000
 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_083340_366166_58445E9E 
X-CRM114-Status: GOOD (  18.33  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  Extend RSNXE capability representation from u16 to u32 to
   support use cases requiring more than 16 bits. Update wpa_pasn_add_rsnxe(),
    pasn_data structure and related APIs to use u32 for rsnxe_capab.
 Signed-off-by:
    Ainy Kumari <ainy.kumari@oss.qualcomm.com> --- src/common/wpa_common.c |
   31 ++++++++++++++++++++++++------- src/common/wpa_common.h | 2 +-
 src/pasn/pasn_common.c
    | 2 +- src/pasn/pasn_co [...]
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.0 SPF_PASS               SPF: sender matches SPF record
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

Extend RSNXE capability representation from u16 to u32 to support
use cases requiring more than 16 bits. Update wpa_pasn_add_rsnxe(),
pasn_data structure and related APIs to use u32 for rsnxe_capab.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/common/wpa_common.c          | 31 ++++++++++++++++++++++++-------
 src/common/wpa_common.h          |  2 +-
 src/pasn/pasn_common.c           |  2 +-
 src/pasn/pasn_common.h           |  4 ++--
 wpa_supplicant/pasn_supplicant.c |  2 +-
 5 files changed, 29 insertions(+), 12 deletions(-)

diff --git a/src/common/wpa_common.c b/src/common/wpa_common.c
index d1a6e86a4..4a32ede9a 100644
--- a/src/common/wpa_common.c
+++ b/src/common/wpa_common.c
@@ -4381,23 +4381,40 @@ int wpa_pasn_parse_parameter_ie(const u8 *data, u8 len, bool from_ap,
 }
 
 
-void wpa_pasn_add_rsnxe(struct wpabuf *buf, u16 capab)
+void wpa_pasn_add_rsnxe(struct wpabuf *buf, u32 capab)
 {
 	size_t flen;
 
-	flen = (capab & 0xff00) ? 2 : 1;
 	if (!capab)
 		return; /* no supported extended RSN capabilities */
+
+	/* Determine how many bytes are needed to represent capab */
+	if (capab & 0xFF000000)
+		flen = 4;
+	else if (capab & 0x00FF0000)
+		flen = 3;
+	else if (capab & 0x0000FF00)
+		flen = 2;
+	else
+		flen = 1;
+
 	if (wpabuf_tailroom(buf) < 2 + flen)
 		return;
-	capab |= flen - 1; /* bit 0-3 = Field length (n - 1) */
+
+	/* Set field length bits (bit 0-3 = Field length (n - 1)) */
+	capab |= (flen - 1);
 
 	wpabuf_put_u8(buf, WLAN_EID_RSNX);
 	wpabuf_put_u8(buf, flen);
-	wpabuf_put_u8(buf, capab & 0x00ff);
-	capab >>= 8;
-	if (capab)
-		wpabuf_put_u8(buf, capab);
+
+	/* Write the capability field byte-by-byte (little-endian) */
+	wpabuf_put_u8(buf, capab & 0x000000FF);
+	if (flen > 1)
+		wpabuf_put_u8(buf, (capab >> 8) & 0x000000FF);
+	if (flen > 2)
+		wpabuf_put_u8(buf, (capab >> 16) & 0x000000FF);
+	if (flen > 3)
+		wpabuf_put_u8(buf, (capab >> 24) & 0x000000FF);
 }
 
 
diff --git a/src/common/wpa_common.h b/src/common/wpa_common.h
index 255f5b0c7..a3b4d4df9 100644
--- a/src/common/wpa_common.h
+++ b/src/common/wpa_common.h
@@ -812,7 +812,7 @@ int wpa_pasn_validate_rsne(const struct wpa_ie_data *data);
 int wpa_pasn_parse_parameter_ie(const u8 *data, u8 len, bool from_ap,
 				struct wpa_pasn_params_data *pasn_params);
 
-void wpa_pasn_add_rsnxe(struct wpabuf *buf, u16 capab);
+void wpa_pasn_add_rsnxe(struct wpabuf *buf, u32 capab);
 int wpa_pasn_add_extra_ies(struct wpabuf *buf, const u8 *extra_ies, size_t len);
 
 void rsn_set_snonce_cookie(u8 *snonce);
diff --git a/src/pasn/pasn_common.c b/src/pasn/pasn_common.c
index ef8649b08..11916bd18 100644
--- a/src/pasn/pasn_common.c
+++ b/src/pasn/pasn_common.c
@@ -153,7 +153,7 @@ void pasn_set_rsn_pairwise(struct pasn_data *pasn, int rsn_pairwise)
 }
 
 
-void pasn_set_rsnxe_caps(struct pasn_data *pasn, u16 rsnxe_capab)
+void pasn_set_rsnxe_caps(struct pasn_data *pasn, u32 rsnxe_capab)
 {
 	if (!pasn)
 		return;
diff --git a/src/pasn/pasn_common.h b/src/pasn/pasn_common.h
index ded679a4d..58e11e44b 100644
--- a/src/pasn/pasn_common.h
+++ b/src/pasn/pasn_common.h
@@ -58,7 +58,7 @@ struct pasn_data {
 	const char *password;
 	int wpa_key_mgmt;
 	int rsn_pairwise;
-	u16 rsnxe_capab;
+	u32 rsnxe_capab;
 	u8 *rsnxe_ie;
 	bool custom_pmkid_valid;
 	u8 custom_pmkid[PMKID_LEN];
@@ -236,7 +236,7 @@ void pasn_set_noauth(struct pasn_data *pasn, bool noauth);
 void pasn_set_password(struct pasn_data *pasn, const char *password);
 void pasn_set_wpa_key_mgmt(struct pasn_data *pasn, int key_mgmt);
 void pasn_set_rsn_pairwise(struct pasn_data *pasn, int rsn_pairwise);
-void pasn_set_rsnxe_caps(struct pasn_data *pasn, u16 rsnxe_capab);
+void pasn_set_rsnxe_caps(struct pasn_data *pasn, u32 rsnxe_capab);
 void pasn_set_rsnxe_ie(struct pasn_data *pasn, const u8 *rsnxe_ie);
 void pasn_set_custom_pmkid(struct pasn_data *pasn, const u8 *pmkid);
 int pasn_set_extra_ies(struct pasn_data *pasn, const u8 *extra_ies,
diff --git a/wpa_supplicant/pasn_supplicant.c b/wpa_supplicant/pasn_supplicant.c
index 9d93aedbf..392ad1b08 100644
--- a/wpa_supplicant/pasn_supplicant.c
+++ b/wpa_supplicant/pasn_supplicant.c
@@ -624,7 +624,7 @@ static void wpas_pasn_auth_start_cb(struct wpa_radio_work *work, int deinit)
 	const u8 *indic;
 	u16 fils_info;
 #endif /* CONFIG_FILS */
-	u16 capab = 0;
+	u32 capab = 0;
 	bool derive_kdk;
 	int ret;
 

From patchwork Thu Jan 15 16:32:44 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184686
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=O+02R7W8;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=HVYZ4nzj;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=TXQODGqj;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsT8K55LMz1y5T
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:34:09 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=+Jtjd6Z65qyLP9lBVdK5Q7COF9UPIGvDglu6V1YWHAs=; b=O+02R7W8QzdIso
	dqnPLVK3YBFnuOT0ONHUUy1GdW8rRwzSQMenHAQoeKAGFgCHNV7nMUw/Zjg3FN8J90ypwG4JR7IaE
	pVESXlWh8Y/mt1KMkO4Q9D5Cqu7TQ8xh45+F87/RVtYe9dftbZiPg3OUvTzzT88IMC+JTwJO2jawm
	VU/TuE3TUx1z8FjKXkC3KIn8bkRahzHOv6mvaoxPUmvyxZ8IS1ESvmtdzJhXQutnKUFxO6TdkAAD8
	VWCQDF7TkoXB9iOmOOYhWEC5y/aUo5Zp/QkxuDqgi/VCkn/fushMz2WJFsZl+mIkrQq5kobOL3W89
	L1dsKRj03XMNArLNNqfg==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQI4-0000000ChXp-1SYu;
	Thu, 15 Jan 2026 16:33:44 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQI2-0000000ChVz-0LX7
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:33:43 +0000
Received: from pps.filterd (m0279868.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFYIi22174630
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:41 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=KKYtZ8EVZDV
	WT/xjsGW+G/FK8vxtbnAL42kiMrAMMnI=; b=HVYZ4nzjstnd55b4gbAWYKd8wT7
	tgIQGq1DetjFjReDhkGZWgPocLo/Z/Ti7iaG4FWGjYyFgW/UaU+ObMuwmoBwr2BH
	WAiwDSfG1JoRbMERz8d3sKUD0F3nlr1mUh6TG0Uoyr0QRlMLu/ue6f4f4WKzrJ5O
	6X+p/g2+PLgL/rv/Xh2LJr8OY90wfAzGirALUQ6FebzjHn2ANSc3weEeVwtWIAv+
	src3xno5V3cyqyDqTnf0KcGoObiBN0BcGXUMgA4uR/2ion4JEQayv50y5eKT/tvK
	nrsPlFgegrKiwXbKF9smGDH90nuM32yPTvxaynVftNHXjww7j4YfT/vwqhQ==
Received: from mail-pl1-f199.google.com (mail-pl1-f199.google.com
 [209.85.214.199])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bq1xh8ec4-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:41 +0000 (GMT)
Received: by mail-pl1-f199.google.com with SMTP id
 d9443c01a7336-2a0e9e0fd49so20119425ad.0
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:33:40 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494820; x=1769099620;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=KKYtZ8EVZDVWT/xjsGW+G/FK8vxtbnAL42kiMrAMMnI=;
        b=TXQODGqjlEJNkZ6h1VEKS+IXFrJ9KC84k1wiTAARKxk/6q22oc2bgydcl+pBEisMpy
         1TaG2UzgyfY8brqDmgg4bNu7v0Q0zaWZuGBkt8Hs4Jgizy1ZGP49rLtHkFmeGgPvbBVW
         7If862uv/zZk/XIXcqogU67KSzf7h5BkleTzDQtogYB3KSEYc1oQIJFFgFFmiics5ZQG
         UkpnQz3iFhRSCPYGYFC+FiIjUNSom4rSnZKR00JmiB3REdwZGFT2aW2O/vLmHbswmaty
         +NML8AXyvdVpotGARST8X0tUrQemnmrxvUPqgl7eBOca2Y9UZ6WT37pPsEE2G9H5Iv+u
         H72Q==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494820; x=1769099620;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=KKYtZ8EVZDVWT/xjsGW+G/FK8vxtbnAL42kiMrAMMnI=;
        b=qLHkXNTo/kYz+TdiTFMHknTkk4gdvYLTM9X97CnPbNIIn926B/orlf3fns3Fk557zp
         J5gUX00eXRFQvUKrJ19cDrhczc15Z/1nPwxp57RpSfTRrGZqbFc+7f0+1F5aoHeoUXhx
         oVSfQl22KTTtqXYBSJbJY28fohVSPWGjr3MkHw3GF+ezUa0CltQ/v2iM3/6Hvirn94eX
         1diEmQFR+kW+44aCR+nPor2NpGUP31K0LfVk6A5EGmu9/xlyHs5MZb/aPo1iCTFB7so4
         ZcGVYTlKwliQyoy/1X5uY5UJdn6K1RJMiuURJXatAH0aeWAqYBwA9db9doReOkVNZrZo
         hNMg==
X-Gm-Message-State: AOJu0YwfmwonAk+W5qIPVfoVHvL9ZwrjoZQ2D7otZg+RjS75bk3cZtBP
	3/hWz/O7EnQGCTy8soHr3e0/xYI1SOnP6bFFF2/hALqem3hUpk7paEzR5Oz2dPiTclgIRVNieYg
	LF/gqnCwX3icbpL4NTLeXA2tyeHhRdV3/R2boDnIrq/Om62ndKeJ8AsSD5LZ422VOayy3Dqmk
X-Gm-Gg: AY/fxX65VgvmiKoe/BGCktE2LqiV/RC/MxbZtzyjZFbT5cARQp78YDgK2xf6MoCjUL5
	mJM2GpJrXGn9YEGnFBdCID4Ai03vsOG+VxuezwMmfBgDImgXe7ewbc0pRZ6JUTnp0E1SPbYv6mG
	onLrNMRWWSRbJfcoApacXhIIy5od3iLZiUlXNo1pSefCEB15+GeJ7MBl4N7rqjMgRbDvfseg4BF
	XRAxHuSSoveWDNCjzAHZuOz+hJDEFd9rqMnYIpmKnbEfKy4u171tWReVxEWTqyHBHLJFpnnwqXB
	GCTaYKI99RjAy2cOEbMKkvlDQeUnDxJCZFcxBMMdkGMJyr8d3g3f58aAEjWvKh4GzcmMu7xa2FT
	jOkJt5TT2MaOxQGDGYy4xWI3hSBo9KzxBNM0f0mPO
X-Received: by 2002:a17:902:ea09:b0:29f:2734:837d with SMTP id
 d9443c01a7336-2a700a51209mr35858065ad.28.1768494819973;
        Thu, 15 Jan 2026 08:33:39 -0800 (PST)
X-Received: by 2002:a17:902:ea09:b0:29f:2734:837d with SMTP id
 d9443c01a7336-2a700a51209mr35857885ad.28.1768494819485;
        Thu, 15 Jan 2026 08:33:39 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.33.37
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:33:39 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 05/27] EPPKE: Add wiphy capability flag for EPPKE
 authentication
Date: Thu, 15 Jan 2026 22:02:44 +0530
Message-Id: <20260115163306.367753-6-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-ORIG-GUID: S6xYgBKCy3pItAHNlsOL8P_ip7esZpWr
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX43d71hHdxpMd
 GxaDCyFlcI2C0LUFbDHUG3yPZjIMjoxpIfYORujhJgNMkwBiyQB15v4q+EeSY3sKC8PblreYOiY
 W4BTb0ZnN/J8c3bs+Hg5NzqK6Ae4cy/KwTkda3rN83n9X1UXGBBZjaI2875Z3K1Wn61RKrE/Z/S
 vNwfHQeYQ3D72XXz7VXIW+lnTfelE5ag7rVCGG6WIxyq+Hk93p8YPNH5rGtkP+ABKs41rj8fops
 xWskQmO3m9BjMp3182wOdjO+Ye4FwY52vVZT4MdyFlODhah+b77ejnmdxMYUQyj2ll++Ni9rVYd
 BCbBfrxJKExIJIAlCb8dwdYDUug7zNry0bIARWkfPeOcpmKhqORdk9Sn1y3J3XZxK2v9Vp8uY+C
 Bw98WNY0B1CY8UOAHg4dsjZv2zYhKf/hX3nqLJqUJWVFx1yaaqOzHIE9BJbTpJwqHkN9lJOSn27
 6Fg932BxcO7Vnmy8XWQ==
X-Authority-Analysis: v=2.4 cv=TdWbdBQh c=1 sm=1 tr=0 ts=696916e5 cx=c_pps
 a=JL+w9abYAAE89/QcEU+0QA==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=y_t11D8O1H_K84lGlygA:9 a=324X-CrmTo6CU4MGRt3R:22
X-Proofpoint-GUID: S6xYgBKCy3pItAHNlsOL8P_ip7esZpWr
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 clxscore=1015 phishscore=0 lowpriorityscore=0 impostorscore=0 malwarescore=0
 bulkscore=0 priorityscore=1501 adultscore=0 spamscore=0 suspectscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_083342_242777_C406B5D1 
X-CRM114-Status: GOOD (  13.82  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  Introduce a wiphy capability flag to allow the supplicant
   to query EPPKE authentication support in STA mode via NL80211_CMD_GET_WIPHY
    netlink interface. Signed-off-by: Ainy Kumari
 <ainy.kumari@oss.qualcomm.com>
    --- src/drivers/driver.h | 3 +++ src/drivers/driver_nl80211_capa.c | 5
 +++++
    2 files changed, 8 insertions(+)
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.0 SPF_PASS               SPF: sender matches SPF record
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

Introduce a wiphy capability flag to allow the supplicant
to query EPPKE authentication support in STA mode via
NL80211_CMD_GET_WIPHY netlink interface.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/drivers/driver.h              | 3 +++
 src/drivers/driver_nl80211_capa.c | 5 +++++
 2 files changed, 8 insertions(+)

diff --git a/src/drivers/driver.h b/src/drivers/driver.h
index 172a89aa3..2ed0282eb 100644
--- a/src/drivers/driver.h
+++ b/src/drivers/driver.h
@@ -2435,6 +2435,9 @@ struct wpa_driver_capa {
 #define WPA_DRIVER_FLAGS2_NON_TRIGGER_BASED_INITIATOR	0x0000000040000000ULL
 /** Driver supports (Re)Association Request/Response frame encryption */
 #define WPA_DRIVER_FLAGS2_ASSOCIATION_FRAME_ENCRYPTION	0x0000000080000000ULL
+/** Driver supports EPPKE authentication */
+#define WPA_DRIVER_FLAGS2_EPPKE				0x0000000100000000ULL
+
 
 	u64 flags2;
 
diff --git a/src/drivers/driver_nl80211_capa.c b/src/drivers/driver_nl80211_capa.c
index 7b5b87496..e1afeb715 100644
--- a/src/drivers/driver_nl80211_capa.c
+++ b/src/drivers/driver_nl80211_capa.c
@@ -726,6 +726,11 @@ static void wiphy_info_ext_feature_flags(struct wiphy_info_data *info,
 	if (ext_feature_isset(ext_features, len,
 			      NL80211_EXT_FEATURE_ASSOC_FRAME_ENCRYPTION))
 		capa->flags2 |= WPA_DRIVER_FLAGS2_ASSOCIATION_FRAME_ENCRYPTION;
+
+	if (ext_feature_isset(ext_features, len, NL80211_EXT_FEATURE_EPPKE)) {
+		capa->flags2 |= WPA_DRIVER_FLAGS2_EPPKE;
+		capa->flags2 |= WPA_DRIVER_FLAGS2_ASSOCIATION_FRAME_ENCRYPTION;
+	}
 }
 
 

From patchwork Thu Jan 15 16:32:45 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184690
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=iKs7dOsG;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=FU+u6zEV;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=cAJTx/Ga;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsT8T3Lt4z1xt4
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:34:17 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=Hs+Qz26KGay3LpHsqyRTMteIHSd2js+YybuAOCLy1RA=; b=iKs7dOsGI+b4Y6
	1e615Wq5OGRZn5b+oN+qS3lJGhQmmIl2EE2Xtb15WvRVe7u2vezy2wEX/AzsiAsK3qbJ5hCiypLFP
	D8rSsdM4B2BkF+g1GiiHAQcrocRuuwAqZxonmNAnleAsi5s58bkEWYHedeQcPy+esrrvy3HRuZCzC
	wBUPJfcV7Gi6d3Oa3/esP70D+1tDd2VSm/xLPFnOepIzXMSTywxYoUFDGFPpoh632FvqfBOuWrn4V
	UTlfDKqPxyWlg+nxF4mVxbwl7Pn7SsE7PPQd70XGbwsW+gtDABUZcVdaF+4AF//yQAfhlMhhwXT7r
	f5KUCip8bpI+hB1a6N5g==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQI7-0000000ChZw-1o8g;
	Thu, 15 Jan 2026 16:33:47 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQI4-0000000ChXj-1W8g
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:33:45 +0000
Received: from pps.filterd (m0279869.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFYZng3113650
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:43 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=GqNZ/4vVAq+
	e9vZsoWnLKtwdU8A723zXqpDYi+zocBU=; b=FU+u6zEV7SazYZRWpGtvO/kMKJA
	3Bae5T8TjdTxsEQJ1Fw5DB1QSAhfwobyE9FmTGbtmT8SI6YZMrzMCUY/oaCBm+lR
	V5N6wnaguwxhiM5LS6KmrS0M/Lt2XqhQ4wyFl5ErByvE/jviDoPbIgt+LEFmIRUV
	UMreFJ91abXB8bQHZt0sIj/harmOmjCZ8KH8hWnXAGVzrp+XXirQys8gUa0EeT5M
	KmHyX/7Oluqn149YM0zaS5BHp0lHtgX0Nf/GVYHF0WjFoiVkwABJMFyl9TcGPYyj
	epUIUOkc0uGauAHDJ/s1EtTGzUYooN68mQIZVxiNZ0Z4SJj6n+WOP+DGIwA==
Received: from mail-pl1-f197.google.com (mail-pl1-f197.google.com
 [209.85.214.197])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bq2pm0838-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:43 +0000 (GMT)
Received: by mail-pl1-f197.google.com with SMTP id
 d9443c01a7336-2a58c1c74a3so8668955ad.2
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:33:43 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494822; x=1769099622;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=GqNZ/4vVAq+e9vZsoWnLKtwdU8A723zXqpDYi+zocBU=;
        b=cAJTx/GancxrYiO8IzaQGhPDVtQdshNHsOeJkXVGk9zJM4AQ2fSsyurhOrJAoqMFcC
         4oaot5lKTiT97wD9GAeEb0nI2yoW8eR3HANXS6m97ISyenY/Z6FQXj+cTbCKXiAET7aM
         Kjfeawe9mx+R0DOMxfn+TJUSrBP8iGGAu0G8bS0WD7DZsMPtZ3QXOCwxF3jigM5VaGBX
         OKCWNjNfoG/AWiPr27hscHPPhWPDunzi4Doro3DZ6mkVcLDBiV8APojldF0xClL/eWpx
         NJbZnzUQD4Lr6Oi/BQ2ngymNwnQDha+JYQotGnwaYSWnq6PCjzjAQx0bXXoWbzeyyS/D
         uc+A==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494822; x=1769099622;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=GqNZ/4vVAq+e9vZsoWnLKtwdU8A723zXqpDYi+zocBU=;
        b=xSBAxsWNwHDkrFRbBFMOzn4iPBlQTPg4kYcqco0Kq9OMt0f7FCLZfa0/1CERwnn3ZD
         yhiCpmdsEKL/wN9qh7QWFeJWHpBHUv+CVv3IJ7wixNh12zRubcLUuqlnacZX9MMWUD1E
         KL+rp1Pd0hjtChpiOyIjQFWe6LT47z84dp9WwS5Jib+Usu3aMIfU/3skPQjX5XwHQpi/
         bpcpCIwNrSX+G+KqPMumqU3zW5NSZ2NINSai6fhsJr8kA1mb9wjrcz9OUxGizEaTvMhG
         fyBjWmGEHTQK5n2oPohE65nLyfa41Jz20b53beoFAoqwWgUAfxBr5a9SIxHgMEYnjC0k
         PBTg==
X-Gm-Message-State: AOJu0YzLWh6gu74ZYWs98+fri+WPwrGY7aQ1EixgKnWdQKhz7HSnZZ/Z
	P9LAM8Ppvf2LQzCCMyfV6+7mc2AVSUNr9t/U8rLEv0ibepQtYQBPooEXeI2PbwrqI0ScGsb09Xe
	IIgApURTaVNfWrNe1SkN+xQXerFEIDS8T0PRrEgWW8q4ohZJb1PE3c/jD/VT+UEBqdF9Wkw4k
X-Gm-Gg: AY/fxX5hZtZuJovzA1fajIiUOaN44OK/gKeAJEoCJdP0WcGpazloFC+Mxt/6kQnIOyd
	QV0HGsUjDLeQoza33DMGSA7vwrgi3uX6yy33F74GDfFC+s95D1LYK7IjZi6yTC4toOKA9ah3QqG
	DngH6/qhLnae1QYc5/a4laTidf4uKcMBENl6QR3A49nDY/dhronAmIpZ+aqvw9ctQPe/hTCMKCx
	XTnAJ3TnCthCR+5YXApSYVTkc9Hpw5Hx5gWHI7K9CPiwj2XliJmia6WCoAieXWyA+HksubV9K5i
	CzDVrJec0wYqoYC8pwsMcUGW8dBsdVivWi+3uXDDqONMMP7NLDVCrzjoJNfMBg8KV1DVoMdXlBe
	E9hMUDOKdWSgsu4lXNCP63URjiQovNAGQjjOYT1xi
X-Received: by 2002:a17:902:ce0d:b0:298:55c8:eb8d with SMTP id
 d9443c01a7336-2a7176c5627mr694905ad.35.1768494822307;
        Thu, 15 Jan 2026 08:33:42 -0800 (PST)
X-Received: by 2002:a17:902:ce0d:b0:298:55c8:eb8d with SMTP id
 d9443c01a7336-2a7176c5627mr694605ad.35.1768494821800;
        Thu, 15 Jan 2026 08:33:41 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.33.39
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:33:41 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 06/27] 11bi: Enhanced Privacy Protection (EPP) related
 definitions
Date: Thu, 15 Jan 2026 22:02:45 +0530
Message-Id: <20260115163306.367753-7-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-GUID: D2In06Hdi53wx4t-O-aUziyh6FZqPgOT
X-Authority-Analysis: v=2.4 cv=TNlIilla c=1 sm=1 tr=0 ts=696916e7 cx=c_pps
 a=cmESyDAEBpBGqyK7t0alAg==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=eaxH8IqBzdGlCjipp8sA:9 a=1OuFwYUASf3TG4hYMiVC:22
X-Proofpoint-ORIG-GUID: D2In06Hdi53wx4t-O-aUziyh6FZqPgOT
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX9+HK4W3fkZAJ
 xtFlDq9biFTkRIv5Yd1u/HV4ib0de+rq7iYF++3A4ABHkd7lpBUNxPSJud0nG7Jv5RrS7nOlHAa
 INUtV5Q7F7fUAmZDrxm/N1CIQXDPckQgY/KHCK86rxN67azuex0yxjPF0C2AUJxeLeAySg9N0UX
 uU6WzHTNPYbyvrSCxPaqemgl02JAoCf4mVV0lKNExNwJU0ouuAWUEsJjjNRLXTFgvuEksmPmHIH
 n5BWfuKCHDNHWtq5UQH36JDrb++RAp9MSBVifeoKlGVQfn7bQUpdpB9kPfa9o3g+Asg46bXqhGo
 xzuAisv7AifKaorQdjSc6uTHMnWeYc5BUMWB96DnM5xiBkKrC0kGQYBtctfk784rKDx2HS7Wd68
 Lras5RlPjt+fDe7CEF8AhwAWwUAvO/+R3MVuRSIrtXeupVBXLXUxipmiydLOVO/AHpgThhz832F
 aqmcw3pppJoQW6dxPCA==
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 malwarescore=0 bulkscore=0 spamscore=0 priorityscore=1501 suspectscore=0
 impostorscore=0 lowpriorityscore=0 clxscore=1015 adultscore=0 phishscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_083344_534037_74312C83 
X-CRM114-Status: GOOD (  15.23  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com> As a
 preparation
    to support EPPKE authentication,
 add additional definitions required to support
    the flow. The definitions pertain to the following features introduced in
    draft IEEE P802.11bi/D2.0: -( [...]
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.0 SPF_PASS               SPF: sender matches SPF record
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

As a preparation to support EPPKE authentication,
add additional definitions required to support the flow.
The definitions pertain to the following features
introduced in draft IEEE P802.11bi/D2.0:
-(Re)Association Request/Response frame Encryption
-IEEE802.1x (EAP) Utilizing Authentication farmes
-PMKSA Caching privacy

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
Signed-off-by: Rohan Dutta <drohan@qti.qualcomm.com>
Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
---
 src/common/defs.h            | 7 +++++++
 src/common/ieee802_11_defs.h | 5 +++++
 src/common/wpa_common.c      | 6 ++++++
 src/common/wpa_common.h      | 1 +
 src/drivers/driver_nl80211.c | 2 ++
 5 files changed, 21 insertions(+)

diff --git a/src/common/defs.h b/src/common/defs.h
index 0a79ba2a6..eb410386a 100644
--- a/src/common/defs.h
+++ b/src/common/defs.h
@@ -52,6 +52,7 @@
 #define WPA_KEY_MGMT_SAE_EXT_KEY BIT(26)
 #define WPA_KEY_MGMT_FT_SAE_EXT_KEY BIT(27)
 #define WPA_KEY_MGMT_IEEE8021X_SHA384 BIT(28)
+#define WPA_KEY_MGMT_EPPKE BIT(29)
 
 
 #define WPA_KEY_MGMT_FT (WPA_KEY_MGMT_FT_PSK | \
@@ -210,12 +211,18 @@ static inline int wpa_key_mgmt_cross_akm(int akm)
 #define WPA_AUTH_ALG_SAE BIT(4)
 #define WPA_AUTH_ALG_FILS BIT(5)
 #define WPA_AUTH_ALG_FILS_SK_PFS BIT(6)
+#define WPA_AUTH_ALG_EPPKE BIT(10)
 
 static inline int wpa_auth_alg_fils(int alg)
 {
 	return !!(alg & (WPA_AUTH_ALG_FILS | WPA_AUTH_ALG_FILS_SK_PFS));
 }
 
+static inline int wpa_auth_alg_eppke(int alg)
+{
+	return !!(alg & WPA_AUTH_ALG_EPPKE);
+}
+
 enum wpa_alg {
 	WPA_ALG_NONE,
 	WPA_ALG_WEP,
diff --git a/src/common/ieee802_11_defs.h b/src/common/ieee802_11_defs.h
index 1b964439b..35e7852ec 100644
--- a/src/common/ieee802_11_defs.h
+++ b/src/common/ieee802_11_defs.h
@@ -98,6 +98,8 @@
 #define WLAN_AUTH_FILS_SK_PFS		5
 #define WLAN_AUTH_FILS_PK		6
 #define WLAN_AUTH_PASN			7
+#define WLAN_AUTH_1X_UTILIZING_AUTHENTICATION_FRAMES     8
+#define WLAN_AUTH_EPPKE			9
 #define WLAN_AUTH_LEAP			128
 
 /* Authentication transaction sequence number */
@@ -633,6 +635,9 @@
 #define WLAN_RSNX_CAPAB_URNM_MFPR 15
 #define WLAN_RSNX_CAPAB_KEK_IN_PASN 18
 #define WLAN_RSNX_CAPAB_SSID_PROTECTION 21
+#define WLAN_RSNX_CAPAB_ASSOC_FRAME_ENCRYPTION 27
+#define WLAN_RSNX_CAPAB_1X_UTILIZING_AUTHENTICATION_FRAMES 28
+#define WLAN_RSNX_CAPAB_PMKSA_CACHING_PRIVACY 29
 #define WLAN_RSNX_CAPAB_SAE_PW_ID_CHANGE 34
 
 /* Multiple BSSID element subelements */
diff --git a/src/common/wpa_common.c b/src/common/wpa_common.c
index 4a32ede9a..9bf675984 100644
--- a/src/common/wpa_common.c
+++ b/src/common/wpa_common.c
@@ -217,6 +217,8 @@ int rsn_key_mgmt_to_wpa_akm(u32 akm_suite)
 	case RSN_AUTH_KEY_MGMT_PASN:
 		return WPA_KEY_MGMT_PASN;
 #endif /* CONFIG_PASN */
+	case RSN_AUTH_KEY_MGMT_EPPKE:
+		return WPA_KEY_MGMT_EPPKE;
 	default:
 		return 0;
 	}
@@ -2910,6 +2912,8 @@ const char * wpa_key_mgmt_txt(int key_mgmt, int proto)
 		return "PASN";
 	case WPA_KEY_MGMT_IEEE8021X_SHA384:
 		return "WPA2-EAP-SHA384";
+	case WPA_KEY_MGMT_EPPKE:
+		return "EPPKE";
 	default:
 		return "UNKNOWN";
 	}
@@ -2964,6 +2968,8 @@ u32 wpa_akm_to_suite(int akm)
 	if (akm & WPA_KEY_MGMT_PASN)
 		return RSN_AUTH_KEY_MGMT_PASN;
 #endif /* CONFIG_PASN */
+	if (akm & WPA_KEY_MGMT_EPPKE)
+		return RSN_AUTH_KEY_MGMT_EPPKE;
 	return 0;
 }
 
diff --git a/src/common/wpa_common.h b/src/common/wpa_common.h
index a3b4d4df9..8a3f23872 100644
--- a/src/common/wpa_common.h
+++ b/src/common/wpa_common.h
@@ -98,6 +98,7 @@ WPA_CIPHER_BIP_CMAC_256)
 #define RSN_AUTH_KEY_MGMT_802_1X_SHA384 RSN_SELECTOR(0x00, 0x0f, 0xac, 23)
 #define RSN_AUTH_KEY_MGMT_SAE_EXT_KEY RSN_SELECTOR(0x00, 0x0f, 0xac, 24)
 #define RSN_AUTH_KEY_MGMT_FT_SAE_EXT_KEY RSN_SELECTOR(0x00, 0x0f, 0xac, 25)
+#define RSN_AUTH_KEY_MGMT_EPPKE RSN_SELECTOR(0x00, 0x0f, 0xac, 29)
 
 #define RSN_AUTH_KEY_MGMT_CCKM RSN_SELECTOR(0x00, 0x40, 0x96, 0x00)
 #define RSN_AUTH_KEY_MGMT_DPP RSN_SELECTOR(0x50, 0x6f, 0x9a, 0x02)
diff --git a/src/drivers/driver_nl80211.c b/src/drivers/driver_nl80211.c
index 24516637e..30433548e 100644
--- a/src/drivers/driver_nl80211.c
+++ b/src/drivers/driver_nl80211.c
@@ -4278,6 +4278,8 @@ static enum nl80211_auth_type get_nl_auth_type(int wpa_auth_alg)
 		return NL80211_AUTHTYPE_FILS_SK;
 	if (wpa_auth_alg & WPA_AUTH_ALG_FILS_SK_PFS)
 		return NL80211_AUTHTYPE_FILS_SK_PFS;
+	if (wpa_auth_alg & WPA_AUTH_ALG_EPPKE)
+		return NL80211_AUTHTYPE_EPPKE;
 
 	return NL80211_AUTHTYPE_MAX + 1;
 }

From patchwork Thu Jan 15 16:32:46 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184691
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=CIo397nw;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=aXDRSCgi;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=YpxRTI99;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsT8Y4YFFz1xt4
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:34:21 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=1gX6ioi4fLIDbn5JVbdXu6+HiBOrmu0kfwQl14+4Ndk=; b=CIo397nwKWV6Yt
	D9Pz108bkBmcPGQtLFYYG+ao1r9jF91sJePp4ndLT6QfrVfynS9kVyAUr3VkDfVmI2s98G0D334fP
	42g6Cno63kPoKG8i+teYjloq0I5bilkzWa3mQCkpoTA6WbkaN7tfUlYikV1X804JftrNTqeTn0sbZ
	kiMBVTbdCy316TWUd2pq5Kq2BTh1qisaSOeosEyddiaQg+rMExPmAEoGypTLttYBr5uRH06/1rdrf
	Pbg055PPGqnBrzAHmKDaIfp94TS8PohqSo1tjiMjLYva3aRoYN259/qTAxu7JrckG4OlSMZiN5uJs
	PFh36icg2bLUQnf4m4lQ==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQI8-0000000Chb6-3Mul;
	Thu, 15 Jan 2026 16:33:48 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQI6-0000000ChZI-3Shn
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:33:48 +0000
Received: from pps.filterd (m0279869.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFYFop3113470
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:46 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=WkVfzp6lmTo
	dtXh4cgQKSGxCP1I7/uJJTEreQZwkS94=; b=aXDRSCgiRRdrcr/n98SDZoVje8d
	XYVJKOGCZmGCRhpz3olGQvTVQ5tzhyoaZ7hgq60hNbw1fAVhBGWBRoWo8xhERGzc
	PEgGVbYkSRIhjsrNHX1R2vu1s73jHx6xP3RfqX/IoPJSIJFa/u0UEXoM68nBfi1k
	RDhfSrGjb5mRXhVu9tswPNnaoT/C75NAqFCD+PLEb5kzwyUf4AWxfzHf2wLmXvpk
	je/kpf4FlViRhx1rTVTX/vW0lGm4hi4kC+ZPO1vds1QTe6/dUZ7xou3KA8hnJaUq
	zrrgpLv2aTdW+YGo01VEbmvDtVeHHSfg8tkMOLlyw2VhlzTvZXDPUS7X7Ug==
Received: from mail-pl1-f200.google.com (mail-pl1-f200.google.com
 [209.85.214.200])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bq2pm083c-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:45 +0000 (GMT)
Received: by mail-pl1-f200.google.com with SMTP id
 d9443c01a7336-29f26fc6476so18939975ad.1
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:33:45 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494824; x=1769099624;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=WkVfzp6lmTodtXh4cgQKSGxCP1I7/uJJTEreQZwkS94=;
        b=YpxRTI99PRr4uE0MQ82NgxWPPvJvFcJ44DwGb2jWyF85uVz+R+IRKqg8QOjBAFYrJ3
         4altcJ9QGIRB/zs+MeLZskXymJikuXxWYTAd3Z60mTlPJl1E+ec3FJX3yjdrm6M1mYv0
         0ycRI29o0yPVatAHZ+rdOBfLCngMolJvBCNzi2cwSfKbpXfgkXfwat6EWNVzvr1R9JQx
         niUnl+310nQ+29PNVGjqygLYhjNQyMSQlKq1kXAqCoGFwRMYukzafRd/iCAAeovGgzCv
         yao9or7F0FaqIrE1S2n3k1lCODEv62Y6F5ee0g6AF7d2j2nzsb6VGGdKlj6wBpugiYc+
         DCUw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494824; x=1769099624;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=WkVfzp6lmTodtXh4cgQKSGxCP1I7/uJJTEreQZwkS94=;
        b=TuR13tAI01cgcV5ZMYgweTS5x8E5QVf+s7v5Lg4Xa3LaeAG9RLQtiNjApN2OujpIVu
         PEOxvubG9HRqO7FNC5gxZL7yg987ANbex90tBkMwCdhCP9IXnia7KRrN+T1tUaLAjwhp
         mSjU3fEiv14eb0Dk37wjKtXkuPxveWbEHQZOGlateTVe0BagWddnNnttlH7pxnmBcyt7
         M1oqaauldbqub7wJFuamIrd5crp1WtOG+pZVcbETeRt6ds11Aknj6X0QU4cPT3u8cLi/
         +8qGIixj88Xofw7zxvmihwca7AP1QEIZFRBAsY0fR0kvePUXhUI2n9/D9s0aZyZknte8
         ImLg==
X-Gm-Message-State: AOJu0Yx3gBfeOP1ovnf7IG9Xc3ixy/sM+vO838IX00mQauFd6Y1CF8HP
	QY2QVInuAfrMo5NcA44DOjO3L3z9P5gBFih0kNuWQiTHKg9Uurm9M7nNF1KUvB50QHHwdRU9/lw
	IREpWQEs1/MdMCdWbTLYtrWoqnrnO8Gzs8naR75j9w+GmmSG0kuY59Jg1p6dg8cyyAXx8Gnya
X-Gm-Gg: AY/fxX4oxrC9PGvnymoA0nUPwLlH3CIM/1+fLMeZdMcV7pIvyCq3HjBmKShXUvAsn5c
	wv3pNPNxrkEvuCRMXOUONxqP9Lnd3QSeAmcLynSAgmCS3jgsA1mQQq6NIDqbV6vWJ6c42Bf5oJ+
	EGj3m/zrowhLO+bZV+SDnirV51SMVnllC1zqKNbbC2EAMReOFSXcPxP2bNJiV9lfV1bDzL9pFH7
	MwImeYvV6ThHNBOahyDZVv34aELrY2Qbjmr/gHVrjHcw3CgBSKzdthAFDX/TbRFwM9zvpF/7YxT
	OrbP4YJk1aCzaMo3gVPQXkj008w7g8tE9rfJJa2u+kg6dk6q4oVYU2XWy5sSGMBixJBSR5BaVg/
	kyxwQsePrwN5wiT3VR/pk2KzZlctB2Zuja/k/tkDv
X-Received: by 2002:a17:903:908:b0:2a0:a8c2:be5d with SMTP id
 d9443c01a7336-2a7174e632amr1155865ad.5.1768494824394;
        Thu, 15 Jan 2026 08:33:44 -0800 (PST)
X-Received: by 2002:a17:903:908:b0:2a0:a8c2:be5d with SMTP id
 d9443c01a7336-2a7174e632amr1155585ad.5.1768494823824;
        Thu, 15 Jan 2026 08:33:43 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.33.42
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:33:43 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 07/27] 11bi: Configuration options to control EPP feature
 support in AP mode
Date: Thu, 15 Jan 2026 22:02:46 +0530
Message-Id: <20260115163306.367753-8-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-GUID: lPOA793HXstEN9EwL1Y-GcQas3qmrOMk
X-Authority-Analysis: v=2.4 cv=TNlIilla c=1 sm=1 tr=0 ts=696916e9 cx=c_pps
 a=IZJwPbhc+fLeJZngyXXI0A==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=GNP3BF6is-2k_EN8WVkA:9 a=uG9DUKGECoFWVXl0Dc02:22
X-Proofpoint-ORIG-GUID: lPOA793HXstEN9EwL1Y-GcQas3qmrOMk
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX1RNxTPX220or
 jB5dTOHWma2jfu7yN3wJSGSOiPDD0g+Ff4XAt9DqwagYxaxrn1CCXEFrFtyCt8OY+MelPVUJfu+
 0GEKsJ0jnyZkL+KyJVkl3s5YWm79taMvLN7EyEQ8PU5K25Id+e1idvBWUpW5oVQoxnNklGruaeg
 fC4qdIj/quy4D55mCKxT1cPYIcxOtGd6dmN6F9ApjpqHD06ITeWkUMdlG3OPixx7OdKKcnGgfXy
 DujlMqdZqI0A/ln/G7fQacmW/ezeD7xAnU0EweabQ+LOQzIrrG7/5kZ7zGhDi0JopElznG8gORU
 np8fGU45ktQmHhXGXIeUTWHz63tHCdmKuefeeXtuP26tMshSjFdjb9s+ELHr2GhatSPPB3VJapO
 1YKuiNIeImwCBt4raoRVyBWbR+8lcDcDHvb0SiP9kTe5lSbk8+eV6lEHlYsEnP9Psm+gpuJHmgb
 ncUbhd9LBH0azq8qkLA==
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 malwarescore=0 bulkscore=0 spamscore=0 priorityscore=1501 suspectscore=0
 impostorscore=0 lowpriorityscore=0 clxscore=1015 adultscore=0 phishscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_083346_987729_B9B3512D 
X-CRM114-Status: GOOD (  20.11  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
 Introduce
    additional configuration options to control the enablement of each of the
    below EPP features in AP: -(Re)Association Request/Response frame
 encryption
    support -PMKSA Caching Privacy Support [...]
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.0 SPF_PASS               SPF: sender matches SPF record
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

Introduce additional configuration options to control the
enablement of each of the below EPP features in AP:
-(Re)Association Request/Response frame encryption support
-PMKSA Caching Privacy Support
-IEEE 802.1X Authentication Utilizing Authentication Frame Support

Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
Signed-off-by: Rohan Dutta <drohan@qti.qualcomm.com>
---
 hostapd/config_file.c  |  8 ++++++++
 hostapd/hostapd.conf   | 23 +++++++++++++++++++++++
 src/ap/ap_config.c     |  5 +++++
 src/ap/ap_config.h     |  5 +++++
 src/ap/wpa_auth.h      |  6 +++++-
 src/ap/wpa_auth_glue.c | 25 +++++++++++++++++++++++++
 6 files changed, 71 insertions(+), 1 deletion(-)

diff --git a/hostapd/config_file.c b/hostapd/config_file.c
index 8d5c1433a..ff85ed765 100644
--- a/hostapd/config_file.c
+++ b/hostapd/config_file.c
@@ -2865,6 +2865,14 @@ static int hostapd_config_fill(struct hostapd_config *conf,
 			return 1;
 		}
 		bss->extended_key_id = val;
+#ifdef CONFIG_ENC_ASSOC
+	} else if (os_strcmp(buf, "assoc_frame_encryption") == 0) {
+		bss->assoc_frame_encryption = atoi(pos);
+	} else if (os_strcmp(buf, "pmksa_caching_privacy") == 0) {
+		bss->pmksa_caching_privacy = atoi(pos);
+	} else if (os_strcmp(buf, "eap_using_authentication_frames") == 0) {
+		bss->eap_using_authentication_frames = atoi(pos);
+#endif /* CONFIG_ENC_ASSOC  */
 	} else if (os_strcmp(buf, "wpa_group_rekey") == 0) {
 		bss->wpa_group_rekey = atoi(pos);
 		bss->wpa_group_rekey_set = 1;
diff --git a/hostapd/hostapd.conf b/hostapd/hostapd.conf
index c76801965..996fa4484 100644
--- a/hostapd/hostapd.conf
+++ b/hostapd/hostapd.conf
@@ -3529,3 +3529,26 @@ own_ip_addr=127.0.0.1
 #bridge=br-lan
 #wpa_key_mgmt=SAE
 #bssid=00:03:7f:12:84:85
+
+##### IEEE 802.11bi related configuration #####################################
+
+#IEEE Std 802.11bi D2.0 introduces following EPP feature capabilities
+#(Re)Association Request/Response frame Encryption: Indicates if AP supports
+#encryption of (Re)Association Request and Response frames
+# 0 = disabled (default)
+# 1 = enabled
+#association_frame_encryption_support=0
+
+#PMKSA Caching privacy: Indicates if the AP would recompute the PMKID after the
+#indicated PMKID in the RSNE identifies a cached PMKSA and a PTKSA was established
+#using the identified PMKSA. The recomputed PMKID will be delivered to the non-AP
+#STA in the key delivery element added in the encrypted (Re)Association Response frame
+# 0 = disabled (default)
+# 1 = enabled
+#pmksa_caching_privacy=0
+
+#IEEE802.1X (EAP) Authentication utilizing Authentication frames: Indicates if
+#the EAP PDU will be encapsulated within the IEEE802.1X authentication frames
+# 0 = disabled (default)
+# 1 = enabled
+#eap_using_authentication_frames=0
diff --git a/src/ap/ap_config.c b/src/ap/ap_config.c
index a92940d75..23c44cef8 100644
--- a/src/ap/ap_config.c
+++ b/src/ap/ap_config.c
@@ -179,6 +179,11 @@ void hostapd_config_defaults_bss(struct hostapd_bss_config *bss)
 #endif /* CONFIG_PASN */
 	bss->urnm_mfpr_x20 = -1;
 	bss->urnm_mfpr = -1;
+#ifdef CONFIG_ENC_ASSOC
+	bss->assoc_frame_encryption = 0;
+	bss->pmksa_caching_privacy = 0;
+	bss->eap_using_authentication_frames = 0;
+#endif /* CONFIG_ENC_ASSOC */
 }
 
 
diff --git a/src/ap/ap_config.h b/src/ap/ap_config.h
index b427a972e..065f43f55 100644
--- a/src/ap/ap_config.h
+++ b/src/ap/ap_config.h
@@ -990,6 +990,11 @@ struct hostapd_bss_config {
 	int mbssid_index;
 
 	bool spp_amsdu;
+#ifdef CONFIG_ENC_ASSOC
+	unsigned int assoc_frame_encryption:1;
+	unsigned int pmksa_caching_privacy:1;
+	unsigned int eap_using_authentication_frames:1;
+#endif /* CONFIG_ENC_ASSOC  */
 };
 
 /**
diff --git a/src/ap/wpa_auth.h b/src/ap/wpa_auth.h
index 12a8b6b1a..36954a19a 100644
--- a/src/ap/wpa_auth.h
+++ b/src/ap/wpa_auth.h
@@ -290,7 +290,11 @@ struct wpa_auth_config {
 	unsigned int secure_ltf:1;
 	unsigned int secure_rtt:1;
 	unsigned int prot_range_neg:1;
-
+#ifdef CONFIG_ENC_ASSOC
+	unsigned int assoc_frame_encryption:1;
+	unsigned int pmksa_caching_privacy:1;
+	unsigned int eap_using_authentication_frames:1;
+#endif /* CONFIG_ENC_ASSOC  */
 	int owe_ptk_workaround;
 	u8 transition_disable;
 #ifdef CONFIG_DPP2
diff --git a/src/ap/wpa_auth_glue.c b/src/ap/wpa_auth_glue.c
index 8418bf8f0..8c59da3d5 100644
--- a/src/ap/wpa_auth_glue.c
+++ b/src/ap/wpa_auth_glue.c
@@ -81,6 +81,25 @@ static void hostapd_wpa_auth_config_update(struct hostapd_data *hapd,
 		!!(hapd->iface->drv_flags2 &
 		   WPA_DRIVER_FLAGS2_PROT_RANGE_NEG_AP);
 
+#ifdef CONFIG_ENC_ASSOC
+	if (_conf->assoc_frame_encryption &&
+	    (hapd->iface->drv_flags2 &
+		WPA_DRIVER_FLAGS2_ASSOCIATION_FRAME_ENCRYPTION))
+		_conf->assoc_frame_encryption = 1;
+	else
+		_conf->assoc_frame_encryption = 0;
+
+	if (_conf->pmksa_caching_privacy)
+		_conf->pmksa_caching_privacy = 1;
+	else
+		_conf->pmksa_caching_privacy = 0;
+
+	if (_conf->eap_using_authentication_frames)
+		_conf->eap_using_authentication_frames = 1;
+	else
+		_conf->eap_using_authentication_frames = 0;
+#endif /* CONFIG_ENC_ASSOC  */
+
 #ifdef CONFIG_IEEE80211BE
 	_conf->mld_addr = NULL;
 	_conf->link_id = -1;
@@ -112,6 +131,12 @@ static void hostapd_wpa_auth_conf(struct hostapd_iface *iface,
 
 	os_memset(wconf, 0, sizeof(*wconf));
 	wconf->wpa = conf->wpa;
+#ifdef CONFIG_ENC_ASSOC
+	wconf->assoc_frame_encryption = conf->assoc_frame_encryption;
+	wconf->pmksa_caching_privacy = conf->pmksa_caching_privacy;
+	wconf->eap_using_authentication_frames =
+		conf->eap_using_authentication_frames;
+#endif /* CONFIG_ENC_ASSOC  */
 	wconf->extended_key_id = conf->extended_key_id;
 	wconf->wpa_key_mgmt = conf->wpa_key_mgmt;
 	wconf->rsn_override_key_mgmt = conf->rsn_override_key_mgmt;

From patchwork Thu Jan 15 16:32:47 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184693
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=HPSTh6Mr;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=gOcGE0zE;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=diT+eyXn;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsT8b3sGSz1xtG
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:34:23 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=iMSxK8vInb9+RBfwbVohyfmG7hX0fV3rr/fdATUzNS4=; b=HPSTh6Mrp5+gkC
	8KanfERWPKvsjDdMmLAkLhXQ8dsRiL+fx4lW/ROYmZqDq9nZA7FB65UIWc2N105UrxgpqZGs5Pn22
	oQLf5uJSswyKAhwPGHRZ+KLjMzgr4C9/7DQfFbxocQlBGeYIaox1DSMyKrecuJ65clxCBhJ77pgku
	+afg92nZHZrcc8uxtj9ZnQ1rI5P0sF8DYFEoEUpVDCFO2djQiXyJWbrO85QJAfNAF7rM+p1zfxnS1
	lq6thJrmS4G7WJF0nFDfTTrA/RUuTFct/j/6wVKj+h61Ees1qyVCmLj2HSSYdaL54pcXein6Otack
	qe7wDktF3CnsJ9CHcVbw==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIB-0000000Chcq-0lHC;
	Thu, 15 Jan 2026 16:33:51 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQI8-0000000ChaI-2MLK
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:33:49 +0000
Received: from pps.filterd (m0279871.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFYGnT2866272
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:47 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=BJ2Ee2T07/7
	utk4dSU9jNNKQw3kve4KDHpi/SQ7cs7U=; b=gOcGE0zEMMREdLFnjAxhX/UfOHe
	LtHsHKD86n5dWxfniRHp4jlE3leItU/th4Kt36iG4I0THLmKC2zy4nQllYC1NOqF
	l2ZDEH3DrUo4M4EgKnlroErr7eynPwhZyGcecy3Axc2HrZmQsPzITStlCvSpQT2M
	8I9cB7CAlDXEuaWsxiANlHR3sfnLpA79gLPBxLKzWMT40H0XEmFodCFlqJd3mCC3
	BVAsTDsKU8JvQ7v+zD+Jxtl0UgrWGIHztLdpfkPlWgQ2EPIlCeKJ/69RocsHPjRq
	MhXR+/k253VkkvQ8de8QmJiAf0Z+xMQYvY7esac0I9su9j9N19yynlU1Y9w==
Received: from mail-pl1-f200.google.com (mail-pl1-f200.google.com
 [209.85.214.200])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bptu2hp50-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:47 +0000 (GMT)
Received: by mail-pl1-f200.google.com with SMTP id
 d9443c01a7336-2a0e952f153so22574435ad.0
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:33:47 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494826; x=1769099626;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=BJ2Ee2T07/7utk4dSU9jNNKQw3kve4KDHpi/SQ7cs7U=;
        b=diT+eyXn6MyvARFaiZugebJJphPBPCtfNhOlRO0EzUIR4hcrr5EI5foxOhBJs2WIDE
         3Q6j4mY3JRCEf5Nuk0bQW5wSRKtLmoCJGnVxGJPjJIidmMTNz1lgMPf+A+IbPjoySRBR
         D5J1nvHoYGs3fVI7HgZZ7LwJ0MBM4kXn1EjXSjisVb3PMytXdXnxc3DXjRIJJqIhbZKU
         huhRk9yvrQO1ZFZfv2l9cj9DCu8lO+Cd8/qL6eL3/wK0puTLSvEBUk698vAD2WSbwfS+
         ijVVRVgwABgmJ5fdi87lQdGT2Y98u9PIfOnd7vbpH56/f2CYfLIIlwcP+p+smQNY9O3Q
         2OwQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494826; x=1769099626;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=BJ2Ee2T07/7utk4dSU9jNNKQw3kve4KDHpi/SQ7cs7U=;
        b=V3jdpl2b93HiWfjr8xmqNNvlX4+oOUjo0XEdezDj0Pnl57n3oK08vc8Ms0gzCz65kd
         SZIlbTIpSSeQxXA+xYzmfJ8yaiaUgQRozZ8FL3VlHCvIvoYmiGrGqPQX+gwz0clegCW7
         IF2/eYZMTEo4cXZslGnAdRE/OVwXXbEXw4KZrXVa4eWsOKZa+t78XfXGxeTK6VtU9s3X
         h6ogZPzdCkBqpiXPmWkgTtn9+jCmLMZjBQzG0FTJIsbv8ayvfhevbXnJNWj+Bm9XaEf2
         fwTQgcCJMY98kzipsLWUempHJ+cSPqvA9KVvzTC9IEmGC6QZbJRKSJzbrm6t7DXmxy9T
         h8qw==
X-Gm-Message-State: AOJu0YzxAMtdc3L+09wW8zYzEzZBMAcm+eCRv+P3HD7+x8zHg9jdDdJ2
	ZDO0JNIVXNG8NiVnoMwFwkDvk6a5kmChY34GPbodMYgG2+cgZ39qQoR7MF3GvPLppTQUXPGgxdC
	xbMzXwkXoza/84iW1NyWMuzr22oEC/pUMnE1meuC7wDVM+oapnWhilDNdyDhRNCRk5q98ZUwM
X-Gm-Gg: AY/fxX6q8l4Ko9aV5+MC7FekN0S7ycf0avoR9+sCpRHqGEtlPnXIP4b/KQs/+EE1Q6p
	Qmhd8/WoFsKUC5UqGoddU2dFmtSCAZpeqIEU5OSkzDxbFsUsmq5ruAfJKZR4U9XbVREBYEbHGch
	WigZZZxWvjfaQa7yfyUzJUu2W4OODUa0Psu7yxmAU6AYfCBz+R8SIxRmEPV3t3HDspmKhIpL6jO
	9xoukTTZKYb7AzXIyK5wRbN4g2zYEEx8y5WiVaW0Jzev60wrY0ExbaPGasXhMf6Ofv1DDmmhxa8
	xLcqVSMCSLl77OKkvR3FWmjqE8Ryl6OynCHwz35TQUDDGvdH1K5H0/KuJq7wdgNvjorZlZVTD+6
	xo1cD7vBCrH3whBI5ztyJrDO8QejCqdLpetiZLfP7
X-Received: by 2002:a17:902:e846:b0:26d:d860:3dae with SMTP id
 d9443c01a7336-2a717529fe1mr1192615ad.3.1768494826457;
        Thu, 15 Jan 2026 08:33:46 -0800 (PST)
X-Received: by 2002:a17:902:e846:b0:26d:d860:3dae with SMTP id
 d9443c01a7336-2a717529fe1mr1192315ad.3.1768494825951;
        Thu, 15 Jan 2026 08:33:45 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.33.44
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:33:45 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 08/27] 11bi: RSNE/RSNXE capability Extensions in AP mode
Date: Thu, 15 Jan 2026 22:02:47 +0530
Message-Id: <20260115163306.367753-9-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfXxPn7eHamu+Cl
 ijDUCanYQK+rxnttZ7xp0moIhegrWAtVftpqI7RQ12q6hqAU+rafqKQxjWwwp2h4lcAF46C4tvU
 alveQmleS1QMi+6xA5LToN8sbDPEdgGCmkn1IKQJ9LUkwk6RmWGB0O2Et/bk2xTKzvxEfJzWphk
 +7xRicOF9v5CY65kLHyGQX/NNhdTmQZ8ERohUzK2vNn2bs8j1/EDXqXnTXsw4MhQih/+iB65dyC
 dhJhnkFrPDcbrE4xRiiBsrMcD8ICslrd0SfX25iLNAXmnZgyZL4EMA/7ec2goU7jx/xRy9zUEVH
 nGYImv6rLiqtM6T2qO07zRqsi8gXobPodRjgjN4H5UAr1bLTgE9xv6uD2BWhhwCeLvUF5A6l0aT
 /43jYFwPKYUrkeDNWhJxsu8Xe1hWI2dRYQ8AIpfzjON5wKPkCFQsF7yV4gUD6w09It2jHHTOnUu
 gtqV84fxAB8GCoBDdJA==
X-Proofpoint-ORIG-GUID: 0EFLyB5mC3M6sHS4Fsv7zAIQTTCx-rrz
X-Authority-Analysis: v=2.4 cv=W6Y1lBWk c=1 sm=1 tr=0 ts=696916eb cx=c_pps
 a=IZJwPbhc+fLeJZngyXXI0A==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=7b7psht5NXxcJgnpxG4A:9 a=uG9DUKGECoFWVXl0Dc02:22
X-Proofpoint-GUID: 0EFLyB5mC3M6sHS4Fsv7zAIQTTCx-rrz
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 adultscore=0 priorityscore=1501 phishscore=0 suspectscore=0
 lowpriorityscore=0 spamscore=0 impostorscore=0 malwarescore=0 clxscore=1015
 bulkscore=0 classifier=typeunknown authscore=0 authtc= authcc= route=outbound
 adjust=0 reason=mlx scancount=1 engine=8.22.0-2512120000
 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_083348_719737_3D0CC4C5 
X-CRM114-Status: GOOD (  17.91  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
 Advertise
    EPPKE AKM suite in RSN IE of Beacons/Probe Response frames Add support to
    include RSNXE capability indications for the following features in
 beacons/probe
    response frames and EPPKE Authentic [...]
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.0 SPF_PASS               SPF: sender matches SPF record
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

Advertise EPPKE AKM suite in RSN IE of Beacons/Probe
Response frames
Add support to include RSNXE capability indications
for the following features in beacons/probe response
frames and EPPKE Authentication frame 2:
-(Re)Association Request/Response frame encryption
-IEEE802.1X (EAP) Authentication Utilizing Authentication
 frames
-PMKSA Caching Privacy

Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
---
 hostapd/config_file.c      |  4 ++++
 src/ap/ieee802_11_shared.c | 16 ++++++++++++++++
 src/ap/wpa_auth_ie.c       | 23 +++++++++++++++++++++--
 3 files changed, 41 insertions(+), 2 deletions(-)

diff --git a/hostapd/config_file.c b/hostapd/config_file.c
index ff85ed765..5e9ed06e8 100644
--- a/hostapd/config_file.c
+++ b/hostapd/config_file.c
@@ -717,6 +717,10 @@ static int hostapd_config_parse_key_mgmt(int line, const char *value)
 		else if (os_strcmp(start, "PASN") == 0)
 			val |= WPA_KEY_MGMT_PASN;
 #endif /* CONFIG_PASN */
+#ifdef CONFIG_ENC_ASSOC
+		else if (os_strcmp(start, "EPPKE") == 0)
+			val |= WPA_KEY_MGMT_EPPKE;
+#endif /* CONFIG_ENC_ASSOC */
 		else {
 			wpa_printf(MSG_ERROR, "Line %d: invalid key_mgmt '%s'",
 				   line, start);
diff --git a/src/ap/ieee802_11_shared.c b/src/ap/ieee802_11_shared.c
index 750891425..05fb35bf3 100644
--- a/src/ap/ieee802_11_shared.c
+++ b/src/ap/ieee802_11_shared.c
@@ -1153,6 +1153,22 @@ u8 * hostapd_eid_rsnxe(struct hostapd_data *hapd, u8 *eid, size_t len)
 	if ((hapd->iface->drv_flags2 & WPA_DRIVER_FLAGS2_SPP_AMSDU) &&
 	    hapd->conf->spp_amsdu)
 		capab |= BIT(WLAN_RSNX_CAPAB_SPP_A_MSDU);
+#ifdef CONFIG_ENC_ASSOC
+	/* Per IEEE802.11bi/D1.2, 12.16.7 PMKSA caching privacy
+	 * A STA that sets the PMKSA Caching Privacy Support
+	 * field in the RSNXE to 1 shall set the (Re)Association
+	 * Frame Encryption Support field in the RSNXE to 1
+	 */
+	if ((hapd->iface->drv_flags2 &
+	     WPA_DRIVER_FLAGS2_ASSOCIATION_FRAME_ENCRYPTION) &&
+	    (hapd->conf->assoc_frame_encryption ||
+	    hapd->conf->pmksa_caching_privacy))
+		capab |= BIT(WLAN_RSNX_CAPAB_ASSOC_FRAME_ENCRYPTION);
+	if (hapd->conf->pmksa_caching_privacy)
+		capab |= BIT(WLAN_RSNX_CAPAB_PMKSA_CACHING_PRIVACY);
+	if (hapd->conf->eap_using_authentication_frames)
+		capab |= BIT(WLAN_RSNX_CAPAB_1X_UTILIZING_AUTHENTICATION_FRAMES);
+#endif /* CONFIG_ENC_ASSOC */
 
 	if (!capab)
 		return eid; /* no supported extended RSN capabilities */
diff --git a/src/ap/wpa_auth_ie.c b/src/ap/wpa_auth_ie.c
index 220ac809f..6ae1350a0 100644
--- a/src/ap/wpa_auth_ie.c
+++ b/src/ap/wpa_auth_ie.c
@@ -303,7 +303,13 @@ static u8 * rsne_write_data(u8 *buf, size_t len, u8 *pos, int group,
 		num_suites++;
 	}
 #endif /* CONFIG_PASN */
-
+#ifdef CONFIG_ENC_ASSOC
+	if (key_mgmt & WPA_KEY_MGMT_EPPKE) {
+		RSN_SELECTOR_PUT(pos, RSN_AUTH_KEY_MGMT_EPPKE);
+		pos += RSN_SELECTOR_LEN;
+		num_suites++;
+	}
+#endif /* CONFIG_ENC_ASSOC */
 #ifdef CONFIG_RSN_TESTING
 	if (rsn_testing) {
 		RSN_SELECTOR_PUT(pos, RSN_SELECTOR(0x12, 0x34, 0x56, 2));
@@ -503,7 +509,20 @@ static u32 rsnxe_capab(struct wpa_auth_config *conf, int key_mgmt)
 		capab |= BIT(WLAN_RSNX_CAPAB_SSID_PROTECTION);
 	if (conf->spp_amsdu)
 		capab |= BIT(WLAN_RSNX_CAPAB_SPP_A_MSDU);
-
+#ifdef CONFIG_ENC_ASSOC
+	/* Per IEEE802.11bi/D2.0, 12.16.7 PMKSA caching privacy
+	 * A STA that sets the PMKSA Caching Privacy Support
+	 * field in the RSNXE to 1 shall set the (Re)Association
+	 * Frame Encryption Support field in the RSNXE to 1
+	 */
+	if (conf->assoc_frame_encryption ||
+	    conf->pmksa_caching_privacy)
+		capab |= BIT(WLAN_RSNX_CAPAB_ASSOC_FRAME_ENCRYPTION);
+	if (conf->pmksa_caching_privacy)
+		capab |= BIT(WLAN_RSNX_CAPAB_PMKSA_CACHING_PRIVACY);
+	if (conf->eap_using_authentication_frames)
+		capab |= BIT(WLAN_RSNX_CAPAB_1X_UTILIZING_AUTHENTICATION_FRAMES);
+#endif /* CONFIG_ENC_ASSOC */
 	return capab;
 }
 

From patchwork Thu Jan 15 16:32:48 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184692
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=L9Uk97ML;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=lfgqNqUw;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=XnfFcQwP;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsT8b3m8cz1xt4
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:34:23 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=rcMfNCPiSb0OV0UOpne3KCrvDs7Ctrw8EQZuCp2v9GE=; b=L9Uk97MLUC2jCV
	LEBt3wGq8SfCCi2CY7+BPnKV+hiuH0XbIrcd5pITChOHta1j1TuH0F47lQQwPJzqwhkK5yNMDO0DH
	+gf/7aItOKlN0JaWHoVR3cJpDr3ZC479QGy95y+xBAsNCws1mNM5zAskZEmebLcWBy6NY2nzK/eQq
	adJpsFt5aDS+KxqI4v5uhTM/ma0o5XMXaX8KiRreiQVPRErqhvUBBYCFmBPW9E1XFCfP0Uo60sHP6
	rgxHhXuKpRQE5BSddcJ0tVAf/50jdA++/V0F7K8qxcIO8Bh/e8bIWFynlqTCS/ZX+OolKG4ThnhQZ
	KGQKGqoP50Ktg/IkcDrw==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQID-0000000Cheb-12cL;
	Thu, 15 Jan 2026 16:33:53 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIA-0000000Chbo-3NLa
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:33:52 +0000
Received: from pps.filterd (m0279872.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFY5rJ1909925
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:50 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=nMyPSiBBklP
	xBS9CcnDdZYUl18WbyUL6ltyOICMHw4w=; b=lfgqNqUwYWoUCyQc5eB4Wpuo+jH
	OerwuEyzAvRxB/la2hNRsoz0Xxz3YLd7Wr2vcP39IxVSfrIyTTyPk+LrpCoe6v1g
	WPw0aEE8tN7rFfJQklQmZrIebfYa56qvp9toK8rWfQX8gkA3mOKCmJDtxRTiCpe0
	lmS/7Gsm553ClGWWtufdACFBPPjxcLDx3M0GCQVWEsJDSbY46BMiEl3eCbOLVAoW
	kSfK4sNl2jBWhq8x0vXPXOcCbxC4mWFflY+pqQwoMbvLfn7eiLLtNOpqMvdhupoJ
	b175G6gsdaQKJa5YAQyisXoXEdR7UmUV5SCVKF+/zixuuWB8BK+DZ0hxSug==
Received: from mail-pl1-f199.google.com (mail-pl1-f199.google.com
 [209.85.214.199])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bpxgn0yp7-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:49 +0000 (GMT)
Received: by mail-pl1-f199.google.com with SMTP id
 d9443c01a7336-2a13be531b2so10882975ad.2
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:33:49 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494829; x=1769099629;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=nMyPSiBBklPxBS9CcnDdZYUl18WbyUL6ltyOICMHw4w=;
        b=XnfFcQwP71khqf5dsLEA9MCm1zgT3qz4kYiRHQiNE1npx+9jWT3+oehEm4rcmv9gcX
         dlV75lttZ1KZ6EDtIGK7FI4kCTqWjh4o4kd5D4LRMBuWCxJowFe5MVmwpEnquy/HI1qs
         9zce1mm3yVL35AarNJK2Jql18hmp6DqgYRl/nBHFqBZhfBahOcM08O5oV8e9Kv3RtFK8
         6/qSKHGZhazMLrSwr53qTqorHOw8B/QUMTPqjbw4Z3LamTKI88/ZdNjZuVUpD4cvP/Jp
         XvZMB7zqwY8rQpv1tKLbGW6tflQNukyqv8eY6bC+YsGWZPWZUqj7Q+hWCwgWST3UCizR
         cW5A==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494829; x=1769099629;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=nMyPSiBBklPxBS9CcnDdZYUl18WbyUL6ltyOICMHw4w=;
        b=B8+zF84OLtNEAYDsJj/q0+6hwzuT+Rv4DTiB/WXsQAgs8aBfBCwhNtW2k4GHVLJt3I
         NaSz0uOz6RvOX9CMRR+gJFuYYrfGE1+ZLW/Yfk1U/jZg+8dUfy2kvcp+P/7vWzaSFl8H
         +uoQ50mqtbz4uL6M6xfwMQLWiwMqk48Y29Sm6gtcAKl7OezsMDJxU/7UcPmJgZ/BtxdH
         Fw4MEl2H3nIU0+2LzU1waQJsvZaHryjHzcXkXqw30RE+IfmMZFFMnBuEZZaAcmqRyrZZ
         KMeMQfTZXG0g9SnUBAkT6OvmBboaTOGSQz9JsZBJ2L2I7YKkMCtLNvos0bRxuVz7ILW/
         MWHw==
X-Gm-Message-State: AOJu0YwUhRKoVQ7o1F4tKBug2yb8Tj6rnf4SlbqOx77Q+aeDgaMcb232
	nx7S0tqNAvzrgtjprIbg1dAj6b32KY1NkrdX4jld5lZDxpV9ONeXLzsC4z35OhvTWDOCLntVB36
	f+ULgqNxtkvp6okbFlTtssyfDPi01uTaarUU2cA9esnYm/2e0cdYEB4CdS1pXP2c+BP/ruKG4
X-Gm-Gg: AY/fxX5e9MOTnedN9TphfpyacibVPAjH2SnF9YxF7Yk6wCY/8poXjf/rCEGm42rzJph
	frMR1DYPqkTREIaZjnIsWW/idhob3leqNi42eLQ/GVL17A5cgY3JPr2devOm7fw1cauOd/B36hk
	qmTMRiRqfGTZRQprx8yHdAfqEr5KIPEbCIgHkois7DwYwJaI0zsb4tM/kTWWxA9gKz8OcudMCYr
	+e3u2SnibYujWD/J3wswrbkd8oAoCJh97RM9F2TLvYzRlHRuyOGUq9jWaDkj0R03MtjbWC+YRzY
	jQl+9NhiumAn5awwkhMW8VoGF8vUAwRzZLdLfvAKxT0p4GSO/CBBTZu0CpJlUl1flXgNAXZtVkt
	Pp+HZRuxx7hq/ZHbCdvwYZSxiUvIdSNySexxO0tZ0
X-Received: by 2002:a17:902:ea0d:b0:295:5b68:9967 with SMTP id
 d9443c01a7336-2a7177d5be8mr554545ad.49.1768494828557;
        Thu, 15 Jan 2026 08:33:48 -0800 (PST)
X-Received: by 2002:a17:902:ea0d:b0:295:5b68:9967 with SMTP id
 d9443c01a7336-2a7177d5be8mr554355ad.49.1768494828069;
        Thu, 15 Jan 2026 08:33:48 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.33.46
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:33:47 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 09/27] wpa_supplicant: Add CONFIG_ENC_ASSOC for association
 frame encryption support
Date: Thu, 15 Jan 2026 22:02:48 +0530
Message-Id: <20260115163306.367753-10-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-GUID: JDHZjA_tDXzC5VM9ubis3ce-PhYRz7U8
X-Proofpoint-ORIG-GUID: JDHZjA_tDXzC5VM9ubis3ce-PhYRz7U8
X-Authority-Analysis: v=2.4 cv=ANDFHcx+ c=1 sm=1 tr=0 ts=696916ed cx=c_pps
 a=JL+w9abYAAE89/QcEU+0QA==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=v5wKuGWGPaTtaeehA4MA:9 a=324X-CrmTo6CU4MGRt3R:22
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX+QwmaYdySHGN
 /U3Zq7FNFZHsQYSS2HW9tYfTJ46MQaKRBiODDvRWmJmflauMmPLgjVa51psejpKV+MZXPfYAtJV
 STTv8aGqf0XpwyZcoDU3CfcdVYQ3DdiL8WT5oFrXgoCC/jyejZkGtIE3YkO2zRqb1NrJSY4BhWx
 A8hlTR39lE9HQZE4Jh/F0VGt3Szc695+8fPLQFeowowBCRDaAZrmrSk9NJkYJws7bpcu27lhO3E
 gk0wJJYzWz5xz9cAz2TKMXGERUPXpGwa5JYmPSAj05i4tM7MqKLzhloYlryDeNfHxVzNSEyxsuQ
 q+l+4QJYxQ4xCd+19qMt+WCRjoY2SgYCVPQczhdH8IqgBC8V/IAuD5i7BhD6OO/hSKBj8eRMawj
 8emi2R51Shz70DoPSwu6gNt6GzR1CvHAzORABQ6y+3nXg6FocE/fhDQl3hdaFIoEoThn7Kzek2t
 6RhhWWSzUbSyMJvkJvw==
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 impostorscore=0 phishscore=0 clxscore=1015 bulkscore=0 malwarescore=0
 spamscore=0 lowpriorityscore=0 adultscore=0 priorityscore=1501 suspectscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_083350_958494_BBF9B50E 
X-CRM114-Status: GOOD (  12.80  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  Introduce CONFIG_ENC_ASSOC in defconfig and update Makefile
    to enable association frame encryption. When enabled,
 also set CONFIG_PASN,
    since EPPKE authentication requires association frame encryption [...]
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.0 SPF_PASS               SPF: sender matches SPF record
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

Introduce CONFIG_ENC_ASSOC in defconfig and update Makefile to enable
association frame encryption. When enabled, also set CONFIG_PASN,
since EPPKE authentication requires association frame encryption and
relies on the PASN base code.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 wpa_supplicant/Makefile  | 5 +++++
 wpa_supplicant/defconfig | 3 +++
 2 files changed, 8 insertions(+)

diff --git a/wpa_supplicant/Makefile b/wpa_supplicant/Makefile
index b92b1e3f2..3bff566fd 100644
--- a/wpa_supplicant/Makefile
+++ b/wpa_supplicant/Makefile
@@ -444,6 +444,11 @@ OBJS += ../src/pasn/pasn_common.o
 OBJS += pasn_supplicant.o
 endif
 
+ifdef CONFIG_ENC_ASSOC
+CONFIG_PASN=y
+CFLAGS += -DCONFIG_ENC_ASSOC
+endif
+
 ifdef CONFIG_HS20
 OBJS += hs20_supplicant.o
 CFLAGS += -DCONFIG_HS20
diff --git a/wpa_supplicant/defconfig b/wpa_supplicant/defconfig
index 84ac8ba12..5861edc9c 100644
--- a/wpa_supplicant/defconfig
+++ b/wpa_supplicant/defconfig
@@ -682,3 +682,6 @@ CONFIG_DPP2=y
 
 # Wi-Fi Aware unsynchronized service discovery (NAN USD)
 #CONFIG_NAN_USD=y
+
+# IEEE P802.11bi/D2.0 Support (Enhanced service with Privacy Protection)
+#CONFIG_ENC_ASSOC =y

From patchwork Thu Jan 15 16:32:49 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184694
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=gJ2GDmln;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=eK5j2LeB;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=GDGKTqgG;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsT8c6b2Jz1xt4
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:34:24 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=MaDmVRlCQgTfomSfkIyeS1+bgkmgkYJMxyRbnEldEYw=; b=gJ2GDmlndbAnSC
	qVQjp5Z8v995wJl23G0M9r8KeYdBjnWz7ZGmht4vHocXl9wBuRAUJRzjAY4oPMtZUGnlN/vM9BwlL
	PcOmot+O7+LTjAJtW1LTDdUqFfDG4af5zWej0UdZG41Urzq1/MHHZIFh3p8VGm/+eb27ijjQcvkXy
	uFMRXk7i8xFKR8kXDgXvMxs5KWtnrQfNARm24fcAIhbLrUdh+/ulN9sVRd9JXiAtzacGSoNJS3Lwy
	WdENuPLCk9wiXpKByfd95OtiNmZiAcVwGguBqYX1iVr7tUCvWGOBYYwDoPhZK0idw7p5MYSNqJQ2G
	XobqdpmDqr/WtovQUPhg==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIF-0000000Chij-2zxJ;
	Thu, 15 Jan 2026 16:33:55 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQID-0000000CheB-0fYF
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:33:54 +0000
Received: from pps.filterd (m0279870.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFY7NC2673401
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:52 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:content-type:date:from:in-reply-to
	:message-id:mime-version:references:subject:to; s=qcppdkim1; bh=
	G0c3lKwwqDJxEcPSDjl+kqYW5tnWyH6+MyNi6PgUWYU=; b=eK5j2LeBGSs+VzCe
	NzoNBiCd5J6aCQlgZJo8I2yTX9tvxW9cjNbYl8MUEFndT1ROJ2HqkdnAHYZv6Zsp
	Txf3dJSYDfYHyTv2L4P2v/fCMP0IRZLf5E00x/CJEn03ke8azVQFHLP2eOjoyKVK
	3I1/ENZ+3FhmiNjHUfRWEiOM1r1Fw4OAKuQ+IRfWmWnI5iaRRi+BT9A+z+xboyQ4
	+lBFNIWKyY5F4BPwQ6I8V9AImfxsDyBXATOnRP4aEF7uAV/0+Eir5F32M6NR1Aag
	MInn3Cu6HFqrWAtjpkAU2br0P2wlbaCN5ejcOvzmhQTg1Zakdggy8PKjLBY1pcu3
	SRys2w==
Received: from mail-pl1-f198.google.com (mail-pl1-f198.google.com
 [209.85.214.198])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bpydugtgx-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:52 +0000 (GMT)
Received: by mail-pl1-f198.google.com with SMTP id
 d9443c01a7336-2a377e15716so20952305ad.3
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:33:51 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494831; x=1769099631;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=G0c3lKwwqDJxEcPSDjl+kqYW5tnWyH6+MyNi6PgUWYU=;
        b=GDGKTqgGtoEPGrqeviOZyohxilXO81iS/Y75sfkSTyygqusnwV/rZk/FEo8i8mYR4B
         vMc12OF5BAPZS2ue8HVTMeGc27pWUf9XrMzuI1Jr8bp2bmk5E9aobjauYkeI3wuwEEKP
         V8XImtef3a90P1T38pwmix0m16Xx9Stoq5uFSAew6A3Vs3kR56njaBlgcyvguAFj2rsH
         mEu9h5MqnUSkMdyVTUgW/i6cChun0vhcQ1c5iQl/16hJoos5pOQj+vCIfRzAa09SoGp8
         twdTOQHBZG946ytlBXlt5yIwx9IZqBnQ2hOwBpKK5s4mZg6/A2aTb3iKw6zDeyrRaZkl
         2v/w==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494831; x=1769099631;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=G0c3lKwwqDJxEcPSDjl+kqYW5tnWyH6+MyNi6PgUWYU=;
        b=nXyEKcod8prVsr7gcrhDFqpoq2tOkELwWfaz3nUpnD2TzKn3hCwge/nvOukjE5nUmx
         icfI9xZCNJRZpVvkgBL6g5XtE6YXpJUfURPcpRRuJwDJcxCyiC96XCmXmXb6HhyAN5HP
         LbIwOBPn0BgTha7vPGBQcfpSjI/gGYVZMdnyoueFFrl6b4vqXaEMN8PpOdc2Fmde7o63
         2M5WDmGqJkOH7agCBJMOEAbMDl2fb4Qn2oM1vYjKAiMmSjZtrPCCdxG70LclIq4Bg9Y7
         IW9BBZNHzQ4YlzCdGn0P/X5Y+LCFxuS+bOMNX048erB8dOnzfLrnO+yAah2EAv8pJZpo
         if4A==
X-Gm-Message-State: AOJu0YwcDxykcoRIDhR8gMII7Rs45ABR6KOLR9FBk1wi9EwZ381idQyx
	5blpWfhQLE53AQzIUXSJeDZJH+UplhTIREGvqhU+tP6YMUE3lGi092bCmg5bugj+I7QWgl0idxt
	Rsb9mgVEdQHMkHXIzXjK/SF13J3eLZ2LTrlOWj9QlHJqOVT1pvH0gsVWt8zabnO1Ow7Vy1nO7
X-Gm-Gg: AY/fxX5dU7JoSew4+5+XdMtyNzs8Lth7FwJULv4fbCXQ7RB//bUESk9yBkEpcIHRiZs
	lHmz49clIH5hEsVIuGUAIjNFw663uRs1HLB3kOUCvQMIfIaLBcNcI1iAoCHGAXDfMGiG2i79QkH
	rknayDby9NXy12Us5h1ZAxkzPY7wglz4JjyXOSbFI6Vpp6uagwp+MRCNU9ZoyfHF1QGkzSB8Zvj
	sAN/DCUTvc8EieuwfD9qp51sLxwUHU655b/mDfujR6mo7iUmOBLh+4Q86zkwe+d5BeA5BvNMh6q
	CDqr0bRPOsnNJQ64gcF7rOMIqd4uv0qTgLpuU+eBlwl2ZAyVuUlKHvUSmJkApLLBJlIIk9uVzdZ
	kaJwlUzv3E9SC61Q3auOO2YQnYPnDaU9zeZ2yao4A
X-Received: by 2002:a17:903:2351:b0:298:616a:ba93 with SMTP id
 d9443c01a7336-2a7174e630fmr906515ad.9.1768494830753;
        Thu, 15 Jan 2026 08:33:50 -0800 (PST)
X-Received: by 2002:a17:903:2351:b0:298:616a:ba93 with SMTP id
 d9443c01a7336-2a7174e630fmr906295ad.9.1768494830128;
        Thu, 15 Jan 2026 08:33:50 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.33.48
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:33:49 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 10/27] EPPKE: Add EPPKE support to PASN PTK derivation per
 IEEE P802.11bi/D2.0
Date: Thu, 15 Jan 2026 22:02:49 +0530
Message-Id: <20260115163306.367753-11-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfXz4yPDNslvAQy
 /rCIUT5o2hGtpQ3Wdj/jy0UB1ecvvvqyV0YFV4+dbtaz+KkNCG3lBltfTFh5LmzuBHIJkwbRb0X
 IlIerSZJEXB4L4uIY/fZ+EwdowQfpwKvZreCOyX8cORJQh398PdxnXFU/RKX7bkJBi8ZOZakEby
 Ebp/lqGMEXRXYPqhz8fRD3PPMl1DFoKPhKSpxFXdH1CL13dL+ZUHXhw35bUXkX94Ftw69Xw6tRq
 0veWmtY+zaJxGkEsUDqvZ0IU24yfrVxQsf6hysumbsG4spc/+yhJtsONk06npxYmmaNqq3b5/D6
 AsH8oH6ycyPFY0gaZcpObaSNFnBpqNx1XJLkINvMM6A3QQRYnWf4ku9y6gLWS/5EYN80sCkEhE2
 OKYyV5lJzZQ3jP+Gsl5Hg13rswnNr63CxUlFVS+zkR82N0LBApUL/N0dVZdOa7CpJgF6DNHQQsN
 rO5YGDdPhIkWC3C8cOw==
X-Proofpoint-ORIG-GUID: t3iCuvhc8-D5gdy5mO-NQw9vQt1x0-M5
X-Authority-Analysis: v=2.4 cv=NafrFmD4 c=1 sm=1 tr=0 ts=696916f0 cx=c_pps
 a=MTSHoo12Qbhz2p7MsH1ifg==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=IkcTkHD0fZMA:10 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10
 a=VkNPw1HP01LnGYTKEx00:22 a=EUspDBNiAAAA:8 a=I1L7H4vTCBpQMSOqNl8A:9
 a=3ZKOabzyN94A:10 a=QEXdDO2ut3YA:10 a=GvdueXVYPmCkWapjIL-Q:22
X-Proofpoint-GUID: t3iCuvhc8-D5gdy5mO-NQw9vQt1x0-M5
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 spamscore=0 impostorscore=0 bulkscore=0 lowpriorityscore=0 suspectscore=0
 phishscore=0 clxscore=1015 priorityscore=1501 malwarescore=0 adultscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_083353_337934_148140E2 
X-CRM114-Status: GOOD (  18.22  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  Extend PASN PTK derivation to support EPPKE authentication
    as specified in IEEE P802.11bi/D2.0, section 12.16.9.3.4. Update the PTK
   derivation label and debug logging to distinguish between PASN and E [...]    
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.0 SPF_PASS               SPF: sender matches SPF record
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

Extend PASN PTK derivation to support EPPKE authentication as specified
in IEEE P802.11bi/D2.0, section 12.16.9.3.4. Update the PTK derivation
label and debug logging to distinguish between PASN and EPPKE
authentication. Update all relevant function calls to pass the
new is_eppke parameter.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/ap/ieee802_11.c              |  3 ++-
 src/common/common_module_tests.c |  2 +-
 src/common/wpa_common.c          | 12 +++++++++---
 src/common/wpa_common.h          |  3 ++-
 src/pasn/pasn_common.h           |  1 +
 src/pasn/pasn_initiator.c        |  3 ++-
 src/pasn/pasn_responder.c        |  3 ++-
 7 files changed, 19 insertions(+), 8 deletions(-)

diff --git a/src/ap/ieee802_11.c b/src/ap/ieee802_11.c
index 611017da1..c1ff3fa8a 100644
--- a/src/ap/ieee802_11.c
+++ b/src/ap/ieee802_11.c
@@ -2815,7 +2815,8 @@ static void pasn_fils_auth_resp(struct hostapd_data *hapd,
 			      wpabuf_len(pasn->secret),
 			      pasn_get_ptk(sta->pasn), pasn_get_akmp(sta->pasn),
 			      pasn_get_cipher(sta->pasn), sta->pasn->kdk_len,
-			      sta->pasn->kek_len, &sta->pasn->hash_alg);
+			      sta->pasn->kek_len, &sta->pasn->hash_alg,
+			      pasn->auth_alg == WLAN_AUTH_EPPKE);
 	if (ret) {
 		wpa_printf(MSG_DEBUG, "PASN: FILS: Failed to derive PTK");
 		goto fail;
diff --git a/src/common/common_module_tests.c b/src/common/common_module_tests.c
index 6b528eabd..bb6b9cf97 100644
--- a/src/common/common_module_tests.c
+++ b/src/common/common_module_tests.c
@@ -655,7 +655,7 @@ static int pasn_test_pasn_auth(void)
 			      spa_addr, bssid,
 			      dhss, sizeof(dhss),
 			      &ptk, WPA_KEY_MGMT_PASN, WPA_CIPHER_CCMP,
-			      WPA_KDK_MAX_LEN, 0, &hash_alg);
+			      WPA_KDK_MAX_LEN, 0, &hash_alg, false);
 
 	if (ret)
 		return ret;
diff --git a/src/common/wpa_common.c b/src/common/wpa_common.c
index 9bf675984..092365f24 100644
--- a/src/common/wpa_common.c
+++ b/src/common/wpa_common.c
@@ -1568,7 +1568,7 @@ static enum rsn_hash_alg pasn_select_hash_alg(int akmp, int cipher,
 
 
 /**
- * pasn_pmk_to_ptk - Calculate PASN PTK from PMK, addresses, etc.
+ * pasn_pmk_to_ptk - Calculate PASN/EPPKE PTK from PMK, addresses, etc.
  * @pmk: Pairwise master key
  * @pmk_len: Length of PMK
  * @spa: Suppplicant address
@@ -1582,13 +1582,15 @@ static enum rsn_hash_alg pasn_select_hash_alg(int akmp, int cipher,
  * @kdk_len: the length in octets that should be derived for HTLK. Can be zero.
  * @kek_len: The length in octets that should be derived for KEK. Can be zero.
  * @alg: Output variable for indicating the selected hash algorithm
+ * @is_eppke: EPPKE authentication
  * Returns: 0 on success, -1 on failure
  */
 int pasn_pmk_to_ptk(const u8 *pmk, size_t pmk_len,
 		    const u8 *spa, const u8 *bssid,
 		    const u8 *dhss, size_t dhss_len,
 		    struct wpa_ptk *ptk, int akmp, int cipher,
-		    size_t kdk_len, size_t kek_len, enum rsn_hash_alg *alg)
+		    size_t kdk_len, size_t kek_len, enum rsn_hash_alg *alg,
+		    bool is_eppke)
 {
 	u8 tmp[WPA_KCK_MAX_LEN + WPA_KEK_MAX_LEN + WPA_TK_MAX_LEN +
 	       WPA_KDK_MAX_LEN];
@@ -1596,7 +1598,8 @@ int pasn_pmk_to_ptk(const u8 *pmk, size_t pmk_len,
 	u8 *data;
 	size_t data_len, ptk_len;
 	int ret = -1;
-	const char *label = "PASN PTK Derivation";
+	const char *label = is_eppke ? "EPPKE PTK Derivation" :
+			    "PASN PTK Derivation";
 
 	if (!pmk || !pmk_len) {
 		wpa_printf(MSG_ERROR, "PASN: No PMK set for PTK derivation");
@@ -1609,6 +1612,9 @@ int pasn_pmk_to_ptk(const u8 *pmk, size_t pmk_len,
 	}
 
 	/*
+	 * Use "EPPKE PTK Derivation" instead of â€œPASN PTK Derivationâ€ for
+	 * EPPKE Authentication per IEEE P802.11bi/D2.0, section 12.16.9.3.4.
+	 *
 	 * PASN-PTK = KDF(PMK, â€œPASN PTK Derivationâ€, SPA || BSSID || DHss)
 	 *
 	 * KCK = L(PASN-PTK, 0, 256)
diff --git a/src/common/wpa_common.h b/src/common/wpa_common.h
index 8a3f23872..c90b44fab 100644
--- a/src/common/wpa_common.h
+++ b/src/common/wpa_common.h
@@ -780,7 +780,8 @@ int pasn_pmk_to_ptk(const u8 *pmk, size_t pmk_len,
 		    const u8 *spa, const u8 *bssid,
 		    const u8 *dhss, size_t dhss_len,
 		    struct wpa_ptk *ptk, int akmp, int cipher,
-		    size_t kdk_len, size_t kek_len, enum rsn_hash_alg *alg);
+		    size_t kdk_len, size_t kek_len, enum rsn_hash_alg *alg,
+		    bool is_eppke);
 
 size_t pasn_mic_len(enum rsn_hash_alg alg);
 
diff --git a/src/pasn/pasn_common.h b/src/pasn/pasn_common.h
index 58e11e44b..e71393496 100644
--- a/src/pasn/pasn_common.h
+++ b/src/pasn/pasn_common.h
@@ -49,6 +49,7 @@ struct pasn_data {
 	bool derive_kdk;
 	size_t kdk_len;
 	void *cb_ctx;
+	unsigned int auth_alg;
 
 #ifdef CONFIG_SAE
 	struct sae_pt *pt;
diff --git a/src/pasn/pasn_initiator.c b/src/pasn/pasn_initiator.c
index 74dde993b..a5091b562 100644
--- a/src/pasn/pasn_initiator.c
+++ b/src/pasn/pasn_initiator.c
@@ -1316,7 +1316,8 @@ int wpa_pasn_auth_rx(struct pasn_data *pasn, const u8 *data, size_t len,
 			      pasn->own_addr, pasn->peer_addr,
 			      wpabuf_head(secret), wpabuf_len(secret),
 			      &pasn->ptk, pasn->akmp, pasn->cipher,
-			      pasn->kdk_len, pasn->kek_len, &pasn->hash_alg);
+			      pasn->kdk_len, pasn->kek_len, &pasn->hash_alg,
+			      pasn->auth_alg == WLAN_AUTH_EPPKE);
 	if (ret) {
 		wpa_printf(MSG_DEBUG, "PASN: Failed to derive PTK");
 		goto fail;
diff --git a/src/pasn/pasn_responder.c b/src/pasn/pasn_responder.c
index 568442e28..21cf33cb3 100644
--- a/src/pasn/pasn_responder.c
+++ b/src/pasn/pasn_responder.c
@@ -414,7 +414,8 @@ pasn_derive_keys(struct pasn_data *pasn,
 			      wpabuf_head(secret), wpabuf_len(secret),
 			      &pasn->ptk, pasn->akmp,
 			      pasn->cipher, pasn->kdk_len, pasn->kek_len,
-			      &pasn->hash_alg);
+			      &pasn->hash_alg,
+			      pasn->auth_alg == WLAN_AUTH_EPPKE);
 	if (ret) {
 		wpa_printf(MSG_DEBUG, "PASN: Failed to derive PTK");
 		return -1;

From patchwork Thu Jan 15 16:32:50 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184695
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=trY8MCst;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=MKuBcEuh;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=kV+SFx0r;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsT8l4k72z1xt4
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:34:31 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=dJ7BO9brF7iF4hywun8tQVhQmkGRt8JiQ4MOTqFWX4Q=; b=trY8MCstpNqmAD
	EyZcoVuPiiLi3Nnblf+ExlAkRyyU/jf9kRO3XzKanArKVTZtXDaL2io+xmojBsUfKG+saLZF4P5Nj
	wAW76y2Rnwk7iLqQ17KCtVa3zYjLTz7dW+o89SjHlU70NdDuADZAA2+vX8CNIK4Ei/1jj1VoRI5Kz
	dmSEtk7HAzIb/GCzw/YHVlwWUiXPMOPdw1DDBgfXUBMO5RnpGWIkntc6AYVdB3sEugfi+F6VONuj4
	twJfS//DxRbACdgzJ4/a50ZVJBMCiglqEnQ8vNvCJMuujR7jzasx2699oE6Og0GlPEvXTZJ43x5st
	VNthrL0FChA6wDT3PmTQ==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQII-0000000ChnH-11se;
	Thu, 15 Jan 2026 16:33:58 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIF-0000000Chgw-0q1H
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:33:56 +0000
Received: from pps.filterd (m0279868.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFYUo62174872
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:54 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=iU5580k4onj
	bW1M2dJIhTAUdMECrRqy7ezrAMabmZ3w=; b=MKuBcEuhR43+gbH1P1IfoFpqXwt
	DyTC6iVk9+mZ/Xr5LSvEDmxLWz+ib0GP/XximCJB5rg9xHAZnmi6jwUjNnjzDpeD
	MoGyMnUPwJ6RS+LhfJ+Daasyv6FkzgjSyX4iweOUTRiIHh8nm8og1BT3Ik5dou02
	ZZl6ZjCC7Ko/bVGshYfQgZCYehrrJygp4+ZhHUYiFFm7Pba6B4c65b5P1rS5Q62Q
	o3j6JJ+fWOyGUXvgKK63ykq0tr0UL8FDnk5C2DEMHkbajYve/mnpDya2uu/n2mWe
	C+++/OQkvztlEH40lMQ608O8dDlMQhx0PaGg1eNvW5U9Lh41Qw0KYrt7+uA==
Received: from mail-pl1-f200.google.com (mail-pl1-f200.google.com
 [209.85.214.200])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bq1xh8ecw-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:53 +0000 (GMT)
Received: by mail-pl1-f200.google.com with SMTP id
 d9443c01a7336-29f25e494c2so11860435ad.0
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:33:53 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494833; x=1769099633;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=iU5580k4onjbW1M2dJIhTAUdMECrRqy7ezrAMabmZ3w=;
        b=kV+SFx0rIVBLOzCC8GsUMkICTeZ3mROTZdzZao0ULEIT7GXRarmH17eesKpbQFu/PD
         69VJwJ5gMEWHVxsnpNBtakgZ2Z3B/CyvcajPnFvBnOodH36sEXtDuoO4cUrtQjN20OY7
         Hb1GqkN83WZYpIhXdtnojcDOebNuydwFFSrH0Sa+iOqWWhRdk2Yv7u/PJGYhIIzpM9uy
         pRWFBj5oJEyNi86L0bhDLBNgIMgwQW52TwDtWgim2GGcwwE5l+qu0YSRVJL5yP9qzpsc
         +j4AhCOXjqEcM4SHHndA9vL7L4Cha/fHO12E2B/IOPgfZ3SpB5m9AkWYdrtoUhS89Bbo
         EFlw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494833; x=1769099633;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=iU5580k4onjbW1M2dJIhTAUdMECrRqy7ezrAMabmZ3w=;
        b=PMFbBjEjTlk1XMN3ltLccEaTHW+CS1QseecBlpymAa2oy65q+peI1pQdZU86+maXRc
         V/BDUbGVBJDcYbP9FWQfy1GUYPMEZM80sLhdiKoVhi2uoJ8fmep7b/N/Yoqe78Tr5ltf
         gr9KFrKQbGJbtoDQ+km4NATn27nks0iLqRmuDMbdDvKVLJCC4XDiaLpS+CWKoJ35T5Qg
         EjbxBQ5Rlzw5DDAPhsT1ZZL9UuqGh2JOvlfsaOrwQWRBmud4lJ5ElzYcVQApgfgu90LZ
         l3gIqmfZ/XLrbrhcbI7kVAwIpLPkxcsYwbS4GaKvQQMGLiePghSYu3I8WGVvvY2nIOej
         Hq7w==
X-Gm-Message-State: AOJu0YwAkkUFXx+VoRNdBE4t9fYlMU/MAbv6bmStrlrRGFTnPU+irB/k
	Wv7rfxXg6aTBHDBI0nPnnfWrWWbg03SDxtbqTKam5ZP/jT01sr+PFiREtSaOlCyN8AEOm9MUYiS
	V+wgJ0eAjfbvHMaxbfoFrSrqL/yoq0UEybRGuFkKkNrILPzcFGbbHzuqx0tsDDB8F3yttFB9a
X-Gm-Gg: AY/fxX5SIs6nHXyvcguP65Fv+1rFcZsDFW8jMi1+CbNBJSVe3H/ghU84SDcqy6VONNA
	jywi21VsYLOUHDsARMJQJgPpBnHH75pLa/gO6X3m90pIJmomKEJJnKVqZRdlp8ufoKURSqjMMTU
	QZP5CZInKgv46/JpMETLAzL4q6hIMVUAnBhlsIc/r9gBZg/FGdLy2NQXbKMm65cFJRRIPRwgFLH
	NYVA2Taw9t2JE5dBLksf7rt5HMCS2M1DaFjpuSTXS93m3/FgkbAMFTqH42AOoSXgI5LybnvddW9
	UZhiwOQQCA2ygdhjwpZuG+pe0vL54GGQ7kUFnqBPLunPsnIJ5HDpDLHVkxfIHMHNBVb+cawp/9h
	46gwGoiI+7My+zXK3nbvcgbb9xqRbrI/5shxokNp6
X-Received: by 2002:a17:903:15c3:b0:2a0:d454:5372 with SMTP id
 d9443c01a7336-2a717809d61mr589415ad.22.1768494832745;
        Thu, 15 Jan 2026 08:33:52 -0800 (PST)
X-Received: by 2002:a17:903:15c3:b0:2a0:d454:5372 with SMTP id
 d9443c01a7336-2a717809d61mr589245ad.22.1768494832214;
        Thu, 15 Jan 2026 08:33:52 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.33.50
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:33:51 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 11/27] PASN: Modify PASN Authentication frame header APIs
 based on auth_algo
Date: Thu, 15 Jan 2026 22:02:50 +0530
Message-Id: <20260115163306.367753-12-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-ORIG-GUID: 3dh307_k83e_2YtILFEtYR2U1dFgm8OI
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfXyAWBlgdJvYsV
 tHdos6FwPKWUv5xbsOlLZ1RCBzm1PW9pbIssmBMG+KDsIDrw5yvrIW/HPU9v3LLZMB9SR7+3Hk6
 FZc/mbbrGZIOeWXq3mxmKa8vN3cuVui9H03k+Rfi2HG2KiKasTQHnY4yZMa8x5JRO7fD9giINYE
 jRuFdJwoA/rSk7dj/x8dI08wgSsM/C+wEJwtYW0vMMx4cPhFnc6aTiXk45gOhnajORjtbMWMzl8
 WRhQclklqoDwgdFaHZoyMiElEDNVWUw9iuCzpmc3+ibwiBkaQo7hOaCPurkdU0cAYtEc652yn/0
 ucUeaH7hQfcFieY5oZBMoAeC2FbFn4S5IbiQdDcoD9zX2v/7dUtZDtlcEmYz+dcSDCRgock/MEI
 i6OXAhpl5geaENVRW2ksjHEbRWywKZpDbk0rif6T9wSD+Bn2EVYdQGY6hpMvE+JC3w5yWe6X/Bt
 r5AeLpz0AgQJ1glSj3A==
X-Authority-Analysis: v=2.4 cv=TdWbdBQh c=1 sm=1 tr=0 ts=696916f2 cx=c_pps
 a=IZJwPbhc+fLeJZngyXXI0A==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=0Y48sV1_-8SCTj8G_BoA:9 a=uG9DUKGECoFWVXl0Dc02:22
X-Proofpoint-GUID: 3dh307_k83e_2YtILFEtYR2U1dFgm8OI
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 clxscore=1015 phishscore=0 lowpriorityscore=0 impostorscore=0 malwarescore=0
 bulkscore=0 priorityscore=1501 adultscore=0 spamscore=0 suspectscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_083355_364286_204CDF2E 
X-CRM114-Status: GOOD (  16.39  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com> Modify
    PASN Authentication frame header API - wpa_pasn_build_auth_header() to
 build
    EPPKE Authentication frame header if auth_algo is WLAN_AUTH_EPPKE else
 build
    a PASN Authentication frame header
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.0 SPF_PASS               SPF: sender matches SPF record
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

Modify PASN Authentication frame header API -
wpa_pasn_build_auth_header() to build EPPKE Authentication
frame header if auth_algo is WLAN_AUTH_EPPKE else build a
PASN Authentication frame header

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
Signed-off-by: Rohan Dutta <drohan@qti.qualcomm.com>
Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
---
 src/common/wpa_common.c   | 10 ++++++----
 src/common/wpa_common.h   |  2 +-
 src/pasn/pasn_initiator.c |  6 ++++--
 src/pasn/pasn_responder.c |  5 +++--
 4 files changed, 14 insertions(+), 9 deletions(-)

diff --git a/src/common/wpa_common.c b/src/common/wpa_common.c
index 092365f24..16c956aa8 100644
--- a/src/common/wpa_common.c
+++ b/src/common/wpa_common.c
@@ -3963,15 +3963,17 @@ int wpa_parse_kde_ies(const u8 *buf, size_t len, struct wpa_eapol_ie_parse *ie)
  * @dst: Destination address
  * @trans_seq: Authentication transaction sequence number
  * @status: Authentication status
+ * @is_eppke: EPPKE authentication
  */
 void wpa_pasn_build_auth_header(struct wpabuf *buf, const u8 *bssid,
 				const u8 *src, const u8 *dst,
-				u8 trans_seq, u16 status)
+				u8 trans_seq, u16 status, bool is_eppke)
 {
 	struct ieee80211_mgmt *auth;
+	u16 auth_alg = is_eppke ? WLAN_AUTH_EPPKE : WLAN_AUTH_PASN;
 
-	wpa_printf(MSG_DEBUG, "PASN: Add authentication header. trans_seq=%u",
-		   trans_seq);
+	wpa_printf(MSG_DEBUG, "%s: Add authentication header trans_seq=%u",
+		   is_eppke ? "EPPKE" : "PASN", trans_seq);
 
 	auth = wpabuf_put(buf, offsetof(struct ieee80211_mgmt,
 					u.auth.variable));
@@ -3984,7 +3986,7 @@ void wpa_pasn_build_auth_header(struct wpabuf *buf, const u8 *bssid,
 	os_memcpy(auth->bssid, bssid, ETH_ALEN);
 	auth->seq_ctrl = 0;
 
-	auth->u.auth.auth_alg = host_to_le16(WLAN_AUTH_PASN);
+	auth->u.auth.auth_alg = host_to_le16(auth_alg);
 	auth->u.auth.auth_transaction = host_to_le16(trans_seq);
 	auth->u.auth.status_code = host_to_le16(status);
 }
diff --git a/src/common/wpa_common.h b/src/common/wpa_common.h
index c90b44fab..fcd7168e2 100644
--- a/src/common/wpa_common.h
+++ b/src/common/wpa_common.h
@@ -797,7 +797,7 @@ int pasn_auth_frame_hash(enum rsn_hash_alg alg, const u8 *data, size_t len,
 
 void wpa_pasn_build_auth_header(struct wpabuf *buf, const u8 *bssid,
 				const u8 *src, const u8 *dst,
-				u8 trans_seq, u16 status);
+				u8 trans_seq, u16 status, bool is_eppke);
 
 int wpa_pasn_add_rsne(struct wpabuf *buf, const u8 *pmkid,
 		      int akmp, int cipher);
diff --git a/src/pasn/pasn_initiator.c b/src/pasn/pasn_initiator.c
index a5091b562..68a4f09fa 100644
--- a/src/pasn/pasn_initiator.c
+++ b/src/pasn/pasn_initiator.c
@@ -611,7 +611,8 @@ static struct wpabuf * wpas_pasn_build_auth_1(struct pasn_data *pasn,
 
 	wpa_pasn_build_auth_header(buf, pasn->bssid,
 				   pasn->own_addr, pasn->peer_addr,
-				   pasn->trans_seq + 1, WLAN_STATUS_SUCCESS);
+				   pasn->trans_seq + 1, WLAN_STATUS_SUCCESS,
+				   pasn->auth_alg == WLAN_AUTH_EPPKE);
 
 	pmkid = NULL;
 	if (wpa_key_mgmt_ft(pasn->akmp)) {
@@ -707,7 +708,8 @@ static struct wpabuf * wpas_pasn_build_auth_3(struct pasn_data *pasn)
 	wpa_pasn_build_auth_header(buf, pasn->bssid,
 				   pasn->own_addr, pasn->peer_addr,
 				   WLAN_AUTH_TR_SEQ_PASN_AUTH3,
-				   WLAN_STATUS_SUCCESS);
+				   WLAN_STATUS_SUCCESS,
+				   pasn->auth_alg == WLAN_AUTH_EPPKE);
 
 	wrapped_data_buf = wpas_pasn_get_wrapped_data(pasn);
 
diff --git a/src/pasn/pasn_responder.c b/src/pasn/pasn_responder.c
index 21cf33cb3..95d7b2e3c 100644
--- a/src/pasn/pasn_responder.c
+++ b/src/pasn/pasn_responder.c
@@ -452,7 +452,8 @@ static void handle_auth_pasn_comeback(struct pasn_data *pasn,
 		return;
 
 	wpa_pasn_build_auth_header(buf, pasn->bssid, own_addr, peer_addr, 2,
-				   WLAN_STATUS_ASSOC_REJECTED_TEMPORARILY);
+				   WLAN_STATUS_ASSOC_REJECTED_TEMPORARILY,
+				   pasn->auth_alg == WLAN_AUTH_EPPKE);
 
 	/*
 	 * Do not include the group as a part of the token since it is not going
@@ -510,7 +511,7 @@ int handle_auth_pasn_resp(struct pasn_data *pasn, const u8 *own_addr,
 		goto fail;
 
 	wpa_pasn_build_auth_header(buf, pasn->bssid, own_addr, peer_addr, 2,
-				   status);
+				   status, pasn->auth_alg == WLAN_AUTH_EPPKE);
 
 	if (status != WLAN_STATUS_SUCCESS)
 		goto done;

From patchwork Thu Jan 15 16:32:51 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184696
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=Z49BlJ4x;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=dDEYToCc;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=f0VsAZbo;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsT8q4J4Gz1xt4
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:34:35 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=WZQp59N651lPWk98gCkgBDTnq7hqpqlCVmkL5XpQGD8=; b=Z49BlJ4xbb+0Vi
	opHQPONQQY6BYIsrHw4aei0JNAA2vUxFhzo3v7aNTZj8SmOhuDrtlktPL6CFN1FWjxv6ljOoAYu0m
	cOO4Uz5NAQINNSB/vboeHoV0/XOhFkNMZcGsOZgGGp6r0r6YXx9M6pMK3wxfXcMI9rfbiQc1QDF5/
	KEHannZ0Cb+grW340rZNj69Gefoie9Q1OpTapCsuun9ztgeHVcKnNdV5NdaKv9NgKzbeourslAdMp
	Ysk6p+be0QMObDwZlAkuY6mU2/Q0JZNFmK4AeHQmwRxBlVqDt5CP/qSWGPd1Xc/Yb1y6Zf/Q1/kob
	0gtZSmT5WDR1pEqBHfnw==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIM-0000000Cht4-1MD9;
	Thu, 15 Jan 2026 16:34:02 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIH-0000000Chke-1yGB
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:33:59 +0000
Received: from pps.filterd (m0279873.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFYOAU1722894
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:56 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=e5+Bpl4Htdu
	jyd98U5M6nFQoOkLVxm9HfaxkbrpoelU=; b=dDEYToCcwQyVRrKf+VrhginATtm
	+/Oks1RqwiQu0ZLE8nWzwm3rML2uo8OISdSttLk8J7ekIirAYqBQUB1ViNT35WFS
	/1lkbxIkvHVenUBI2beZ4VYSPfyAkF7YexYvPIjf6j3r2VLgHwuFl/97qiCNcIsI
	dXnoufP3ev34lp+WBLMpqOfDshw7OEJkIeSQJPETiwWy2C2lRj8TIhtoLNaJ512c
	3hXDof82zH1dddz43O1W2138gdJDDIXEDeFBzdgMRwhtSKJyI/8sy8zxGQ6DbfDH
	hOqbsf7banT9E2IK8Et43vmkRnr3tVMcR4kbed406KhH/eh4LDMc73qGQjw==
Received: from mail-pl1-f199.google.com (mail-pl1-f199.google.com
 [209.85.214.199])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bptna1p9h-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:56 +0000 (GMT)
Received: by mail-pl1-f199.google.com with SMTP id
 d9443c01a7336-2a13cd9a784so8482565ad.2
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:33:56 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494835; x=1769099635;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=e5+Bpl4Htdujyd98U5M6nFQoOkLVxm9HfaxkbrpoelU=;
        b=f0VsAZboezIFQsPKZYNyRuKH0ZlItVC/03/sia+8TPQz6b0vjunxKzHwMqCKp7LQRO
         VlQeXxB7KnczQZVI6GoYkzq0l6yvGWWZx+pJmVyvCHmcoF/uoubdOHKTleqCP9e3BxWY
         TWCtMmBwhSqA8QrNCOgA5K1nsXriGEPNG8QNl6Uf53P9oFQOCgpte4nJWOm8pi+YvULt
         rilYpFJ2CD+3Mfff0jlO879i1cS12kRA8ZZHfHuV/K1E6u0OKt9shwj8TGzCTKSMrpbx
         nYaF1PrHRmntZPVKTquaR5U2QriN7gyrgVLUJC8a4W3dgRVOPaBhTFUIz+on92dqDEZ6
         fsBQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494835; x=1769099635;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=e5+Bpl4Htdujyd98U5M6nFQoOkLVxm9HfaxkbrpoelU=;
        b=VGQE9LdRTS7q/cqfr2GhUeprFfEM62Q3oqPqFfg/qszYfKwve3PhrpqeGb+GEAL7hZ
         BSJ2ZFB1c1cAVxAmm/1v2cr5SxFkSi/s5DUQB1dV97htqV1BwYGTkSFEODCnm5/kq1k/
         n74qW/uWDBtvJJ7k16bzwAzVOKhmFJx7fO87hD0j7oDBWhcIPLSvOYC4fThVEhtnB5Go
         4yarHy95zTlGyEdCByG3iKccjRjoF0qXciyqcHplvASi4DlobbPJrFxjFMvH+Y3Efxci
         dewewHNbSThdN2Fq1hmrMZRM2fKOpgmgmw0pms2m/CXkGZZW2nWLTh15yFDzA0smO7gZ
         kq4Q==
X-Gm-Message-State: AOJu0YwyPpdRtGqiE19HcwigfVGTAppHAobHkuhaeGvkk/dY0rPO9RRz
	gYfTCymjnzV5r3IzyPUat+I9Hjs0cVJcsL19MLHR645lDgb6HOZen2tJnpTP5FbsgBIALCMxGm/
	weXIgohYHODvox2FtMpje7x8bGtArfgghUyqbirvLum+wXQpWn57bzVJEB9cqlCM9nVBlQPeG
X-Gm-Gg: AY/fxX4iSli5craHjeL/jdKeFNzRy9yuBmBvzRb2wIkHy2xF31l6V9hqHqUYrUIeiLK
	mlhwiUlwQbkmOUZ5UErMRHg5vXAmP1BB4kf0A8eipVAdmvqaK/Px25f1ToCSH8ntXSbxLLW+eJU
	U/9z8r+gYUW24ud0cWjj5FZtPeB88f5BJOKbOulxb5IwfZeYazMjCmnEspe+hbXNR8RrtWL+8B7
	mo4yuITrR80Lr8p4Es4rA7AhH/U7GBN4jOANdc8UxJblC3quF8bZmWbOmo2itaAcxdFHAw0aC2w
	sUpMin38sR1xQpfSeSStoqaAN7L69HtTiaBbleoqja/5cCOgOZ2aN4jKrbK0d/PDnWds3NuB6vJ
	+9PX5hlaVUfHXlEweA8wxahSSmi6DasK2IuLr7Bfv
X-Received: by 2002:a17:903:234e:b0:295:8a21:155a with SMTP id
 d9443c01a7336-2a7176c50bdmr667005ad.35.1768494834909;
        Thu, 15 Jan 2026 08:33:54 -0800 (PST)
X-Received: by 2002:a17:903:234e:b0:295:8a21:155a with SMTP id
 d9443c01a7336-2a7176c50bdmr666775ad.35.1768494834312;
        Thu, 15 Jan 2026 08:33:54 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.33.52
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:33:53 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 12/27] EPPKE: Extend existing PASN APIs for EPPKE
 Authentication
Date: Thu, 15 Jan 2026 22:02:51 +0530
Message-Id: <20260115163306.367753-13-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-GUID: z5EMaTTLadLH2Duk5A5eQ2npA_uE05XU
X-Proofpoint-ORIG-GUID: z5EMaTTLadLH2Duk5A5eQ2npA_uE05XU
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX/Ny9UbtL3Bbo
 pOTzkTWO9NTHxuyNYGUYXZbDWLXs6ayDAnx58xjFqcpJxC6sF0255AnIJh6v/+ypgv80xSGavzY
 XXTlW1ZRrrGPByOULHedAIJ9LYOoLAmFymphM01qTmCYMCQZBsY1ElCT7xF/3X+Ns2wMgETCqtW
 XWtFAy5ozr2/2YPCGJdkQQi67P6L1sDSUWKiL32PFUiV6dO05RxiMkhA+1qtuYSMiaqm9wyDRKy
 QDLaLXSDZYcy0rNXMX/4zOvnM9OkKzoXlTLQJGHI7U8s0H/6r6279WCd2qe1y7QwXr0M0ThPLlp
 hF3MrhDnFKO3fK/f5kuMJm1kWpf6rVDWBYiW97m48feeViH0vwVUg49JO4wS3/0fXulX0uPc8A2
 hVH77RG6rqj+h3LAHa+pFwrHnkrpFRDyZCBLNuMjTIWy30D0mQMi85Am7sR2Qa0KVIEqkUSjD2h
 CPEiERQee9v1OW7sMWg==
X-Authority-Analysis: v=2.4 cv=fsHRpV4f c=1 sm=1 tr=0 ts=696916f4 cx=c_pps
 a=JL+w9abYAAE89/QcEU+0QA==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=-p00wUXRotJ8S6rdUekA:9 a=324X-CrmTo6CU4MGRt3R:22
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 malwarescore=0 priorityscore=1501 bulkscore=0 adultscore=0 spamscore=0
 clxscore=1015 impostorscore=0 phishscore=0 lowpriorityscore=0 suspectscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_083357_642019_59C590CC 
X-CRM114-Status: GOOD (  24.84  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com> As per
    IEEE P802.11bi/D2.0,
 12.16.9.3.2 (EPPKE Frame Construction and Processing),
    PASN frame construction and processing apply for EPPKE authentication with
    few differences. So Extend the existing PA [...]
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.0 SPF_PASS               SPF: sender matches SPF record
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

As per IEEE P802.11bi/D2.0, 12.16.9.3.2 (EPPKE
Frame Construction and Processing), PASN frame construction
and processing apply for EPPKE authentication with few
differences. So Extend the existing PASN APIs to
accommodate EPPKE authentication

This change adds following extensions for AP Responder:
  -Skip sta object deletion after Authentication frame 3
   processing
  -Bypass the vendor interface to set keys to driver
   (QCA_NL80211_VENDOR_SUBCMD_SECURE_RANGING_CONTEXT).
  -NL80211_CMD_NEW_KEY will be used to set keys to driver
   for EPPK initiated link after processing of EPPKE
   Authentication frame 1
  -For MLO Association:
   Provision PMK to be cached in ML PMK cache
   Include Basic MLE in Authentication frame 2

To support the EPPKE flow, extend pasn_data structure to hold:
   AP MLD Address
   ML STA indication

Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
Signed-off-by: Rohan Dutta <drohan@qti.qualcomm.com>
---
 hostapd/Makefile          |  5 +++
 hostapd/defconfig         |  3 ++
 src/ap/ieee802_11.c       | 77 +++++++++++++++++++++++++++++++++------
 src/ap/ieee802_11_eht.c   |  1 +
 src/ap/sta_info.h         |  4 +-
 src/ap/wpa_auth.c         |  4 +-
 src/ap/wpa_auth.h         |  2 +-
 src/pasn/pasn_common.c    | 10 +++++
 src/pasn/pasn_common.h    |  3 ++
 src/pasn/pasn_responder.c | 38 ++++++++++++++++++-
 10 files changed, 131 insertions(+), 16 deletions(-)

diff --git a/hostapd/Makefile b/hostapd/Makefile
index 70029bb0d..b9992530e 100644
--- a/hostapd/Makefile
+++ b/hostapd/Makefile
@@ -615,6 +615,11 @@ OBJS += ../src/ap/nan_usd_ap.o
 CFLAGS += -DCONFIG_NAN_USD
 endif
 
+ifdef CONFIG_ENC_ASSOC
+CONFIG_PASN=y
+CFLAGS += -DCONFIG_ENC_ASSOC
+endif
+
 ifdef CONFIG_PASN
 CFLAGS += -DCONFIG_PASN
 CFLAGS += -DCONFIG_PTKSA_CACHE
diff --git a/hostapd/defconfig b/hostapd/defconfig
index 2dd132831..dddd75d95 100644
--- a/hostapd/defconfig
+++ b/hostapd/defconfig
@@ -418,3 +418,6 @@ CONFIG_DPP2=y
 
 # Wi-Fi Aware unsynchronized service discovery (NAN USD)
 #CONFIG_NAN_USD=y
+
+# Feature support based on IEEE P802.11bi/D2.0
+#CONFIG_ENC_ASSOC=y
diff --git a/src/ap/ieee802_11.c b/src/ap/ieee802_11.c
index c1ff3fa8a..2e0b9eb95 100644
--- a/src/ap/ieee802_11.c
+++ b/src/ap/ieee802_11.c
@@ -3001,6 +3001,10 @@ static void hapd_initialize_pasn(struct hostapd_data *hapd,
 	pasn_register_callbacks(pasn, hapd, hapd_pasn_send_mlme, NULL);
 	pasn_set_bssid(pasn, hapd->own_addr);
 	pasn_set_own_addr(pasn, hapd->own_addr);
+#if defined(CONFIG_IEEE80211BE) && defined(CONFIG_ENC_ASSOC)
+	if (hapd->conf->mld_ap)
+		pasn_set_own_mld_addr(pasn, hapd->mld->mld_addr);
+#endif /* CONFIG_IEEE80211BE && CONFIG_ENC_ASSOC */
 	pasn_set_peer_addr(pasn, sta->addr);
 	pasn_set_wpa_key_mgmt(pasn, hapd->conf->wpa_key_mgmt);
 	pasn_set_rsn_pairwise(pasn, hapd->conf->rsn_pairwise);
@@ -3021,8 +3025,15 @@ static void hapd_initialize_pasn(struct hostapd_data *hapd,
 	pasn->rsn_ie = wpa_auth_get_wpa_ie(hapd->wpa_auth, &pasn->rsn_ie_len);
 	pasn_set_rsnxe_ie(pasn, hostapd_wpa_ie(hapd, WLAN_EID_RSNX));
 	pasn->disable_pmksa_caching = hapd->conf->disable_pmksa_caching;
+#ifdef CONFIG_ENC_ASSOC
 	pasn_set_responder_pmksa(pasn,
-				 wpa_auth_get_pmksa_cache(hapd->wpa_auth));
+				 wpa_auth_get_pmksa_cache(hapd->wpa_auth,
+							  (sta->epp_sta ?
+							  ap_sta_is_mld(hapd, sta) : false)));
+#else
+	pasn_set_responder_pmksa(pasn,
+				 wpa_auth_get_pmksa_cache(hapd->wpa_auth, false));
+#endif /* CONFIG_ENC_ASSOC */
 
 	pasn->comeback_after = hapd->conf->pasn_comeback_after;
 	pasn->comeback_idx = hapd->comeback_idx;
@@ -3098,7 +3109,12 @@ static void hapd_pasn_update_params(struct hostapd_data *hapd,
 		wpa_printf(MSG_DEBUG, "PASN: Mismatch in AKMP/cipher");
 		return;
 	}
-
+#ifdef CONFIG_ENC_ASSOC
+	pasn->auth_alg = mgmt->u.auth.auth_alg;
+#ifdef CONFIG_IEEE80211BE
+	pasn->is_ml_peer = sta->mld_info.mld_sta;
+#endif
+#endif /* CONFIG_ENC_ASSOC */
 	pasn_set_akmp(pasn, rsn_data.key_mgmt);
 	pasn_set_cipher(pasn, rsn_data.pairwise_cipher);
 
@@ -3237,19 +3253,31 @@ static void handle_auth_pasn(struct hostapd_data *hapd, struct sta_info *sta,
 			return;
 		}
 
-		if (handle_auth_pasn_3(sta->pasn, hapd->own_addr,
-				       sta->addr, mgmt, len) == 0) {
+		if ((ret = handle_auth_pasn_3(sta->pasn, hapd->own_addr,
+					      sta->addr, mgmt, len)) == 0) {
+#ifdef CONFIG_ENC_ASSOC
+			if (sta->epp_sta) {
+				sta->auth_alg = WLAN_AUTH_EPPKE;
+				sta->flags |= WLAN_STA_AUTH;
+			}
+#endif /* CONFIG_ENC_ASSOC */
 			ptksa_cache_add(hapd->ptksa, hapd->own_addr, sta->addr,
 					pasn_get_cipher(sta->pasn), 43200,
 					pasn_get_ptk(sta->pasn), NULL, NULL,
 					pasn_get_akmp(sta->pasn));
+#ifdef CONFIG_ENC_ASSOC
+			if (!sta->epp_sta)
+#endif /* CONFIG_ENC_ASSOC */
+				pasn_set_keys_from_cache(hapd, hapd->own_addr,
+							 sta->addr,
+							 pasn_get_cipher(sta->pasn),
+							 pasn_get_akmp(sta->pasn));
+		}
+#ifdef CONFIG_ENC_ASSOC
+		if (!sta->epp_sta || (sta->epp_sta && ret < 0))
+#endif /* CONFIG_ENC_ASSOC */
+			ap_free_sta(hapd, sta);
 
-			pasn_set_keys_from_cache(hapd, hapd->own_addr,
-						 sta->addr,
-						 pasn_get_cipher(sta->pasn),
-						 pasn_get_akmp(sta->pasn));
-		}
-		ap_free_sta(hapd, sta);
 	} else {
 		wpa_printf(MSG_DEBUG,
 			   "PASN: Invalid transaction %u - ignore", trans_seq);
@@ -3339,6 +3367,17 @@ static void handle_auth(struct hostapd_data *hapd,
 	}
 #endif /* CONFIG_NO_RC4 */
 
+#ifdef CONFIG_ENC_ASSOC
+	if (auth_alg == WLAN_AUTH_EPPKE &&
+	    !hapd->conf->assoc_frame_encryption) {
+		wpa_printf(MSG_INFO,
+			   "Unsupported EPPKE authentication algorithm (%d)",
+			   auth_alg);
+		resp = WLAN_STATUS_NOT_SUPPORTED_AUTH_ALG;
+		goto fail;
+	}
+#endif /* CONFIG_ENC_ASSOC */
+
 	if (hapd->tkip_countermeasures) {
 		wpa_printf(MSG_DEBUG,
 			   "Ongoing TKIP countermeasures (Michael MIC failure) - reject authentication");
@@ -3371,6 +3410,11 @@ static void handle_auth(struct hostapd_data *hapd,
 	       (hapd->conf->wpa_key_mgmt & WPA_KEY_MGMT_PASN) &&
 	       auth_alg == WLAN_AUTH_PASN) ||
 #endif /* CONFIG_PASN */
+#ifdef CONFIG_ENC_ASSOC
+		(hapd->conf->wpa &&
+		 (hapd->conf->wpa_key_mgmt & WPA_KEY_MGMT_EPPKE) &&
+		 auth_alg == WLAN_AUTH_EPPKE) ||
+#endif /* CONFIG_ENC_ASSOC */
 	      ((hapd->conf->auth_algs & WPA_AUTH_ALG_SHARED) &&
 	       auth_alg == WLAN_AUTH_SHARED_KEY))) {
 		wpa_printf(MSG_INFO, "Unsupported authentication algorithm (%d)",
@@ -3388,6 +3432,9 @@ static void handle_auth(struct hostapd_data *hapd,
 	      (auth_alg == WLAN_AUTH_PASN &&
 	       auth_transaction == WLAN_AUTH_TR_SEQ_PASN_AUTH3) ||
 #endif /* CONFIG_PASN */
+#ifdef CONFIG_ENC_ASSOC
+	      (auth_alg == WLAN_AUTH_EPPKE && auth_transaction == 3) ||
+#endif /* CONFIG_ENC_ASSOC */
 	      (auth_alg == WLAN_AUTH_SHARED_KEY && auth_transaction == 3))) {
 		wpa_printf(MSG_INFO, "Unknown authentication transaction number (%d)",
 			   auth_transaction);
@@ -3565,7 +3612,12 @@ static void handle_auth(struct hostapd_data *hapd,
 			goto fail;
 		}
 	}
-
+#ifdef CONFIG_ENC_ASSOC
+	if (auth_alg == WLAN_AUTH_EPPKE) {
+		wpa_printf(MSG_DEBUG, "Mark the station as an EPP Peer");
+		sta->epp_sta = true;
+	}
+#endif /* CONFIG_ENC_ASSOC */
 #ifdef CONFIG_IEEE80211BE
 	/* Set the non-AP MLD information based on the initial Authentication
 	 * frame. Once the STA entry has been added to the driver, the driver
@@ -3730,6 +3782,9 @@ static void handle_auth(struct hostapd_data *hapd,
 				 handle_auth_fils_finish);
 		return;
 #endif /* CONFIG_FILS */
+#ifdef CONFIG_ENC_ASSOC
+	case WLAN_AUTH_EPPKE:
+#endif /* CONFIG_ENC_ASSOC */
 #ifdef CONFIG_PASN
 	case WLAN_AUTH_PASN:
 		handle_auth_pasn(hapd, sta, mgmt, len, auth_transaction,
diff --git a/src/ap/ieee802_11_eht.c b/src/ap/ieee802_11_eht.c
index feeb77ebe..cb63a5b22 100644
--- a/src/ap/ieee802_11_eht.c
+++ b/src/ap/ieee802_11_eht.c
@@ -1060,6 +1060,7 @@ static const u8 * auth_skip_fixed_fields(struct hostapd_data *hapd,
 	 * (Presence of fields and elements in Authentications frames) */
 	switch (auth_alg) {
 	case WLAN_AUTH_OPEN:
+	case WLAN_AUTH_EPPKE:
 		return pos;
 #ifdef CONFIG_SAE
 	case WLAN_AUTH_SAE:
diff --git a/src/ap/sta_info.h b/src/ap/sta_info.h
index 3fb97edd5..18218b949 100644
--- a/src/ap/sta_info.h
+++ b/src/ap/sta_info.h
@@ -99,7 +99,9 @@ struct sta_info {
 	u8 supported_rates[WLAN_SUPP_RATES_MAX];
 	int supported_rates_len;
 	u8 qosinfo; /* Valid when WLAN_STA_WMM is set */
-
+#ifdef CONFIG_ENC_ASSOC
+	bool epp_sta; /* Indicates if the station is an EPP peer */
+#endif /* CONFIG_ENC_ASSOC */
 #ifdef CONFIG_MESH
 	enum mesh_plink_state plink_state;
 	u16 peer_lid;
diff --git a/src/ap/wpa_auth.c b/src/ap/wpa_auth.c
index 620e55387..040efd4a4 100644
--- a/src/ap/wpa_auth.c
+++ b/src/ap/wpa_auth.c
@@ -6895,11 +6895,11 @@ int wpa_auth_pmksa_add_entry(struct wpa_authenticator *wpa_auth,
 
 
 struct rsn_pmksa_cache *
-wpa_auth_get_pmksa_cache(struct wpa_authenticator *wpa_auth)
+wpa_auth_get_pmksa_cache(struct wpa_authenticator *wpa_auth, bool is_ml)
 {
 	if (!wpa_auth || !wpa_auth->pmksa)
 		return NULL;
-	return wpa_auth->pmksa;
+	return is_ml ? wpa_auth->ml_pmksa : wpa_auth->pmksa;
 }
 
 
diff --git a/src/ap/wpa_auth.h b/src/ap/wpa_auth.h
index 36954a19a..4883e2db9 100644
--- a/src/ap/wpa_auth.h
+++ b/src/ap/wpa_auth.h
@@ -541,7 +541,7 @@ wpa_auth_pmksa_create_entry(const u8 *aa, const u8 *spa, const u8 *pmk,
 int wpa_auth_pmksa_add_entry(struct wpa_authenticator *wpa_auth,
 			     struct rsn_pmksa_cache_entry *entry);
 struct rsn_pmksa_cache *
-wpa_auth_get_pmksa_cache(struct wpa_authenticator *wpa_auth);
+wpa_auth_get_pmksa_cache(struct wpa_authenticator *wpa_auth, bool is_ml);
 struct rsn_pmksa_cache_entry *
 wpa_auth_pmksa_get(struct wpa_authenticator *wpa_auth, const u8 *sta_addr,
 		   const u8 *pmkid);
diff --git a/src/pasn/pasn_common.c b/src/pasn/pasn_common.c
index 11916bd18..bd197bebd 100644
--- a/src/pasn/pasn_common.c
+++ b/src/pasn/pasn_common.c
@@ -100,6 +100,16 @@ void pasn_set_own_addr(struct pasn_data *pasn, const u8 *addr)
 }
 
 
+#ifdef CONFIG_ENC_ASSOC
+void pasn_set_own_mld_addr(struct pasn_data *pasn, const u8 *addr)
+{
+	if (!pasn || !addr)
+		return;
+	os_memcpy(pasn->mld_addr, addr, ETH_ALEN);
+}
+#endif /* CONFIG_ENC_ASSOC */
+
+
 void pasn_set_peer_addr(struct pasn_data *pasn, const u8 *addr)
 {
 	if (!pasn || !addr)
diff --git a/src/pasn/pasn_common.h b/src/pasn/pasn_common.h
index e71393496..f5e22c1d9 100644
--- a/src/pasn/pasn_common.h
+++ b/src/pasn/pasn_common.h
@@ -50,6 +50,8 @@ struct pasn_data {
 	size_t kdk_len;
 	void *cb_ctx;
 	unsigned int auth_alg;
+	u8 mld_addr[ETH_ALEN];
+	bool is_ml_peer;
 
 #ifdef CONFIG_SAE
 	struct sae_pt *pt;
@@ -212,6 +214,7 @@ void pasn_disable_kdk_derivation(struct pasn_data *pasn);
 void pasn_set_akmp(struct pasn_data *pasn, int akmp);
 void pasn_set_cipher(struct pasn_data *pasn, int cipher);
 void pasn_set_own_addr(struct pasn_data *pasn, const u8 *addr);
+void pasn_set_own_mld_addr(struct pasn_data *pasn, const u8 *addr);
 void pasn_set_peer_addr(struct pasn_data *pasn, const u8 *addr);
 void pasn_set_bssid(struct pasn_data *pasn, const u8 *addr);
 void pasn_set_initiator_pmksa(struct pasn_data *pasn,
diff --git a/src/pasn/pasn_responder.c b/src/pasn/pasn_responder.c
index 95d7b2e3c..8ad6ff03c 100644
--- a/src/pasn/pasn_responder.c
+++ b/src/pasn/pasn_responder.c
@@ -147,7 +147,10 @@ static int pasn_wd_handle_sae_commit(struct pasn_data *pasn,
 		wpa_printf(MSG_DEBUG, "PASN: No SAE PT found");
 		return -1;
 	}
-
+#ifdef CONFIG_ENC_ASSOC
+	if (pasn->auth_alg == WLAN_AUTH_EPPKE && pasn->is_ml_peer)
+		own_addr = pasn->mld_addr;
+#endif
 	ret = sae_prepare_commit_pt(&pasn->sae, pasn->pt, own_addr, peer_addr,
 				    NULL, NULL);
 	if (ret) {
@@ -575,6 +578,17 @@ int handle_auth_pasn_resp(struct pasn_data *pasn, const u8 *own_addr,
 		pasn->prepare_data_element(pasn->cb_ctx, peer_addr);
 
 	wpa_pasn_add_extra_ies(buf, pasn->extra_ies, pasn->extra_ies_len);
+#ifdef CONFIG_ENC_ASSOC
+	if (pasn->auth_alg == WLAN_AUTH_EPPKE && pasn->is_ml_peer) {
+		wpa_printf(MSG_DEBUG, "EPPKE: Add Multi Link IE");
+		wpabuf_put_u8(buf, WLAN_EID_EXTENSION);
+		wpabuf_put_u8(buf, 10);
+		wpabuf_put_u8(buf, WLAN_EID_EXT_MULTI_LINK);
+		wpabuf_put_le16(buf, MULTI_LINK_CONTROL_TYPE_BASIC);
+		wpabuf_put_u8(buf, ETH_ALEN + 1);
+		wpabuf_put_data(buf, pasn->mld_addr, ETH_ALEN);
+	}
+#endif /* CONFIG_ENC_ASSOC */
 
 	/* Add the mic */
 	mic_len = pasn_mic_len(pasn->hash_alg);
@@ -728,6 +742,18 @@ int handle_auth_pasn_1(struct pasn_data *pasn,
 		goto send_resp;
 	}
 
+#ifdef CONFIG_ENC_ASSOC
+	/* IEEE802.11 bi D2.0 12.16.9 Enhanced Data Privacy Key Exchange
+	 * allows the use of SAE/SAE-EXT/FT-SAE/FT-SAE-EXT as base AKMP
+	 */
+	if (mgmt->u.auth.auth_alg == WLAN_AUTH_EPPKE &&
+	    !wpa_key_mgmt_sae(rsn_data.key_mgmt)) {
+		wpa_printf(MSG_DEBUG, "EPPKE: Invalid Base AKM");
+		status = WLAN_STATUS_INVALID_RSNIE;
+		goto send_resp;
+	}
+#endif /* CONFIG_ENC_ASSOC */
+
 	if (!(rsn_data.key_mgmt & pasn->wpa_key_mgmt) ||
 	    !(rsn_data.pairwise_cipher & pasn->rsn_pairwise)) {
 		wpa_printf(MSG_DEBUG, "PASN: Mismatch in AKMP/cipher");
@@ -758,6 +784,16 @@ int handle_auth_pasn_1(struct pasn_data *pasn,
 
 	wpa_printf(MSG_DEBUG, "PASN: kek_len=%zu", pasn->kek_len);
 
+	if (mgmt->u.auth.auth_alg == WLAN_AUTH_EPPKE &&
+	    !ieee802_11_rsnx_capab_len(elems.rsnxe, elems.rsnxe_len,
+				       WLAN_RSNX_CAPAB_ASSOC_FRAME_ENCRYPTION)) {
+		wpa_printf(MSG_DEBUG,
+			   "EPPKE: Missing (Re)Association Request/Response frame "
+			   "enryption support in RSNXE");
+		status = WLAN_STATUS_UNSPECIFIED_FAILURE;
+		goto send_resp;
+	}
+
 	if (!elems.pasn_params || !elems.pasn_params_len) {
 		wpa_printf(MSG_DEBUG,
 			   "PASN: No PASN Parameters element found");

From patchwork Thu Jan 15 16:32:52 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184698
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=cuGm43LZ;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=LgIV+MGw;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=H+cQuFK7;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsT8x0GyZz1xtG
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:34:41 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=9kZBy2zW7PwmwcaWD+5ifAJgTybiC/yXJ+El5D/Te38=; b=cuGm43LZ1SFcbd
	W6U5YSdITayNec68R22yCFFNpw4UTpo2J9wbRix7i+ICiRZqCsyMgZeaTprJiTsl07IBqElMWesIC
	es4A9kYbMA45jw15NfQ+Anr/l+OdJQjWu2qwY3AEc34QPnk1c44mU7gy9PmnwIsiE8YBJG49j9fYL
	qFaHAyEqkQw9NfZONqoqGZfGdRYU39dCkcHuLVzXIl/ZtKTTT/6zkfL3cm/18aIFLDbjlbDV4oUhI
	ipHxhiF7ZehwL/bdeDADDUP2ZeDMmEHnauQTGUjFuLxBahlsWZpqp7jA38qPmQfX5scv0qw3/LWrQ
	98XWOcBtZYnmU9mfrufg==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIP-0000000ChwH-46eq;
	Thu, 15 Jan 2026 16:34:06 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIJ-0000000ChoN-2nG9
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:34:01 +0000
Received: from pps.filterd (m0279872.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFYBSV1910032
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:58 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=R472WppMYNO
	6awdpnHBABrLII42CXKqXxTiZlsiG1SA=; b=LgIV+MGwI3gZIW278T2x9kkOQv5
	wc7C7x3pXaNdgcDCibKwptXLf4Gf5DwKl1odyGVJmiSxBiyBM9pxwCzyAPl24oz2
	naR0Cn++ZzacR63B4Lf8QiiyHu+ogPYnioAh68oiTyVKZpJkT0ve8rs1C4AAKkkq
	GrePF6bc/nQe5t8x4DuWrFgNOz5OX6DwlEzwJjTHKqOVQMbfKbhmTg5SDzmnfxdR
	yqT1jHQdfU6WR7Q0DEaO4vXMRCNeYN3FDrlZU1dnLoXU0DlY/bUW7JEILgBmP1W1
	RRMhX/VhLufOKGICzgazaoKumxXcX6CkwAL2qLkJhFgnwSz1CPZhmkogXRg==
Received: from mail-pl1-f197.google.com (mail-pl1-f197.google.com
 [209.85.214.197])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bpxgn0ypu-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:33:58 +0000 (GMT)
Received: by mail-pl1-f197.google.com with SMTP id
 d9443c01a7336-2a0d59f0198so11839245ad.1
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:33:58 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494837; x=1769099637;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=R472WppMYNO6awdpnHBABrLII42CXKqXxTiZlsiG1SA=;
        b=H+cQuFK75cjRjDI9oETKFAzkWsD9s0m46tx+YeNzcxyutLLmdFy1+vuhoR+13ifGqO
         NhQDockFybnoeW/HcZBilq5inGNZNggx1busfsAOMbng7TbOOZ3Of77AicnRVyJqlvDo
         56Bgr7WQd4tfFn3YJODot1ic9gttZ9xEl+/L257IpTedYxQgldD6p0eeuL0P9rp2b6HE
         I7T679NIswa7Bnr4uO0ADF5SyiwZ3RGaKGADwu4+DkTrq9NtIoVS8+7d6S7v5uc11cYQ
         CCuL0fvdbHo1woaAiXTt/z/E7FICWyJwFLE84c2r7XcpxO8SyioYZQJrTpxHeKS0trRd
         k1qA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494837; x=1769099637;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=R472WppMYNO6awdpnHBABrLII42CXKqXxTiZlsiG1SA=;
        b=o8J7A2Pho6GmmLTV5gHOfw1j2cGFuhD7VHNV2kXJ1RG4IPMsIiuAAwDRUAM2+zOnwb
         WcA2VFipbniW+BZldDoRXrcgXkPPSHPRcDVOaBgmGUyvsBLAbkY9lQYGz3Y64Cv2QcXO
         M8+9EE4RgwtgKzXxL6/9sVaJ1ImgXanCtuBfplhqZmpsuhGDlI0Hgk9IjAYwAKDxSvQt
         5r0DwFAxXHMQcI/t7KELxe2jJWzEJClvk9en1Izy3GXSvBzuc58rtVGLJhf0H32LbOUG
         6o4cSfbaJ5cx+thSUpglqtr+/giuLu4W9Q57ygIp1v0QaLxm0X2fzWVtwpHQJvB9NBtj
         pN3Q==
X-Gm-Message-State: AOJu0Yy+XTPdeUShQlSguzDtaISdjoidydmlHSck/pRjYADL9KwSWKRd
	r1/cSDvfHiABX20RmAVH6WNw6+pINR9KzG5FoCUkGs9owvX7q8mYAH68BddX4V9fiYhtiZh9SlC
	rcz4gi9hxG7UKAYvVQYJ5DZXPChFXqLqCgZPWZWLmS/Z9a/xezdyLsivB+Bc83TNJBYsH+BW9
X-Gm-Gg: AY/fxX70nNSZTtMEe7eTGiBRfY1LMMA1B1gbWOMzhIOyQByQXPxkY9yXzCtJwragxIh
	X/BqdJwE4vm0DHcyPjkVoZa0+8pEykTPkQysPQvjjtargdgJDjGDpcJXFOSf3pM2nZ7PhkZCIcU
	gdJAZTU5PsKRGck38nFrDaVu/rOWLZTm/nUExmnAR9y7ULx0IcmtQ2dJsTx0UClbhFODB2vF4qf
	D/HO2yNtnaGCMoohLNJoDT1iYeqqC6ms4WbmXiF/jvMnPsCWxm9T3eztz8f6RcMiuP+W9uni+yr
	Uzo3i3PSHnyLwUOPGLtonTCIuVqwWgEWx3ToC2AGDZw/L63YrMIvQT1j2hYc+Bn49IJJbn8m4Jr
	ZRhyQ4cPbL77VfPA0mBRUlAiGm1PAvjW+XISxhUCR
X-Received: by 2002:a17:903:41cd:b0:2a0:afeb:fbbb with SMTP id
 d9443c01a7336-2a7174fa86fmr984085ad.1.1768494837064;
        Thu, 15 Jan 2026 08:33:57 -0800 (PST)
X-Received: by 2002:a17:903:41cd:b0:2a0:afeb:fbbb with SMTP id
 d9443c01a7336-2a7174fa86fmr983835ad.1.1768494836447;
        Thu, 15 Jan 2026 08:33:56 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.33.54
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:33:56 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 13/27] EPPKE: PTK/MIC Computation and key installation
 changes in Responder mode
Date: Thu, 15 Jan 2026 22:02:52 +0530
Message-Id: <20260115163306.367753-14-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-GUID: L_qDGj2lM75hyF9JdfMvTPvsU0CYpp91
X-Proofpoint-ORIG-GUID: L_qDGj2lM75hyF9JdfMvTPvsU0CYpp91
X-Authority-Analysis: v=2.4 cv=ANDFHcx+ c=1 sm=1 tr=0 ts=696916f6 cx=c_pps
 a=cmESyDAEBpBGqyK7t0alAg==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=WGb3iPcmAAAA:8 a=9c2JfzCumqVceNjkUsYA:9
 a=jKcKK7Of1z-IfGoh:21 a=1OuFwYUASf3TG4hYMiVC:22 a=9JPlHzl_CvN4BZy81pxD:22
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX6e5uv/RIs5Rl
 /FyFv7KOUxz8lJUy3jnqJioeXaWn+msbF30pqC2LRyMXq2QWChmsycyj8vUeTh9xMWof023aFd7
 taAsr0/cjp2xN0pbaMblBovHfrsDtxnVkSnRhHicX6MvuxGxRNkChFEDOSiNTE1F7grv/x00Zzc
 nPXa/LofgBTVKJIWJi4ZM7PzGoEb9N8Ji8Ar0QuY3cGUo9CNKAr2H1kiykD3n1Ew4E727ggiexH
 lU1Tjhjg8CA8DkjM338NTvsExdZP6RCFmEjfSvvikqsq577C2eryQTsvFek6+BOsy5iRK+0YFyY
 1QaVD5hHssXzJQHDhOxMbV13vJzBe2okBJEcZL/Y/lHVVrhc/ea6qpZKJrRysLz/nxiFx6IjUBm
 W4mChQ39LFybpOaMsyeZzkHxl4/Horn06F4pa46yv4qp98nETi9FKr4kTCzT5aJxHfFs094GPJJ
 AipvYMFbmNsC6lMb6dw==
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 impostorscore=0 phishscore=0 clxscore=1015 bulkscore=0 malwarescore=0
 spamscore=0 lowpriorityscore=0 adultscore=0 priorityscore=1501 suspectscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_083359_861542_9405769C 
X-CRM114-Status: GOOD (  24.40  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com> As per
    IEEE P802.11bi/D2.0,
 12.16.9.3.4 (PTKSA derivation and MIC computation with
    EPPKE authentication) For MLO, the following modifications shall be used:
    -The AP MLD MAC address is used instead of [...]
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.0 SPF_PASS               SPF: sender matches SPF record
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

As per IEEE P802.11bi/D2.0, 12.16.9.3.4 (PTKSA derivation
and MIC computation with EPPKE authentication)
For MLO, the following modifications shall be used:
 -The AP MLD MAC address is used instead of the BSSID.
 -The non-AP MLD MAC address is used instead of the SPA.

In AP Responder mode, if the peer is in unauthorized state,
and processing of the EPPKE Authentication frame 1 received from
initiator is successful and results in a PTKSA derivation,
Install the pairwise key TK to the driver and if the peer is
already in an authorized state, wait until EPPKE Authentication
frame 3 validation is successful to install the pairwise key to
the driver.

Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
Signed-off-by: Rohan Dutta <drohan@qti.qualcomm.com>
---
 src/ap/ieee802_11.c              | 32 +++++++++++++++++++++++++++++---
 src/common/wpa_common.c          | 21 +++++++++++++++------
 src/p2p/p2p.c                    |  3 ++-
 src/pasn/pasn_common.c           |  8 +++++++-
 src/pasn/pasn_common.h           | 14 +++++++++++++-
 src/pasn/pasn_responder.c        | 27 +++++++++++++++++++++++++++
 wpa_supplicant/pasn_supplicant.c |  4 ++--
 7 files changed, 95 insertions(+), 14 deletions(-)

diff --git a/src/ap/ieee802_11.c b/src/ap/ieee802_11.c
index 2e0b9eb95..dbc2ceea8 100644
--- a/src/ap/ieee802_11.c
+++ b/src/ap/ieee802_11.c
@@ -2993,12 +2993,29 @@ static int hapd_pasn_send_mlme(void *ctx, const u8 *data, size_t data_len,
 }
 
 
+#ifdef CONFIG_ENC_ASSOC
+static int eppk_set_key(void *ctx, enum wpa_alg alg,
+			const u8 *addr, const u8 *key,
+			size_t key_len)
+{
+	struct hostapd_data *hapd = ctx;
+
+	return hostapd_drv_set_key(hapd->conf->iface, hapd, alg, addr,
+				   0, 0, 1, NULL, 0, key, key_len,
+				   KEY_FLAG_PAIRWISE_RX_TX);
+}
+#else
+#define eppk_set_key NULL
+#endif /* CONFIG_ENC_ASSOC */
+
+
 static void hapd_initialize_pasn(struct hostapd_data *hapd,
 				 struct sta_info *sta)
 {
 	struct pasn_data *pasn = sta->pasn;
 
-	pasn_register_callbacks(pasn, hapd, hapd_pasn_send_mlme, NULL);
+	pasn_register_callbacks(pasn, hapd, hapd_pasn_send_mlme,
+				NULL, eppk_set_key);
 	pasn_set_bssid(pasn, hapd->own_addr);
 	pasn_set_own_addr(pasn, hapd->own_addr);
 #if defined(CONFIG_IEEE80211BE) && defined(CONFIG_ENC_ASSOC)
@@ -3026,6 +3043,7 @@ static void hapd_initialize_pasn(struct hostapd_data *hapd,
 	pasn_set_rsnxe_ie(pasn, hostapd_wpa_ie(hapd, WLAN_EID_RSNX));
 	pasn->disable_pmksa_caching = hapd->conf->disable_pmksa_caching;
 #ifdef CONFIG_ENC_ASSOC
+	pasn->tk_configured = false;
 	pasn_set_responder_pmksa(pasn,
 				 wpa_auth_get_pmksa_cache(hapd->wpa_auth,
 							  (sta->epp_sta ?
@@ -3111,6 +3129,7 @@ static void hapd_pasn_update_params(struct hostapd_data *hapd,
 	}
 #ifdef CONFIG_ENC_ASSOC
 	pasn->auth_alg = mgmt->u.auth.auth_alg;
+	pasn->authorized = ap_sta_is_authorized(sta);
 #ifdef CONFIG_IEEE80211BE
 	pasn->is_ml_peer = sta->mld_info.mld_sta;
 #endif
@@ -3219,7 +3238,8 @@ static void handle_auth_pasn(struct hostapd_data *hapd, struct sta_info *sta,
 			return;
 		}
 
-		sta->pasn = pasn_data_init();
+		if (!sta->pasn)
+			sta->pasn = pasn_data_init();
 		if (!sta->pasn) {
 			wpa_printf(MSG_DEBUG,
 				   "PASN: Failed to allocate PASN context");
@@ -3266,7 +3286,13 @@ static void handle_auth_pasn(struct hostapd_data *hapd, struct sta_info *sta,
 					pasn_get_ptk(sta->pasn), NULL, NULL,
 					pasn_get_akmp(sta->pasn));
 #ifdef CONFIG_ENC_ASSOC
-			if (!sta->epp_sta)
+			if (sta->epp_sta && !sta->pasn->tk_configured)
+				sta->pasn->eppk_set_key(sta->pasn->cb_ctx,
+							wpa_cipher_to_alg(sta->pasn->cipher),
+							sta->addr,
+							sta->pasn->ptk.tk,
+							sta->pasn->ptk.tk_len);
+			else if (!sta->epp_sta)
 #endif /* CONFIG_ENC_ASSOC */
 				pasn_set_keys_from_cache(hapd, hapd->own_addr,
 							 sta->addr,
diff --git a/src/common/wpa_common.c b/src/common/wpa_common.c
index 16c956aa8..5effba077 100644
--- a/src/common/wpa_common.c
+++ b/src/common/wpa_common.c
@@ -1571,8 +1571,12 @@ static enum rsn_hash_alg pasn_select_hash_alg(int akmp, int cipher,
  * pasn_pmk_to_ptk - Calculate PASN/EPPKE PTK from PMK, addresses, etc.
  * @pmk: Pairwise master key
  * @pmk_len: Length of PMK
- * @spa: Suppplicant address
- * @bssid: AP BSSID
+ * @spa: As per IEEE802.11bi/D2.0, 12.16.9.3.4, for EPPKE authentication,
+ *	Non-AP MLD MAC address is used for MLO. For PASN authentication or
+ *	EPPKE authentication for Non-MLO, Non-AP Link MAC address is used.
+ * @bssid: As per IEEE802.11bi/D2.0, 12.16.9.3.4, for EPPKE authentication,
+ *	AP MLD MAC address is used for MLO. For PASN authentication or EPPKE
+ *	authentication for Non-MLO, AP BSSID is used.
  * @dhss: Is the shared secret (DHss) derived from the PASN ephemeral key
  *	exchange encoded as an octet string
  * @dhss_len: The length of dhss in octets
@@ -1799,10 +1803,15 @@ int wpa_ltf_keyseed(struct wpa_ptk *ptk, int akmp, int cipher)
  * @alg: Selected hash algorithm from pasn_pmk_to_ptk()
  * @kck: The key confirmation key for the PASN PTKSA
  * @kck_len: KCK length in octets
- * @addr1: For the 2nd PASN frame supplicant address; for the 3rd frame the
- *	BSSID
- * @addr2: For the 2nd PASN frame the BSSID; for the 3rd frame the supplicant
- *	address
+ * @addr1: For the 2nd PASN/EPPKE frame supplicant address is used for Non-MLO;
+ *	for MLO, 2nd EPPKE authentication to use Non-AP MLD MAC address.
+ *	For the 3rd PASN/EPPKE frame BSSID is used for Non-MLO. for MLO, 3rd EPPKE
+ *	authentication to use AP MLD MAC address as per IEEE802.11bi/D2.0, 12.16.9.3.4
+ * @addr2: For the 2nd PASN/EPPKE frame BSSID is used for Non-MLO;
+ *	for MLO, 2nd EPPKE authentication to use AP MLD MAC address.
+ *	For the 3rd PASN/EPPKE frame supplicant address is used for Non-MLO.
+ *	for MLO, 3rd EPPKE authentication frame to use Non-AP MLD MAC address as
+ *	per IEEE802.11bi/D2.0, 12.16.9.3.4
  * @data: For calculating the MIC for the 2nd PASN frame, this should hold the
  *	Beacon frame RSNE + RSNXE. For calculating the MIC for the 3rd PASN
  *	frame, this should hold the hash of the body of the PASN 1st frame.
diff --git a/src/p2p/p2p.c b/src/p2p/p2p.c
index 711c7343c..25a89d7a0 100644
--- a/src/p2p/p2p.c
+++ b/src/p2p/p2p.c
@@ -7243,7 +7243,8 @@ int p2p_pasn_auth_rx(struct p2p_data *p2p, const struct ieee80211_mgmt *mgmt,
 
 	pasn_register_callbacks(pasn, p2p->cfg->cb_ctx,
 				p2p->cfg->pasn_send_mgmt,
-				p2p->cfg->pasn_validate_pmkid);
+				p2p->cfg->pasn_validate_pmkid,
+				NULL);
 	auth_transaction = le_to_host16(mgmt->u.auth.auth_transaction);
 
 	if (dev->role == P2P_ROLE_PAIRING_INITIATOR &&
diff --git a/src/pasn/pasn_common.c b/src/pasn/pasn_common.c
index bd197bebd..f9ec5ca9c 100644
--- a/src/pasn/pasn_common.c
+++ b/src/pasn/pasn_common.c
@@ -47,7 +47,10 @@ void pasn_register_callbacks(struct pasn_data *pasn, void *cb_ctx,
 					      unsigned int wait),
 			     int (*validate_custom_pmkid)(void *ctx,
 							  const u8 *addr,
-							  const u8 *pmkid))
+							  const u8 *pmkid),
+			     int (*eppke_set_key)(void *ctx, enum wpa_alg alg,
+						  const u8 *addr, const u8 *key,
+						  size_t key_len))
 {
 	if (!pasn)
 		return;
@@ -55,6 +58,9 @@ void pasn_register_callbacks(struct pasn_data *pasn, void *cb_ctx,
 	pasn->cb_ctx = cb_ctx;
 	pasn->send_mgmt = send_mgmt;
 	pasn->validate_custom_pmkid = validate_custom_pmkid;
+#ifdef CONFIG_ENC_ASSOC
+	pasn->eppk_set_key = eppke_set_key;
+#endif /* CONFIG_ENC_ASSOC */
 }
 
 
diff --git a/src/pasn/pasn_common.h b/src/pasn/pasn_common.h
index f5e22c1d9..45ac3b4ce 100644
--- a/src/pasn/pasn_common.h
+++ b/src/pasn/pasn_common.h
@@ -140,6 +140,10 @@ struct pasn_data {
 	u16 comeback_idx;
 	u16 *comeback_pending_idx;
 	struct wpabuf *frame;
+#ifdef CONFIG_ENC_ASSOC
+	bool authorized;
+	bool tk_configured;
+#endif /* CONFIG_ENC_ASSOC */
 
 	/**
 	 * send_mgmt - Function handler to transmit a Management frame
@@ -165,6 +169,10 @@ struct pasn_data {
 	int (*prepare_data_element)(void *ctx, const u8 *peer_addr);
 
 	int (*parse_data_element)(void *ctx, const u8 *data, size_t len);
+#ifdef CONFIG_ENC_ASSOC
+	int (*eppk_set_key)(void *ctx, enum wpa_alg alg, const u8 *addr,
+			    const u8 *key, size_t key_len);
+#endif /* CONFIG_ENC_ASSOC */
 };
 
 /* Initiator */
@@ -207,7 +215,11 @@ void pasn_register_callbacks(struct pasn_data *pasn, void *cb_ctx,
 					      unsigned int wait),
 			     int (*validate_custom_pmkid)(void *ctx,
 							  const u8 *addr,
-							  const u8 *pmkid));
+							  const u8 *pmkid),
+			     int (*eppke_set_key)(void *ctx, enum wpa_alg alg,
+						  const u8 *addr, const u8 *key,
+						  size_t key_len));
+
 void pasn_enable_kdk_derivation(struct pasn_data *pasn);
 void pasn_disable_kdk_derivation(struct pasn_data *pasn);
 
diff --git a/src/pasn/pasn_responder.c b/src/pasn/pasn_responder.c
index 8ad6ff03c..1aa72de11 100644
--- a/src/pasn/pasn_responder.c
+++ b/src/pasn/pasn_responder.c
@@ -413,6 +413,13 @@ pasn_derive_keys(struct pasn_data *pasn,
 
 	pasn->pmk_len = pmk_len;
 	os_memcpy(pasn->pmk, pmk, pmk_len);
+
+#ifdef CONFIG_ENC_ASSOC
+	if (pasn->auth_alg == WLAN_AUTH_EPPKE &&
+	    pasn->is_ml_peer)
+		own_addr = pasn->mld_addr;
+#endif /* CONFIG_ENC_ASSOC */
+
 	ret = pasn_pmk_to_ptk(pmk, pmk_len, peer_addr, own_addr,
 			      wpabuf_head(secret), wpabuf_len(secret),
 			      &pasn->ptk, pasn->akmp,
@@ -641,6 +648,12 @@ int handle_auth_pasn_resp(struct pasn_data *pasn, const u8 *own_addr,
 		data = rsn_ie;
 	}
 
+#ifdef CONFIG_ENC_ASSOC
+	if (pasn->auth_alg == WLAN_AUTH_EPPKE &&
+	    pasn->is_ml_peer)
+		own_addr = pasn->mld_addr;
+#endif /* CONFIG_ENC_ASSOC */
+
 	ret = pasn_mic(pasn->hash_alg, pasn->ptk.kck, pasn->ptk.kck_len,
 		       own_addr, peer_addr, data, data_len,
 		       frame, frame_len, mic);
@@ -1013,6 +1026,14 @@ int handle_auth_pasn_1(struct pasn_data *pasn,
 		goto send_resp;
 	}
 
+#ifdef CONFIG_ENC_ASSOC
+	if (pasn->auth_alg == WLAN_AUTH_EPPKE && !pasn->authorized) {
+		pasn->eppk_set_key(pasn->cb_ctx, wpa_cipher_to_alg(pasn->cipher),
+				   peer_addr, pasn->ptk.tk, pasn->ptk.tk_len);
+		pasn->tk_configured = true;
+	}
+#endif /* CONFIG_ENC_ASSOC */
+
 	wpabuf_free(pasn->auth1);
 	pasn->auth1 = wpabuf_alloc_copy(((const u8 *) mgmt) + IEEE80211_HDRLEN,
 					len - IEEE80211_HDRLEN);
@@ -1094,6 +1115,12 @@ int handle_auth_pasn_3(struct pasn_data *pasn, const u8 *own_addr,
 		goto fail;
 	}
 
+#ifdef CONFIG_ENC_ASSOC
+	if (pasn->auth_alg == WLAN_AUTH_EPPKE &&
+	    pasn->is_ml_peer)
+		own_addr = pasn->mld_addr;
+#endif /* CONFIG_ENC_ASSOC */
+
 	/* Verify the MIC */
 	copy_len = len - offsetof(struct ieee80211_mgmt, u.auth);
 	mic_offset = elems.mic - (const u8 *) &mgmt->u.auth;
diff --git a/wpa_supplicant/pasn_supplicant.c b/wpa_supplicant/pasn_supplicant.c
index 392ad1b08..7f91e192a 100644
--- a/wpa_supplicant/pasn_supplicant.c
+++ b/wpa_supplicant/pasn_supplicant.c
@@ -716,7 +716,7 @@ static void wpas_pasn_auth_start_cb(struct wpa_radio_work *work, int deinit)
 		capab |= BIT(WLAN_RSNX_CAPAB_SPP_A_MSDU);
 
 	pasn_set_rsnxe_caps(pasn, capab);
-	pasn_register_callbacks(pasn, wpa_s, wpas_pasn_send_mlme, NULL);
+	pasn_register_callbacks(pasn, wpa_s, wpas_pasn_send_mlme, NULL, NULL);
 	ssid = wpa_config_get_network(wpa_s->conf, awork->network_id);
 
 #ifdef CONFIG_SAE
@@ -974,7 +974,7 @@ int wpas_pasn_auth_rx(struct wpa_supplicant *wpa_s,
 	wpabuf_free(pasn->frame);
 	pasn->frame = NULL;
 
-	pasn_register_callbacks(pasn, wpa_s, wpas_pasn_send_mlme, NULL);
+	pasn_register_callbacks(pasn, wpa_s, wpas_pasn_send_mlme, NULL, NULL);
 	ret = wpa_pasn_auth_rx(pasn, (const u8 *) mgmt, len, &pasn_data);
 	if (ret == 0) {
 		ptksa_cache_add(wpa_s->ptksa, pasn->own_addr, pasn->peer_addr,

From patchwork Thu Jan 15 16:32:53 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184699
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=1Exwjdp4;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=lXrsws+c;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=kXalMLLl;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsT912CjKz1xt4
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:34:45 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=1ut/88IOX1fxPOkbpcVU+o6MqdCMwNnF9P/msqXYdSw=; b=1Exwjdp43w/CBJ
	nZ2hkrTc7iffz0rKw4rumVyGoPzhTF5qlAQz102BMj8p4Zd+n0jV0fcmgQb0H6DpnEclbKUpfPlOj
	RtVuSDyJE5YP4kxjqSvAm+8LpC6rh4shZaxgCXAM+HXDjaEPRk1C6Fj0MUjtRd5W3tLl7LA6poKGF
	NhMYIVy1O/8ImsRkTQbBmuwvZdfmNeuqgaOETO1iPrCVQKWPxxVbdHDPpBNSenXNioey+Hy7selIe
	ZG7EGD6mvGvPpOSmu6T0j0ln3qQZHY0yqKxd0tpDxVY/osWlvK1/tCytA0Y8DfhVy/YAK/K3t36Rg
	XZUUkGf1mXcp0TBe5wKA==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIT-0000000Ci49-2hnm;
	Thu, 15 Jan 2026 16:34:09 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIL-0000000Chqp-1BQ3
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:34:02 +0000
Received: from pps.filterd (m0279870.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFY6PE2673031
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:00 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=f65CC/m/35n
	n9s5ClZWYKasirua/Z+9H5K5NPqUcNX8=; b=lXrsws+cD9UKLsROHEJ9QOcjf0i
	vCB6h+kBb/BvsLKXTK2OJhZtlJSz4uTDO77SmYdZHkS6EX1szBPWQ4hb+dh4lqiF
	DIkVdCtiR9pQH5LoMbdGC0EOZNswmkf8eMy+uqHcy8EMG4l+z+z+aOrhuhyGv7MW
	dIPrEKTKBJoHWdRsi/OJ0C2O/kZ6w8NOLNyEK1sThfxO+p70o8PyCDHdIkU7I2uS
	RY6G8XUWcMqZ6A/b+duQXDIK4KlGLwY7g32k5MNmjizPKgnX81N7oGqOM6g+cN31
	QezFm3nYRHxjxEn2xvzN7vRtBMHDAcV/5EaNKk466Prkq6DdJ568RWBInCQ==
Received: from mail-pl1-f197.google.com (mail-pl1-f197.google.com
 [209.85.214.197])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bpydugthh-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:00 +0000 (GMT)
Received: by mail-pl1-f197.google.com with SMTP id
 d9443c01a7336-2a31087af17so12232355ad.1
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:34:00 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494839; x=1769099639;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=f65CC/m/35nn9s5ClZWYKasirua/Z+9H5K5NPqUcNX8=;
        b=kXalMLLlr16RmgwN35F3lKwMcwb1p+Idkt6T8Khsy/OP1l1VKdnltL1oMIVUsJek60
         y+Uax7JLaYnojtQoRf2g1qwFRa8T6blwzaXK3xIJFz6tEkEB4qdTJHLRqGqj5DGiJQrB
         r2gBcVLsI3NjOAzf9Tsh0uxlrQl9/le9ufFN9mzayuceTC38CCCxAQysHgTPsuouLn78
         cmV3hDVEuI2aDB13Sit+C+QpHsQRpj0iiCcBfYv0+l8+JCxMlNYCR0pAkax9nt1CO7BX
         TV8uvtEm0dPJv7zbr8q65maBnCwyyOm6TDihNRrXhg1OQpSTbOTu2z8LVWwi/9uB+/SH
         DHtw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494839; x=1769099639;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=f65CC/m/35nn9s5ClZWYKasirua/Z+9H5K5NPqUcNX8=;
        b=QrG/Bjf0v0/7kqXXGBG1Kmb+Zcp88kZj+n4uec1C+c4iFJFAfAruJgw5+4CP3LDbmd
         oxuKCElsiCwuq5pu/5jSNXh/zPF4OaqTmG0VWtJuSc5wJNLMBwJOOxT5DEcwW5K4k9Hp
         /Y5kO6JXxCe/n+wfSRh5qP1cb+m1xP8aA46Gp2OvBrOA0afDD2wv4XmzBb+Bk4zsPWEH
         cKPX/HEn1+iuOscNj4YfO2FmmOoFPwOXiKlVuH7fKfoZ+4TpoOjm2xrCUzdqzFG+5sEd
         LHHkGGpZVr5sTTQGpNlk/Fhu7LpkCV7ZjUlHHGuLxa9uQc51Cuwx6DzB/cTi+IOc/QDr
         10Cg==
X-Gm-Message-State: AOJu0YxpuuGn1YXAdpNXkOIORhguc2Q7Buu5xGFkwW2Byku3faDwo1yg
	E/fS4aMGS1gu7oWkIXUIvHGeQgN7uGp3DOpVsZWV0f809JbVNoGNe3NL/TweuegroN5cKjMQ2f+
	5aVgzHTaaktnuDHxEsxPOrfaWY2mtvfnt21H4H4djTOTtJm2GzmiHLzgRuuD8Pxudwn7cYwIf
X-Gm-Gg: AY/fxX594/RZC9W3aoEqiREhbpYpN+ns/n7NtvuWDd/BQPy7jj2fzUcLugf46LquYIP
	SjtzQgQ9VTUKmq4wRRRzWkIsd+VGTCzmHYNIp3OmQ+DrVtEYSQ2Fi1jtcsmeLVkmskUQvhL7gXT
	+zUYAvKIWgzP9hxs1Wg1fKA3v4uivgSHqo1NadbI3RI+w7jjqbuD2YDWX0aDF9EbMYbxZ74GeR/
	Eh5SV+7HCmGKiFUaw1DuWgyYHIrP4wyz2iOJp7Vzh51idGwGXNgBBqe5Wd1wpyXuv9dWe1d4JNj
	t9O8GuWvWKvnEIJu8nxHFsXmqE0a67DFKi9h9pZMO3Kph0tct4YLD0y6SAxqJMJvsj6rXKRnufA
	F6ksW/VP/6tkbtswOahbOn/g0Cs9N9lIz20Ad08of
X-Received: by 2002:a17:903:94e:b0:2a0:d629:903c with SMTP id
 d9443c01a7336-2a7175c1989mr853985ad.30.1768494839046;
        Thu, 15 Jan 2026 08:33:59 -0800 (PST)
X-Received: by 2002:a17:903:94e:b0:2a0:d629:903c with SMTP id
 d9443c01a7336-2a7175c1989mr853795ad.30.1768494838553;
        Thu, 15 Jan 2026 08:33:58 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.33.56
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:33:58 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 14/27] EPPKE: EPP peer indication to driver
Date: Thu, 15 Jan 2026 22:02:53 +0530
Message-Id: <20260115163306.367753-15-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX5hqw4wfEhOfV
 u3KyB+xTLYaQ/JUlUH8NbedrFbyoWAJduNrMfXHBMeAI09wdYdFypJswXTscEvymXdIU3bp2dz0
 mfd7TPKZl7O+PCE7juCAyiXrUM4bPlslUxBrfQZZB1MU/1RSsVqcJ3BeXx653cfc208sPbzj0qP
 tNyIvADs+PsqaxPs5Z1duBTbUXLM1isMa2EcIC3TuiNlpbRV0tmZw1DB5DICq8M+M8d28+PiNRm
 Z4U4oCaDS7++PY5V2hJRKfsSIqj8JwWBXt2qOnfmL/nGKwS93lQuWdilyqT+GVJZ186++z0xcub
 kxXLI0DbxIQNpO5gt9YwSNQsvpPTR2vfS0Wwr8TqkkW+9Lb32A+fT5mwo5dqWVdbZNgVyrOmtkt
 Y7g3RsKFLq/TQ0bubA+JQRsLiDm+3AKjH3gNqgXz8Uf2PjtM/eZDrTRRCsAmNxwohTZ+LTv6Hkh
 lxH3fuvlDLhp4GW9xuA==
X-Proofpoint-ORIG-GUID: pQLfgJO15YZxK5u8gnHjGFtUPMa3FxwB
X-Authority-Analysis: v=2.4 cv=NafrFmD4 c=1 sm=1 tr=0 ts=696916f8 cx=c_pps
 a=cmESyDAEBpBGqyK7t0alAg==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=YZ6FbwD5D2sa2JcNKG0A:9 a=1OuFwYUASf3TG4hYMiVC:22
X-Proofpoint-GUID: pQLfgJO15YZxK5u8gnHjGFtUPMa3FxwB
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 spamscore=0 impostorscore=0 bulkscore=0 lowpriorityscore=0 suspectscore=0
 phishscore=0 clxscore=1015 priorityscore=1501 malwarescore=0 adultscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_083401_507417_7A69AB0B 
X-CRM114-Status: GOOD (  20.92  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
 Indicate
    that a peer is an Enhanced Privacy Protection (EPP) peer via the netlink
   attribute @NL80211_ATTR_EPP_PEER in @NL80211_CMD_NEW_STA and
 @NL80211_CMD_ADD_LINK_STA    
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.0 SPF_PASS               SPF: sender matches SPF record
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

Indicate that a peer is an Enhanced Privacy
Protection (EPP) peer via the netlink attribute
@NL80211_ATTR_EPP_PEER in @NL80211_CMD_NEW_STA
and @NL80211_CMD_ADD_LINK_STA

Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
Signed-off-by: Rohan Dutta <drohan@qti.qualcomm.com>
---
 src/ap/ap_drv_ops.c          |  6 ++++--
 src/ap/ap_drv_ops.h          |  2 +-
 src/ap/ieee802_11.c          | 15 ++++++++++++---
 src/ap/sta_info.c            |  8 ++++++--
 src/drivers/driver.h         |  3 +++
 src/drivers/driver_nl80211.c |  8 ++++++++
 6 files changed, 34 insertions(+), 8 deletions(-)

diff --git a/src/ap/ap_drv_ops.c b/src/ap/ap_drv_ops.c
index 18bf01772..11c209c6f 100644
--- a/src/ap/ap_drv_ops.c
+++ b/src/ap/ap_drv_ops.c
@@ -480,7 +480,7 @@ int hostapd_sta_add(struct hostapd_data *hapd,
 		    const struct ieee80211_he_6ghz_band_cap *he_6ghz_capab,
 		    u32 flags, u8 qosinfo, u8 vht_opmode, int supp_p2p_ps,
 		    int set, const u8 *link_addr, bool mld_link_sta,
-		    u16 eml_cap)
+		    u16 eml_cap, bool epp_sta)
 {
 	struct hostapd_sta_add_params params;
 
@@ -510,7 +510,9 @@ int hostapd_sta_add(struct hostapd_data *hapd,
 	params.support_p2p_ps = supp_p2p_ps;
 	params.set = set;
 	params.mld_link_id = -1;
-
+#ifdef CONFIG_ENC_ASSOC
+	params.epp_sta = epp_sta;
+#endif
 #ifdef CONFIG_IEEE80211BE
 	/*
 	 * An AP MLD needs to always specify to what link the station needs
diff --git a/src/ap/ap_drv_ops.h b/src/ap/ap_drv_ops.h
index 517c16e35..671b99042 100644
--- a/src/ap/ap_drv_ops.h
+++ b/src/ap/ap_drv_ops.h
@@ -50,7 +50,7 @@ int hostapd_sta_add(struct hostapd_data *hapd,
 		    const struct ieee80211_he_6ghz_band_cap *he_6ghz_capab,
 		    u32 flags, u8 qosinfo, u8 vht_opmode, int supp_p2p_ps,
 		    int set, const u8 *link_addr, bool mld_link_sta,
-		    u16 eml_cap);
+		    u16 eml_cap, bool epp_sta);
 int hostapd_set_privacy(struct hostapd_data *hapd, int enabled);
 int hostapd_set_generic_elem(struct hostapd_data *hapd, const u8 *elem,
 			     size_t elem_len);
diff --git a/src/ap/ieee802_11.c b/src/ap/ieee802_11.c
index dbc2ceea8..910025f49 100644
--- a/src/ap/ieee802_11.c
+++ b/src/ap/ieee802_11.c
@@ -4488,7 +4488,11 @@ static int __check_assoc_ies(struct hostapd_data *hapd, struct sta_info *sta,
 	const u8 *wpa_ie;
 	size_t wpa_ie_len;
 	const u8 *p2p_dev_addr = NULL;
+	bool epp_sta = false;
 
+#ifdef CONFIG_ENC_ASSOC
+	epp_sta = sta->epp_sta;
+#endif
 	if (type != LINK_PARSE_RECONF) {
 		resp = check_ssid(hapd, sta, elems->ssid, elems->ssid_len);
 		if (resp != WLAN_STATUS_SUCCESS)
@@ -4777,7 +4781,7 @@ static int __check_assoc_ies(struct hostapd_data *hapd, struct sta_info *sta,
 			wpa_printf(MSG_DEBUG, "SAE: " MACSTR
 				   " using PMKSA caching", MAC2STR(sta->addr));
 			sae_assign_vlan(hapd, sta, sa->sae_vlan_id);
-		} else if (wpa_auth_uses_sae(sta->wpa_sm) &&
+		} else if (!epp_sta && wpa_auth_uses_sae(sta->wpa_sm) &&
 			   sta->auth_alg != WLAN_AUTH_SAE &&
 			   !(sta->auth_alg == WLAN_AUTH_FT &&
 			     wpa_auth_uses_ft_sae(sta->wpa_sm))) {
@@ -5359,9 +5363,13 @@ static int add_associated_sta(struct hostapd_data *hapd,
 	struct ieee80211_eht_capabilities eht_cap;
 	int set = 1;
 	const u8 *mld_link_addr = NULL;
-	bool mld_link_sta = false;
+	bool mld_link_sta = false, epp_sta = false;
 	u16 eml_cap = 0;
 
+#ifdef CONFIG_ENC_ASSOC
+	epp_sta = sta->epp_sta;
+#endif
+
 #ifdef CONFIG_IEEE80211BE
 	if (ap_sta_is_mld(hapd, sta)) {
 		u8 mld_link_id = hapd->mld_link_id;
@@ -5452,7 +5460,8 @@ static int add_associated_sta(struct hostapd_data *hapd,
 			    sta->he_6ghz_capab,
 			    sta->flags | WLAN_STA_ASSOC, sta->qosinfo,
 			    sta->vht_opmode, sta->p2p_ie ? 1 : 0,
-			    set, mld_link_addr, mld_link_sta, eml_cap)) {
+			    set, mld_link_addr, mld_link_sta, eml_cap,
+			    epp_sta)) {
 		hostapd_logger(hapd, sta->addr,
 			       HOSTAPD_MODULE_IEEE80211, HOSTAPD_LEVEL_NOTICE,
 			       "Could not %s STA to kernel driver",
diff --git a/src/ap/sta_info.c b/src/ap/sta_info.c
index 6670174cd..6d2a15176 100644
--- a/src/ap/sta_info.c
+++ b/src/ap/sta_info.c
@@ -1986,9 +1986,12 @@ static void ap_sta_remove_link_sta(struct hostapd_data *hapd,
 int ap_sta_re_add(struct hostapd_data *hapd, struct sta_info *sta)
 {
 	const u8 *mld_link_addr = NULL;
-	bool mld_link_sta = false;
+	bool mld_link_sta = false, epp_sta = false;
 	u16 eml_cap = 0;
 
+#ifdef CONFIG_ENC_ASSOC
+	epp_sta = sta->epp_sta;
+#endif
 	/*
 	 * If a station that is already associated to the AP, is trying to
 	 * authenticate again, remove the STA entry, in order to make sure the
@@ -2022,7 +2025,8 @@ int ap_sta_re_add(struct hostapd_data *hapd, struct sta_info *sta)
 			    sta->supported_rates_len,
 			    0, NULL, NULL, NULL, 0, NULL, 0, NULL,
 			    sta->flags, 0, 0, 0, 0,
-			    mld_link_addr, mld_link_sta, eml_cap)) {
+			    mld_link_addr, mld_link_sta, eml_cap,
+			    epp_sta)) {
 		hostapd_logger(hapd, sta->addr,
 			       HOSTAPD_MODULE_IEEE80211,
 			       HOSTAPD_LEVEL_NOTICE,
diff --git a/src/drivers/driver.h b/src/drivers/driver.h
index 2ed0282eb..e727dabf9 100644
--- a/src/drivers/driver.h
+++ b/src/drivers/driver.h
@@ -2668,6 +2668,9 @@ struct hostapd_sta_add_params {
 	size_t eht_capab_len;
 	u32 flags; /* bitmask of WPA_STA_* flags */
 	u32 flags_mask; /* unset bits in flags */
+#ifdef CONFIG_ENC_ASSOC
+	bool epp_sta;
+#endif
 #ifdef CONFIG_MESH
 	enum mesh_plink_state plink_state;
 	u16 peer_aid;
diff --git a/src/drivers/driver_nl80211.c b/src/drivers/driver_nl80211.c
index 30433548e..86a1d7557 100644
--- a/src/drivers/driver_nl80211.c
+++ b/src/drivers/driver_nl80211.c
@@ -6217,6 +6217,14 @@ static int wpa_driver_nl80211_sta_add(void *priv,
 			goto fail;
 	}
 
+#ifdef CONFIG_ENC_ASSOC
+	if (params->epp_sta) {
+		wpa_printf(MSG_DEBUG, "EPP STA");
+		if (nla_put_flag(msg, NL80211_ATTR_EPP_PEER))
+			goto fail;
+	}
+#endif
+
 	ret = send_and_recv_cmd(drv, msg);
 	msg = NULL;
 	if (ret)

From patchwork Thu Jan 15 16:32:54 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184700
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=wl4v6hWq;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=cEYaMiBQ;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=UXGiZnS5;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsT976WpTz1xt4
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:34:51 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=7ryWedbAp25iWn1Dvna5QYubu7rQ0XSmdGzDU2g1eg0=; b=wl4v6hWqukq7hz
	LN+g7xRdjRuT3Pot2dTlKTuWdKqrfy9a3kaKeZBCUale9EUHfNmkG9IeGbUw5lY6V/eyNymJCv2Ju
	J62VwDGtOUdcs55AsC7jZ+m7qSROqZWqCSQLYBpG/FZKccGCqj567h75Vf618mnSE/Xcj+9gZb0BZ
	xBlyP2zwkQT8Xd9IXSzOF+3iXtiTh4HVN0Rrdy6Hbu99bY6dzcfbC7X2WapwCyBwAoUjFIINwTMK2
	9A4cQpYnCMLAQzmkDSIew5m/QKcwAkH8zhxDi4exP4sMps91GDUg9pRkE8o3qo6GzKjkFg7eWgbHY
	HMx/exPgsd3XaG/v2PlA==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIb-0000000CiEn-2xdW;
	Thu, 15 Jan 2026 16:34:17 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIN-0000000ChuO-349K
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:34:06 +0000
Received: from pps.filterd (m0279873.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFYFIW1722684
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:02 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=4lLJnt77xXK
	AOMCTTj2A4G1pFd8JvyvJKpBd/oinJFs=; b=cEYaMiBQhINXI56SNBO6XoVcOIt
	gCdWLyGoqu7nG6KcYM4YA9ekfBtnf/b+F0PCEkmVempa4LAkOjyYUyGkdRNTT96H
	miJI5omjZi93ic+75Wl4DCjiTKAtmOCbTRaDDC7WnDXp/rr+RzRdHgR1ztcvaw/e
	xcTSUTWqPyu2kQnY8I07lcuEqrhYtzceD4PPDxRZVAuN2TqbfRjhyR5CZCCz6kLB
	C24OkoTJ0rWJWhykHsA1RFSOhw/Ft/jU0YUc4ujsB3npj+fmUrurtX237cu3E5tm
	hgp10DhDw150UJuUwsyf0u1rIK5nn4KDszpC9KXlB9pmHFmE5EundA7JgWQ==
Received: from mail-pl1-f200.google.com (mail-pl1-f200.google.com
 [209.85.214.200])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bptna1p9w-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:02 +0000 (GMT)
Received: by mail-pl1-f200.google.com with SMTP id
 d9443c01a7336-2a0f0c7a06eso10197965ad.2
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:34:02 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494841; x=1769099641;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=4lLJnt77xXKAOMCTTj2A4G1pFd8JvyvJKpBd/oinJFs=;
        b=UXGiZnS5WE+6DRA+A8kJudQz+LOrju/K/rEESY3Pxz9SxfKsCcbgqRCqRkJ7gGv/zJ
         vtiIJ4TVuMd6XFiVU06vGMNsMoxrGZow+0C2uyNyhWbSRzKwNHJgXoiMEgzV87nAozEl
         5a0KB8eAxSkTYLuDPJ7yPhAZSeErh8kZ1sjsvYL3UHGxy5wdDlwcBZcv8E150puN6gqS
         puufqWaOBmizCuprubl4/kaEswxp1PDBuBYtFPy8YPG1BGai5LLd11jwEMaN6+odWEmO
         HS+zItQs+dBHFLqePQVLNtbU5R+RVVvktEVCfb525p6tq7vfI6tC63+xDlwhQEigTRIT
         EV7Q==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494841; x=1769099641;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=4lLJnt77xXKAOMCTTj2A4G1pFd8JvyvJKpBd/oinJFs=;
        b=sLreByKinvIdk8wZy5365+czFDD3zr/C3b1Lmvty8JvTsKCgOBiWF5Yk1Gand+RSo7
         LpPBGroN5WR/SE4R9hqIG84G14P3cmG9NLYt5zKzRqu2VlCaupoiiVkGGZXlM3rdOq+S
         hGWwEBM609P+ObfTKClo3CoLy21fVSuCQUId9bCU/stho9OtCAyvfcxB8C7oEJtq3FqO
         OW//qq5cNJC2HUGK6IdGSSNzTBgqJOkYE6xWwPLsYxuwzemw3Dd2oAImrNjdh0Qg8DKs
         QorCdoZ8J1aLdJxA1e5RhigRrdG9ItQJdAicDcTsEBTGK4r+S0N41KivPdGm+aBiJVJK
         5j2A==
X-Gm-Message-State: AOJu0YyIyIhogmC8hPrcemJCQSQgw2b1LVFR/3ByV8z1P4R0zdylr0ls
	MKulyvRHKVROGyj14tf6sEllRtLon+uPcpMmnjwl4KRsoiCMTO+edNdm2Ulbe8y63hOC/pYUV+L
	PACCraLcIgRH9G/facG+TtCzP+/kjjlaR7in5LQjDLRRj87bcevt0mzJcYCer3WYR7YU8Anjf
X-Gm-Gg: AY/fxX5EwPs0IxGka9IhAH2zOlDaistrwdno1MUJcbEZx8DwLVHi/QCxruEfe9iAq7c
	Go5H7fQ0tk+RntdIS9KvS5JMv9b+AbBvvWiTCbWUdsCtG+jfMOWzmG2cDsTpC6KAbpeseJhfmw1
	44bHDga5FM18wb2JOfHRjW7k9z1ncZ0yv41ob1q74b9RVi6pec/+gDqvtJ1JvMnR0p7N6hMEQt8
	Sibq39wGvtHjbVOWBypS4De60kYDKkIgh3gdpJ4Etx7pKwTxeDeL5HkXjosrCryOFMhqjDnBZI0
	S06VBo8JaTVXbZZLw6NXyR/8Wj7ist5P+LtQWN3+lN0E6HxQBjiwSB1rqBrVfsif7F3H0EReG37
	DkKMOoDIv63lM96j3QGX6Y0UoLVaMsMICoEijmM+K
X-Received: by 2002:a17:902:ce0c:b0:29e:9387:f2b0 with SMTP id
 d9443c01a7336-2a7176cc6aemr743095ad.39.1768494841181;
        Thu, 15 Jan 2026 08:34:01 -0800 (PST)
X-Received: by 2002:a17:902:ce0c:b0:29e:9387:f2b0 with SMTP id
 d9443c01a7336-2a7176cc6aemr742865ad.39.1768494840681;
        Thu, 15 Jan 2026 08:34:00 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.33.58
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:34:00 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 15/27] EPPKE: RSNE/Key delivery element in (Re)Association
 Response
Date: Thu, 15 Jan 2026 22:02:54 +0530
Message-Id: <20260115163306.367753-16-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-GUID: OyeDpWOzxLzXVPoIxTDdw5oBHv4O9uXa
X-Proofpoint-ORIG-GUID: OyeDpWOzxLzXVPoIxTDdw5oBHv4O9uXa
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfXyqF/OVg6zTPd
 MDTwggupJhVRbTc0y7J8huKA0Q2L+Be21ntJo7C1RaJfQh7l4Abd8jTLRJegPVroSzaZTu5iWfk
 DRZPVLsNSYXTpWy/Mc8G1vrlGNE79szZACz1NhObYhlQOHFNRAOMPeFQjEYHHgEBv1lHpDW05Or
 j5drI/J77EZsKNYmsCEe6C9X8VQm5z+PTJkB353/QtEmRqjYdSB9gFy7h1OghgfcWth6WeKfR+3
 HNydo+BBY8ZVyon6sQzj4Q3205Arba0d1NTJV+xbT92PIvIdYYJF4Mq6CCmOJJNsEHjnrxEko0F
 D1r1fNij8MG6yX7CKTqgGRLrdTQ+WaFKnLnAm1KvWDEwrgGr/M60w71t3/ikZxjBIuiFz/lNK+Q
 QJ6Sr0Qa3Zd/5a+T2KWghHv1VibShn+UVRPUjpD/ttQ5HZ/Z9HJw8z3VNqlKVppcUqeEOaxLY2P
 lATCKuyE6zeTslHOYeA==
X-Authority-Analysis: v=2.4 cv=fsHRpV4f c=1 sm=1 tr=0 ts=696916fa cx=c_pps
 a=IZJwPbhc+fLeJZngyXXI0A==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=Era5zkz8ZhAaHRNwK2sA:9 a=uG9DUKGECoFWVXl0Dc02:22
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 malwarescore=0 priorityscore=1501 bulkscore=0 adultscore=0 spamscore=0
 clxscore=1015 impostorscore=0 phishscore=0 lowpriorityscore=0 suspectscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_083405_542673_FED932A8 
X-CRM114-Status: GOOD (  19.08  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
 -Include
    RSN IE and Key delivery element indicating group KDEs to an EPP non-AP STA
    in (Re)Association Response frame and also set the protected bit in the
 frame
    control in 802.11 frame header as an i [...]
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.0 SPF_PASS               SPF: sender matches SPF record
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

-Include RSN IE and Key delivery element indicating
group KDEs to an EPP non-AP STA in (Re)Association
Response frame and also set the protected bit in the
frame control in 802.11 frame header as an indication
to driver/firmware that this frame needs to be encrypted

Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
Signed-off-by: Rohan Dutta <drohan@qti.qualcomm.com>
---
 src/ap/ieee802_11.c |  9 +++++++
 src/ap/wpa_auth.c   | 62 +++++++++++++++++++++++++++++++++++++++++++++
 src/ap/wpa_auth.h   |  6 ++++-
 3 files changed, 76 insertions(+), 1 deletion(-)

diff --git a/src/ap/ieee802_11.c b/src/ap/ieee802_11.c
index 910025f49..87ad421c7 100644
--- a/src/ap/ieee802_11.c
+++ b/src/ap/ieee802_11.c
@@ -5774,6 +5774,15 @@ rsnxe_done:
 			  wpabuf_len(hapd->conf->assocresp_elements));
 		p += wpabuf_len(hapd->conf->assocresp_elements);
 	}
+#ifdef CONFIG_ENC_ASSOC
+	if (sta && sta->auth_alg == WLAN_AUTH_EPPKE &&
+	    status_code == WLAN_STATUS_SUCCESS) {
+		reply->frame_control |= WLAN_FC_ISWEP;
+		p = wpa_auth_write_assoc_resp_eppke(sta->wpa_sm, p,
+						    (buf + buflen - p),
+						    ap_sta_is_mld(hapd, sta));
+	}
+#endif /* CONFIG_ENC_ASSOC */
 
 	send_len += p - reply->u.assoc_resp.variable;
 
diff --git a/src/ap/wpa_auth.c b/src/ap/wpa_auth.c
index 040efd4a4..f7fc9eda4 100644
--- a/src/ap/wpa_auth.c
+++ b/src/ap/wpa_auth.c
@@ -7836,6 +7836,68 @@ bool wpa_auth_sm_known_sta_identification(struct wpa_state_machine *sm,
 }
 
 
+#ifdef CONFIG_ENC_ASSOC
+u8 * wpa_auth_write_assoc_resp_eppke(struct wpa_state_machine *sm,
+				     u8 *pos, size_t max_len, bool is_ml)
+{
+	int res;
+
+	if (!sm)
+		return pos;
+
+	res = wpa_write_rsn_ie(&sm->wpa_auth->conf, pos, max_len, NULL);
+	if (res < 0)
+		return pos;
+	pos = wpa_auth_eid_key_delivery((pos + res), sm, is_ml);
+
+	return pos;
+}
+
+
+/*TODO Key delivery element is fragmentable*/
+u8 * wpa_auth_eid_key_delivery(u8 *eid, struct wpa_state_machine *sm,
+			       bool is_ml)
+{
+	size_t gtk_len, kde_len = 0;
+	u8 rsc[WPA_KEY_RSC_LEN] = {0}, *gtk;
+	struct wpa_group *gsm = sm->group;
+	u8 hdr[2];
+	/*
+	 *ElementID(0xff)|Length(1B)|ElementID EXtn(1B)|RSC(8B)|KDE list
+	 */
+	*eid++ = WLAN_EID_EXTENSION;
+
+	if (!is_ml) {
+		/*GTK KDE: 0xdd|len(1B)|RSN Selector(4B)|KeyID(2B)|GTK|*/
+		kde_len = 2 + RSN_SELECTOR_LEN + 2 + gsm->GTK_len +
+			  ieee80211w_kde_len(sm);
+	} else
+		kde_len = wpa_auth_ml_group_kdes_len(sm, KDE_ALL_LINKS);
+
+	*eid++ = 1 + WPA_KEY_RSC_LEN + kde_len;
+	*eid++ = WLAN_EID_EXT_KEY_DELIVERY;
+	/*RSC*/
+	if (!is_ml && sm->group->wpa_group_state == WPA_GROUP_SETKEYSDONE)
+		wpa_auth_get_seqnum(sm->wpa_auth, NULL, gsm->GN, rsc);
+	os_memcpy(eid, rsc, WPA_KEY_RSC_LEN);
+
+	eid += WPA_KEY_RSC_LEN;
+
+	if (is_ml)
+		eid = wpa_auth_ml_group_kdes(sm, eid, KDE_ALL_LINKS);
+	else {
+		gtk = gsm->GTK[gsm->GN - 1];
+		gtk_len = gsm->GTK_len;
+		hdr[0] = gsm->GN & 0x03;
+		eid = wpa_add_kde(eid, RSN_KEY_DATA_GROUPKEY, hdr, 2, gtk, gtk_len);
+		eid = ieee80211w_kde_add(sm, eid);
+	}
+
+	return eid;
+}
+#endif /* CONFIG_ENC_ASSOC */
+
+
 void wpa_reset_assoc_sm_info(struct wpa_state_machine *assoc_sm,
 			     struct wpa_authenticator *wpa_auth,
 			     u8 mld_assoc_link_id)
diff --git a/src/ap/wpa_auth.h b/src/ap/wpa_auth.h
index 4883e2db9..c023168f9 100644
--- a/src/ap/wpa_auth.h
+++ b/src/ap/wpa_auth.h
@@ -653,7 +653,11 @@ void wpa_auth_set_dpp_z(struct wpa_state_machine *sm, const struct wpabuf *z);
 void wpa_auth_set_ssid_protection(struct wpa_state_machine *sm, bool val);
 void wpa_auth_set_transition_disable(struct wpa_authenticator *wpa_auth,
 				     u8 val);
-
+u8 * wpa_auth_eid_key_delivery(u8 *eid,
+			       struct wpa_state_machine *sm,
+			       bool is_ml);
+u8 * wpa_auth_write_assoc_resp_eppke(struct wpa_state_machine *sm,
+				     u8 *pos, size_t max_len, bool is_ml);
 int wpa_auth_resend_m1(struct wpa_state_machine *sm, int change_anonce,
 		       void (*cb)(void *ctx1, void *ctx2),
 		       void *ctx1, void *ctx2);

From patchwork Thu Jan 15 16:32:55 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184702
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=SBwBiw0i;
	dkim=temperror header.d=infradead.org header.i=@infradead.org
 header.a=rsa-sha256 header.s=desiato.20200630 header.b=jpXqVWA3;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=US+VRz90;
	dkim=neutral header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=Al70KlEf;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsT9Y6sylz1xqf
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:35:13 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=mzsMZ/cm6xq3YMHKNHkQ1fXQNTSe0Ug7dvRocExx/0g=; b=SBwBiw0iBI/VDt
	PWoJp5J0Gdg6qoXphUQ+fVS7le4odIUfgx2n/CMBjm65YwCIcVN1bd4Mg2WiXavykJZCuwYkoHgJj
	xTzUq0gZon6wDRTy/LR12xOfhmbvRfTaF5mm76RC3NszvSrdTQ7wBYrfFV+OFqj/T2X7a/A+d8Nrq
	KbMNCo5rFn3Ewzu3LULq+xUVAwcY7QJ6L5Y8GcCy5/MytSqq2EJzeIH+GKDt1sDnZRJ2kdbggGtFI
	NFCOFAR1oJCweHJI0X8CTkkxig8f3qIsF/Ham4Hzdwxh4tQOSxBZrw+gUOP3DYkfee/ecP6+KTU6x
	7il4Thqgj/AgMODPVd3Q==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIw-0000000Cig1-11Wp;
	Thu, 15 Jan 2026 16:34:38 +0000
Received: from desiato.infradead.org ([2001:8b0:10b:1:d65d:64ff:fe57:4e05])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIZ-0000000CiBu-4612
	for hostap@bombadil.infradead.org;
	Thu, 15 Jan 2026 16:34:16 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=infradead.org; s=desiato.20200630; h=Content-Transfer-Encoding:MIME-Version
	:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender:Reply-To:
	Content-Type:Content-ID:Content-Description;
	bh=NeG3C4/Tp0h9un6LfEKGYiqsPgOabwVC7cb3UHu1Nhg=; b=jpXqVWA3AlWMMhedbPM8ve4n3H
	KNyb3Spm7OlfUMKmguNgJZdLdXvbQveAa8Nd8HbEp5DqrBBFHsUwA0jKdaM0rQXpo08HtBrckASNx
	hTxr6kO8dYeH7cQTxouerv4d0IffABW5EiLEA57SSSF5YB4Ofy6Bw0EnWJRS2X5Tw9sqKXQhPQJ9M
	PKQD2BtpHfDkojjSAkW6dK5KbR3e7aXwOOSXJdH94tgGUxaXbsuhuZHqVY0RAdIbKWH+Dm9DEWMxU
	YjBMxab7VBkZvMUjaHdHs+dDS8rrl6SvzTpFrwXsofbHj+PECufI2p+sP0gL9e571PunX0szDo1OH
	7nuErtcg==;
Received: from mx0a-0031df01.pphosted.com ([205.220.168.131])
	by desiato.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIT-0000000798l-0fi8
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:34:14 +0000
Received: from pps.filterd (m0279865.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFYXBn2981315
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:04 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=NeG3C4/Tp0h
	9un6LfEKGYiqsPgOabwVC7cb3UHu1Nhg=; b=US+VRz90KvrNlbrZuy/1PhLKEtV
	tYVTCk4ZYRjnJ1r7p8C+bttNGAyPb7J5psceOE6eiDuk2Hb+tjkH/6iZ69T3WRVs
	B4sJ/dny18jwojRiNY9sFrL3mbVpSgbPsPuUOi8bPsS7NgEbpiWytDZKlS26wSkC
	XbGeS2yUxXzhlQXKW1oHea1Ll9AUOE5HNsrOIo+Sheh8/F/i4SZllbQShoWFj15X
	eYd0b6ynWfJ2vxxZQKU4P5S3wnubdYGUvO/2o3Z+G7Jn3TMA48G39yi5zUP3fiJH
	C38DFQV5+lmx4/6FbyURFzZ11zcs0fC9jaFLj/uhZrOtzwYCmAQTfpF7dAg==
Received: from mail-pj1-f71.google.com (mail-pj1-f71.google.com
 [209.85.216.71])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bprej24gm-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:04 +0000 (GMT)
Received: by mail-pj1-f71.google.com with SMTP id
 98e67ed59e1d1-34c6e05af3bso986048a91.3
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:34:04 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494843; x=1769099643;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=NeG3C4/Tp0h9un6LfEKGYiqsPgOabwVC7cb3UHu1Nhg=;
        b=Al70KlEfw5png4bgk7eqGDKskbmDKNEdKqAzmK6wpeQP/lzKosKwo50ur1CvbHLPSe
         3amYGNDtULQ+pczWU08OTu7duOxqj6wAZBQAD4cErscYvzI9U66Cvm+ZzFCqussokdZK
         qXeWr1yJli8jqEgDlzNso8BR/rTYsu8WpGsty+tLmQln8EUdhsdobOgArUXQ5JWLCSe0
         z++GcaJYSI5B1DYqSnI0GMZ0uawQmmsn9Gymm6+tKB9Mnj5TQD73j/vcsoGTXkc7j/SM
         ZSqNmtrgo+SnqhKyf81rMs9vDhTPcKH2xmEv7cvM9htiraOYnI57YmhVnJUnPPaWwKci
         Z3Dg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494843; x=1769099643;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=NeG3C4/Tp0h9un6LfEKGYiqsPgOabwVC7cb3UHu1Nhg=;
        b=RSoD8thgNlBOITdetKbti4Sh3iAh/GLTjfsRsGPJTQfBChvEoKYxCO5TCN/FvcXsZB
         eNVWujDwkEXOyTKpbme7fgDjRO86G26LzSGarNwBEaZZ7+SvQ678zBOQJaA4e48whyGn
         0HPLbrUFW+TAsIcvVPJnnFT87kZCTQ/mxDowtexpodI7/GCH3GghaO4MDpvpJ0Aq6rI2
         tPRstGPONxqfb7JWOtVdWacTK2e26OH/AhyGpmE0PRpVICRoBJLALVf5Xx3pYs0AaxFb
         ZVHyuEn6+1QOoStPhulaUZcVO9KI0MfbSZtPubuq6pot43xHV82i6CoAIknaLpY4F1Gy
         BldA==
X-Gm-Message-State: AOJu0Yz2aE1nr+hQUq+oAsgIemJ4R+WjW1SyIpqVi8xgJKugOALDillm
	/2zG+Cpf+eYCYXF9h5j8fVxDYQfQOiixULK4Giz1KJOrbRIvYWp8N9ACa3uAonjGrN6/dKTTXcG
	mUEyUxlSzPMycJs10yv9Ba5+MEOi1dFAberwjCCoHpKOlws51E0hKPzidbm2UujA5wp/AS/lN
X-Gm-Gg: AY/fxX5A6MRIH6yC0OsTa7MIidNIgsVsjqn44Z3E4Pulu7izt21CBJ6EjyZYKKV9Lst
	jegMTEs36CvXOANyLkPVzv4TJesH0SUgbbUVQPDxFYeszKIhzymLMvykavCP0BV1NuhO6VkjaeF
	nPzKo1Xo8is/9EPXbw7TtuL9Z7CmiW1nxTp0XGSVtlr+0patnJazzNEH/tFx6UoUee3YeaVhWI8
	Iq9utQbYEuaWxfRcImOfxtr2z4wGuluxA6NUdTpyvNAEIsv2jqX2x2cm9hJ3/NhBzeMWLnExzS6
	8by2w+KHAvr9KJUxHl8K8wkoQRN+gNNHy0mECzw5IdMxYpf39Bvpzjf1dWkU21JPaTky8dDvAgP
	PEvnJQZheBHFtKXg5R2PsMxf1dYLFjq6rj8lj99uj
X-Received: by 2002:a17:902:da8a:b0:2a0:f469:1f56 with SMTP id
 d9443c01a7336-2a7176c546fmr756195ad.31.1768494843282;
        Thu, 15 Jan 2026 08:34:03 -0800 (PST)
X-Received: by 2002:a17:902:da8a:b0:2a0:f469:1f56 with SMTP id
 d9443c01a7336-2a7176c546fmr755985ad.31.1768494842829;
        Thu, 15 Jan 2026 08:34:02 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.34.01
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:34:02 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 16/27] EPPKE: Skip 4WH and move PTK state directly to
 PTKINITDONE
Date: Thu, 15 Jan 2026 22:02:55 +0530
Message-Id: <20260115163306.367753-17-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX/DxVoYx0OMgE
 BTcHBRSDxi385DPbsvBitGi8bVcXXcPndMELLvi2dzExVTRXLXfebJZ3T6PYd0+2Hq7VZEIw4GP
 XEWjSUdX8bV8k0sQ+CfNTtnaCzzAWSZX3l0hUaJanRTyP1rO1keKD0kAXu0vxYnP2pJZqqFwJuA
 gcj/LAwICfrRuv+2xN+xEx7eE5aj5nH8b7g0/qwu/n1aOmK8kGlYgybv4cuoJ8TcnMf5MHxikNJ
 3rHXpt1RYvsJ/9JgIajpz5/NyRfmC2sh2Nx+NvKR5eLyduL9ncaZqtehm7TpcnM7kXqFk6xDwCx
 M9TVSuZ0Y/lMAky2k5WAv0gFn4hhoha2RgZ04dBQ2kho7ysiq9sKm+OJQn1Pee4yg/+8oVETGbl
 WTP2xh+ZywG/466pcizP6VrIuuJS+YGST92vA35AC2C9nOQAvHN+iRpYNIO9JDae9QMnvE3slQn
 d1qxLur0ea1VUysGlQA==
X-Proofpoint-ORIG-GUID: LNoA3bWiw8YMsCfk6CihjhrthRuI2mrB
X-Authority-Analysis: v=2.4 cv=Rc+dyltv c=1 sm=1 tr=0 ts=696916fc cx=c_pps
 a=UNFcQwm+pnOIJct1K4W+Mw==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=soJdZWk_hRMbt9HGYo4A:9 a=uKXjsCUrEbL0IQVhDsJ9:22
X-Proofpoint-GUID: LNoA3bWiw8YMsCfk6CihjhrthRuI2mrB
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 lowpriorityscore=0 adultscore=0 spamscore=0 suspectscore=0 priorityscore=1501
 clxscore=1015 bulkscore=0 malwarescore=0 phishscore=0 impostorscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_163409_721808_F2C6CB38 
X-CRM114-Status: GOOD (  17.12  )
X-Spam-Score: -0.9 (/)
X-Spam-Report: Spam detection software,
 running on the system "desiato.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com> A
 successful
    EPPKE Authentication results in the establishment of a PTKSA. So skip
 4-way
    handshake procedure and move the PTK state directly to PTKINITDONE Also
 move
    the peer state to authorized.
 Content analysis details:   (-0.9 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.168.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.168.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.168.131 listed in
 sa-trusted.bondedsender.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.168.131 listed in
 bl.score.senderscore.com]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

A successful EPPKE Authentication results in the
establishment of a PTKSA. So skip 4-way handshake
procedure and move the PTK state directly to PTKINITDONE
Also move the peer state to authorized.

Signed-off-by: Rohan Dutta <drohan@qti.qualcomm.com>
Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
---
 src/ap/ap_mlme.c    |  6 ++++--
 src/ap/ieee802_11.c |  3 ++-
 src/ap/wpa_auth.c   | 16 ++++++++++++++++
 3 files changed, 22 insertions(+), 3 deletions(-)

diff --git a/src/ap/ap_mlme.c b/src/ap/ap_mlme.c
index 309e69a3f..efc214fe5 100644
--- a/src/ap/ap_mlme.c
+++ b/src/ap/ap_mlme.c
@@ -112,7 +112,8 @@ void mlme_associate_indication(struct hostapd_data *hapd, struct sta_info *sta)
 	if (sta->auth_alg != WLAN_AUTH_FT &&
 	    sta->auth_alg != WLAN_AUTH_FILS_SK &&
 	    sta->auth_alg != WLAN_AUTH_FILS_SK_PFS &&
-	    sta->auth_alg != WLAN_AUTH_FILS_PK)
+	    sta->auth_alg != WLAN_AUTH_FILS_PK &&
+	    sta->auth_alg != WLAN_AUTH_EPPKE)
 		mlme_deletekeys_request(hapd, sta);
 	ap_sta_clear_disconnect_timeouts(hapd, sta);
 }
@@ -140,7 +141,8 @@ void mlme_reassociate_indication(struct hostapd_data *hapd,
 	if (sta->auth_alg != WLAN_AUTH_FT &&
 	    sta->auth_alg != WLAN_AUTH_FILS_SK &&
 	    sta->auth_alg != WLAN_AUTH_FILS_SK_PFS &&
-	    sta->auth_alg != WLAN_AUTH_FILS_PK)
+	    sta->auth_alg != WLAN_AUTH_FILS_PK &&
+	    sta->auth_alg != WLAN_AUTH_EPPKE)
 		mlme_deletekeys_request(hapd, sta);
 	ap_sta_clear_disconnect_timeouts(hapd, sta);
 }
diff --git a/src/ap/ieee802_11.c b/src/ap/ieee802_11.c
index 87ad421c7..a9c37d079 100644
--- a/src/ap/ieee802_11.c
+++ b/src/ap/ieee802_11.c
@@ -7314,7 +7314,8 @@ static void handle_assoc_cb(struct hostapd_data *hapd,
 	    sta->auth_alg == WLAN_AUTH_FILS_SK ||
 	    sta->auth_alg == WLAN_AUTH_FILS_SK_PFS ||
 	    sta->auth_alg == WLAN_AUTH_FILS_PK ||
-	    sta->auth_alg == WLAN_AUTH_FT) {
+	    sta->auth_alg == WLAN_AUTH_FT ||
+	    sta->auth_alg == WLAN_AUTH_EPPKE) {
 		/*
 		 * Open, static WEP, FT protocol, or FILS; no separate
 		 * authorization step.
diff --git a/src/ap/wpa_auth.c b/src/ap/wpa_auth.c
index f7fc9eda4..bfcd257d7 100644
--- a/src/ap/wpa_auth.c
+++ b/src/ap/wpa_auth.c
@@ -1041,6 +1041,17 @@ int wpa_auth_sta_associated(struct wpa_authenticator *wpa_auth,
 	if (!wpa_auth || !wpa_auth->conf.wpa || !sm)
 		return -1;
 
+#ifdef CONFIG_ENC_ASSOC
+	if (sm->auth_alg == WLAN_AUTH_EPPKE) {
+		wpa_auth_logger(wpa_auth, wpa_auth_get_spa(sm), LOGGER_DEBUG,
+				"EPPKE authentication already completed - do not start 4-way handshake");
+		/* Go to PTKINITDONE state to allow GTK rekeying */
+		sm->wpa_ptk_state = WPA_PTK_PTKINITDONE;
+		sm->Pair = true;
+		return 0;
+	}
+#endif /* CONFIG_ENC_ASSOC */
+
 #ifdef CONFIG_IEEE80211R_AP
 	if (sm->ft_completed) {
 		wpa_auth_logger(wpa_auth, wpa_auth_get_spa(sm), LOGGER_DEBUG,
@@ -2522,6 +2533,11 @@ int wpa_auth_sm_event(struct wpa_state_machine *sm, enum wpa_event event)
 	    (event == WPA_AUTH || event == WPA_ASSOC))
 		remove_ptk = 0;
 #endif /* CONFIG_FILS */
+#ifdef CONFIG_ENC_ASSOC
+	if (sm->auth_alg == WLAN_AUTH_EPPKE &&
+	    (event == WPA_AUTH || event == WPA_ASSOC))
+		remove_ptk = 0;
+#endif /* CONFIG_ENC_ASSOC */
 
 	if (remove_ptk) {
 		sm->PTK_valid = false;

From patchwork Thu Jan 15 16:32:56 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184701
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=Aod53LRb;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=X/yJWvCk;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=Ne+F2Uk6;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsT9N3gLVz1xt4
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:35:04 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=eoYBN2rhGeNAXZ+ugoJOukjLzIl3NZrXWt6kghT8pWE=; b=Aod53LRbYsGvZD
	n6ZWgn4lcbYBbN5SlyaYXEqwTOouIRCAVEDzzy9lc0yGXFDUIv+ArzKT4usinrIO+1k2g9LnlW5I7
	9F0+P83YJeEbcJkDSRY9DsI4fRDnpCf5gqQ8RE5gLYQ/soRVXDRXB/20P+n4GdhXgytLwKdCKvBLN
	1ug8O2dLVOBubx3gk71jR5nLC7X5YrQLGntsSaf4XV6DNIPmlPJRODdcQtMdOIW/hfjTwS3SiVUf6
	YzCuKFJSeENLk/v7oK3LAYeC/s/SokglQgkZpeYnhbLh5BmCFjL31h0f3zqR2sg54BkgxKfvEzrIs
	tKf4rGeFPlcBb2q9NX8Q==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIk-0000000CiQY-0DPm;
	Thu, 15 Jan 2026 16:34:26 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIS-0000000Ci2K-3PpR
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:34:16 +0000
Received: from pps.filterd (m0279871.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFYGpT2866209
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:07 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=8S0nolajKI1
	sL1gwH7d46HkoIdhyWwNGmQkqktVztZ0=; b=X/yJWvCk2FSSEsaCtquLLDWYddd
	zO6bM+jodPKLJBvdz3REI6CsN9+En74yPcz3c3BtafNtFtxBVmDc+V0aZdvQpcqV
	Sb3SQ1EQnRB+kM0xsgcsefammvavIAMqubrQMsQYoqMzfC3qcbiAqZyWA/FRD91s
	Ectl0uiQqMvoGEviWnOCmtavKiwhCGlxSg8h9l/iJqWH+kp3YtaU33umvfmEBfR6
	dPsZDTgNPVu3mp5ZCCJq5K0of8PBv7OmuAOpP3iSH/PYHibyih8JWXppPMu5IkM8
	7PTdC+eXXgBhl0dV453IYMEXwWLUfqT8s65t1YbVmEsVN7GL09xZt9p1LDQ==
Received: from mail-pl1-f199.google.com (mail-pl1-f199.google.com
 [209.85.214.199])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bptu2hp6h-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:07 +0000 (GMT)
Received: by mail-pl1-f199.google.com with SMTP id
 d9443c01a7336-2a0e9e0fd49so20121795ad.0
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:34:07 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494846; x=1769099646;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=8S0nolajKI1sL1gwH7d46HkoIdhyWwNGmQkqktVztZ0=;
        b=Ne+F2Uk67bN/jCXR9QcLc99YxsigcjRUE94kDZB0XMMII9mK8nylYuc2/iR6zHAqf0
         Wf+ftwgo7J+B/mlOi6fLDF+yfvs2/FFOKkCoVGHVJUwvvbN/Q44/lcFa7+y2Sy8zViMB
         JQXwseDod0sSwyirO6B0pwjS+kYS23y3Dp+jPhStrFYSdCGJk3hdc5yFW94Pd/bjpkoc
         LQNTsPkVnT92o2sJx5qfUFxeG6gwkNmba2x+r2MJUvip0LEE+e4oJck3QUIMABx93fl0
         HD6jUV4kR+wBuxDZaqur/bEKZVVZsarqypFqVbR1wFq53zww9fkT5JoRos5Sw5LHTGsG
         aH5g==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494846; x=1769099646;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=8S0nolajKI1sL1gwH7d46HkoIdhyWwNGmQkqktVztZ0=;
        b=LzXmdo0aHkR5MYt4HZkOpFBaK487IXKBpwV3/Zu3M2urrZ/8lGtHvSkj5TqWMUUO2x
         w030JS+TDRMyBQgWZdZ+HC8dbi5FjwmW6JF2WA7Shmb1wrAUDAZtIISnz2XrXyEtCo/g
         6NuvBSh0oZ0L4u47X68knrmaHqCMI8tInrmgpRRMp+oCH8D0NFpUdN8D/U/yvBWjlTPS
         1V3dXmdMkzcsi/0aMUuhZS+mECHhg4qwpuw03JiGJIpn2bmlV/gZ6vsUWIKCDmuFfs0Y
         r76kZUJ9YYiG/gBEpeemJbbRauXwS7Xj5z1/BYUpkeH4zdaGjviO9+StMszDb38z1m9Z
         djJA==
X-Gm-Message-State: AOJu0YwU5qG4unjl+8Oy1EFrGSsHdjlORbikM3W3GKuYxHMZrBaZQ9jn
	BicoW6VTRTur9ZQFyJ6NAOJKmYQ0QgXUWrn14LSMgv11Jn2UmdIAR+b3nFO+xaltumvb2igh9Gm
	WhbEkppWdp/RsOn79MKPb9jUGMBviGYbZAl3PWtousoGdA2dKhIX2JB+pkuvjPSdmaOcOfZ2q
X-Gm-Gg: AY/fxX5d4lme3ztJ/0YAAADZlqUmi2fObY0b2tjKZgmkvauyvOUA4vFqKdvRRjLZJr0
	2PMjMnMDuMASHEw4E4Yq54aUxOLEswPilMKu6/fCCGgRzpVQn2ULOcMCOLsNj3lpv/eBiP4mhxf
	V6wI8ROk3WS7Oe+K+A8CfrcdOLyFVSD3jq6If6NrCx758yTMnGWLTNo9RtHxr6F0c/Ji1PoPLU/
	sh99sfb/n4Qun4kU2SBU08fdEglpOVaesmGKJCjmCqkUVdBmSjgJZdwDDXVHnD46GqpTRgdyHyQ
	fbDIFxz9S/FZRYXmDHBnF7eM8ZIvBCsWWMrt7mGehLYjtR42rHYniyxOWUWQOLx+j/RBKrZxsJz
	FxcjBGugRTZk+L/PCoc0KW45uafl8p4TtaRrcXV0D
X-Received: by 2002:a17:902:e787:b0:2a0:fb1c:144e with SMTP id
 d9443c01a7336-2a700990c98mr34463525ad.7.1768494845788;
        Thu, 15 Jan 2026 08:34:05 -0800 (PST)
X-Received: by 2002:a17:902:e787:b0:2a0:fb1c:144e with SMTP id
 d9443c01a7336-2a700990c98mr34463225ad.7.1768494845057;
        Thu, 15 Jan 2026 08:34:05 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.34.03
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:34:04 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 17/27] EPPKE: Add support for EPPKE authentication for
 SME-in-Userspace case
Date: Thu, 15 Jan 2026 22:02:56 +0530
Message-Id: <20260115163306.367753-18-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX3cz3lizpUCpa
 npzf9sGrBlSRIVT3ZT7u9tB5aKBY/UoHSBKBgh4+saPQGKbqs5RrupZbp/QAgPPAYxj1XvdrfTi
 zM8VDeFZ2rkfAgi+cRRmc/4O32QmSXMfEw/A774XawI/UFP8w/dRsBr7zawSbcP0/pdF73wEi5Y
 1OVieSAlVrRLVGx0f9V1MJj3+0H1ErLEViRcw8tGnnQ/cG/RJq/VdeEYBumVMYMIsiCsCy4jlVM
 LVXAWbpcx6zwo3L8o6jkHN6bBzubR/aZZ0lfhDqa8F5UQYA6+hx2PfnXCb06mAN95xLUtaFX2jT
 0SBT4z0cht6cbJMee/uMXRqPQSf/0hQrg9R61iYAYNmmZkLEkIwrtTCRugaQvEPtfCHKU36kE92
 8yCyfid9gKL6V1XDPzGLpYd9PWOg+7nJUK/MttYsGu13dcj5u81g7Rppez4VyitKN7euuqui3p3
 Uw8CY7XaLJFLo3cwuEg==
X-Proofpoint-ORIG-GUID: Tbr05pURHG0wUqaLNX2iXqkd69INdrZj
X-Authority-Analysis: v=2.4 cv=W6Y1lBWk c=1 sm=1 tr=0 ts=696916ff cx=c_pps
 a=JL+w9abYAAE89/QcEU+0QA==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=sWKEhP36mHoA:10
 a=VkNPw1HP01LnGYTKEx00:22 a=EUspDBNiAAAA:8 a=xevxeqDSjUnoaC6EqPUA:9
 a=324X-CrmTo6CU4MGRt3R:22
X-Proofpoint-GUID: Tbr05pURHG0wUqaLNX2iXqkd69INdrZj
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 adultscore=0 priorityscore=1501 phishscore=0 suspectscore=0
 lowpriorityscore=0 spamscore=0 impostorscore=0 malwarescore=0 clxscore=1015
 bulkscore=0 classifier=typeunknown authscore=0 authtc= authcc= route=outbound
 adjust=0 reason=mlx scancount=1 engine=8.22.0-2512120000
 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_083409_128330_932DC45A 
X-CRM114-Status: GOOD (  22.96  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  Extend existing PASN Implementation for authentication
 frame
    construction and processing logic to align with IEEE 802.11bi/D2.0,
 section
    12.16.9.3.2 for EPPKE authentication support. Apply PASN logic [...]
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

Extend existing PASN Implementation for authentication frame construction
and processing logic to align with IEEE 802.11bi/D2.0, section 12.16.9.3.2
for EPPKE authentication support. Apply PASN logic for EPPKE authentication
with necessary differences to support SME-in-Userspace scenarios.

Below are the Key Changes:
 1. Modify PASN Authentication request frame construction APIs:
    - Remove 'static' from M1 and M3 frame building functions to make them
      globally accessible.
    - Add 'is_sme_drv' parameter to differentiate between frames sent via
      %NL80211_CMD_AUTHENTICATE (false) and %NL80211_CMD_FRAME (true)
      interface and prepare auth_data for authentication request frames
      accordingly.
 2. Refactor PASN authentication response frame parsing API:
    - Introduce a new helper function wpas_parse_pasn_frame() to handle
      authentication response frame parsing in a modular way. This
      separates the frame parsing logic from wpa_pasn_auth_rx() and
      enables reuse for SME-in-Userspace scenarios.
    - Simplify pasn_parse_encrypted_data() by removing ieee80211_mgmt
      dependency and enables reuse for SME-in-Userspace scenarios.
 3. Update SME code to integrate EPPKE flow:
    - Add initialization, frame construction and event handling for EPPKE
      using extended PASN APIs for building authentication request frames
      and parsing the authentication response frame.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/pasn/pasn_common.c          |   9 +-
 src/pasn/pasn_common.h          |   8 ++
 src/pasn/pasn_initiator.c       | 154 +++++++++++++++++--------
 src/pasn/pasn_responder.c       |   4 +-
 wpa_supplicant/sme.c            | 196 +++++++++++++++++++++++++++++++-
 wpa_supplicant/wpa_supplicant.c |   1 +
 6 files changed, 309 insertions(+), 63 deletions(-)

diff --git a/src/pasn/pasn_common.c b/src/pasn/pasn_common.c
index f9ec5ca9c..35b91b32d 100644
--- a/src/pasn/pasn_common.c
+++ b/src/pasn/pasn_common.c
@@ -331,14 +331,7 @@ int pasn_parse_encrypted_data(struct pasn_data *pasn, const u8 *data,
 	u8 *buf;
 	u16 buf_len;
 	struct ieee802_11_elems elems;
-	const struct ieee80211_mgmt *mgmt =
-		(const struct ieee80211_mgmt *) data;
-
-	if (len < 24 + 6 ||
-	    ieee802_11_parse_elems(mgmt->u.auth.variable,
-				   len - offsetof(struct ieee80211_mgmt,
-						  u.auth.variable),
-				   &elems, 0) == ParseFailed) {
+	if (ieee802_11_parse_elems(data, len, &elems, 0) == ParseFailed) {
 		wpa_printf(MSG_DEBUG,
 			   "PASN: Failed parsing Authentication frame");
 		return -1;
diff --git a/src/pasn/pasn_common.h b/src/pasn/pasn_common.h
index 45ac3b4ce..cf9ef93b1 100644
--- a/src/pasn/pasn_common.h
+++ b/src/pasn/pasn_common.h
@@ -183,6 +183,10 @@ int wpas_pasn_start(struct pasn_data *pasn, const u8 *own_addr,
 		    int freq, const u8 *beacon_rsne, u8 beacon_rsne_len,
 		    const u8 *beacon_rsnxe, u8 beacon_rsnxe_len,
 		    const struct wpabuf *comeback);
+struct wpabuf *wpas_pasn_build_auth_1(struct pasn_data *pasn,
+				       const struct wpabuf *comeback,
+				       bool verify, bool is_sme_drv);
+struct wpabuf *wpas_pasn_build_auth_3(struct pasn_data *pasn, bool is_sme_drv);
 int wpa_pasn_verify(struct pasn_data *pasn, const u8 *own_addr,
 		    const u8 *peer_addr, const u8 *bssid,
 		    int akmp, int cipher, u16 group,
@@ -193,6 +197,10 @@ int wpa_pasn_auth_rx(struct pasn_data *pasn, const u8 *data, size_t len,
 		     struct wpa_pasn_params_data *pasn_params);
 int wpa_pasn_auth_tx_status(struct pasn_data *pasn,
 			    const u8 *data, size_t data_len, u8 acked);
+int wpas_parse_pasn_frame(struct pasn_data *pasn, u16 auth_type, u16 auth_transaction,
+			  u16 status_code, const u8 *frame_data, size_t frame_data_len,
+			  struct wpa_pasn_params_data *pasn_params);
+
 
 /* Responder */
 int handle_auth_pasn_1(struct pasn_data *pasn,
diff --git a/src/pasn/pasn_initiator.c b/src/pasn/pasn_initiator.c
index 68a4f09fa..ec356173a 100644
--- a/src/pasn/pasn_initiator.c
+++ b/src/pasn/pasn_initiator.c
@@ -582,9 +582,9 @@ static u8 wpas_pasn_get_wrapped_data_format(struct pasn_data *pasn)
 }
 
 
-static struct wpabuf * wpas_pasn_build_auth_1(struct pasn_data *pasn,
+struct wpabuf *wpas_pasn_build_auth_1(struct pasn_data *pasn,
 					      const struct wpabuf *comeback,
-					      bool verify)
+					      bool verify, bool is_sme_drv)
 {
 	struct wpabuf *buf, *pubkey = NULL, *wrapped_data_buf = NULL;
 	const u8 *pmkid;
@@ -609,10 +609,16 @@ static struct wpabuf * wpas_pasn_build_auth_1(struct pasn_data *pasn,
 
 	wrapped_data = wpas_pasn_get_wrapped_data_format(pasn);
 
-	wpa_pasn_build_auth_header(buf, pasn->bssid,
-				   pasn->own_addr, pasn->peer_addr,
-				   pasn->trans_seq + 1, WLAN_STATUS_SUCCESS,
-				   pasn->auth_alg == WLAN_AUTH_EPPKE);
+	if (!is_sme_drv) {
+		wpabuf_put_le16(buf, pasn->trans_seq + 1);
+		wpabuf_put_le16(buf, WLAN_STATUS_SUCCESS);
+	} else {
+		wpa_pasn_build_auth_header(buf, pasn->bssid,
+					   pasn->own_addr, pasn->peer_addr,
+					   pasn->trans_seq + 1,
+					   WLAN_STATUS_SUCCESS,
+					   pasn->auth_alg == WLAN_AUTH_EPPKE);
+	}
 
 	pmkid = NULL;
 	if (wpa_key_mgmt_ft(pasn->akmp)) {
@@ -682,7 +688,8 @@ fail:
 }
 
 
-static struct wpabuf * wpas_pasn_build_auth_3(struct pasn_data *pasn)
+struct wpabuf *wpas_pasn_build_auth_3(struct pasn_data *pasn,
+					      bool is_sme_drv)
 {
 	struct wpabuf *buf, *wrapped_data_buf = NULL;
 	u8 mic[WPA_PASN_MAX_MIC_LEN];
@@ -703,13 +710,18 @@ static struct wpabuf * wpas_pasn_build_auth_3(struct pasn_data *pasn)
 	if (!buf)
 		goto fail;
 
-	wrapped_data = wpas_pasn_get_wrapped_data_format(pasn);
+	if (!is_sme_drv) {
+		wpabuf_put_le16(buf, WLAN_AUTH_TR_SEQ_PASN_AUTH3);
+		wpabuf_put_le16(buf, WLAN_STATUS_SUCCESS);
+	} else {
+		wpa_pasn_build_auth_header(buf, pasn->bssid,
+					   pasn->own_addr, pasn->peer_addr,
+					   WLAN_AUTH_TR_SEQ_PASN_AUTH3,
+					   WLAN_STATUS_SUCCESS,
+					   pasn->auth_alg == WLAN_AUTH_EPPKE);
+	}
 
-	wpa_pasn_build_auth_header(buf, pasn->bssid,
-				   pasn->own_addr, pasn->peer_addr,
-				   WLAN_AUTH_TR_SEQ_PASN_AUTH3,
-				   WLAN_STATUS_SUCCESS,
-				   pasn->auth_alg == WLAN_AUTH_EPPKE);
+	wrapped_data = wpas_pasn_get_wrapped_data_format(pasn);
 
 	wrapped_data_buf = wpas_pasn_get_wrapped_data(pasn);
 
@@ -1010,7 +1022,7 @@ static int wpas_pasn_send_auth_1(struct pasn_data *pasn, const u8 *own_addr,
 		   MAC2STR(pasn->peer_addr), pasn->akmp, pasn->cipher,
 		   pasn->group);
 
-	frame = wpas_pasn_build_auth_1(pasn, comeback, verify);
+	frame = wpas_pasn_build_auth_1(pasn, comeback, verify, true);
 	if (!frame) {
 		wpa_printf(MSG_DEBUG, "PASN: Failed building 1st auth frame");
 		goto fail;
@@ -1153,36 +1165,27 @@ static bool is_pasn_auth_frame(struct pasn_data *pasn,
 }
 
 
-int wpa_pasn_auth_rx(struct pasn_data *pasn, const u8 *data, size_t len,
-		     struct wpa_pasn_params_data *pasn_params)
-
+int wpas_parse_pasn_frame(struct pasn_data *pasn, u16 auth_type,
+			  u16 auth_transaction, u16 status,
+			  const u8 *auth_data, size_t auth_data_len,
+			  struct wpa_pasn_params_data *pasn_params)
 {
 	struct ieee802_11_elems elems;
 	struct wpa_ie_data rsn_data;
-	const struct ieee80211_mgmt *mgmt =
-		(const struct ieee80211_mgmt *) data;
-	struct wpabuf *wrapped_data = NULL, *secret = NULL, *frame = NULL;
+	struct wpabuf *wrapped_data = NULL, *secret = NULL;
 	u8 mic[WPA_PASN_MAX_MIC_LEN], out_mic[WPA_PASN_MAX_MIC_LEN];
 	u8 mic_len;
-	u16 status;
 	int ret, inc_y;
 	u8 *copy = NULL;
 	size_t mic_offset, copy_len;
 
-	if (!is_pasn_auth_frame(pasn, mgmt, len, true))
-		return -2;
-
-	if (mgmt->u.auth.auth_transaction !=
-	    host_to_le16(pasn->trans_seq + 1)) {
+	if (auth_transaction != pasn->trans_seq + 1) {
 		wpa_printf(MSG_DEBUG,
 			   "PASN: RX: Invalid transaction sequence: (%u != %u)",
-			   le_to_host16(mgmt->u.auth.auth_transaction),
-			   pasn->trans_seq + 1);
+			   auth_transaction, pasn->trans_seq + 1);
 		return -3;
 	}
 
-	status = le_to_host16(mgmt->u.auth.status_code);
-
 	if (status != WLAN_STATUS_SUCCESS &&
 	    status != WLAN_STATUS_ASSOC_REJECTED_TEMPORARILY) {
 		wpa_printf(MSG_DEBUG,
@@ -1190,10 +1193,8 @@ int wpa_pasn_auth_rx(struct pasn_data *pasn, const u8 *data, size_t len,
 		goto fail;
 	}
 
-	if (ieee802_11_parse_elems(mgmt->u.auth.variable,
-				   len - offsetof(struct ieee80211_mgmt,
-						  u.auth.variable),
-				   &elems, 0) == ParseFailed) {
+	if (ieee802_11_parse_elems(auth_data, auth_data_len, &elems, 0) ==
+				   ParseFailed) {
 		wpa_printf(MSG_DEBUG,
 			   "PASN: Failed parsing Authentication frame");
 		goto fail;
@@ -1354,14 +1355,24 @@ int wpa_pasn_auth_rx(struct pasn_data *pasn, const u8 *data, size_t len,
 	/* Use a copy of the message since we need to clear the MIC field */
 	if (!elems.mic)
 		goto fail;
-	mic_offset = elems.mic - (const u8 *) &mgmt->u.auth;
-	copy_len = len - offsetof(struct ieee80211_mgmt, u.auth);
-	if (mic_offset + mic_len > copy_len)
-		goto fail;
-	copy = os_memdup(&mgmt->u.auth, copy_len);
+
+	mic_offset = elems.mic - auth_data;
+	/* 6 bytes for auth algorithm, auth transaction and status code.
+	 * 2 bytes each.
+	 */
+	copy = os_malloc(auth_data_len + 6);
 	if (!copy)
 		goto fail;
-	os_memset(copy + mic_offset, 0, mic_len);
+
+	os_memcpy(copy, &auth_type, 2);
+	os_memcpy(copy + 2, &auth_transaction, 2);
+	os_memcpy(copy + 4, &status, 2);
+	os_memcpy(copy + 6, auth_data, auth_data_len);
+	copy_len = auth_data_len + 6;
+	if (mic_offset + mic_len > auth_data_len)
+		goto fail;
+
+	os_memset(copy + mic_offset + 6, 0, mic_len);
 
 	if (pasn->beacon_rsne_rsnxe) {
 		/* Verify the MIC */
@@ -1421,12 +1432,61 @@ int wpa_pasn_auth_rx(struct pasn_data *pasn, const u8 *data, size_t len,
 
 	wpa_printf(MSG_DEBUG, "PASN: Success verifying Authentication frame");
 
-	if (pasn_parse_encrypted_data(pasn, data, len) < 0) {
+	if (pasn_parse_encrypted_data(pasn, auth_data, auth_data_len) < 0) {
 		wpa_printf(MSG_DEBUG, "PASN: Encrypted data processing failed");
 		goto fail;
 	}
 
-	frame = wpas_pasn_build_auth_3(pasn);
+	return 0;
+fail:
+	wpabuf_free(wrapped_data);
+	wpabuf_free(secret);
+	os_free(copy);
+
+	/*
+	 * TODO: In case of an error the standard allows to silently drop
+	 * the frame and terminate the authentication exchange. However, better
+	 * reply to the AP with an error status.
+	 */
+	if (status == WLAN_STATUS_SUCCESS)
+		pasn->status = WLAN_STATUS_UNSPECIFIED_FAILURE;
+	else
+		pasn->status = status;
+
+	return -1;
+
+}
+
+
+int wpa_pasn_auth_rx(struct pasn_data *pasn, const u8 *data, size_t len,
+		     struct wpa_pasn_params_data *pasn_params)
+{
+	const struct ieee80211_mgmt *mgmt =
+		(const struct ieee80211_mgmt *) data;
+	struct wpabuf *frame = NULL;
+	int ret;
+
+	if (!is_pasn_auth_frame(pasn, mgmt, len, true))
+		return -2;
+
+	ret = wpas_parse_pasn_frame(pasn, le_to_host16(mgmt->u.auth.auth_alg),
+				    le_to_host16(mgmt->u.auth.auth_transaction),
+				    le_to_host16(mgmt->u.auth.status_code),
+				    mgmt->u.auth.variable,
+				    len - offsetof(struct ieee80211_mgmt,
+				    u.auth.variable), pasn_params);
+
+	if (ret < 0) {
+		wpa_printf(MSG_DEBUG, "PASN: Failed parsing PASN M2 auth frame");
+		goto fail;
+	}
+
+	if (ret == 1) {
+		wpa_printf(MSG_DEBUG, "PASN: Temporary rejection, Retry");
+		return 1;
+	}
+
+	frame = wpas_pasn_build_auth_3(pasn, true);
 	if (!frame) {
 		wpa_printf(MSG_DEBUG, "PASN: Failed building 3rd auth frame");
 		goto fail;
@@ -1451,21 +1511,17 @@ int wpa_pasn_auth_rx(struct pasn_data *pasn, const u8 *data, size_t len,
 
 	return 0;
 fail:
-	wpa_printf(MSG_DEBUG, "PASN: Failed RX processing - terminating");
-	wpabuf_free(wrapped_data);
-	wpabuf_free(secret);
-	os_free(copy);
-
 	/*
 	 * TODO: In case of an error the standard allows to silently drop
 	 * the frame and terminate the authentication exchange. However, better
 	 * reply to the AP with an error status.
 	 */
-	if (status == WLAN_STATUS_SUCCESS)
+	if (le_to_host16(mgmt->u.auth.status_code) == WLAN_STATUS_SUCCESS)
 		pasn->status = WLAN_STATUS_UNSPECIFIED_FAILURE;
 	else
-		pasn->status = status;
+		pasn->status = le_to_host16(mgmt->u.auth.status_code);
 
+	wpa_printf(MSG_DEBUG, "PASN: Failed RX processing - terminating");
 	return -1;
 }
 
diff --git a/src/pasn/pasn_responder.c b/src/pasn/pasn_responder.c
index 1aa72de11..f7f1bc413 100644
--- a/src/pasn/pasn_responder.c
+++ b/src/pasn/pasn_responder.c
@@ -1184,7 +1184,9 @@ int handle_auth_pasn_3(struct pasn_data *pasn, const u8 *own_addr,
 		wpabuf_free(wrapped_data);
 	}
 
-	if (pasn_parse_encrypted_data(pasn, (const u8 *) mgmt, len) < 0) {
+	if (pasn_parse_encrypted_data(pasn, (const u8 *) mgmt->u.auth.variable,
+				      len - offsetof(struct ieee80211_mgmt,
+				      u.auth.variable)) < 0) {
 		wpa_printf(MSG_DEBUG, "PASN: Encrypted data processing failed");
 		goto fail;
 	}
diff --git a/wpa_supplicant/sme.c b/wpa_supplicant/sme.c
index fba6508bc..3510faf74 100644
--- a/wpa_supplicant/sme.c
+++ b/wpa_supplicant/sme.c
@@ -32,6 +32,9 @@
 #include "scan.h"
 #include "sme.h"
 #include "hs20_supplicant.h"
+#include "pasn/pasn_common.h"
+#include "common/dragonfly.h"
+#include "common/ptksa_cache.h"
 
 #define SME_AUTH_TIMEOUT 5
 #define SME_ASSOC_TIMEOUT 5
@@ -41,6 +44,7 @@ static void sme_assoc_timer(void *eloop_ctx, void *timeout_ctx);
 static void sme_obss_scan_timeout(void *eloop_ctx, void *timeout_ctx);
 static void sme_stop_sa_query(struct wpa_supplicant *wpa_s);
 
+static const int dot11RSNAConfigPMKLifetime = 43200;
 
 #ifdef CONFIG_SAE
 
@@ -597,6 +601,133 @@ static void sme_add_assoc_req_ie(struct wpa_supplicant *wpa_s,
 	}
 }
 
+#ifdef CONFIG_ENC_ASSOC
+static struct sae_pt *
+sme_eppke_sae_derive_pt(struct wpa_ssid *ssid, int group)
+{
+	const char *password = ssid->sae_password;
+	int groups[2] = { group, 0 };
+
+	if (!password)
+		password = ssid->passphrase;
+
+	if (!password) {
+		wpa_printf(MSG_DEBUG, "PASN: SAE without a password");
+		return NULL;
+	}
+
+	return sae_derive_pt(groups, ssid->ssid, ssid->ssid_len,
+			     (const u8 *) password, os_strlen(password),
+			     (const u8 *) ssid->sae_password_id,
+			     ssid->sae_password_id ?
+			     os_strlen(ssid->sae_password_id) : 0);
+}
+
+static void wpas_eppke_initialize(struct wpa_supplicant *wpa_s, struct wpa_bss *bss,
+				 struct wpa_ssid *ssid)
+{
+	struct pasn_data *pasn;
+	const u8 *beacon_rsne, *beacon_rsnxe;
+	u8 beacon_rsne_len, beacon_rsnxe_len;
+	u32 capab = 0;
+	int group;
+
+	pasn = &wpa_s->pasn;
+
+	if (sme_set_sae_group(wpa_s, 0) < 0) {
+		wpa_printf(MSG_DEBUG, "EPPKE: Failed to select group");
+		return;
+	}
+	group = wpa_s->sme.sae.group;
+
+	if (!dragonfly_suitable_group(group, 1)) {
+		wpa_printf(MSG_DEBUG,
+			"PASN: Reject unsuitable group %u", group);
+		return;
+	}
+
+	beacon_rsne = wpa_bss_get_rsne(wpa_s, bss, NULL, false);
+	if (!beacon_rsne) {
+		wpa_printf(MSG_DEBUG, "EPPKE: Can't connect without RSNE");
+		return;
+	}
+
+	beacon_rsnxe = wpa_bss_get_rsnxe(wpa_s, bss, NULL, false);
+
+	beacon_rsne_len = *(beacon_rsne + 1) + 2;
+	beacon_rsnxe_len = beacon_rsnxe ? *(beacon_rsnxe + 1) + 2 : 0;
+	if (beacon_rsne && beacon_rsne_len) {
+		wpabuf_free(pasn->beacon_rsne_rsnxe);
+		pasn->beacon_rsne_rsnxe = wpabuf_alloc(beacon_rsne_len +
+						       beacon_rsnxe_len);
+		if (!pasn->beacon_rsne_rsnxe) {
+			wpa_printf(MSG_DEBUG,
+				   "PASN: Failed storing beacon RSNE/RSNXE");
+			return;
+		}
+
+		wpabuf_put_data(pasn->beacon_rsne_rsnxe, beacon_rsne,
+				beacon_rsne_len);
+		if (beacon_rsnxe && beacon_rsnxe_len)
+			wpabuf_put_data(pasn->beacon_rsne_rsnxe,
+					beacon_rsnxe, beacon_rsnxe_len);
+	}
+	capab |= BIT(WLAN_RSNX_CAPAB_KEK_IN_PASN);
+	capab |= BIT(WLAN_RSNX_CAPAB_ASSOC_FRAME_ENCRYPTION);
+
+#ifdef CONFIG_SAE
+	if (wpa_key_mgmt_sae(ssid->key_mgmt)) {
+		capab |= BIT(WLAN_RSNX_CAPAB_SAE_H2E);
+		if (beacon_rsnxe && !ieee802_11_rsnx_capab(beacon_rsnxe,
+		    WLAN_RSNX_CAPAB_SAE_H2E)) {
+			wpa_printf(MSG_DEBUG, "PASN: AP does not support SAE H2E");
+			return;
+		}
+		if (pasn->pt)
+			sae_deinit_pt(pasn->pt);
+		pasn_set_pt(pasn, sme_eppke_sae_derive_pt(ssid, group));
+		if (!pasn->pt) {
+			wpa_printf(MSG_DEBUG, "PASN: Failed to derive PT");
+			return;
+		}
+		pasn->sae.state = SAE_NOTHING;
+		pasn->sae.send_confirm = 0;
+	} else {
+		wpa_msg(wpa_s, MSG_INFO, "Base AKM not present");
+		return;
+	}
+#endif /* CONFIG_SAE */
+
+	pasn_set_rsnxe_caps(pasn, capab);
+	pasn_set_initiator_pmksa(pasn, wpa_sm_get_pmksa_cache(wpa_s->wpa));
+
+	if (pasn->ecdh)
+		crypto_ecdh_deinit(pasn->ecdh);
+	pasn->ecdh = crypto_ecdh_init(group);
+	if (!pasn->ecdh) {
+		wpa_printf(MSG_INFO, "PASN: Failed to init ECDH");
+		return;
+	}
+	pasn->akmp = wpa_s->key_mgmt;
+	pasn->cipher = wpa_pick_pairwise_cipher(ssid->pairwise_cipher, 1);
+	pasn->group = group;
+	pasn->freq = bss->freq;
+	pasn->auth_alg = WLAN_AUTH_EPPKE;
+
+	os_memcpy(pasn->own_addr, wpa_s->own_addr, ETH_ALEN);
+	if (wpa_s->drv_flags2 & WPA_DRIVER_FLAGS2_MLO)
+		os_memcpy(pasn->peer_addr, wpa_s->ap_mld_addr, ETH_ALEN);
+	else
+		os_memcpy(pasn->peer_addr, bss->bssid, ETH_ALEN);
+	os_memcpy(pasn->bssid, bss->bssid, ETH_ALEN);
+
+	wpa_printf(MSG_DEBUG,
+		   "PASN: Init: " MACSTR " akmp=0x%x, cipher=0x%x, group=%u",
+		   MAC2STR(pasn->peer_addr), pasn->akmp,
+			   pasn->cipher, pasn->group);
+}
+#endif /* CONFIG_ENC_ASSOC */
+
 
 static void sme_send_authentication(struct wpa_supplicant *wpa_s,
 				    struct wpa_bss *bss, struct wpa_ssid *ssid,
@@ -698,14 +829,22 @@ static void sme_send_authentication(struct wpa_supplicant *wpa_s,
 		if (!rsn) {
 			wpa_dbg(wpa_s, MSG_DEBUG,
 				"SAE enabled, but target BSS does not advertise RSN");
+		}
+		if (wpa_parse_wpa_ie(rsn, 2 + rsn[1], &ied)) {
+			wpa_printf(MSG_DEBUG, "PASN: Failed parsing RSNE data");
+			return;
 #ifdef CONFIG_DPP
-		} else if (wpa_parse_wpa_ie(rsn, 2 + rsn[1], &ied) == 0 &&
-			   (ssid->key_mgmt & WPA_KEY_MGMT_DPP) &&
+		} else if ((ssid->key_mgmt & WPA_KEY_MGMT_DPP) &&
 			   (ied.key_mgmt & WPA_KEY_MGMT_DPP)) {
 			wpa_dbg(wpa_s, MSG_DEBUG, "Prefer DPP over SAE when both are enabled");
 #endif /* CONFIG_DPP */
-		} else if (wpa_parse_wpa_ie(rsn, 2 + rsn[1], &ied) == 0 &&
-			   wpa_key_mgmt_sae(ied.key_mgmt)) {
+#ifdef CONFIG_ENC_ASSOC
+		} else if (wpa_s->drv_flags2 & WPA_DRIVER_FLAGS2_EPPKE &&
+			   (ied.key_mgmt & WPA_KEY_MGMT_EPPKE)) {
+			wpa_dbg(wpa_s, MSG_DEBUG, "Prefer EPPKE over SAE when both are enabled");
+			params.auth_alg = WPA_AUTH_ALG_EPPKE;
+#endif /* CONFIG_ENC_ASSOC */
+		} else if (wpa_key_mgmt_sae(ied.key_mgmt)) {
 			if (wpas_is_sae_avoided(wpa_s, ssid, &ied)) {
 				wpa_dbg(wpa_s, MSG_DEBUG,
 					"SAE enabled, but disallowing SAE auth_alg without PMF");
@@ -1026,6 +1165,20 @@ static void sme_send_authentication(struct wpa_supplicant *wpa_s,
 	}
 #endif /* CONFIG_MBO */
 
+#ifdef CONFIG_ENC_ASSOC
+	if (!skip_auth && params.auth_alg == WPA_AUTH_ALG_EPPKE) {
+		wpas_eppke_initialize(wpa_s, bss, ssid);
+		if (start)
+			resp = wpas_pasn_build_auth_1(&wpa_s->pasn, NULL,
+							    false, 0);
+		else
+			resp = wpas_pasn_build_auth_3(&wpa_s->pasn, 0);
+
+		params.auth_data = wpabuf_head(resp);
+		params.auth_data_len = wpabuf_len(resp);
+		wpa_s->sme.auth_alg = params.auth_alg;
+	}
+#endif /* CONFIG_ENC_ASSOC */
 #ifdef CONFIG_SAE
 	if (!skip_auth && params.auth_alg == WPA_AUTH_ALG_SAE &&
 	    pmksa_cache_set_current(wpa_s->wpa, NULL,
@@ -1167,7 +1320,9 @@ no_fils:
 		wpa_ssid_txt(params.ssid, params.ssid_len), params.freq);
 
 	eapol_sm_notify_portValid(wpa_s->eapol, false);
-	wpa_clear_keys(wpa_s, bss->bssid);
+	if (wpa_s->sme.auth_alg != WPA_AUTH_ALG_EPPKE) {
+		wpa_clear_keys(wpa_s, bss->bssid);
+	}
 	wpa_supplicant_set_state(wpa_s, WPA_AUTHENTICATING);
 	if (old_ssid != wpa_s->current_ssid)
 		wpas_notify_network_changed(wpa_s);
@@ -2080,6 +2235,37 @@ void sme_event_auth(struct wpa_supplicant *wpa_s, union wpa_event_data *data)
 
 	eloop_cancel_timeout(sme_auth_timer, wpa_s, NULL);
 
+#ifdef CONFIG_ENC_ASSOC
+	if (data->auth.auth_type == WLAN_AUTH_EPPKE) {
+		struct pasn_data *pasn = &wpa_s->pasn;
+		struct wpa_pasn_params_data pasn_params;
+		int res;
+
+		res = wpas_parse_pasn_frame(pasn, data->auth.auth_type,
+					    data->auth.auth_transaction,
+					    data->auth.status_code,
+					    data->auth.ies, data->auth.ies_len,
+					    &pasn_params);
+
+		if (res < 0) {
+			wpas_connection_failed(wpa_s, wpa_s->pending_bssid,
+					       NULL);
+			wpa_supplicant_set_state(wpa_s, WPA_DISCONNECTED);
+		}
+
+		ptksa_cache_add(wpa_s->ptksa, pasn->own_addr, pasn->peer_addr,
+				pasn_get_cipher(pasn),
+				dot11RSNAConfigPMKLifetime,
+				pasn_get_ptk(pasn), NULL, NULL,
+				pasn_get_akmp(pasn));
+
+		if (pasn->pmksa_entry)
+			wpa_sm_set_cur_pmksa(wpa_s->wpa, pasn->pmksa_entry);
+
+		sme_send_authentication(wpa_s, wpa_s->current_bss,
+					wpa_s->current_ssid, 0);
+	}
+#endif /* CONFIG_ENC_ASSOC */
 #ifdef CONFIG_SAE
 	if (data->auth.auth_type == WLAN_AUTH_SAE) {
 		const u8 *addr = wpa_s->pending_bssid;
diff --git a/wpa_supplicant/wpa_supplicant.c b/wpa_supplicant/wpa_supplicant.c
index 293d4920e..70c92ea00 100644
--- a/wpa_supplicant/wpa_supplicant.c
+++ b/wpa_supplicant/wpa_supplicant.c
@@ -9476,6 +9476,7 @@ void wpas_request_connection(struct wpa_supplicant *wpa_s)
 	wpa_s->disconnected = 0;
 	wpa_s->reassociate = 1;
 	wpa_s->last_owe_group = 0;
+	wpa_pasn_reset(&wpa_s->pasn);
 
 	if (wpa_supplicant_fast_associate(wpa_s) != 1)
 		wpa_supplicant_req_scan(wpa_s, 0, 0);

From patchwork Thu Jan 15 16:32:57 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184704
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=IjCDl9lI;
	dkim=fail reason="signature verification failed" (2048-bit key;
 secure) header.d=infradead.org header.i=@infradead.org header.a=rsa-sha256
 header.s=casper.20170209 header.b=pRRWHWBJ;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=DCoWdRFC;
	dkim=neutral header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=c3uWeRYU;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsT9v1l7tz1xqf
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:35:31 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=l3MGgTgm8fpTz71E66vhJN0QkPOmzLowO4Izk/wFg8s=; b=IjCDl9lIk/9DQk
	C4YXe478evyfIBKfrH2vLtVPLyrAe2cxFLCoq8B8V7wf90Agr06NuU/dAlrhkFm7GLkGl0GNcr7jB
	XroJxmoi4Y07QEe6nV2p8+dwSayxoXpa78OmmFvHrKTLKx9ZSNUqPQ3x8YhYNCwZiiyrkZUCUcM5z
	kEe9sRbe/bPsmWUwN+gbSGpUlf97hh/rqnuRwLTXCwHvogGxqPyo9uDrqcYgLwkFg7ZctL1tDCYS+
	d6d6lrbzEKA4iPrp4sShyR+AkRyoYrDcBsqFE+f9riJCZsreIzvQPb3vCEl2m2FQed8rth7JOywzm
	pYSx2wOQmgUAS4/fpVcQ==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQJ8-0000000Cix4-25uk;
	Thu, 15 Jan 2026 16:34:52 +0000
Received: from casper.infradead.org ([2001:8b0:10b:1236::1])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIg-0000000CiKN-0nX2
	for hostap@bombadil.infradead.org;
	Thu, 15 Jan 2026 16:34:22 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=infradead.org; s=casper.20170209; h=Content-Transfer-Encoding:MIME-Version:
	References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender:Reply-To:
	Content-Type:Content-ID:Content-Description;
	bh=dVMNzkPGJu9T7MuLFZ18wh2C4kH+DV3khpPYHpcCGiM=; b=pRRWHWBJ6qIhu8hI9kQBhhe4LR
	IFC+/4cz+ISUCxaVvFleCdksiqUWrZy+ZMp//kbTIuf7duqL49hPjd0It67bfYSUKvUknA/hRKaPx
	tC8YWxiXbYhzKHLbv5g7B7qap1MLZKb2pty4ofxhhWAEE3EOQt4EJYrM7G7Tpt7UNQJE7MXiWMK9h
	0DswvX8uP9VWDW+gEdbGVCGD3Gg+hGjeE7zZ74A9glxQK+N3fgOAgXTvvkzRnSz26x8mMUmv/3wpY
	/WMSd21unyoCWm+d1N3x2RC6/NqXd3FoTZGciCYVZuvAb9JWEfX4YTo09oCklncVL68l4/hQkg8lC
	xwFGYArA==;
Received: from mx0a-0031df01.pphosted.com ([205.220.168.131])
	by casper.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIX-00000007ybm-3eDp
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:34:20 +0000
Received: from pps.filterd (m0279866.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFfx9F2311995
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:08 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=dVMNzkPGJu9
	T7MuLFZ18wh2C4kH+DV3khpPYHpcCGiM=; b=DCoWdRFCXAXGiCgLQaMNzujRFX6
	qR0Woin3+Gx1BCUgoxtWAT+5t8nIpvd+WXkbXBJU+esR8BwDV01G07KLfC9Xhtvn
	duMcAqNxjKSMVifPve37s6tr/xrKHW5KFW+wKORMDD0UCmWyVWwJYQyWSjj9Z2fX
	VbQ9hz1R8FAX6TRnrWEQn3AHB1RtLgJ9okGm3NpcH0vGl5UcXwqxAA0qIb6oLkaH
	p57qVqRX6XkP1jp2tr0Ijax8qStKkhCD4+ON6NLl2eZmc2aQ5HUCMZUgoSMRn7E8
	HZFdSbrQlq3vB9xzyCMcCyiWIv1JxHHqopGUN7jP0JC93W78TWJX+Ov10SQ==
Received: from mail-pg1-f198.google.com (mail-pg1-f198.google.com
 [209.85.215.198])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bq340g6v9-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:08 +0000 (GMT)
Received: by mail-pg1-f198.google.com with SMTP id
 41be03b00d2f7-b62da7602a0so753393a12.2
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:34:08 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494848; x=1769099648;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=dVMNzkPGJu9T7MuLFZ18wh2C4kH+DV3khpPYHpcCGiM=;
        b=c3uWeRYU91AmF70xacro/8Z2OICDE++uUVFje4y/VbaUK3JDtK0FA1CH0Wbo58MV8O
         lBx/HzcYCCrh9szzQViYH5yaqD7kzACweK8pNhrrdqNWuXOtGH2JPvXGZXDYmgZ9nM0d
         JJGUa2yIFAn2jX0oEOdZncQeWCDfCloOowtpScPjtcLEP6t7m7RF73Iwq6ZihHypw60j
         Ft94XAeTA100BxfjIR5y5X+bbl7S5/ZCWDyjtv28d3f2WZMHxvmhOoOaKraLkV6gaqAf
         oycKen4ILiEL6v2WJ800cx3UXlrEdLORZXyVebBjJgdaUewZ9qrKSL/KZJQExXUvRPd8
         hsNQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494848; x=1769099648;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=dVMNzkPGJu9T7MuLFZ18wh2C4kH+DV3khpPYHpcCGiM=;
        b=V2nz0eufbtLMmMWuKwswqlCYfZwXxAXvVdAAFbZT0OrTbpFqe+Qwz5eKdoaR5lKW5T
         6U0DTo2HNMVD3K5HyBmLIt+Bpj6Nscxuth2ZPJGV0H19FRNGPv4QuTlI2IyU6TPfOagh
         6UhzipLMP8iuiObFmX+laWC5I6d380DgjAeEcOetVxsqb+b29TqYvkNagh+tL5iLeIIo
         OyyF6byShyOpF7CBAP+5y02iKgc/rCK0V7YPonFH0sp6J9ekj1ZEGmzP7hV1ly/IFyBM
         5VuTstmkLB95gyAzHociTFMgvZDmUwIj69AjPHYmAu5W7tmLczZWh1bb/jFIghShEl/y
         pgNw==
X-Gm-Message-State: AOJu0YwnFPFtB8+jJwf8Zlf2WiPv5tptUUTF8kXSS+ijqKac8jHPdCQu
	BTDmPQ24SAChO2Ge43QOeGbR/0yWTadGjUgo5CE/fzWh2NFEou+yrclY2DtNx+6oBBJMLi2r9yc
	8geT83qvhcQytHPdi6uvzX7CAUAEdSh2ucMmfgo/mEvQyr5MJ7BmNnLXW6AbnT/3uhh5JRu20
X-Gm-Gg: AY/fxX79RUaKxG0TYGmEDDHiHTNtFwLcAurA3mskUD92+aYMUkNUnltopclpYNPDOS+
	0g0eBGk8TJLV3hBc5SAHI/9woaIFYRyR4nqczEpjPfu3tehiCNq4PdrIkdm8feIFdim2efT6Rzq
	xyDQJjD2B38MJBjCGk58hDKaylhYcezD10P9qyzhS1QlXWO3/IL09KKaEmjmC7vkJ98Sd2OTMo7
	MhnZcsOZpkWY4wkCZajlDW/3NQl4KSe+CVa2UUJ0cZAQ488mU42JomHnoRMP0KlbaHNn1Uhj6x5
	bc7pwa0N7Q6gRrtWd3y0wEuVXj/wJWlMmAj+yNQV7RSosWFqhFKYJTZG2iFYg8tr4ydS7BldPR0
	Qi8Xu9MBxzhV7a1v+Nik6LuaXu+Zqlk/lTvwr0kZb
X-Received: by 2002:a17:902:cec2:b0:2a1:325d:8219 with SMTP id
 d9443c01a7336-2a7176c289amr782205ad.38.1768494847775;
        Thu, 15 Jan 2026 08:34:07 -0800 (PST)
X-Received: by 2002:a17:902:cec2:b0:2a1:325d:8219 with SMTP id
 d9443c01a7336-2a7176c289amr782025ad.38.1768494847310;
        Thu, 15 Jan 2026 08:34:07 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.34.05
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:34:06 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 18/27] EPPKE: Add Multi-Link support in Authentication
 frames
Date: Thu, 15 Jan 2026 22:02:57 +0530
Message-Id: <20260115163306.367753-19-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-GUID: 373jkJs3FOjLdtEttZltGN3Mq-UcjQmx
X-Authority-Analysis: v=2.4 cv=bp9BxUai c=1 sm=1 tr=0 ts=69691700 cx=c_pps
 a=Qgeoaf8Lrialg5Z894R3/Q==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=fVceUa6IFZthgqk8aiAA:9 a=x9snwWr2DeNwDh03kgHS:22
X-Proofpoint-ORIG-GUID: 373jkJs3FOjLdtEttZltGN3Mq-UcjQmx
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX45xB3G6NtIvE
 xAfM5eTzU+2S6if3U8CbUCbMMKa8gUWFCONuA4307fiBd3/l/ywRNfL4zFcaCFraLkZ4a09ClX0
 zuT/l9CaFIAKGSgHsBUmXLILniwFO0p2HQAnDWphfV5qGW/Rw7WK3IKn7Z8JS6oz4VnjQNKNche
 t2UWEajxkfqF97xyUCWjC19LGOZ19/X7R6HmDBwwc7dN8hVeKAo4ruUtuYihZP+XnBx+6BVQ7vn
 wlWvGJzL1BLRPhcLRS/OxOP4v1IVNzbdY/xRmGLOUNiLKuhzGCbdKiPXs5T42SckBc4mCbeuW2O
 vr/FC8dOW7TZAebPFbq9HYjguhcztKa6rciS1KuKtD8gR8RJIkL4GLqZm/Dc5r5ZvTgB5cAl1qP
 8efccjdFgwkyphOQ2VPe1vt1KE2y8aDOBAJ7UD75QgNHegi1/qyiNlREF0lOJMB38E3uWht/YzU
 UP5nH4GPbfIPoN7mmfQ==
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 suspectscore=0 spamscore=0 bulkscore=0 impostorscore=0 malwarescore=0
 lowpriorityscore=0 phishscore=0 clxscore=1015 priorityscore=1501 adultscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_163414_314217_E918CBAE 
X-CRM114-Status: GOOD (  15.77  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: SpamAssassin version 4.0.1 on casper.infradead.org summary:
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.168.131 listed in list.dnswl.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.168.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.168.131 listed in
 sa-trusted.bondedsender.org]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.168.131 listed in
 bl.score.senderscore.com]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

Enhance EPPKE authentication to include Multi-Link Element (MLE) for
MLO-capable stations. The MLE is added to authentication request frames
when the station supports Multi-Link operation, ensuring proper handling
of MLO connections during EPPKE authentication.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/pasn/pasn_initiator.c | 24 ++++++++++++++++++++++++
 wpa_supplicant/sme.c      |  6 ++++--
 2 files changed, 28 insertions(+), 2 deletions(-)

diff --git a/src/pasn/pasn_initiator.c b/src/pasn/pasn_initiator.c
index ec356173a..30f42fb65 100644
--- a/src/pasn/pasn_initiator.c
+++ b/src/pasn/pasn_initiator.c
@@ -664,6 +664,18 @@ struct wpabuf *wpas_pasn_build_auth_1(struct pasn_data *pasn,
 
 	wpa_pasn_add_extra_ies(buf, pasn->extra_ies, pasn->extra_ies_len);
 
+#ifdef CONFIG_ENC_ASSOC
+	if (pasn->auth_alg == WLAN_AUTH_EPPKE && pasn->is_ml_peer) {
+		wpa_printf(MSG_DEBUG, "EPPKE: Include Multi Link Element");
+		wpabuf_put_u8(buf, WLAN_EID_EXTENSION);
+		wpabuf_put_u8(buf, 10);
+		wpabuf_put_u8(buf, WLAN_EID_EXT_MULTI_LINK);
+		wpabuf_put_le16(buf, MULTI_LINK_CONTROL_TYPE_BASIC);
+		wpabuf_put_u8(buf, ETH_ALEN + 1);
+		wpabuf_put_data(buf, pasn->own_addr, ETH_ALEN);
+	}
+#endif /* CONFIG_ENC_ASSOC */
+
 	wpabuf_free(pasn->auth1);
 	pasn->auth1 = wpabuf_alloc_copy(wpabuf_head_u8(buf) + IEEE80211_HDRLEN,
 					wpabuf_len(buf) - IEEE80211_HDRLEN);
@@ -741,6 +753,18 @@ struct wpabuf *wpas_pasn_build_auth_3(struct pasn_data *pasn,
 
 	wpa_pasn_add_extra_ies(buf, pasn->extra_ies, pasn->extra_ies_len);
 
+#ifdef CONFIG_ENC_ASSOC
+	if (pasn->auth_alg == WLAN_AUTH_EPPKE && pasn->is_ml_peer) {
+		wpa_printf(MSG_DEBUG, "EPPKE: Include Multi Link Element");
+		wpabuf_put_u8(buf, WLAN_EID_EXTENSION);
+		wpabuf_put_u8(buf, 10);
+		wpabuf_put_u8(buf, WLAN_EID_EXT_MULTI_LINK);
+		wpabuf_put_le16(buf, MULTI_LINK_CONTROL_TYPE_BASIC);
+		wpabuf_put_u8(buf, ETH_ALEN + 1);
+		wpabuf_put_data(buf, pasn->own_addr, ETH_ALEN);
+	}
+#endif /* CONFIG_ENC_ASSOC */
+
 	/* Add the MIC */
 	mic_len = pasn_mic_len(pasn->hash_alg);
 	wpabuf_put_u8(buf, WLAN_EID_MIC);
diff --git a/wpa_supplicant/sme.c b/wpa_supplicant/sme.c
index 3510faf74..107fd2d15 100644
--- a/wpa_supplicant/sme.c
+++ b/wpa_supplicant/sme.c
@@ -715,10 +715,12 @@ static void wpas_eppke_initialize(struct wpa_supplicant *wpa_s, struct wpa_bss *
 	pasn->auth_alg = WLAN_AUTH_EPPKE;
 
 	os_memcpy(pasn->own_addr, wpa_s->own_addr, ETH_ALEN);
-	if (wpa_s->drv_flags2 & WPA_DRIVER_FLAGS2_MLO)
+	if (wpa_s->drv_flags2 & WPA_DRIVER_FLAGS2_MLO) {
+		pasn->is_ml_peer = true;
 		os_memcpy(pasn->peer_addr, wpa_s->ap_mld_addr, ETH_ALEN);
-	else
+	} else {
 		os_memcpy(pasn->peer_addr, bss->bssid, ETH_ALEN);
+	}
 	os_memcpy(pasn->bssid, bss->bssid, ETH_ALEN);
 
 	wpa_printf(MSG_DEBUG,

From patchwork Thu Jan 15 16:32:58 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184703
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=sFI/SWUf;
	dkim=temperror header.d=infradead.org header.i=@infradead.org
 header.a=rsa-sha256 header.s=casper.20170209 header.b=qyj+WWM4;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=ay1+TuDG;
	dkim=neutral header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=WEd7H1Ah;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsT9l1jFGz1xqf
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:35:23 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=+i77JDmi8ewmlDN/aYUB85gwZdC07+6d/sKB3bKQ4Ys=; b=sFI/SWUfkS1Pr0
	bvzdLif5vVnOReV91GEiW4RiLo6/gi6YpQziu+t8fsC6qT4ErkkCmMLx6KJCyfg6kJBLmyGslPkLl
	BV8I0b8+USXA1mwQIv7c9YXr9IhVIFYOP+2omguuOUZoJv12PrpSncRsBLTQXJ2fiwb6/A76YqmF+
	+Kek+PADTA9r+TcsltPFi/D1I/Ya6TU2KvsK3orBs7UtGubsgmirtTLB9gl2dkp5JqBetn0YVJAZ6
	jDRyJRAb60+XT/6rMMZ8jisiX44hspxf9UuoE10qsBamhHXhM8J878BER1e6db+trgnHwYZzk+YTe
	q2ZUMzGKOFbgDHCCfUXQ==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQJ1-0000000CioT-2EaC;
	Thu, 15 Jan 2026 16:34:43 +0000
Received: from casper.infradead.org ([2001:8b0:10b:1236::1])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIg-0000000CiLG-22ao
	for hostap@bombadil.infradead.org;
	Thu, 15 Jan 2026 16:34:22 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=infradead.org; s=casper.20170209; h=Content-Transfer-Encoding:MIME-Version:
	References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender:Reply-To:
	Content-Type:Content-ID:Content-Description;
	bh=32NRQPH0EwCLPHmAnH+1+HJHfyClN92WcjhXqLIdbZY=; b=qyj+WWM44F2rG/Tf6dXQ+A+gXE
	FVMIMA+HKTfHrZlwx3HehiWA8XLhI7wfrrSqua3Qzssu+/02X1WPLSGKEiWdGh3dPohKa5XlCcd6z
	CGXnAtxVBRFAB9xxbKE6cdYiWGcojQnGkskMCBjyxgwGfH6Bpxm2TO3U9FG+wrur48t4TN+lyavCC
	obBDqfOV8bsNOTPPMI3PlBY1LQaYvgE+Ma7a/vFXpNcujNJc+fz0A9ctOwhFJRi/lNQuZt9MQg87Y
	Ra/2UA+B9z5KWTG2c8LZ5JGKUZNwDi/GvpLVLE4QDoLhAGDRGcCCNAQOPZnd/Y7SHoQnABduo7G9O
	f3GrsHCQ==;
Received: from mx0a-0031df01.pphosted.com ([205.220.168.131])
	by casper.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIY-00000007ydb-2JEY
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:34:20 +0000
Received: from pps.filterd (m0279867.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFYDaj2817423
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:11 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=32NRQPH0EwC
	LPHmAnH+1+HJHfyClN92WcjhXqLIdbZY=; b=ay1+TuDGfeTn6Z9iPHDfLTt3ixz
	YJy3EuBDIPNjmvDZGxWkaYxESrvpId44ni4BNe3iASGhr/HW9zC5i5g/SKsZ7y64
	z5n719IThziLmyqquCHFQ5/zJvJ+AAJhh/hxUM34XorsWXd9p8fH+f0Rb9JYggDG
	zYdKqu1YsxCaurS72AH5aNNHCtiA3l0UX/Qjn+1JpAvSKTM6vzzZB5nWoCbLyv4M
	C4TodacuEfQv6JsldVxJwitbB8UhU1qAsPBZjhZuVLP88rKxw255TalU7QbI9J1x
	s3BlRBgwAu0TICRhm1JAyrEfHFr1Xb3cd8qC65qYQPX6Uz5uQfprvZoQVbw==
Received: from mail-pl1-f197.google.com (mail-pl1-f197.google.com
 [209.85.214.197])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bpwpxh6ad-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:10 +0000 (GMT)
Received: by mail-pl1-f197.google.com with SMTP id
 d9443c01a7336-2a0f0c7a06eso10200395ad.2
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:34:10 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494850; x=1769099650;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=32NRQPH0EwCLPHmAnH+1+HJHfyClN92WcjhXqLIdbZY=;
        b=WEd7H1Ah6qgntmfDAfmtkJtkUzoZTbv7rKwohnWH33mL14uGAatPmhyHMVlsX2cEAC
         hdd/0y2pfxN4lK9bsOtj6GkyR0wjgyejnp6ac9gSwviTJlSAjRJ/NYzNPDeHyHbTw1Rd
         2c6ubnL+WRh35UW/3pD7FGwFYgqdNpBTWm2JLGI6uazWCYNQXScOraJ5GsGn/AwFYg+s
         HDnimuResPkk0ZvrNCI2lJKXWYY5C9FWFzy3ngvcgSKh9h77rybIXd5xLgk0EVdebcUK
         tStwAbrsoK6TSJEyuOVFzypimEI7BhHOckXCY5RX9TbfHPa0nr26km0dkq2eR8MU/D7d
         g24g==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494850; x=1769099650;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=32NRQPH0EwCLPHmAnH+1+HJHfyClN92WcjhXqLIdbZY=;
        b=xBe4h1dJ5j1XKL7XTJOnhzZhKsiOBgfvPb3mwrn1tNbdr8HCRqBshHpjeLr1UwwbLB
         GknVzwPH3ugmPjFe29lBBMulrxAmMVAugzjZd1J1nYSk9YHTyTURjsX2Sy36Wv8/04cG
         LSKyMD5z7FdsuhYBeqWVqtth8Dr5FVr0DEtSOOCNNU1vBYDhF2a/lMGJCa3G+yuK9Dbe
         eGsLFANgcovwm83BmzCVwcERPT101axoHIRqlu8W8EJhRlW0qU63ekhA5dB4E7Amg4kH
         9C/y87SgKuY7/xUAruymJxC8kw5JAZxNvBCtxrpfAxksPZW64URvGkDFBvFhmzjfaue5
         Fi1w==
X-Gm-Message-State: AOJu0YxovdGD5MGG7LJ5ZG9SkTce13KdJf2OBcgZxcHkQz2azPrvqgHD
	UhZ8LthhieOLyhGjEoJk2eDnL8EK0IO2jd/p5mcTxr+E03Vsi2MegH4ubd0f5iFvjwDVn75DLfU
	I/UxlEBbu9owiLq9R3oM7SHGoWN/7uY2xkkat2MzLM/1tPXMaqhuyjrVY0ufZUsvgpiTmNDlM
X-Gm-Gg: AY/fxX6ouX6y5jHyUj2xDv+xgJdC0NvdEEhwNrQ4zfXoaH2+RvWeZuajQmTCjTreoax
	w9Z9xwmm3IZ3YqCTIqn+eyuScAj17wooBBc+M0vIRENDBRXpG+Td22+2jlCdwE3Zu1ccnrIglWD
	7yEh11PbQRd7GJYvDsyUW1WpXEMm7AGPFjJArbu49YninesMNwyBtoLWSAUV0RfcpJfEhGDBAcR
	IUBv/BBPYLIPJ39demJd/AYD6PbTEuVznRjpEkiIzlkFTOqXEzpA8sEcUKr1Bs7r2X8b+3+k606
	24bdZCxZPKPxOD5dniij8DfZ7i+mf2EHe6mFUVYaXmI2WckzcT59F716iEXl23sM/iNRZ2dE9jt
	U1QCBuVv6eLhoHkxA+NMJTfN1BRzYAEH4q7xitinZ
X-Received: by 2002:a17:903:120b:b0:297:cf96:45bd with SMTP id
 d9443c01a7336-2a717537567mr999995ad.19.1768494850097;
        Thu, 15 Jan 2026 08:34:10 -0800 (PST)
X-Received: by 2002:a17:903:120b:b0:297:cf96:45bd with SMTP id
 d9443c01a7336-2a717537567mr999685ad.19.1768494849560;
        Thu, 15 Jan 2026 08:34:09 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.34.07
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:34:09 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 19/27] PASN: Add support for MIC computation for M3 frame
 for SME-in-Userspace
Date: Thu, 15 Jan 2026 22:02:58 +0530
Message-Id: <20260115163306.367753-20-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Authority-Analysis: v=2.4 cv=ZtPg6t7G c=1 sm=1 tr=0 ts=69691702 cx=c_pps
 a=cmESyDAEBpBGqyK7t0alAg==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=_ZxDteGZkJ4JSaPUSXwA:9 a=1OuFwYUASf3TG4hYMiVC:22
X-Proofpoint-GUID: My1QrrEdpEO9lUkMrDkf7sVg-LFsirU6
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX3stNnrnZqfLe
 9qMoLeOM3cQFX/zGnlhYFRF95jnz1AjxVQGvoAE9GHNgHJT3gEL61mIhtZjEngcc5gAeWd5P7tX
 mqrlXK5r0vuBsNYeeS7nVAS98W8Nl/4zAqZ3gidSwm+ij2lzcd/NiHAN7GXVRh39xTvnCfCeRy8
 1gk4LY6JDVLBWM8XGkJJRG44rykGDpoJe9RZUgl2soiqaqugpCeOq/rrrXWRwAdgyCcF8fboFjb
 7mBn2ZhewEQBwPQBAvsISm14XI4BKhEET4PtWSfTz5UQLNVOOugl5Vjj24cZIOLIXm2g/hEm9WK
 20g4m9bhqDckizDSQ2vZfouzuBU24DBBrQURDbRTVk7uQQQA6gbUrrT9aSd4jaW3AkPotbjMPtd
 dK0TydunSKDL1v4EMlbo2AVJ7lwdr62ZwGgnhiFwF+lqkTZN2p6sZDlqr5wNUpB1r6qLh3myQp2
 s31KZOpM+u3y5Im4Acw==
X-Proofpoint-ORIG-GUID: My1QrrEdpEO9lUkMrDkf7sVg-LFsirU6
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 spamscore=0 adultscore=0 phishscore=0 clxscore=1015 priorityscore=1501
 lowpriorityscore=0 impostorscore=0 malwarescore=0 bulkscore=0 suspectscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_163414_900522_51694C14 
X-CRM114-Status: GOOD (  15.85  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: SpamAssassin version 4.0.1 on casper.infradead.org summary:
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.168.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.168.131 listed in
 sa-trusted.bondedsender.org]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.168.131 listed in list.dnswl.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.168.131 listed in
 bl.score.senderscore.com]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

For SME-in-Userspace scenarios, MIC is computed on frame3 body,
hash of frame1 body, but frame1 and frame3 contain auth_data starting
from transaction number to comply with mac80211 requirement, hence
prepend auth algorithm to frame body for preparing MIC.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/pasn/pasn_initiator.c | 53 ++++++++++++++++++++++++++++++++++-----
 1 file changed, 47 insertions(+), 6 deletions(-)

diff --git a/src/pasn/pasn_initiator.c b/src/pasn/pasn_initiator.c
index 30f42fb65..b7ed5ee9d 100644
--- a/src/pasn/pasn_initiator.c
+++ b/src/pasn/pasn_initiator.c
@@ -582,6 +582,18 @@ static u8 wpas_pasn_get_wrapped_data_format(struct pasn_data *pasn)
 }
 
 
+static u8 * pasn_prepend_auth_alg(u16 auth_alg, const u8 *buf, size_t len)
+{
+	u8 *new_buf = os_malloc(len + 2);
+	if (!new_buf)
+		return NULL;
+
+	os_memcpy(new_buf, &auth_alg, 2);
+	os_memcpy(new_buf + 2, buf, len);
+	return new_buf;
+}
+
+
 struct wpabuf *wpas_pasn_build_auth_1(struct pasn_data *pasn,
 					      const struct wpabuf *comeback,
 					      bool verify, bool is_sme_drv)
@@ -589,6 +601,9 @@ struct wpabuf *wpas_pasn_build_auth_1(struct pasn_data *pasn,
 	struct wpabuf *buf, *pubkey = NULL, *wrapped_data_buf = NULL;
 	const u8 *pmkid;
 	u8 wrapped_data;
+	const u8 *data;
+	size_t data_len;
+	u8 *copy = NULL;
 
 	wpa_printf(MSG_DEBUG, "PASN: Building frame 1");
 
@@ -676,9 +691,23 @@ struct wpabuf *wpas_pasn_build_auth_1(struct pasn_data *pasn,
 	}
 #endif /* CONFIG_ENC_ASSOC */
 
+	if (!is_sme_drv) {
+		copy = pasn_prepend_auth_alg(pasn->auth_alg,
+					     wpabuf_head_u8(buf),
+					     wpabuf_len(buf));
+		if (!copy)
+			goto fail;
+		data = copy;
+		data_len = wpabuf_len(buf) + 2;
+		os_free(copy);
+	} else {
+		data = wpabuf_head_u8(buf) + IEEE80211_HDRLEN;
+		data_len = wpabuf_len(buf) - IEEE80211_HDRLEN;
+	}
+
 	wpabuf_free(pasn->auth1);
-	pasn->auth1 = wpabuf_alloc_copy(wpabuf_head_u8(buf) + IEEE80211_HDRLEN,
-					wpabuf_len(buf) - IEEE80211_HDRLEN);
+	pasn->auth1 = wpabuf_alloc_copy(data, data_len);
+
 	if (!pasn->auth1) {
 		wpa_printf(MSG_DEBUG, "PASN: Failed to store a copy of Auth1");
 		goto fail;
@@ -696,6 +725,7 @@ fail:
 	wpabuf_free(wrapped_data_buf);
 	wpabuf_free(pubkey);
 	wpabuf_free(buf);
+	os_free(copy);
 	return NULL;
 }
 
@@ -708,7 +738,7 @@ struct wpabuf *wpas_pasn_build_auth_3(struct pasn_data *pasn,
 	u8 mic_len;
 	size_t data_len;
 	const u8 *data;
-	u8 *ptr;
+	u8 *ptr, *copy = NULL;
 	u8 wrapped_data;
 	int ret;
 	u8 hash[SHA512_MAC_LEN];
@@ -770,11 +800,21 @@ struct wpabuf *wpas_pasn_build_auth_3(struct pasn_data *pasn,
 	wpabuf_put_u8(buf, WLAN_EID_MIC);
 	wpabuf_put_u8(buf, mic_len);
 	ptr = wpabuf_put(buf, mic_len);
-
 	os_memset(ptr, 0, mic_len);
 
-	data = wpabuf_head_u8(buf) + IEEE80211_HDRLEN;
-	data_len = wpabuf_len(buf) - IEEE80211_HDRLEN;
+	if (!is_sme_drv) {
+		copy = pasn_prepend_auth_alg(pasn->auth_alg,
+					     wpabuf_head_u8(buf), wpabuf_len(buf));
+		if (!copy)
+			goto fail;
+		data = copy;
+		data_len = wpabuf_len(buf) + 2;
+		os_free(copy);
+	} else {
+		data = wpabuf_head_u8(buf) + IEEE80211_HDRLEN;
+		data_len = wpabuf_len(buf) - IEEE80211_HDRLEN;
+	}
+
 
 	if (!pasn->auth1 ||
 	    pasn_auth_frame_hash(pasn->hash_alg, wpabuf_head(pasn->auth1),
@@ -808,6 +848,7 @@ fail:
 	pasn->status = WLAN_STATUS_UNSPECIFIED_FAILURE;
 	wpabuf_free(wrapped_data_buf);
 	wpabuf_free(buf);
+	os_free(copy);
 	return NULL;
 }
 

From patchwork Thu Jan 15 16:32:59 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184731
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=QNeSSpyS;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=MbcfmdXc;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=RjKkfwsO;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsTgm10wLz1xtD
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:57:56 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=jJ6ss8BG/0HktWb0GWdfts+LSlU/RB01DfJqcd+3mUg=; b=QNeSSpySDKZYx6
	aEWe7sUq9CghT3yGlP9GgHv6asO6K69R7fF7a/g3CkdRhKTE8skRlI/x+twQl+NE7DmxQrVN/CHa4
	yJTkVPOXQ4jSclMopmOcemsak1z5UGjAwLATrfYCl8YqPUm2wHSwKpFMEXk159sng8rjuvcARoQy0
	Gwomap3xgWAxAeiI+t0uic2F7gz2GgMvAyGNI8PRux5GnS1427Arkktb2qNhKjd6W7NRFdtxHZXrn
	WCOXU/SDnSTwoZIBt4snQNdxEepmsl9LrJx03Qa6CHD9HKiWh/2AeEfx9o79ahTNGmk0wmS5tCsn/
	cy33L9bM4umkRHZHMIgQ==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQf6-0000000CoPo-1z8o;
	Thu, 15 Jan 2026 16:57:32 +0000
Received: from mx0a-0031df01.pphosted.com ([205.220.168.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQf2-0000000CoPL-1OLw
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:57:30 +0000
Received: from pps.filterd (m0279866.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFfxj72311885
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:13 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=nHFVfOAh+jt
	2QyCdb9V1YPTXR37k1SvZXemxx/cs71Y=; b=MbcfmdXcOZL07vgnvinGiZZPcMb
	aYU4I/gdm3vKFblTcWxuAkg4p3EkZVSPmjJQPDlNci6fCYeK81t1vZI29452d/wF
	Cem3WkpYPr1/iA9oYstv8w/6xWyYbSWecDXK51zfApTzt12YVYAb1yxMeR9shQn3
	Ap74g0qAiZ9t61mMmWl9yMK1NthRAnX3EFBcWTwoJ27iiyH/Ot1HMyaaaSoCStGd
	7cGgBpYhPg2wkIzxV0FC7YqXybBoNdeWjYfvFhGG1lTMFiYQqoqh9hANeWwY/18z
	RCnkl7m836K8JbYe0K4P8iUTlrI+TcqO2aVMzMV/9cZUPqhSsqnBArvMI+w==
Received: from mail-pl1-f197.google.com (mail-pl1-f197.google.com
 [209.85.214.197])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bq340g6vh-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:12 +0000 (GMT)
Received: by mail-pl1-f197.google.com with SMTP id
 d9443c01a7336-2a0f0c7a06eso10200855ad.2
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:34:12 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494852; x=1769099652;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=nHFVfOAh+jt2QyCdb9V1YPTXR37k1SvZXemxx/cs71Y=;
        b=RjKkfwsO0qZUetXGV7cpU/ma56Wp37vTo0Xg+mJyXCm6+8PrUz79vhWyANaGyUf3z/
         UGAuTmiFpoAknkSa+pOhyTbK8Bf84+qemsDJG8E+Wuc1CkuKR858Yd75ip0vVDFjuc9m
         1qJLn3C/zJu27AP0sOJ5nFIbzbVfI5jsBFh1bPDjUR98M9HyV/006U5DScZ0Ij8HVWR4
         gp9XWRnxHRxgzV/l16j/BLkDXglvRdmUNkvrbtRPZunxLMlHZ1rlACSA3DlBTz3FedLM
         5JnngV3jM84JWZlrWAXfv4/ar3TNDXAmuqs+TnnXhK0Shb7YjVEXXcui885lZrJDdn9k
         fmKw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494852; x=1769099652;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=nHFVfOAh+jt2QyCdb9V1YPTXR37k1SvZXemxx/cs71Y=;
        b=E1y+JBkkkHc4qhJ/Bl1nd9PP1Mmmgyz6kTVvQswo3QaAqIX+EFki3zW+pEQiLXcfUX
         fflS63GCPi2bShKfqaKmO/vNUGrPYnWkd0ZMGV0rJ3UezD6PUIPbwKWXBeriXC2JvNz1
         1+ouE3b4+ekhwWriSMEEAO1ACbqTsExiBU48d2N4Jg6WMaZriQHtc/fJk7JfgRhuWynQ
         4pMh1wIsz77OkgD22PRZEG2FcVG0MsxsB8/MhoEr4+KYMoz+5NGUddGQ0LGG+PnANyDy
         C4utXI1nsfzBHJk4zEctD7II0oCr+nCr8PP6l18aIyKMW2Vq5/1u8NnDFReZi/H8jvyC
         7aWQ==
X-Gm-Message-State: AOJu0YxexzCkFkCdaq9tU55TJhWwdstdkx/CyQ5W0zakqanzYHPGFFhP
	Ft6L6zg86UNVl15+3a9uKOVjNGQN7Jf4VbSFF3caM1ibCd9vaEftytlYEnUb2s4oPvlsEJ4Q0Cn
	lx88DFwl74j+TQXTlQzpvPbqktSn8yNVrLvqNP3TllKfhYwbUG6p1JADeeQDybQzRNi9p6TAY
X-Gm-Gg: AY/fxX7PLuSB64CvNQVWV6VtnnhP6upvu36ImdUe8sAkM+rXBm/9DTus8SaPCMk1VP+
	cl5PKXsL+dbfta0VBVyI7uxtw0sMbK1lCoRL8evKOl04kW9F6CiONolMstIEjZX0JiVm23a59Sd
	8yIJFimAfBynKjOYOvBep6N9UhGY8Z/3zqtzdZ4qp0IbRHM28Ita7QvhXzXrXJ6rWuhps3hn9PM
	q80vLgr2GcIHs7UiOAUnBSwMQ06qcRCdzPK7bqcgzToMBg9S8yXV379kWG0hf3In8pNUN6WyKq/
	ze9Bqiq6TJqZxPjUdKKLP6c1/bvLZOw+RJYNA83LidtljLSXGgfL6t5vnez3kneT5oAXxg4urG5
	hJZ3jKoCOBnGntqLKS+WxilgrywPQmkzzrtRu/46U
X-Received: by 2002:a17:902:c40c:b0:2a1:35df:2513 with SMTP id
 d9443c01a7336-2a717533c8dmr931495ad.17.1768494852158;
        Thu, 15 Jan 2026 08:34:12 -0800 (PST)
X-Received: by 2002:a17:902:c40c:b0:2a1:35df:2513 with SMTP id
 d9443c01a7336-2a717533c8dmr931315ad.17.1768494851671;
        Thu, 15 Jan 2026 08:34:11 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.34.09
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:34:11 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 20/27] sme: Add support to install temporal key for EPPKE
 Authentication Protocol
Date: Thu, 15 Jan 2026 22:02:59 +0530
Message-Id: <20260115163306.367753-21-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-GUID: AqmbKiZuI65-ZhTuD_uEUVxzJKST6a-t
X-Authority-Analysis: v=2.4 cv=bp9BxUai c=1 sm=1 tr=0 ts=69691705 cx=c_pps
 a=cmESyDAEBpBGqyK7t0alAg==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=WGb3iPcmAAAA:8 a=h52FGU5zhrQ_ahV0zzcA:9
 a=1OuFwYUASf3TG4hYMiVC:22 a=9JPlHzl_CvN4BZy81pxD:22
X-Proofpoint-ORIG-GUID: AqmbKiZuI65-ZhTuD_uEUVxzJKST6a-t
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfXzwFCuQgkMTxY
 /J2Lz77rLmor/IozjfYjttjJq6AGMiB4/1oqA6Y0m+sg41KjLeiQHX9aq2BwRri/SKIXwx+/S7Y
 BDrGntMuBJp+5kew3s6l0uRf+jkLkZaSW4om35UsASxucJwXdDoV4K8iugY2Mt4tbXkxmna5kxo
 lDaZMyeA8hj4gPsW3jcx3ruHQpUSURbntCl2DzQd1ZkrKwdr/S9geLwFm2NujddYnzFUcjGUQG1
 g8iqj72AMjonT2+QJmXVOypP0nSOXPqzBXP/jBsK/p0O+ETNEwtMDocWUz7Ocbrfxq8yzMfGC/1
 yq7MhXxpvjp5V3tR8Hi/hOSXphJA27RVQtID02z/ufz9zLv+lvaWU50sL+c1god+xU23hcogm6K
 t5KcbQUzk3L/dzyWP+fKvcv2BDNiCiTIE6XXNn0ac6WcKhChsPFb2h0j0O6ot1BlWfjDbTBkc6F
 Mp26hJdj1glUIdq8gxQ==
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 suspectscore=0 spamscore=0 bulkscore=0 impostorscore=0 malwarescore=0
 lowpriorityscore=0 phishscore=0 clxscore=1015 priorityscore=1501 adultscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_085728_379477_340BD84D 
X-CRM114-Status: GOOD (  14.18  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Kavita Kavita <kavita.kavita@oss.qualcomm.com> Add
 support
    to install the temporal key for Enhanced Privacy Protection Key Exchange
   (EPPKE) as specified in section 12.16.9 of IEEE P802.11bi/D2.0 after
 authentication
    completes.
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.168.131 listed in
 sa-trusted.bondedsender.org]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.168.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.168.131 listed in
 sa-accredit.habeas.com]
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.0 SPF_PASS               SPF: sender matches SPF record
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.168.131 listed in
 bl.score.senderscore.com]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Kavita Kavita <kavita.kavita@oss.qualcomm.com>

Add support to install the temporal key for Enhanced Privacy Protection
Key Exchange (EPPKE) as specified in section 12.16.9 of
IEEE P802.11bi/D2.0 after authentication completes.

This commit add support to configure temporal key TK with the driver
immediately after authentication completes.

Signed-off-by: Kavita Kavita <kavita.kavita@oss.qualcomm.com>
Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 wpa_supplicant/sme.c | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/wpa_supplicant/sme.c b/wpa_supplicant/sme.c
index 107fd2d15..eaed91c1c 100644
--- a/wpa_supplicant/sme.c
+++ b/wpa_supplicant/sme.c
@@ -2242,6 +2242,9 @@ void sme_event_auth(struct wpa_supplicant *wpa_s, union wpa_event_data *data)
 		struct pasn_data *pasn = &wpa_s->pasn;
 		struct wpa_pasn_params_data pasn_params;
 		int res;
+		enum wpa_alg alg;
+		u8 zero[WPA_TK_MAX_LEN] = {0};
+		struct ptksa_cache_entry *entry;
 
 		res = wpas_parse_pasn_frame(pasn, data->auth.auth_type,
 					    data->auth.auth_transaction,
@@ -2266,6 +2269,14 @@ void sme_event_auth(struct wpa_supplicant *wpa_s, union wpa_event_data *data)
 
 		sme_send_authentication(wpa_s, wpa_s->current_bss,
 					wpa_s->current_ssid, 0);
+
+		alg = wpa_cipher_to_alg(pasn_get_cipher(pasn));
+		entry = ptksa_cache_get(wpa_s->ptksa, pasn->peer_addr,
+					pasn_get_cipher(pasn));
+
+		wpa_drv_set_key(wpa_s, -1, alg, pasn->peer_addr, 0, 1,
+				zero, 6, entry->ptk.tk, entry->ptk.tk_len,
+				KEY_FLAG_PAIRWISE_RX_TX);
 	}
 #endif /* CONFIG_ENC_ASSOC */
 #ifdef CONFIG_SAE

From patchwork Thu Jan 15 16:33:00 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184706
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=P++FTRXm;
	dkim=fail reason="signature verification failed" (2048-bit key;
 secure) header.d=infradead.org header.i=@infradead.org header.a=rsa-sha256
 header.s=casper.20170209 header.b=OHqjgz6S;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=oHj+O8Ze;
	dkim=neutral header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=RduKj7uC;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsTB76XyQz1xqf
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:35:43 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=nhy0c4Ag6VwqBhNNbyzcNPWPdS3XziyEf5KAYGhatiI=; b=P++FTRXmCfsWz+
	gKD3WfNHIbEa13KKtjSMJEip5LaWle5M5xNE5TRBwKvY0U3TTEfyn0m9KVIFlI6nHWxbBvrgysnep
	N9m2vOnVBhKwizU8yNOsxaFvm5CwvGQFHFwNsBGDqwSj0ZtdjmoPV9j8WixLlOy0FTKIcacVoyClP
	8Kk/cC6Cm/JFYhExsCcXefhj4ObMln/e06W+e4WcZAKQfKAbQjKp1Ote/JM6DzvkvQ7ekj2zEWhds
	bMEjBFb61/tEqfQ4lS/aKA11IiZeDE29vC75DM+R/mGPxwbNtlSARoAxM/sPPhySnaMh3UnCUx3m1
	fUeFdlMu3NTfSsv19d7g==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQJS-0000000CjQ8-3YKF;
	Thu, 15 Jan 2026 16:35:10 +0000
Received: from casper.infradead.org ([2001:8b0:10b:1236::1])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIj-0000000CiPw-1tjT
	for hostap@bombadil.infradead.org;
	Thu, 15 Jan 2026 16:34:25 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=infradead.org; s=casper.20170209; h=Content-Transfer-Encoding:MIME-Version:
	References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender:Reply-To:
	Content-Type:Content-ID:Content-Description;
	bh=8xMA0XsS8LOdk7R1DkV+TUvuzswhtCZ5C1hpY0yVOd4=; b=OHqjgz6SzeRqHyen8r+Zcnevym
	me7vnVm1G1UxmQQf7/31A20LVvzLEawV8tNWwq+v7CtEeRPtWUX9K3Pek0OovAY8PoHmC7vJ+mYXe
	gqj20rosw4V9Vy4hmR9IpK3xcDzY+UfCvJ4kUfZe04VjsHHOKnmsTViz73jlBYRU2q/PHtEWaRKuG
	gHaMJsCaiLwt/PrdlMzhrqUYpYpRHplKmxUMjVfYcoDWvL7ekVA9pdzEH1Bv2RgcJEyib8BVkWhXo
	N+MaA2FxDJqW19ck39ooI63hJ8R83ZZsWyYaVjR4v+1ELXHwuFWf97QZCalyNA1TGP3Z28mVZZLbJ
	e2grDMyw==;
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by casper.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQId-00000007yfu-0nXA
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:34:23 +0000
Received: from pps.filterd (m0279873.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFYIH41722756
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:15 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=8xMA0XsS8LO
	dk7R1DkV+TUvuzswhtCZ5C1hpY0yVOd4=; b=oHj+O8ZedqYPdvNy3R8s4B5sYjO
	YYHEQLmmwnmL/87A1puiZ+EzhF7SYtbPlz2GeKqx6a1WBiAaNOS8LKZm4azGRsft
	U7PuJibvknQ8utLWpQ9CuE4uMGAC9rqHZ+3kgQ9yHKmpnPvpH3MyrhoonU2Pg7Sv
	Tf27qkeBqneDr2UInV4YCgxqiiwFy2V4tiNxDVH1kE7LNQKlDKR0lcWozCc3Snt3
	CvrzlrYJP1JcQGF0XOm7S/srVaAQOM6fZYTtbuBHdUhAku32kqLUCLYTjozbzI5A
	5A3kZfKTbZUDR08vZOrLiGPVUa4LvKkhqOugT1J1YMQxf7pLYk+3PxzEScw==
Received: from mail-pj1-f70.google.com (mail-pj1-f70.google.com
 [209.85.216.70])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bptna1pap-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:15 +0000 (GMT)
Received: by mail-pj1-f70.google.com with SMTP id
 98e67ed59e1d1-34ac814f308so1435441a91.3
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:34:15 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494854; x=1769099654;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=8xMA0XsS8LOdk7R1DkV+TUvuzswhtCZ5C1hpY0yVOd4=;
        b=RduKj7uCi4Ex9vHpIuE15rzGGlZ1+KbY8iGk9Y5wIl21IEmIXGi9VqVSo1WizrW4+d
         UsgyxwIcdr2rGrGQ+d23XWtJ5Jf0ztaaq9jUS9YKgWSfA7U2EirU0sdoTRxnSpLV+MgR
         OZR/VaCcd+0E4ulbjYdoj6KkMlGHED5f3+ZZwl7UTg2qNUy9mZgAR7CJJY2FQ8XEmh6u
         4MWYdp4UpvKKWYr2XFkGsTbnsTa1HZRX86iGlclbZxTF30CqlOEK6Gp+zeQxk8SXunmm
         oQGdZ9UbwawtKscb32V4Qvqa68nZCNVviPkwkKIodjXnLrtPPnja0I9nwqMpJ9Qwyol8
         kA4A==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494854; x=1769099654;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=8xMA0XsS8LOdk7R1DkV+TUvuzswhtCZ5C1hpY0yVOd4=;
        b=BEmh+RAlVR1yEDubWVTcSajDJQYXylZkRHbrS5lOoX9ov0EnlxW/Sz9Iwk2xk2F/M+
         RE42f5k6ZnFuwy4p1hVAhPrxIEoardZBOmec/rLHBHoRLTmstHVA3ANo7kO40m2kBhQP
         Y9QgEIb1BbEo5IpvsZLnLPxz5YUr/+AydQGrS1xN8T8if08PZwJCl1eEFMdZGS2xL9qF
         Cbj6pXzk+ryT4lm7PZW5X5ZbN96zV4KiarNX+KTLWcSkBOaOIb/41P2+TXjG228Q5U6V
         nYbe6BPnInVWNRbNFd91TMYbOochK4oxYVQYdw1IEvb9uy7jyd54U1FREu/LacNut6wV
         40nw==
X-Gm-Message-State: AOJu0YxpLNQMJ4xLAV6+dXCa/N6lwy2EvE6JObJr7aPR3wWKIE40pNQv
	RRvG0kSyyS4j2ZwynjdHzf0VSQgV3pkDpU2dtl+OEzCEZSgNMHg2Y3+87KHN2wCKxifKuWsyv0H
	+Cx6R/zsCc8FrXPl0exsBr8BAsmb3nlzLdNQkBIsUOVeRhiUqKCRyak30znXk+oo/euog797X
X-Gm-Gg: AY/fxX4dbqXM4DoHzL+cQ1MbYp00nMv8LxaoKFodcB3EhzqCEk7xv9TPBMFz8gWZfn7
	EEw0sTfOpVXrscz8U7kjdXW/mYeeLJzsIcg6nwUqpiB4KsrIzl2snYrCQMWJ2AArsxWWO/ksy/O
	l3LYWnFi//yBUSzInEGpsxZGhiqyccS/KzZ63m2LF5ThCQ7FX/mFA56wifIOgT+3ZP2Z+L6Qz83
	E0E4U3qQZpxXMC50dh1OYConaQyWkOCdkhB14V8+SymZ3HQ9qw2oTn2wP2jI+M9O/uqdymnpEwj
	Yiqyao/Kh2rRhzBSenYqEmgxpDn2ClgSfwVCjJwgtW65geGVl/pEIa0yUNgYNrbEgJHtOxmBswI
	GC2qsDxj60a3Rpf7lhXGWUKih8lic3N7lxe9Rm+WX
X-Received: by 2002:a17:902:e846:b0:26d:d860:3dae with SMTP id
 d9443c01a7336-2a717529fe1mr1205325ad.3.1768494854224;
        Thu, 15 Jan 2026 08:34:14 -0800 (PST)
X-Received: by 2002:a17:902:e846:b0:26d:d860:3dae with SMTP id
 d9443c01a7336-2a717529fe1mr1205075ad.3.1768494853800;
        Thu, 15 Jan 2026 08:34:13 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.34.12
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:34:13 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 21/27] Add support for temporal key removal on association
 failure
Date: Thu, 15 Jan 2026 22:03:00 +0530
Message-Id: <20260115163306.367753-22-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-GUID: cuBEYf7d_Qb7LZOzJav_ctl8Us0x73pJ
X-Proofpoint-ORIG-GUID: cuBEYf7d_Qb7LZOzJav_ctl8Us0x73pJ
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX5vLvXVJDTBMr
 bnd+88/OMOUOywzzc717qSkYDUqOmwrfvd+yT2WDD2NZRQ7jwgUpi/RM8pWdhpJHS7I8krFxjRT
 gTZbp2Jaqg60T4eE9XHVfdbpGShXAl4TwUcyEHTQwfedbdFD3nFOwLlx6NnpzTOoW6ziCc4/lO2
 2mtjd2Brcbt1O1jBdr319LiVMywpCuzzAg7sy4HR+72Vc4/U7MKpvvViv8X97BpOHnbGW9X8CVI
 PbBItJHSFWt2aGRK/Oem06m97cOkbSI1ogIwnfKQCmKbIlalZ4U5v0yIARySEy72vFVeAw5wZ2S
 5TkWJg0jlaRrQfu3pH8pirBY8QndhTXrjUPKBmuz/7noVjsTdcHgSyhapllD3pcUQ5Fxj2rqCSp
 VT4Ng/8ZVMmrymS2uVzWxEjKGWVqaDAF3gqlJ3ZZHtTM/XzsM2yxL5Fsp1ooUSohL8VZ9ZVVEth
 +whb99Wec3RsUTVe48g==
X-Authority-Analysis: v=2.4 cv=fsHRpV4f c=1 sm=1 tr=0 ts=69691707 cx=c_pps
 a=0uOsjrqzRL749jD1oC5vDA==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=93F2k_ZiEV6NZnqzGGkA:9 a=mQ_c8vxmzFEMiUWkPHU9:22
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 malwarescore=0 priorityscore=1501 bulkscore=0 adultscore=0 spamscore=0
 clxscore=1015 impostorscore=0 phishscore=0 lowpriorityscore=0 suspectscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_163419_459182_6A618BB4 
X-CRM114-Status: GOOD (  14.54  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: SpamAssassin version 4.0.1 on casper.infradead.org summary:
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Kavita Kavita <kavita.kavita@oss.qualcomm.com>

This change adds logic to remove the configured temporal key (TK) for
Enhanced Privacy Protection Key Exchange (EPPKE) in the event of an
association request and/or response failure.

The removal is triggered immediately upon detection of association
request/response failure.

Signed-off-by: Kavita Kavita <kavita.kavita@oss.qualcomm.com>
---
 wpa_supplicant/events.c | 10 ++++++++++
 wpa_supplicant/sme.c    | 20 ++++++++++++++++++++
 2 files changed, 30 insertions(+)

diff --git a/wpa_supplicant/events.c b/wpa_supplicant/events.c
index d831557b3..3083271f8 100644
--- a/wpa_supplicant/events.c
+++ b/wpa_supplicant/events.c
@@ -390,6 +390,16 @@ void wpa_supplicant_mark_disassoc(struct wpa_supplicant *wpa_s)
 	}
 
 	wpa_supplicant_set_state(wpa_s, WPA_DISCONNECTED);
+
+#ifdef CONFIG_ENC_ASSOC
+	/* Clear configured keys and PTKSA */
+
+	if (wpa_s->ptksa &&
+	    ptksa_cache_get(wpa_s->ptksa, wpa_s->bssid, WPA_CIPHER_NONE)) {
+		wpa_clear_keys(wpa_s, wpa_s->bssid);
+		ptksa_cache_flush(wpa_s->ptksa, wpa_s->bssid, WPA_CIPHER_NONE);
+	}
+#endif
 	bssid_changed = !is_zero_ether_addr(wpa_s->bssid);
 	os_memset(wpa_s->bssid, 0, ETH_ALEN);
 	os_memset(wpa_s->pending_bssid, 0, ETH_ALEN);
diff --git a/wpa_supplicant/sme.c b/wpa_supplicant/sme.c
index eaed91c1c..092ad6ff5 100644
--- a/wpa_supplicant/sme.c
+++ b/wpa_supplicant/sme.c
@@ -2997,6 +2997,17 @@ mscs_fail:
 			wpas_connection_failed(wpa_s, wpa_s->pending_bssid,
 					       NULL);
 			wpa_supplicant_set_state(wpa_s, WPA_DISCONNECTED);
+#ifdef CONFIG_ENC_ASSOC
+			/* Clear configured keys and PTKSA */
+
+			if (wpa_s->ptksa && ptksa_cache_get(wpa_s->ptksa,
+							    wpa_s->bssid,
+							    WPA_CIPHER_NONE)) {
+				wpa_clear_keys(wpa_s, wpa_s->bssid);
+				ptksa_cache_flush(wpa_s->ptksa, wpa_s->bssid,
+						  WPA_CIPHER_NONE);
+			}
+#endif
 			os_memset(wpa_s->pending_bssid, 0, ETH_ALEN);
 		}
 		return;
@@ -3059,6 +3070,15 @@ static void sme_deauth(struct wpa_supplicant *wpa_s, const u8 **link_bssids)
 
 	wpas_connection_failed(wpa_s, wpa_s->pending_bssid, link_bssids);
 	wpa_supplicant_set_state(wpa_s, WPA_DISCONNECTED);
+#ifdef CONFIG_ENC_ASSOC
+	/* Clear configured keys and PTKSA */
+
+	if (wpa_s->ptksa &&
+		ptksa_cache_get(wpa_s->ptksa, wpa_s->bssid, WPA_CIPHER_NONE)) {
+		wpa_clear_keys(wpa_s, wpa_s->bssid);
+		ptksa_cache_flush(wpa_s->ptksa, wpa_s->bssid, WPA_CIPHER_NONE);
+	}
+#endif
 	os_memset(wpa_s->bssid, 0, ETH_ALEN);
 	os_memset(wpa_s->pending_bssid, 0, ETH_ALEN);
 	if (bssid_changed)

From patchwork Thu Jan 15 16:33:01 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184705
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=TwLq7PBR;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=JKLHUiy8;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=RP3Ku1fQ;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsTB21v51z1xqf
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:35:38 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=65oGJFvTDHFTW42EaCJkzybml5AG7HbrnGwkYLHTJ0Q=; b=TwLq7PBRbRZtgr
	sVB9Og7TRnMhNmDAo2bEts490abClXw1p9MDSBP/vGswjudAyEceYGGqiZJ1Uv3Kh0O6CQDeu7Yea
	enoKTPYUAtJBy6Jwz50aex81PiUq76YHJZslVIo7V7/uSzA8GgqM+Zl0UbtFdrzIkk93ZW4ZIv+dU
	bJigvIknTKgYO881X7rSjIU68f68RMLel1IJaXiL6ias8wNox+CXdZ1895LPYuegFMyHWJe+J5jnz
	WYaSEs43LJzYQqn5QKq7c1ty4ZmgHNXk9CtZbUKZR14OlKN6F6Sxtw54reiQQWocH0FKon3fV/7iF
	kiAbTJLwCTTuulOQDEJw==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQJM-0000000CjHl-3z6y;
	Thu, 15 Jan 2026 16:35:05 +0000
Received: from mx0a-0031df01.pphosted.com ([205.220.168.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIc-0000000CiGj-3uxm
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:34:22 +0000
Received: from pps.filterd (m0279863.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFYHic2701765
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:17 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=IfR6dlRrAta
	fYEE0/0xrMdxun+Mv+E6Np/S52V8a9eE=; b=JKLHUiy8//CCV3Ds+ogdLBkctoy
	xljOFkIZBfC8MVCn0KVCmMf8u7J/CjEy2mrIpz73h2cRFq23OWhjdukS2s02O78Z
	sv0sRAkYSoI6/qlDRnLQcjoUJTTIRItj5//4sSgY2gcFnQaBJngZjDZcfe3N4ezj
	g2oahsg081WzpmECmSt2t2Ymy+b6g01X3S7ncV84EBpvDJ3XQTFlqNuNBBJvyfHz
	OwkP2bezIErMXvU4VoRL6HkfKrvekDUS0b1j+Po/w4GH9j3JIcinXPTXkIXraP3e
	uFoB7kmLli/yqFSjjdXm+FB2RHtBp8ZUmdn0xHdChKWAnE1unegls1DQQDw==
Received: from mail-pl1-f200.google.com (mail-pl1-f200.google.com
 [209.85.214.200])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bpj1pu5uu-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:17 +0000 (GMT)
Received: by mail-pl1-f200.google.com with SMTP id
 d9443c01a7336-2a0bb1192cbso10943065ad.1
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:34:17 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494857; x=1769099657;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=IfR6dlRrAtafYEE0/0xrMdxun+Mv+E6Np/S52V8a9eE=;
        b=RP3Ku1fQ0culuSeKyc79Ia3gZdhhb70xcSMZfsbHRaEnMGJBxawoGe6y+PERlSecZ6
         WCWBp7wrRSopTEThQez7N6TQjE42U2wbnMZBHWKDgkZso3/FeNDfCn/O1nNzPbdUXG2p
         q+JRBdRDsYcZDiQb61m+L6Oo/s15Q/j5ipz9AINnIE3BdfterXD0YtZSHEP4pGhfJPdZ
         VgDbkPFji44MJHkSAKpRjbWmzhb4E/CODAtwy/c2Gc3zGdJDXff7s92xR/OykaLFmaFc
         1PbbyIZrCaLd/uawHvY68+ouxxIR3/6jLrU3zEm/x6TV2dvu+AuVxvU5iFXh4W/jciSD
         ahtQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494857; x=1769099657;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=IfR6dlRrAtafYEE0/0xrMdxun+Mv+E6Np/S52V8a9eE=;
        b=P1avxi8LIfukgmTxyh0uB9KoZM+xCeIb4m5A3oN0IbyG+SOyWUIY2AxvzY+oUKJvA5
         p4fvdkh8MA57NcTuVplJk/sqytTqfGXei+1bnnlVOSBc52JVKWPcrjRdqnBgSDAtZR06
         ABfwVuL4oiD2nOkXfFo8eGytNegwhr/H4oHGJg7KXx4MObgPWO3qGLAV6XFPc/OmTgND
         cIjlh5aeqIUoKDfldqs7oH5yh/tInuqB50m/LIQf/QHbzJVMA5VdhOtklc5w7lxrPNf9
         P5lbGN9tFhwNoNsfkVfYZJNwTsvFSJVZT/L1FTo1NrK6o1F6nbhyLz6wL2Nl4zQjaBb0
         LthA==
X-Gm-Message-State: AOJu0YwG5IpTLa73DELlmg56bdBXAr2dX1ytC+no1uXI8DrHocjUlrUU
	8LnLLFwr0oaZH3Px4MNhguV3Z9fq8v67CV+1yb84lxWYJgKDyuV5V6gJAiNm4aHVKvHMWv5UzbT
	7B8S9S161eYKvV0PA73nM+QhMnnw1m7vcFyVC86oJcyBRteFr50aJHvhnDqMnnW6tcVr/hYPO
X-Gm-Gg: AY/fxX7QP4axNSrM7wBv2Ke2Ocy0UdFT3MXYIs0ARHD4VtOZkH7O/KGhmWsS5m7w4Wr
	ny9oARsiEO+Qz3TBYrtO/DfvXeEPc9LuRvY+67QMqYI/Rhcdhsju9orX/v1cgb/vF8S0NNgd4/W
	ZOHLIapqprkNlelUvWaT+Dw9nr3AVbph3aNyiQfIeuFBwhrNrrVDx/Sfafi6XDXKv28dWaxpQ6B
	GQKO5Y30HeNrcYDr5xWK17MBGWM2SHFAFQKE5an2GXn2dTmEhIVIQBr/uMpv241bYsvG2bRbljj
	/1y4lKHPoeV0zyH/Dm3dfZUcFeyFzPmgoVRt0aHxmCBWx/E5klnZ01LwR+8bAjUNQx4muXSmMSX
	yEN48r3TA4rc+3jyMDYCxvt7ThL3hUvxK0n3BTiJT
X-Received: by 2002:a17:902:d503:b0:267:a5df:9b07 with SMTP id
 d9443c01a7336-2a7175189a1mr1053135ad.12.1768494856472;
        Thu, 15 Jan 2026 08:34:16 -0800 (PST)
X-Received: by 2002:a17:902:d503:b0:267:a5df:9b07 with SMTP id
 d9443c01a7336-2a7175189a1mr1052875ad.12.1768494855858;
        Thu, 15 Jan 2026 08:34:15 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.34.14
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:34:15 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 22/27] EPPKE: Update RSNE construction and validation per
 IEEE P802.11bi/D2.0
Date: Thu, 15 Jan 2026 22:03:01 +0530
Message-Id: <20260115163306.367753-23-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX1zLiE2etYjzc
 wcAkI44/IGOFpK2OxgzwHI16f7iL8mMmcFkiTgSYc9CcHIn2fcdTQeBol7V25Y7D6RxaaYRWUMi
 btHWyGcGvBx15Es/SnaLOFgQ8wIvK3J9dixT9dAP5yFkpI6x/YMgvbGH+oDFE0uZ8xHGJof2nJE
 7+tZh+blq8lF3pqQMrqtOCKm7yb5RW6oWOm2RmqlAVyDllAPrx3SeBbylKbQfKDjVjrYGyotVDk
 bjycrTlJ5C+75yKoWLOS1Avp+P62VtWIUSbZJ+0ENTvvsVm5NJGKSUrY4VnK+EcoducOjiso0D9
 q8QlLZBcKPzFgX84/AWB+PRjW+Q43xX+5QcjrOfnTTqi08M1jdJoemRHC8/pLL9xNj0MsTobo65
 ccMVaXxzsgdrp8hpckYCadA9/N3YvYq9mEmiso0ag3kX6rCeAq+DH5aCqK8i88FRi4nHdnn90c/
 IaQ9/eQ2zfoZ1m6ec5Q==
X-Authority-Analysis: v=2.4 cv=J+KnLQnS c=1 sm=1 tr=0 ts=69691709 cx=c_pps
 a=IZJwPbhc+fLeJZngyXXI0A==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=xcmWd_6MeBnLkgOKCPIA:9 a=uG9DUKGECoFWVXl0Dc02:22
X-Proofpoint-GUID: AwczQ_3YUcPr8S0wajBGxKRuUHXTpTNz
X-Proofpoint-ORIG-GUID: AwczQ_3YUcPr8S0wajBGxKRuUHXTpTNz
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 spamscore=0 adultscore=0 priorityscore=1501 bulkscore=0 phishscore=0
 clxscore=1015 suspectscore=0 malwarescore=0 lowpriorityscore=0
 impostorscore=0 classifier=typeunknown authscore=0 authtc= authcc=
 route=outbound adjust=0 reason=mlx scancount=1 engine=8.22.0-2512120000
 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_083419_410965_CF173DE6 
X-CRM114-Status: GOOD (  21.18  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  Update existing PASN APIs for RSNE generation and
 validation
    logic to align with IEEE 802.11bi/D2.0,
 section 12.16.9.3.2 to support EPPKE
    authentication. Below are the key changes: - Add
 wpa_pick_group_mgmt_cipher()
    to select group management cipher. - Extend wpa_pasn_add_rsne() and
 wpa_pasn_validate_rsne()
    to support Group Data and Group Management Ci [...]
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.168.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.168.131 listed in
 sa-trusted.bondedsender.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.168.131 listed in
 sa-accredit.habeas.com]
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.0 SPF_PASS               SPF: sender matches SPF record
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.168.131 listed in
 bl.score.senderscore.com]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

Update existing PASN APIs for RSNE generation and validation logic to
align with IEEE 802.11bi/D2.0, section 12.16.9.3.2 to support EPPKE
authentication.

Below are the key changes:
- Add wpa_pick_group_mgmt_cipher() to select group management cipher.
- Extend wpa_pasn_add_rsne() and wpa_pasn_validate_rsne() to support
  Group Data and Group Management Cipher Suites inclusion for EPPKE.
- Pass group cipher parameters in PASN initiator/responder mode.
- Skip MFPR bit setting in RSN Capabilities for EPPKE.
- Ensure RSNE reflects correct capabilities and cipher suites based
  on auth type

Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/ap/ieee802_11.c       |  2 +-
 src/common/wpa_common.c   | 70 +++++++++++++++++++++++++++++----------
 src/common/wpa_common.h   |  7 ++--
 src/pasn/pasn_common.h    |  2 ++
 src/pasn/pasn_initiator.c | 14 +++++---
 src/pasn/pasn_responder.c | 22 ++++++++----
 wpa_supplicant/sme.c      |  7 ++++
 7 files changed, 93 insertions(+), 31 deletions(-)

diff --git a/src/ap/ieee802_11.c b/src/ap/ieee802_11.c
index a9c37d079..420e80a34 100644
--- a/src/ap/ieee802_11.c
+++ b/src/ap/ieee802_11.c
@@ -2927,7 +2927,7 @@ static int pasn_wd_handle_fils(struct hostapd_data *hapd, struct sta_info *sta,
 		return -1;
 	}
 
-	ret = wpa_pasn_validate_rsne(&rsne_data);
+	ret = wpa_pasn_validate_rsne(&rsne_data, false);
 	if (ret) {
 		wpa_printf(MSG_DEBUG, "PASN: FILS: Failed validating RSNE");
 		return -1;
diff --git a/src/common/wpa_common.c b/src/common/wpa_common.c
index 5effba077..cdde7ec02 100644
--- a/src/common/wpa_common.c
+++ b/src/common/wpa_common.c
@@ -3327,6 +3327,20 @@ int wpa_pick_group_cipher(int ciphers)
 }
 
 
+int wpa_pick_group_mgmt_cipher(int ciphers)
+{
+	if (ciphers & WPA_CIPHER_AES_128_CMAC)
+		return WPA_CIPHER_AES_128_CMAC;
+	if (ciphers & WPA_CIPHER_BIP_GMAC_128)
+		return WPA_CIPHER_BIP_GMAC_128;
+	if (ciphers & WPA_CIPHER_BIP_GMAC_256)
+		return WPA_CIPHER_BIP_GMAC_256;
+	if (ciphers & WPA_CIPHER_BIP_CMAC_256)
+		return WPA_CIPHER_BIP_CMAC_256;
+	return -1;
+}
+
+
 int wpa_parse_cipher(const char *value)
 {
 	int val = 0, last;
@@ -4002,13 +4016,15 @@ void wpa_pasn_build_auth_header(struct wpabuf *buf, const u8 *bssid,
 
 
 /*
- * wpa_pasn_add_rsne - Add an RSNE for PASN authentication
+ * wpa_pasn_add_rsne - Add an RSNE for PASN/EPPKE authentication
  * @buf: Buffer in which the IE will be added
  * @pmkid: Optional PMKID. Can be NULL.
  * @akmp: Authentication and key management protocol
  * @cipher: The cipher suite
+ * @is_eppke: EPPKE Authentication
  */
-int wpa_pasn_add_rsne(struct wpabuf *buf, const u8 *pmkid, int akmp, int cipher)
+int wpa_pasn_add_rsne(struct wpabuf *buf, const u8 *pmkid, int akmp, int cipher,
+		      bool is_eppke, int group_cipher, int group_mgmt_cipher)
 {
 	struct rsn_ie_hdr *hdr;
 	u32 suite;
@@ -4030,8 +4046,13 @@ int wpa_pasn_add_rsne(struct wpabuf *buf, const u8 *pmkid, int akmp, int cipher)
 	WPA_PUT_LE16(hdr->version, RSN_VERSION);
 	pos = (u8 *) (hdr + 1);
 
-	/* Group addressed data is not allowed */
-	RSN_SELECTOR_PUT(pos, RSN_CIPHER_SUITE_NO_GROUP_ADDRESSED);
+	if (is_eppke) {
+		/* EPPKE: Group addressed data is allowed */
+		RSN_SELECTOR_PUT(pos, wpa_cipher_to_suite(WPA_PROTO_RSN, group_cipher));
+	} else {
+		/* PASN: Group addressed data is not allowed */
+		RSN_SELECTOR_PUT(pos, RSN_CIPHER_SUITE_NO_GROUP_ADDRESSED);
+	}
 	pos += RSN_SELECTOR_LEN;
 
 	/* Add the pairwise cipher */
@@ -4082,8 +4103,13 @@ int wpa_pasn_add_rsne(struct wpabuf *buf, const u8 *pmkid, int akmp, int cipher)
 	}
 	pos += RSN_SELECTOR_LEN;
 
-	/* RSN Capabilities: PASN mandates both MFP capable and required */
-	capab = WPA_CAPABILITY_MFPC | WPA_CAPABILITY_MFPR;
+	if (is_eppke) {
+		/* RSN Capabilities: EPPKE does not mandate setting MFPR to 1 */
+		capab = WPA_CAPABILITY_MFPC;
+	} else {
+		/* RSN Capabilities: PASN mandates both MFP capable and required */
+		capab = WPA_CAPABILITY_MFPC | WPA_CAPABILITY_MFPR;
+	}
 	WPA_PUT_LE16(pos, capab);
 	pos += 2;
 
@@ -4099,9 +4125,13 @@ int wpa_pasn_add_rsne(struct wpabuf *buf, const u8 *pmkid, int akmp, int cipher)
 		pos += 2;
 	}
 
-	/* Group addressed management is not allowed */
-	RSN_SELECTOR_PUT(pos, RSN_CIPHER_SUITE_NO_GROUP_ADDRESSED);
-
+	if (is_eppke) {
+		/* EPPKE: Group addressed management is allowed */
+		RSN_SELECTOR_PUT(pos, wpa_cipher_to_suite(WPA_PROTO_RSN, group_mgmt_cipher));
+	} else {
+		/* PASN: Group addressed management is not allowed */
+		RSN_SELECTOR_PUT(pos, RSN_CIPHER_SUITE_NO_GROUP_ADDRESSED);
+	}
 	return 0;
 }
 
@@ -4239,23 +4269,29 @@ int wpa_pasn_add_wrapped_data(struct wpabuf *buf,
 
 
 /*
- * wpa_pasn_validate_rsne - Validate PSAN specific data of RSNE
+ * wpa_pasn_validate_rsne - Validate PASN/EPPKE specific data of RSNE
  * @data: Parsed representation of an RSNE
+ * @is_eppke: EPPKE Authentication
  * Returns -1 for invalid data; otherwise 0
  */
-int wpa_pasn_validate_rsne(const struct wpa_ie_data *data)
+int wpa_pasn_validate_rsne(const struct wpa_ie_data *data, bool is_eppke)
 {
-	u16 capab = WPA_CAPABILITY_MFPC | WPA_CAPABILITY_MFPR;
+	u16 capab = WPA_CAPABILITY_MFPC;
+
+	if (!is_eppke)
+		capab |= WPA_CAPABILITY_MFPR;
 
 	if (data->proto != WPA_PROTO_RSN)
 		return -1;
 
 	if ((data->capabilities & capab) != capab) {
-		wpa_printf(MSG_DEBUG, "PASN: Invalid RSNE capabilities");
+		wpa_printf(MSG_DEBUG, "%s: Invalid RSNE capabilities",
+			   is_eppke ? "EPPKE" : "PASN");
 		return -1;
 	}
 
-	if (!data->has_group || data->group_cipher != WPA_CIPHER_GTK_NOT_USED) {
+	if (!data->has_group ||
+	    (!is_eppke && data->group_cipher != WPA_CIPHER_GTK_NOT_USED)) {
 		wpa_printf(MSG_DEBUG, "PASN: Invalid group data cipher");
 		return -1;
 	}
@@ -4286,12 +4322,12 @@ int wpa_pasn_validate_rsne(const struct wpa_ie_data *data)
 	case WPA_KEY_MGMT_PASN:
 		break;
 	default:
-		wpa_printf(MSG_ERROR, "PASN: invalid key_mgmt: 0x%0x",
-			   data->key_mgmt);
+		wpa_printf(MSG_ERROR, "%s: invalid key_mgmt: 0x%0x",
+			   is_eppke ? "EPPKE" : "PASN", data->key_mgmt);
 		return -1;
 	}
 
-	if (data->mgmt_group_cipher != WPA_CIPHER_GTK_NOT_USED) {
+	if (!is_eppke && (data->mgmt_group_cipher != WPA_CIPHER_GTK_NOT_USED)) {
 		wpa_printf(MSG_DEBUG, "PASN: Invalid group mgmt cipher");
 		return -1;
 	}
diff --git a/src/common/wpa_common.h b/src/common/wpa_common.h
index fcd7168e2..1419dced2 100644
--- a/src/common/wpa_common.h
+++ b/src/common/wpa_common.h
@@ -767,6 +767,7 @@ int rsn_cipher_put_suites(u8 *pos, int ciphers);
 int wpa_cipher_put_suites(u8 *pos, int ciphers);
 int wpa_pick_pairwise_cipher(int ciphers, int none_allowed);
 int wpa_pick_group_cipher(int ciphers);
+int wpa_pick_group_mgmt_cipher(int ciphers);
 int wpa_parse_cipher(const char *value);
 int wpa_write_ciphers(char *start, char *end, int ciphers, const char *delim);
 int wpa_select_ap_group_cipher(int wpa, int wpa_pairwise, int rsn_pairwise);
@@ -799,8 +800,8 @@ void wpa_pasn_build_auth_header(struct wpabuf *buf, const u8 *bssid,
 				const u8 *src, const u8 *dst,
 				u8 trans_seq, u16 status, bool is_eppke);
 
-int wpa_pasn_add_rsne(struct wpabuf *buf, const u8 *pmkid,
-		      int akmp, int cipher);
+int wpa_pasn_add_rsne(struct wpabuf *buf, const u8 *pmkid, int akmp, int cipher,
+		      bool is_eppke, int group_cipher, int group_mgmt_cipher);
 
 void wpa_pasn_add_parameter_ie(struct wpabuf *buf, u16 pasn_group,
 			       u8 wrapped_data_format,
@@ -810,7 +811,7 @@ void wpa_pasn_add_parameter_ie(struct wpabuf *buf, u16 pasn_group,
 int wpa_pasn_add_wrapped_data(struct wpabuf *buf,
 			      struct wpabuf *wrapped_data_buf);
 
-int wpa_pasn_validate_rsne(const struct wpa_ie_data *data);
+int wpa_pasn_validate_rsne(const struct wpa_ie_data *data, bool is_eppke);
 int wpa_pasn_parse_parameter_ie(const u8 *data, u8 len, bool from_ap,
 				struct wpa_pasn_params_data *pasn_params);
 
diff --git a/src/pasn/pasn_common.h b/src/pasn/pasn_common.h
index cf9ef93b1..09b1fb717 100644
--- a/src/pasn/pasn_common.h
+++ b/src/pasn/pasn_common.h
@@ -52,6 +52,8 @@ struct pasn_data {
 	unsigned int auth_alg;
 	u8 mld_addr[ETH_ALEN];
 	bool is_ml_peer;
+	int group_cipher;
+	int group_mgmt_cipher;
 
 #ifdef CONFIG_SAE
 	struct sae_pt *pt;
diff --git a/src/pasn/pasn_initiator.c b/src/pasn/pasn_initiator.c
index b7ed5ee9d..9253db943 100644
--- a/src/pasn/pasn_initiator.c
+++ b/src/pasn/pasn_initiator.c
@@ -297,7 +297,9 @@ static struct wpabuf * wpas_pasn_fils_build_auth(struct pasn_data *pasn)
 	wpabuf_put_le16(buf, WLAN_STATUS_SUCCESS);
 
 	/* Own RSNE */
-	wpa_pasn_add_rsne(buf, NULL, pasn->akmp, pasn->cipher);
+	wpa_pasn_add_rsne(buf, NULL, pasn->akmp, pasn->cipher,
+			  pasn->auth_alg == WLAN_AUTH_EPPKE,
+			  pasn->group_cipher, pasn->group_mgmt_cipher);
 
 	/* FILS Nonce */
 	wpabuf_put_u8(buf, WLAN_EID_EXTENSION);
@@ -423,7 +425,8 @@ static int wpas_pasn_wd_fils_rx(struct pasn_data *pasn, struct wpabuf *wd)
 		return -1;
 	}
 
-	ret = wpa_pasn_validate_rsne(&rsne_data);
+	ret = wpa_pasn_validate_rsne(&rsne_data,
+				     pasn->auth_alg == WLAN_AUTH_EPPKE);
 	if (ret) {
 		wpa_printf(MSG_DEBUG, "PASN: FILS: Failed validating RSNE");
 		return -1;
@@ -660,7 +663,9 @@ struct wpabuf *wpas_pasn_build_auth_1(struct pasn_data *pasn,
 			wrapped_data_buf = wpas_pasn_get_wrapped_data(pasn);
 	}
 
-	if (wpa_pasn_add_rsne(buf, pmkid, pasn->akmp, pasn->cipher) < 0)
+	if (wpa_pasn_add_rsne(buf, pmkid, pasn->akmp, pasn->cipher,
+			      pasn->auth_alg == WLAN_AUTH_EPPKE,
+			      pasn->group_cipher, pasn->group_mgmt_cipher) < 0)
 		goto fail;
 
 	if (!wrapped_data_buf)
@@ -1320,7 +1325,8 @@ int wpas_parse_pasn_frame(struct pasn_data *pasn, u16 auth_type,
 		goto fail;
 	}
 
-	ret = wpa_pasn_validate_rsne(&rsn_data);
+	ret = wpa_pasn_validate_rsne(&rsn_data,
+				     pasn->auth_alg == WLAN_AUTH_EPPKE);
 	if (ret) {
 		wpa_printf(MSG_DEBUG, "PASN: Failed validating RSNE");
 		goto fail;
diff --git a/src/pasn/pasn_responder.c b/src/pasn/pasn_responder.c
index f7f1bc413..aebee493f 100644
--- a/src/pasn/pasn_responder.c
+++ b/src/pasn/pasn_responder.c
@@ -304,7 +304,9 @@ static struct wpabuf * pasn_get_fils_wd(struct pasn_data *pasn)
 	wpabuf_put_le16(buf, WLAN_STATUS_SUCCESS);
 
 	/* Own RSNE */
-	wpa_pasn_add_rsne(buf, NULL, pasn->akmp, pasn->cipher);
+	wpa_pasn_add_rsne(buf, NULL, pasn->akmp, pasn->cipher,
+			  pasn->auth_alg == WLAN_AUTH_EPPKE,
+			  pasn->group_cipher, pasn->group_mgmt_cipher);
 
 	/* FILS Nonce */
 	wpabuf_put_u8(buf, WLAN_EID_EXTENSION);
@@ -544,8 +546,9 @@ int handle_auth_pasn_resp(struct pasn_data *pasn, const u8 *own_addr,
 #endif /* CONFIG_FILS */
 	}
 
-	if (wpa_pasn_add_rsne(buf, pmkid,
-			      pasn->akmp, pasn->cipher) < 0)
+	if (wpa_pasn_add_rsne(buf, pmkid, pasn->akmp, pasn->cipher,
+			      pasn->auth_alg == WLAN_AUTH_EPPKE,
+			      pasn->group_cipher, pasn->group_mgmt_cipher) < 0)
 		goto fail;
 
 	/* No need to derive PMK if PMKSA is given */
@@ -622,8 +625,10 @@ int handle_auth_pasn_resp(struct pasn_data *pasn, const u8 *own_addr,
 		if (!rsn_buf)
 			goto fail;
 
-		if (wpa_pasn_add_rsne(rsn_buf, pmkid,
-				      pasn->akmp, pasn->cipher) < 0)
+		if (wpa_pasn_add_rsne(rsn_buf, pmkid, pasn->akmp, pasn->cipher,
+				      pasn->auth_alg == WLAN_AUTH_EPPKE,
+				      pasn->group_cipher,
+				      pasn->group_mgmt_cipher) < 0)
 			goto fail;
 
 		rsn_ie = wpabuf_head_u8(rsn_buf);
@@ -748,7 +753,8 @@ int handle_auth_pasn_1(struct pasn_data *pasn,
 		goto send_resp;
 	}
 
-	ret = wpa_pasn_validate_rsne(&rsn_data);
+	ret = wpa_pasn_validate_rsne(&rsn_data,
+				     pasn->auth_alg == WLAN_AUTH_EPPKE);
 	if (ret) {
 		wpa_printf(MSG_DEBUG, "PASN: Failed validating RSNE");
 		status = WLAN_STATUS_INVALID_RSNIE;
@@ -776,6 +782,10 @@ int handle_auth_pasn_1(struct pasn_data *pasn,
 
 	pasn->akmp = rsn_data.key_mgmt;
 	pasn->cipher = rsn_data.pairwise_cipher;
+#ifdef CONFIG_ENC_ASSOC
+	pasn->group_cipher = rsn_data.group_cipher;
+	pasn->group_mgmt_cipher = rsn_data.mgmt_group_cipher;
+#endif /* CONFIG_ENC_ASSOC */
 
 	if (pasn->derive_kdk &&
 	    ieee802_11_rsnx_capab_len(elems.rsnxe, elems.rsnxe_len,
diff --git a/wpa_supplicant/sme.c b/wpa_supplicant/sme.c
index 092ad6ff5..f1db461d2 100644
--- a/wpa_supplicant/sme.c
+++ b/wpa_supplicant/sme.c
@@ -631,6 +631,7 @@ static void wpas_eppke_initialize(struct wpa_supplicant *wpa_s, struct wpa_bss *
 	u8 beacon_rsne_len, beacon_rsnxe_len;
 	u32 capab = 0;
 	int group;
+	int group_mgmt_cipher;
 
 	pasn = &wpa_s->pasn;
 
@@ -710,6 +711,12 @@ static void wpas_eppke_initialize(struct wpa_supplicant *wpa_s, struct wpa_bss *
 	}
 	pasn->akmp = wpa_s->key_mgmt;
 	pasn->cipher = wpa_pick_pairwise_cipher(ssid->pairwise_cipher, 1);
+	pasn->group_cipher = wpa_pick_group_cipher(ssid->group_cipher);
+	if (ssid->group_mgmt_cipher != 0)
+		group_mgmt_cipher = ssid->group_mgmt_cipher;
+	else
+		group_mgmt_cipher = WPA_CIPHER_AES_128_CMAC;
+	pasn->group_mgmt_cipher = wpa_pick_group_mgmt_cipher(group_mgmt_cipher);
 	pasn->group = group;
 	pasn->freq = bss->freq;
 	pasn->auth_alg = WLAN_AUTH_EPPKE;

From patchwork Thu Jan 15 16:33:02 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184707
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=eU6+cAmj;
	dkim=fail reason="signature verification failed" (2048-bit key;
 secure) header.d=infradead.org header.i=@infradead.org header.a=rsa-sha256
 header.s=casper.20170209 header.b=endnCXwz;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=NWomwmWU;
	dkim=neutral header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=QeyHLnos;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsTBS6rt0z1xqf
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:36:00 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=7yvhqV0KgzPiI1dnwDW/qGeKjflWhhnMvRJU1fl7iRE=; b=eU6+cAmjlFIBFL
	/oDA9JC3DAusHUzdSOCPBiDqRJcXesinMlUnuoW8rWXP+dLaXwj+et7ohgjULvM8DzrtJWERLJE0G
	JF01K8lDbeyVcdA1gWNLm+PVH/i/fmhPZetAHNAhhaT85uEsdhHiygNRldzgMURlwGsRLKs9py6Eh
	+YUjD7MYRyHSybqQXMhI3FN29eLaNFAhDcbhFA1wSDhWorYGF1fO+7cL7RAUrtgaqlRH6elS4UJml
	ADG4ZfddeSr+jTW4lNR7eSKQVHnSfWti3OV49co4bnrlZSUYBaNnVyGuR1Ryb8RZyzgbm90XPz/CU
	zNoyotDTdaH5v89HI4Ng==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQJb-0000000Cjbj-0rUP;
	Thu, 15 Jan 2026 16:35:19 +0000
Received: from casper.infradead.org ([2001:8b0:10b:1236::1])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIl-0000000CiS8-1Mg6
	for hostap@bombadil.infradead.org;
	Thu, 15 Jan 2026 16:34:27 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=infradead.org; s=casper.20170209; h=Content-Transfer-Encoding:MIME-Version:
	References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender:Reply-To:
	Content-Type:Content-ID:Content-Description;
	bh=t64xQeuRL8n8HNMtyFDg9q+u+EJfkqsP6KwUYhXXOFU=; b=endnCXwzbEKmn8yph2jwmXG8OX
	E9id6JsOMqxxUYQfu5zpK9jMy3CvICHCcCc1hjfXMrimqskFSIEhv9cF+XlGW7DE2JnDom505jj00
	ZAjIZByqrcFNq9BNkaZw2TP9Uk0JU9DaLt3OaO6uYHqjIeNpoEhwkwMagYVDJepCIg7Sg103IqPIQ
	urEyK262QT2oB981zTLIcvifR8LDGx28Aw2SiaO77R3ZpdCpUKPpsGPOqCqHvur0yv7Fsr2mJExBA
	2oZJyUi80OlsVSV1JqrMImIsyN9lrbcoEm5yvLfY50CeKP4VZTNrgQlZgpdVhS0SWf+JKiXmEPdHr
	7bYHXPDA==;
Received: from mx0a-0031df01.pphosted.com ([205.220.168.131])
	by casper.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIf-00000007ygt-3dg0
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:34:25 +0000
Received: from pps.filterd (m0279865.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFYXHm2981311
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:19 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=t64xQeuRL8n
	8HNMtyFDg9q+u+EJfkqsP6KwUYhXXOFU=; b=NWomwmWUHdQp8xHm+Swbnw7StLk
	eddlA0xnAxoyolVUjBx8UpM2h6Vs7xcgGRuakWZqQsQOFIqtBZLutcHLX/R12xZG
	5XE3MWdH9rgMH2ij95mOJ/x5rZqEtkKhttB/QaSSRxH5pcdMY2ibbAx8O2h4vUvM
	S5omPTkrLGM+QCmLk+plQqqMBXkr95E3ifAKiosQwoU0k4oaI7ZyGuxwbOhuuVHF
	a77iRHYaD3shLMpWQpGa8IuiXnTCy5el84R8ERINzcjAYm3/ZJSp5SnUiKU09jPP
	5yboHnFKYqptnvYAGGwi7OI3fQTCxK2Eehfi4pZ4hZbChhatCnqgiiVYUFg==
Received: from mail-pl1-f200.google.com (mail-pl1-f200.google.com
 [209.85.214.200])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bprej24hf-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:19 +0000 (GMT)
Received: by mail-pl1-f200.google.com with SMTP id
 d9443c01a7336-2a13cd9a784so8484115ad.2
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:34:19 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494859; x=1769099659;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=t64xQeuRL8n8HNMtyFDg9q+u+EJfkqsP6KwUYhXXOFU=;
        b=QeyHLnosc7Racf/ptYNm4Fk3eN5XJebB39mj1Kyz4OsysXc/QBWj44FeEf6ckD4mFw
         1/QnXLWB3IKHwqJJf66Q7aS+RqbLSaS9KDQ7R3hVSzAuhY8sUi8rSBOTckDGv7oHyn2f
         RPpQFOVY1v5lsOBAktQ+WRsb1YyWypLSXNxAbrZpCIklPSlS/UeMAc3d47XsAiUxYD6j
         Y0nI8dPzYYmxf77pB8IasXugXNmkXQWMRew7CZIPDlwuQxeaflLb82iQYoGevQ3acrm3
         MMIf4sdr2T/uNd2J7o2y0Ccq6c8/aUL+DyjCXq97Ra9akjrzMxYRoLhVn4a+Bx28GqEx
         Tg5Q==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494859; x=1769099659;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=t64xQeuRL8n8HNMtyFDg9q+u+EJfkqsP6KwUYhXXOFU=;
        b=gbBOnaL0I/kvvEssxn1vFytg1hnKwM19Ou3zEmooTj2/R/SpSsFlyq4xQpD19n+wSn
         W1cpcThg0IVS0kiHhbAgcZlRNKm+fQcKoka8D1q+y+z79Pa7EsifROR4sfoOonkrEWbi
         s+YvE546GkC3uf3hdKhvZqLWjAIsvvUsvtsYLKT3N0Xhtd729uV8DNqkH4/nXhjvS4iE
         NY7ecmlrzndr408t7bYCSaeR6/FD0KugHrcWuQ4V3P0wq/raTQYPV/EoF5fSCRMhtI7q
         EzMkR0yPyb+rsSxCZtwDsDl9B7Daq/lqlrenUZ/REQRs8JHPyMCHtuakWUxX8C72rvcW
         kjwQ==
X-Gm-Message-State: AOJu0YwqWIQ+miqnhFutBjpDZrjlEmpZvCxZh8Bvt4k8KB6TGeRPOiYN
	N6+6sGro14LbYR/yygvKJ0fAk3Q9ckAFt2jdwyVZCwBJZ3Md+hJ+yiqcEvqD2fwicASqy19uD+p
	CCtlPU/NAcSHn1vLQ8ryjwew82Ocly+fYXHodNZ2mOdftmic1VzrTqFJbWe2b3LAk2iPsrwny
X-Gm-Gg: AY/fxX5x2md8POxqswRKu0JPP0t7l9Aju3C62pTVftNYBRq+81AHUoVu8F2mw968YQS
	bpKcnMIFiGuDt4UPWQVl6F4CODThavekCcwn9vH86IEWTNgSkoBSoHEmdhPRvQ0Kc4v6Fr+F/6A
	0EurpK1XKk2GJGdnQHKQNfFQ1qXEFOYaHUeaKGw1VQpr/Ww2uRbC8DUDGbs2uVrXvm+VHWEhuAD
	4MVzz/AYk76bZR/IkWr/r50JmfpM2af2UCaJrFtkWIXVvo5uLrP1WPnCI3tyF1Y/kiCzCAh8I15
	ZCUyYTP/nuLb5zLhhdr/uJ4BuCHg/ha1P38pyoQtpkeRadyQTcn5maWJEywYWH/HDFskVPYu05h
	LmCOpJg46Hm97R2kwk4L+MqMLHMZwSqXWWw88lm6o
X-Received: by 2002:a17:902:fc48:b0:2a0:c852:5f9f with SMTP id
 d9443c01a7336-2a71752a9b2mr1116315ad.7.1768494858527;
        Thu, 15 Jan 2026 08:34:18 -0800 (PST)
X-Received: by 2002:a17:902:fc48:b0:2a0:c852:5f9f with SMTP id
 d9443c01a7336-2a71752a9b2mr1116085ad.7.1768494858034;
        Thu, 15 Jan 2026 08:34:18 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.34.16
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:34:17 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 23/27] EPPKE: Skip 4-Way handshake and authorize supplicant
 port on association
Date: Thu, 15 Jan 2026 22:03:02 +0530
Message-Id: <20260115163306.367753-24-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX1jaHibi933hj
 zz9Xv8z/WfBXk9VCgic0HKQj0pmHXv7sU6iIV5z8R0vJoWLz5HesWHVbArmwCX3lmQ0yFMyKmoU
 tZ0ijfpXTf0kKjEirY6GWuNvCQVQ5UAVBD0SjFFViD7vZZYPPlUJd8pfwqFnT5eMeOy7IgEI1wi
 sysAESe0GOON75ruJlwfju4yEagH9dzEzBXGTnor5of6CogI4QcG49aK6I99dRt9qP7HdRpPeIH
 mLA5CJFybPuYnzaeYYY+P+3EQHISpKtHWdpxDL7IXWemdQWwXKhfH5VvUQH0c8dEqn1IGGZzryh
 cw1aOPyzGJuccxoV/+bg41sSttv9SHujM09lbEDEUPhsFUxM1dvgYWUx9/5+TQiNI5T1xu9uBfa
 zAaW5OnGz5QQfrbFru9kXQAUzSZUmXCnJBcVmgtkOjmFJc5tllSiBn4CBVT1g7fBTtShwl6Pcef
 0M0hHC4fal4PLTWDDYA==
X-Proofpoint-ORIG-GUID: Mua3utDfK8ca0ljWo24IfRmbWxkceqsp
X-Authority-Analysis: v=2.4 cv=Rc+dyltv c=1 sm=1 tr=0 ts=6969170b cx=c_pps
 a=IZJwPbhc+fLeJZngyXXI0A==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=GNlDLKQ8XaKaA97bf_kA:9 a=uG9DUKGECoFWVXl0Dc02:22
X-Proofpoint-GUID: Mua3utDfK8ca0ljWo24IfRmbWxkceqsp
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 lowpriorityscore=0 adultscore=0 spamscore=0 suspectscore=0 priorityscore=1501
 clxscore=1015 bulkscore=0 malwarescore=0 phishscore=0 impostorscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_163422_205202_CFA93DB7 
X-CRM114-Status: GOOD (  17.65  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: SpamAssassin version 4.0.1 on casper.infradead.org summary:
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.168.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.168.131 listed in
 sa-trusted.bondedsender.org]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.168.131 listed in
 bl.score.senderscore.com]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.168.131 listed in list.dnswl.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

For EPPKE authentication, PTK is derived during authentication frame
exchange. Skip EAPOL 4-Way handshake and move supplicant state to
WPA_CONNECTED after association. Update state handling to authorize
the port and ensure proper control for SME-in-Userspace scenarios.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/rsn_supp/wpa.c              | 10 ++++++++++
 src/rsn_supp/wpa.h              |  6 ++++++
 src/rsn_supp/wpa_i.h            |  3 +++
 wpa_supplicant/events.c         | 12 ++++++++++++
 wpa_supplicant/wpa_supplicant.c |  5 +++++
 5 files changed, 36 insertions(+)

diff --git a/src/rsn_supp/wpa.c b/src/rsn_supp/wpa.c
index 01ca1679d..5f0b0e3d8 100644
--- a/src/rsn_supp/wpa.c
+++ b/src/rsn_supp/wpa.c
@@ -7076,6 +7076,16 @@ int wpa_fils_is_completed(struct wpa_sm *sm)
 }
 
 
+int wpa_eppke_is_completed(struct wpa_sm *sm)
+{
+#ifdef CONFIG_ENC_ASSOC
+	return sm && sm->eppke_completed;
+#else /* CONFIG_ENC_ASSOC */
+	return 0;
+#endif /* CONFIG_ENC_ASSOC */
+}
+
+
 #ifdef CONFIG_OWE
 
 struct wpabuf * owe_build_assoc_req(struct wpa_sm *sm, u16 group)
diff --git a/src/rsn_supp/wpa.h b/src/rsn_supp/wpa.h
index acd905b71..46e03ad99 100644
--- a/src/rsn_supp/wpa.h
+++ b/src/rsn_supp/wpa.h
@@ -280,6 +280,7 @@ void wpa_sm_set_ptk_kck_kek(struct wpa_sm *sm,
 			    const u8 *ptk_kck, size_t ptk_kck_len,
 			    const u8 *ptk_kek, size_t ptk_kek_len);
 int wpa_fils_is_completed(struct wpa_sm *sm);
+int wpa_eppke_is_completed(struct wpa_sm *sm);
 void wpa_sm_pmksa_cache_reconfig(struct wpa_sm *sm);
 int wpa_sm_set_mlo_params(struct wpa_sm *sm, const struct wpa_sm_mlo *mlo);
 void wpa_sm_set_driver_bss_selection(struct wpa_sm *sm,
@@ -518,6 +519,11 @@ static inline int wpa_fils_is_completed(struct wpa_sm *sm)
 	return 0;
 }
 
+static inline int wpa_eppke_is_completed(struct wpa_sm *sm)
+{
+	return 0;
+}
+
 static inline void wpa_sm_pmksa_cache_reconfig(struct wpa_sm *sm)
 {
 }
diff --git a/src/rsn_supp/wpa_i.h b/src/rsn_supp/wpa_i.h
index d0c3541b5..c36a1f3ae 100644
--- a/src/rsn_supp/wpa_i.h
+++ b/src/rsn_supp/wpa_i.h
@@ -223,6 +223,9 @@ struct wpa_sm {
 	u8 fils_ft[FILS_FT_MAX_LEN];
 	size_t fils_ft_len;
 #endif /* CONFIG_FILS */
+#ifdef CONFIG_ENC_ASSOC
+	unsigned int eppke_completed:1;
+#endif /* CONFIG_ENC_ASSOC */
 
 #ifdef CONFIG_OWE
 	struct crypto_ecdh *owe_ecdh;
diff --git a/wpa_supplicant/events.c b/wpa_supplicant/events.c
index 3083271f8..ba79f7f6d 100644
--- a/wpa_supplicant/events.c
+++ b/wpa_supplicant/events.c
@@ -4409,6 +4409,9 @@ static void wpa_supplicant_event_assoc(struct wpa_supplicant *wpa_s,
 	if (!ft_completed)
 		ft_completed = wpa_fils_is_completed(wpa_s->wpa);
 
+	if (!ft_completed)
+		ft_completed = wpa_eppke_is_completed(wpa_s->wpa);
+
 	wpa_supplicant_set_state(wpa_s, WPA_ASSOCIATED);
 	if (!ether_addr_equal(bssid, wpa_s->bssid)) {
 		if (os_reltime_initialized(&wpa_s->session_start)) {
@@ -4432,6 +4435,7 @@ static void wpa_supplicant_event_assoc(struct wpa_supplicant *wpa_s,
 		if (wpa_supplicant_dynamic_keys(wpa_s) && !ft_completed) {
 			wpa_clear_keys(wpa_s, bssid);
 		}
+
 		if (wpa_supplicant_select_config(wpa_s, data) < 0) {
 			wpa_supplicant_deauthenticate(
 				wpa_s, WLAN_REASON_DEAUTH_LEAVING);
@@ -4467,6 +4471,14 @@ static void wpa_supplicant_event_assoc(struct wpa_supplicant *wpa_s,
 #endif /* CONFIG_SME */
 
 	wpa_msg(wpa_s, MSG_INFO, "Associated with " MACSTR, MAC2STR(bssid));
+#ifdef CONFIG_SME
+#ifdef CONFIG_ENC_ASSOC
+	if (wpa_s->sme.auth_alg == WPA_AUTH_ALG_EPPKE) {
+		data->assoc_info.authorized = true;
+		wpa_supplicant_set_state(wpa_s, WPA_COMPLETED);
+	}
+#endif /* CONFIG_ENC_ASSOC */
+#endif
 	if (wpa_s->current_ssid) {
 		/* When using scanning (ap_scan=1), SIM PC/SC interface can be
 		 * initialized before association, but for other modes,
diff --git a/wpa_supplicant/wpa_supplicant.c b/wpa_supplicant/wpa_supplicant.c
index 70c92ea00..1bd43a0bf 100644
--- a/wpa_supplicant/wpa_supplicant.c
+++ b/wpa_supplicant/wpa_supplicant.c
@@ -1216,6 +1216,11 @@ void wpa_supplicant_set_state(struct wpa_supplicant *wpa_s,
 				    MAC2STR(wpa_s->ap_mld_addr));
 
 #ifdef CONFIG_SME
+#ifdef CONFIG_ENC_ASSOC
+		if ((wpa_s->drv_flags & WPA_DRIVER_FLAGS_SME) &&
+		    wpa_auth_alg_eppke(wpa_s->sme.auth_alg))
+			wpa_drv_set_supp_port(wpa_s, 1);
+#endif /* CONFIG_ENC_ASSOC */
 		if ((wpa_s->drv_flags & WPA_DRIVER_FLAGS_SME) &&
 		    wpa_auth_alg_fils(wpa_s->sme.auth_alg))
 			fils_hlp_sent = 1;

From patchwork Thu Jan 15 16:33:03 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184708
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=uZndaJxI;
	dkim=fail reason="signature verification failed" (2048-bit key;
 secure) header.d=infradead.org header.i=@infradead.org header.a=rsa-sha256
 header.s=casper.20170209 header.b=sqbu2OAh;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=NxHzKQV3;
	dkim=neutral header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=DYL3mcgu;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsTBZ50ysz1xqf
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:36:06 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=OSOUhIx5frb8PzY+DLHpDz/32tqj5BJ13tR1moN1nas=; b=uZndaJxIzkkmrW
	a+PRnpDJl945uGyeuUyIN5c/uAXjEXh3eia6cB2GMorqvhGXzW5oo0EQxB+Lcvemm90YxqV3nhrxM
	ptxrAD32ERBU7qJWB/Oy/u5jjsnn6wc3Yw+37R1rbDxPDYsMSYhujCdli2UqsnNv76laOB6VY9QJc
	cn1ukDSB5gWReQu/uGLx5uJ9BeUWNIdqRC1QjpoUaxtKSc/RZiXniTaBmnkZXKPNIyoskSt/h/sOC
	7RC/kEyYOM0cfDTaf1oLU378AXvE7OJpUEuk8eE0qLrV/WYucgXJfIu+bQKMBiLgOIzgtgwoEXyHF
	npRqLoJdLEN2PHlckiSg==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQJi-0000000CjjH-1OxB;
	Thu, 15 Jan 2026 16:35:26 +0000
Received: from casper.infradead.org ([2001:8b0:10b:1236::1])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIr-0000000Cic0-41iE
	for hostap@bombadil.infradead.org;
	Thu, 15 Jan 2026 16:34:34 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=infradead.org; s=casper.20170209; h=Content-Transfer-Encoding:MIME-Version:
	References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender:Reply-To:
	Content-Type:Content-ID:Content-Description;
	bh=NzxLcOHice/Mknb2T8bpzvM/xwcbdaVPh3sshaMGW0M=; b=sqbu2OAhvmnp60Z6CyM46HJmaK
	t97KQs7y7P7wJg0Qq97jpkMPboD/CCzQ+L6MjoSiTKolQKfYK68i3FSaNEV9uwyrXV/GL//O/2zzO
	06sKIhN8Wz/FwvC030coO+vtrrCAXzJnOVpXNnwgEVUfGzB25nztD5WVQAIyQFNx29NEmFNxJigZm
	6AlccsXL86WByqlsdkWAeXfLDFAMxex/ohT9tjQ/uEcrD9s4mgLC5t9nhChMvkpA45/vEQFi0DCp4
	PYL6QEDEbQlSehK9gcCTXjufwNfLHZUcZaVepYdvzxSaxw6rpCRE8qO9EmAMzCTfpz0TfbRAjiW2j
	6yp212iA==;
Received: from mx0a-0031df01.pphosted.com ([205.220.168.131])
	by casper.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIk-00000007yir-2Ts6
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:34:32 +0000
Received: from pps.filterd (m0279863.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFYYjw2702147
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:22 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=NzxLcOHice/
	Mknb2T8bpzvM/xwcbdaVPh3sshaMGW0M=; b=NxHzKQV3WIlMhns3lJz9z5qQ1xW
	Tv2Lpb8wcAfxhsBE7dL5THbOGqOmWhOMAgIzP8y/79tUEb03qD7Nsdgd2EFyQdxU
	zhzh3inLh9ixkqeKhgjFhXILTUaqIbqkNuON/tC/CxVjIzoaUrvNrcGo+822clVv
	bkZmcR7ipExZMTmSiMFYvFOMhOhhp9EZvRftOn3y8yN4mwwnLwEDOnqGSEObIXm0
	CCWkpkGwDWge7SZe/wwvXP1pjDUBaqyqTQmsKcAUkTHc8DlyEGvlssP4FGC/amR9
	qF8e3nR4+yX2V7aPrgdv1EDTnkk6LeNeYJsWlz3kg4maLE1t9oF28vWKznw==
Received: from mail-pl1-f199.google.com (mail-pl1-f199.google.com
 [209.85.214.199])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bpj1pu5v0-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:21 +0000 (GMT)
Received: by mail-pl1-f199.google.com with SMTP id
 d9443c01a7336-29f8e6a5de4so11090575ad.2
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:34:21 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494861; x=1769099661;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=NzxLcOHice/Mknb2T8bpzvM/xwcbdaVPh3sshaMGW0M=;
        b=DYL3mcguklqbJkWXcQ2kblh6XWamAGpIQosill4kf454f5zICDEPqYkVO64PO2MS+z
         B9FdyVbG9kzLQqLRx7V0D9Xpc45tMv9WLkufGC0qC0M0rROOUlKPiziG3CK+K/4KTgll
         OQ0hlWei1Zj0zrr+0zyojtUGab97cgCeQZjRbhLMcVED8UxECHvgHr+rYuYoJ62LCk1g
         dYhvZHlch/pJXdfzHmBEOidKQ4OEWauUIkinTXtBXis3VkOL3D61wU7+mogolqOYfSB/
         jt+zfgYNcKH2Nd9Hbh8PZPG4IQSb9kx6224q1TgDHsO+DpmUKn91zpYOrOLt2Ygu2S1f
         zpFw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494861; x=1769099661;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=NzxLcOHice/Mknb2T8bpzvM/xwcbdaVPh3sshaMGW0M=;
        b=d1c5J4zKvmRvCtYgwgHx590CrZkvcAt9Oo0G4YDIlpC+DeoLC/DA9eFXVkt4giTe99
         h9Uyav5Rr4TNLME31B6guoQAVxsTk/AG0elc3Cgcd7UFwEZvmS0w6NTZ8LPzlkNhSHZ7
         dqsPs2uI4IvbFFb1oMYAP5eyTaSMwREys9TDa/V+AYexh7zliWL5S5Ot8AQK0EvUBO9e
         HX01e1aFKDdTKz42gf7M0Im6tCu7CcvOtUsJ7ceuCtEWRiODhC+l7wS5wALsJcA1saNW
         1K/EVLweBzwiak6yadwyVO1BcKMTq0TS3L4nHbnKXZvWkcO0VdWjEhJ+FAYqfSt3NcR+
         3QwA==
X-Gm-Message-State: AOJu0YyDM5v38kb/T+Y2BG2ybg2s8Nu1jeMDdOsRFv//I+igtC8Sq6Kz
	9A3GPbhuWIEsajziFSYClbymBbldK8M30HyPZssKFaLLM0ijqjSBCJs4mmuu6E6Uz5umClI5hkb
	L80nsxoaL7RMgt/SnP6zZlkWTidWi3rBE95uZelfVKJ8mSNeo81P0ftkDCkj/nEexd9mk8RjU
X-Gm-Gg: AY/fxX6oMTLZdK/RbeLNgLErncBs/c7KhgkE77HH/4N+vYhHf+sFzwWYkPHc5eFCuch
	bMN6wrsTVUWaB063ApHbJQi0S75icYZ0nBSOAyAucoOxmKEUlmFXDy44MaID6kxehiCdv7SJiUU
	WpfXnBl9QZeMCMlkNEoNcA6AlprVRCGIBhjPqHnHZPNDcub9Tbmw+fx7YU7qwUGwICtR0Frx158
	RFNLsFuKbkb1Vk2P98QAw74N8XbEFb8zq6S6U7h+eByWBqZmZ1VovTe5oTDG8dvBrgnbgMhqE0P
	yO93msJwN1mo1EoAEVYNhrx4Tn+ONV30f8p23TleMuFmjg+v+7CHd2ENaroMGbkc3snseWV3uRI
	IZqmIAjw8j+SXxIS4xpfajkvs10J/jCPH2RfeSO9H
X-Received: by 2002:a17:903:3846:b0:2a5:8c1c:744f with SMTP id
 d9443c01a7336-2a7177ce31cmr560535ad.40.1768494860746;
        Thu, 15 Jan 2026 08:34:20 -0800 (PST)
X-Received: by 2002:a17:903:3846:b0:2a5:8c1c:744f with SMTP id
 d9443c01a7336-2a7177ce31cmr560305ad.40.1768494860208;
        Thu, 15 Jan 2026 08:34:20 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.34.18
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:34:19 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 24/27] EPPKE: Retrieve KCK/KEK from PTKSA and install group
 keys for GTK rekey
Date: Thu, 15 Jan 2026 22:03:03 +0530
Message-Id: <20260115163306.367753-25-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX5GFsNunUEKeQ
 K+MKB6Vaw3BZc337Hv6mXYuRIfaZpiEgfuAoYhGRDTtvU8KlCITQg5F9mGt9G+4elJcJFl/bidX
 MvoZxQa4CBeBA8qlhjA20TOCNTdud4YCEa1wnrhq9JB/UpsIiKT7RoYTPxQWq3l2mVc5MbW93p+
 tJ2pu6yl21ua/YRRerwb6XuepWD7whm5jWSEkB6tewz2H0c6ZwIb6MpCfUaEuSzn+sNVYewMKkN
 LS8gjEJHg3C5eF/akQ2SRhM+md5Dpc74e8LW4igJPD+KHiiW5FKgBk+4kWDtBgufNuVE/q4PbUR
 F97TriPV3HM6FyxGgYyWwnWbcLmuhMKsAjkhSERYVrXgVbVBxrzbZNT6YXaGFo7TnsnrsCwasYJ
 +PfyEU48R5b3ef+40Ep0nu2TR3gYt7hf1m1WDlQOvnrYbrJ9Nau7inhsQehbbu4wbhsnqLxpV6I
 1pUPzivjPr63a1xBaUg==
X-Authority-Analysis: v=2.4 cv=J+KnLQnS c=1 sm=1 tr=0 ts=6969170d cx=c_pps
 a=JL+w9abYAAE89/QcEU+0QA==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=aJKCS5uhWmQZfN3LeZEA:9 a=324X-CrmTo6CU4MGRt3R:22
X-Proofpoint-GUID: tVNP9e6XJoOfuhrzK2p70qmP_qEsmZDT
X-Proofpoint-ORIG-GUID: tVNP9e6XJoOfuhrzK2p70qmP_qEsmZDT
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 spamscore=0 adultscore=0 priorityscore=1501 bulkscore=0 phishscore=0
 clxscore=1015 suspectscore=0 malwarescore=0 lowpriorityscore=0
 impostorscore=0 classifier=typeunknown authscore=0 authtc= authcc=
 route=outbound adjust=0 reason=mlx scancount=1 engine=8.22.0-2512120000
 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_163427_065695_C5959F67 
X-CRM114-Status: GOOD (  23.45  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: SpamAssassin version 4.0.1 on casper.infradead.org summary:
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.168.131 listed in list.dnswl.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.168.131 listed in
 sa-trusted.bondedsender.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.168.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.168.131 listed in
 bl.score.senderscore.com]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

This change adds support for:
- Retrieving KCK (Key Confirmation Key) and KEK (Key Encryption Key) from
  PTKSA cache and storing them in wpa_sm for use during GTK rekey operations.
- Installing GTK and related group keys to the driver as part of EPPKE-based
  association flow.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/rsn_supp/wpa.c      | 203 +++++++++++++++++++++++++++++++++++++++-
 src/rsn_supp/wpa.h      |   2 +
 wpa_supplicant/events.c |  32 +++++++
 3 files changed, 235 insertions(+), 2 deletions(-)

diff --git a/src/rsn_supp/wpa.c b/src/rsn_supp/wpa.c
index 5f0b0e3d8..0897b1bef 100644
--- a/src/rsn_supp/wpa.c
+++ b/src/rsn_supp/wpa.c
@@ -3155,7 +3155,8 @@ static void wpa_supplicant_process_mlo_1_of_2(struct wpa_sm *sm,
 	u8 i;
 	struct wpa_eapol_ie_parse ie;
 
-	if (!sm->msg_3_of_4_ok && !wpa_fils_is_completed(sm)) {
+	if (!sm->msg_3_of_4_ok && !wpa_fils_is_completed(sm) &&
+	    !wpa_eppke_is_completed(sm)) {
 		wpa_msg(sm->ctx->msg_ctx, MSG_INFO,
 			"MLO RSN: Group Key Handshake started prior to completion of 4-way handshake");
 		goto failed;
@@ -3391,7 +3392,8 @@ static void wpa_supplicant_process_1_of_2(struct wpa_sm *sm,
 	struct wpa_eapol_ie_parse ie;
 	u16 gtk_len;
 
-	if (!sm->msg_3_of_4_ok && !wpa_fils_is_completed(sm)) {
+	if (!sm->msg_3_of_4_ok && !wpa_fils_is_completed(sm) &&
+	    !wpa_eppke_is_completed(sm)) {
 		wpa_msg(sm->ctx->msg_ctx, MSG_INFO,
 			"RSN: Group Key Handshake started prior to completion of 4-way handshake");
 		goto failed;
@@ -7086,6 +7088,203 @@ int wpa_eppke_is_completed(struct wpa_sm *sm)
 }
 
 
+#ifdef CONFIG_ENC_ASSOC
+int eppke_process_assoc_resp(struct wpa_sm *sm, u64 flags, int valid_links,
+			     const u8 *resp, size_t len)
+{
+	struct ieee802_11_elems elems;
+	struct wpa_gtk_data gd;
+	int maxkeylen;
+	struct wpa_eapol_ie_parse kde;
+
+	if (!sm || !sm->ptk_set) {
+		wpa_printf(MSG_DEBUG, "EPPKE: No KEK available");
+		return -1;
+	}
+
+	wpa_hexdump(MSG_DEBUG, "EPPKE: (Re)Association Response frame",
+		    resp, len);
+
+	if (ieee802_11_parse_elems(resp, len, &elems, 1) == ParseFailed) {
+		wpa_printf(MSG_DEBUG,
+			   "EPPKE: Failed to parse decrypted elements");
+		goto fail;
+	}
+
+	if (!elems.rsn_ie) {
+		wpa_printf(MSG_DEBUG,
+			   "EPPKE: No RSNE in (Re)Association Response");
+	} else if (wpa_compare_rsn_ie(wpa_key_mgmt_sae(sm->key_mgmt),
+				      sm->ap_rsn_ie, sm->ap_rsn_ie_len,
+				      elems.rsn_ie - 2, elems.rsn_ie_len + 2)) {
+		wpa_msg(sm->ctx->msg_ctx, MSG_INFO,
+			"EPPKE: RSNE mismatch between Beacon/Probe Response and (Re)Association Response");
+		wpa_hexdump(MSG_DEBUG, "EPPKE: RSNE in Beacon/Probe Response",
+			    sm->ap_rsn_ie, sm->ap_rsn_ie_len);
+		wpa_hexdump(MSG_DEBUG, "EPPKE: RSNE in (Re)Association Response",
+			    elems.rsn_ie, elems.rsn_ie_len);
+		goto fail;
+	}
+
+	if ((sm->ap_rsnxe && !elems.rsnxe) ||
+	    (!sm->ap_rsnxe && elems.rsnxe) ||
+	    (sm->ap_rsnxe && elems.rsnxe && sm->ap_rsnxe_len >= 2 &&
+	     (sm->ap_rsnxe_len != 2U + elems.rsnxe_len ||
+	      os_memcmp(sm->ap_rsnxe + 2, elems.rsnxe, sm->ap_rsnxe_len - 2) !=
+	      0))) {
+		wpa_msg(sm->ctx->msg_ctx, MSG_INFO,
+			"EPPKE: RSNXE mismatch between Beacon/Probe Response and (Re)Association Response");
+		wpa_hexdump(MSG_INFO, "EPPKE: RSNXE in Beacon/Probe Response",
+			    sm->ap_rsnxe, sm->ap_rsnxe_len);
+		wpa_hexdump(MSG_INFO, "EPPKE: RSNXE in (Re)Association Response",
+			    elems.rsnxe, elems.rsnxe_len);
+		if (sm->assoc_rsnxe && sm->assoc_rsnxe_len)
+			goto fail;
+	}
+
+	/* Key Delivery */
+	if (!elems.key_delivery) {
+		wpa_printf(MSG_DEBUG, "EPPKE: No Key Delivery element");
+		goto fail;
+	}
+
+	/* Parse GTK and set the key to the driver */
+	os_memset(&gd, 0, sizeof(gd));
+	if (wpa_supplicant_parse_ies(elems.key_delivery + WPA_KEY_RSC_LEN,
+				     elems.key_delivery_len - WPA_KEY_RSC_LEN,
+				     &kde) < 0) {
+		wpa_printf(MSG_DEBUG, "EPPKE: Failed to parse KDEs");
+		goto fail;
+	}
+
+	if ((flags & WPA_DRIVER_FLAGS2_MLO) && valid_links != -1) {
+		u8 i;
+
+		for_each_link(valid_links, i) {
+			size_t gtk_kde_len;
+			struct wpa_gtk_data gd;
+			int rsc_len;
+
+			if (!kde.mlo_gtk[i]) {
+				wpa_msg(sm->ctx->msg_ctx, MSG_ERROR,
+					"EPPKE: No MLO GTK for link ID %u", i);
+				return -1;
+			}
+
+			os_memset(&gd, 0, sizeof(gd));
+			gtk_kde_len = kde.mlo_gtk_len[i];
+
+			/* Minimal sanity:
+			 * 1 byte KeyID + RSC + at least 5 bytes GTK
+			 */
+			if (gtk_kde_len < 1 + 6 + 5) {
+				wpa_printf(MSG_DEBUG, "EPPKE: Invalid MLO GTK"
+					   " KDE len=%lu for link %u",
+					   gtk_kde_len, i);
+				goto fail;
+			}
+
+			wpa_hexdump_key(MSG_DEBUG, "EPPKE: Received MLO GTK",
+					kde.mlo_gtk[i], gtk_kde_len);
+
+			/* KeyID in low 2 bits;
+			 * Tx bit workaround from KDE[0] bit2
+			 */
+			gd.keyidx = kde.mlo_gtk[i][0] & 0x3;
+			gd.tx = wpa_supplicant_gtk_tx_bit_workaround(sm,
+								     !!(kde.mlo_gtk[i][0] & BIT(2)));
+
+			rsc_len = wpa_cipher_rsc_len(sm->group_cipher); /* returns PN/RSC length */
+			if (rsc_len <= 0) {
+				wpa_printf(MSG_DEBUG, "EPPKE: Unsupported group cipher (no RSC len)");
+				goto fail;
+			}
+
+			/* Actual GTK length = total KDE - KeyID(1) - RSC/PN.
+			 * For CCMP/GCMP, gtk_kde_len is typically 23 -> 23 - 1 - 6 = 16.
+			 */
+			gd.gtk_len = gtk_kde_len - 1 - rsc_len;
+
+			/* Validate GTK length against algorithm requirements */
+			if (wpa_supplicant_check_group_cipher(sm, sm->group_cipher,
+							      gd.gtk_len, gd.gtk_len,
+							      &gd.key_rsc_len, &gd.alg))
+				goto fail;
+
+			if (gd.gtk_len > sizeof(gd.gtk)) {
+				wpa_printf(MSG_DEBUG, "EPPKE: Too long GTK in"
+					   " GTK KDE (len=%u)", gd.gtk_len);
+				goto fail;
+			}
+
+			os_memcpy(gd.gtk, kde.mlo_gtk[i] + 1 + rsc_len, gd.gtk_len);
+
+			if (wpa_supplicant_install_mlo_gtk(sm, i, &gd, elems.key_delivery, 0) < 0) {
+				wpa_printf(MSG_DEBUG, "EPPKE: Failed to set MLO GTK (link=%u)", i);
+				goto fail;
+			}
+
+			if (_mlo_ieee80211w_set_keys(sm, i, &kde) < 0) {
+				wpa_printf(MSG_DEBUG, "EPPKE: Failed to set MLO IGTK (link=%u)", i);
+				goto fail;
+			}
+		}
+	} else {
+		if (!kde.gtk) {
+			wpa_printf(MSG_DEBUG, "EPPKE: No GTK KDE");
+			goto fail;
+		}
+		maxkeylen = gd.gtk_len = kde.gtk_len - 2;
+		if (wpa_supplicant_check_group_cipher(sm, sm->group_cipher,
+						      gd.gtk_len, maxkeylen,
+						      &gd.key_rsc_len, &gd.alg))
+			goto fail;
+
+		wpa_hexdump_key(MSG_DEBUG, "EPPKE: Received GTK", kde.gtk, kde.gtk_len);
+		gd.keyidx = kde.gtk[0] & 0x3;
+		gd.tx = wpa_supplicant_gtk_tx_bit_workaround(sm,
+							     !!(kde.gtk[0] & BIT(2)));
+		if (kde.gtk_len - 2 > sizeof(gd.gtk)) {
+			wpa_printf(MSG_DEBUG, "EPPKE: Too long GTK in GTK KDE (len=%lu)",
+				   (unsigned long) kde.gtk_len - 2);
+			goto fail;
+		}
+		os_memcpy(gd.gtk, kde.gtk + 2, kde.gtk_len - 2);
+
+		wpa_printf(MSG_DEBUG, "EPPKE: Set GTK to driver");
+		if (wpa_supplicant_install_gtk(sm, &gd, elems.key_delivery, 0) < 0) {
+			wpa_printf(MSG_DEBUG, "EPPKE: Failed to set GTK");
+			goto fail;
+		}
+
+		if (ieee80211w_set_keys(sm, &kde) < 0) {
+			wpa_printf(MSG_DEBUG, "EPPKE: Failed to set IGTK");
+			goto fail;
+		}
+	}
+
+	wpa_sm_store_ptk(sm, sm->bssid, sm->pairwise_cipher,
+			 sm->dot11RSNAConfigPMKLifetime, &sm->ptk);
+
+	wpa_sm_set_rekey_offload(sm);
+
+	wpa_printf(MSG_DEBUG, "EPPKE: Auth+Assoc completed successfully");
+	sm->eppke_completed = 1;
+	forced_memzero(&gd, sizeof(gd));
+
+	return 0;
+fail:
+	forced_memzero(&gd, sizeof(gd));
+	return -1;
+}
+
+
+void wpa_sm_set_reset_eppke_completed(struct wpa_sm *sm, int set)
+{
+	if (sm)
+		sm->eppke_completed = !!set;
+}
+#endif /* CONFIG_ENC_ASSOC */
 #ifdef CONFIG_OWE
 
 struct wpabuf * owe_build_assoc_req(struct wpa_sm *sm, u16 group)
diff --git a/src/rsn_supp/wpa.h b/src/rsn_supp/wpa.h
index 46e03ad99..06c84fc88 100644
--- a/src/rsn_supp/wpa.h
+++ b/src/rsn_supp/wpa.h
@@ -670,6 +670,8 @@ struct wpabuf * fils_build_assoc_req(struct wpa_sm *sm, const u8 **kek,
 				     const struct wpabuf **hlp,
 				     unsigned int num_hlp);
 int fils_process_assoc_resp(struct wpa_sm *sm, const u8 *resp, size_t len);
+int eppke_process_assoc_resp(struct wpa_sm *sm, u64 flags, int link_id,
+			     const u8 *resp, size_t len);
 
 struct wpabuf * owe_build_assoc_req(struct wpa_sm *sm, u16 group);
 int owe_process_assoc_resp(struct wpa_sm *sm, const u8 *bssid,
diff --git a/wpa_supplicant/events.c b/wpa_supplicant/events.c
index ba79f7f6d..d1217ec5f 100644
--- a/wpa_supplicant/events.c
+++ b/wpa_supplicant/events.c
@@ -3660,7 +3660,39 @@ static int wpa_supplicant_event_associnfo(struct wpa_supplicant *wpa_s,
 	    !(wpa_s->drv_flags & WPA_DRIVER_FLAGS_SME))
 		wpa_sm_set_reset_fils_completed(wpa_s->wpa, 1);
 #endif /* CONFIG_FILS */
+#ifdef CONFIG_ENC_ASSOC
+#ifdef CONFIG_SME
+	if (wpa_s->sme.auth_alg == WPA_AUTH_ALG_EPPKE) {
+		struct ptksa_cache_entry *entry;
 
+		if (wpa_s->ptksa == NULL) {
+			wpa_printf(MSG_DEBUG, "EPPKE: PTKSA not cached");
+			return -1;
+		}
+
+		entry = ptksa_cache_get(wpa_s->ptksa, wpa_s->valid_links ?
+					wpa_s->ap_mld_addr : bssid,
+					wpa_s->pairwise_cipher);
+
+		wpa_sm_set_ptk_kck_kek(wpa_s->wpa, entry->ptk.kck,
+				       entry->ptk.kck_len, entry->ptk.kek,
+				       entry->ptk.kek_len);
+
+		if (!data->assoc_info.resp_ies ||
+		    eppke_process_assoc_resp(wpa_s->wpa,
+					    wpa_s->drv_flags2,
+					    wpa_s->valid_links ?
+					    wpa_s->valid_links : -1,
+					    data->assoc_info.resp_ies,
+					    data->assoc_info.resp_ies_len) <
+		    0) {
+			wpa_supplicant_deauthenticate(wpa_s,
+						      WLAN_REASON_UNSPECIFIED);
+			return -1;
+		}
+	}
+#endif /* CONFIG_SME */
+#endif /* CONFIG_ENC_ASSOC */
 #ifdef CONFIG_OWE
 	if (wpa_s->key_mgmt == WPA_KEY_MGMT_OWE &&
 	    !(wpa_s->drv_flags2 & WPA_DRIVER_FLAGS2_OWE_OFFLOAD_STA) &&

From patchwork Thu Jan 15 16:33:04 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184709
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=VYRzTNBx;
	dkim=fail reason="signature verification failed" (2048-bit key;
 secure) header.d=infradead.org header.i=@infradead.org header.a=rsa-sha256
 header.s=casper.20170209 header.b=L84y0hAY;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=aMcKXXiT;
	dkim=neutral header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=TOHvNkzX;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsTBd5Ctmz1xqf
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:36:09 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=NIYwhep7lzxVgKH1iNtjDT7YtJKYbBSJu24Y3ccMgR8=; b=VYRzTNBxqUTSgI
	a9oeisJooMe3+OuIRu4RLa5IvhEOZH3lUlud5M3YAb9KkR6kJSxZdHzUhPdKpTqWsHfKPXjIuzbhD
	90SJRZm1tZJa2VWdZpDi8Uj4vPSMRaYApDjeEsDDta0fDYD4HZ+OJuRW/fvQANxEpxjEvqmyuhT09
	QsUrwfCFdiD5Fwt68GfPS/JTTG80I4WkDSuY90zMDIz6uj2uGdwqFE4EzLyVOlC3NsWmxZ347XM12
	mVzmcEw8xmpmjr7eB3dHj4oUYljXXRu3LtrjEODStxYqnpXwUwC5AsbQ5dxbLsRwF8gpKap0RoO13
	hcr4y0DxkHpyRhPshK4A==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQJn-0000000Cjsu-3gkz;
	Thu, 15 Jan 2026 16:35:31 +0000
Received: from casper.infradead.org ([2001:8b0:10b:1236::1])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIs-0000000Cicp-2ypR
	for hostap@bombadil.infradead.org;
	Thu, 15 Jan 2026 16:34:34 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=infradead.org; s=casper.20170209; h=Content-Transfer-Encoding:MIME-Version:
	References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender:Reply-To:
	Content-Type:Content-ID:Content-Description;
	bh=Eelk5clLySsU+tjIAbVclkuA77mvFtd/JifBCCBQMpY=; b=L84y0hAYB0U704EW5FPNsKxNeW
	6IoW7zj33AE36mvCPcgsiy5qrCUHE+Y1CByqRfyhygT86Yae9vbLb8vD1cGWcbqD5BM5D60sa+CM0
	0/WUTX1rX7ksY0C9KZAYo/P7XVwY5ZQdb0+gor+SxOJpAx6JtHdqpj6us6GOVBe1mPSPS0ptSYU1Q
	Ev0Yl/rhA5FD/UORUZPHTmuED2H1d1gcxO6tMefMwH4/uF+gccMPSRm/hykbT3MwHO8d99KcvrmGt
	wXNkymK93PtmvY42fyn/BGQPtn47zJ7Jc1fC+4Esb4uClbbeiwiNVMtsPZWkWlSmg62jDRBmU7dUn
	0Hdrpzfg==;
Received: from mx0a-0031df01.pphosted.com ([205.220.168.131])
	by casper.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIl-00000007yix-2nxb
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:34:33 +0000
Received: from pps.filterd (m0279865.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFYXHn2981311
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:23 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=Eelk5clLySs
	U+tjIAbVclkuA77mvFtd/JifBCCBQMpY=; b=aMcKXXiT/isfifHcwZjAWRwfu34
	jxLg3HAoQFlUZarYw5E0IUmtHomvlJvw9eY7yXIO7C8VXA75n8YkddIBXLkEMcd5
	tLbwR/HiTZD+jHhwjzSy2isIPJVU9O2R9Ykl7uXIaFmNWycV+0jk/cVmUOy99w2N
	1+2pOqgWbnTk1hFJUGsCzKe2chBuJQA0ooxHODD5plF9eb39g3ifGogtTdS7mkYY
	n5EXdw1h9rNyiCaWTlSH1oruFA2us4TZa4ITsL8mzud6SxPk27Z6Ly1Rpgjb6wlN
	ELyVoqn5ychaxsqvonh35EBGLGKlWEfGd7Crp8outgk8GzynVag4mWqJi8w==
Received: from mail-pg1-f198.google.com (mail-pg1-f198.google.com
 [209.85.215.198])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bprej24hn-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:23 +0000 (GMT)
Received: by mail-pg1-f198.google.com with SMTP id
 41be03b00d2f7-c5269fcecdeso613144a12.0
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:34:23 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494863; x=1769099663;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=Eelk5clLySsU+tjIAbVclkuA77mvFtd/JifBCCBQMpY=;
        b=TOHvNkzXyk0SMnEC2XY0SYllbN9ENNQHoZFAH8H+uNWQuHN2UwuPcBbG5tyQoPYSYD
         s2tkn3qWr3PKFBVPx4UGDE1qH9JtcYtSmNHL2G9Q3bk9r+4ukwRM7jQN1WYhMGYnFxsq
         IP2juHXRJl+nxB6w/1P3s9Qz1OcjmFwbE0176h/QOW563dlItcg2PtaHl4QorsKdco0m
         9qZT93yUO1God3GvZsObJFx/nYABoKfE6VgXcawyW41vDbYq/9aDNg/I6A5B8K2EGFTx
         GtbORjB/iv9gb2puYJYEXC71JnBrUp/3Hya3y3PO8mBQX2rw1uA5i1bTP/m8+J3Y0Uq+
         YUsg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494863; x=1769099663;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=Eelk5clLySsU+tjIAbVclkuA77mvFtd/JifBCCBQMpY=;
        b=P6clxiF3/HbI/JkwCgigt5gdOZWa9t16sGyhtN20LnaLzxol1RVl3GfHydLd13AeXN
         D3qO+AeohVbswN7CBSmMaQYw24ahOz0f4nL79k7xJ/9si+/QbtHPMI7D1l1jAPvo8P01
         XrfwjXMPN2+5IN8hmYISb0FFQ7o3Y8OENG+vfTRqGnuon+1VNDeZiyXGY+q3whe0t6G/
         idQovkK58ofolGeDchvgokyP2shvs6KNIF2fxoJkdt30S721zgER4rPSw2JaT7ozmGoo
         53L/vULNPCFaaTZlEPh5fMEwfcSHHweayymHulkUxaYP4e/3qUBnEypvaAvM/77reOhM
         4l1A==
X-Gm-Message-State: AOJu0YwlA72Ey86rAa+w0XP4UEASei9wdg2ZyWUTgUVOwkMzsrRsS0OD
	KLjV4GLHALUMQv0mvM7Z4tq8K109xntNykFtar+6mtpIlej/71eRaqKSQ2grudJIe+sDT3SELFs
	J0yrC8ySaMzoChxCRVawe8hUMYGG1QFON1rZDAg8iVVk19OXmv8ktMHAm1A0SuSCzBXEEZJxZ
X-Gm-Gg: AY/fxX4mOk3JZ1X2ZDZKiIXKmXsvK38uWPYwjcn9q9EL3oQspKBgPMmbZ1x8xPkc9jc
	RyMkjNr1qvSw1Lz07CZzqDrmX3Js01pHni+5Qd1/+6+lWeykljnWPa9c0jBGtwE44fa66ehqNb7
	EEDTJYXHuniOymBGbgBGo7Sn0ZBiiLOtx5K9Fl9yiBDL4YE73DZM4/5cuE2JP5xiTZ2itKysrUV
	a0dvVRL3Si7AQvuB8hOk6ZH+XqpkAlh4FMyPdHBE4s7H+l3L9SSfMBFtS+lM/ShLM8dOrlOHpTM
	c9lJZzY6Txwpd2g7paVvHgSQRb1reu5XKZ6gcSvdMt0pK6VX2mII2OcsuLMovLZyQaxOHHkHSvM
	3lIihroy913qmDXdMOUifadlazZI9G/G2nyj+rP6C
X-Received: by 2002:a17:903:28d:b0:2a1:e19:ff4 with SMTP id
 d9443c01a7336-2a7176c58edmr713235ad.29.1768494862757;
        Thu, 15 Jan 2026 08:34:22 -0800 (PST)
X-Received: by 2002:a17:903:28d:b0:2a1:e19:ff4 with SMTP id
 d9443c01a7336-2a7176c58edmr713045ad.29.1768494862274;
        Thu, 15 Jan 2026 08:34:22 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.34.20
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:34:22 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 25/27] tests: Enable CONFIG_ENC_ASSOC for hwsim
 wpa_supplicant
Date: Thu, 15 Jan 2026 22:03:04 +0530
Message-Id: <20260115163306.367753-26-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX83H/fjC0EK+r
 vaIb92W4Pu9RcpK9Aj02zQSY4dIeO5A3jGIk4BcpkF0ZCgVQVF2IbKWpKj4XzJaphVuuYeTWRa/
 1Uo1AZe7qJVPGnN1ds1v1zO+grHdmx3x1UkH5xsbYNXw4b8wxkKhho4qeRdHLCbPh9diidSEa0Q
 VuqfLVejGk7d1cIToISvpD+E5k6Kug11Z2sjavGRG+dW87+Vi//ohbp5OLhs9FLWxtznAwqKTK5
 ABIHbdAo4SD7tQ8Du2VE3hjtBYcM7C4dQrbKdEF7BZWxyNZ6OZ+OfWcQBUwAn4LNNDbpo31+0nw
 l8qAf03/YctBmD3dzV2VzooobGzky5a1KWJFEKExsBC0rYwl7lE9RdAdgrTMKaU7/8nR8cLRVX3
 KFdEUp71YKm2P8+BhkWXkdr9kfw15sWbSqkS/k0yAUTQBtmxpXdOzbXNGOD9tPsFKU5y8dU8fJe
 C3qrMZQdT7rC66crTgg==
X-Proofpoint-ORIG-GUID: XfPm-YS8t2xgPjohcWJa3VvPovTCd7wg
X-Authority-Analysis: v=2.4 cv=Rc+dyltv c=1 sm=1 tr=0 ts=6969170f cx=c_pps
 a=Qgeoaf8Lrialg5Z894R3/Q==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=idPbxda75d4-GageoJcA:9 a=x9snwWr2DeNwDh03kgHS:22
X-Proofpoint-GUID: XfPm-YS8t2xgPjohcWJa3VvPovTCd7wg
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 lowpriorityscore=0 adultscore=0 spamscore=0 suspectscore=0 priorityscore=1501
 clxscore=1015 bulkscore=0 malwarescore=0 phishscore=0 impostorscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_163428_048190_D4A6D43F 
X-CRM114-Status: GOOD (  11.79  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: SpamAssassin version 4.0.1 on casper.infradead.org summary:
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.168.131 listed in list.dnswl.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.168.131 listed in
 sa-trusted.bondedsender.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.168.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.168.131 listed in
 bl.score.senderscore.com]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Kavita Kavita <kavita.kavita@oss.qualcomm.com>

Enable CONFIG_ENC_ASSOC option for wpa_supplicant in hwsim to run EPPKE
related tests.

Signed-off-by: Kavita Kavita <kavita.kavita@oss.qualcomm.com>
---
 tests/hwsim/example-wpa_supplicant.config | 1 +
 1 file changed, 1 insertion(+)

diff --git a/tests/hwsim/example-wpa_supplicant.config b/tests/hwsim/example-wpa_supplicant.config
index d9b26464c..9343ce32e 100644
--- a/tests/hwsim/example-wpa_supplicant.config
+++ b/tests/hwsim/example-wpa_supplicant.config
@@ -170,3 +170,4 @@ CONFIG_NAN_USD=y
 
 CONFIG_IEEE80211BE=y
 CONFIG_PROCESS_COORDINATION=y
+CONFIG_ENC_ASSOC=y

From patchwork Thu Jan 15 16:33:05 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184710
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=4GEJ9Qd/;
	dkim=fail reason="signature verification failed" (2048-bit key;
 secure) header.d=infradead.org header.i=@infradead.org header.a=rsa-sha256
 header.s=casper.20170209 header.b=ZCaPsQED;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=OM1SnQ6Q;
	dkim=neutral header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=LFxZTvow;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsTBl3sqGz1xqf
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:36:15 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=MOcvTx21OatGNDK0/vIvdLTL7l170dLa4UcmERxF1IM=; b=4GEJ9Qd/p6FgUF
	5U5ZXttXV/5B5kOIbDfYNF4FjKLJpo9OMS8IErfeB1txtR8WFGxS1w3e2vc1w3F7YGUHglIoeH78a
	P2Q7hRz2g7wY9iOm0kdtdJB5xgeMfOjdy/0HQTfEQ8cqIPLsw7Jx90P1fknL1hItl7Y4uG32PR4pl
	YXj1HVc11VFrBA2A7YU3X8JDIv3ADgUSs/23WdWV8Z97/Y5g58SO1VskeVRYmR1yG7iOrMzTqZFyn
	ZuMhVqmost5sKqyIYvfMTzPvMDPJ6UJt578A5ijWcdvupC1c3pbqAxRzIP6ab7n9Qe+IbEvtv4CNS
	CUznk0oRzW2kC8b73rvg==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQJs-0000000CjyN-1v51;
	Thu, 15 Jan 2026 16:35:36 +0000
Received: from casper.infradead.org ([2001:8b0:10b:1236::1])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIt-0000000CidO-0T4c
	for hostap@bombadil.infradead.org;
	Thu, 15 Jan 2026 16:34:35 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=infradead.org; s=casper.20170209; h=Content-Transfer-Encoding:MIME-Version:
	References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender:Reply-To:
	Content-Type:Content-ID:Content-Description;
	bh=umDxDcocUK3tITxxdq6eXyXEXgvhe4RPkX+phTYR2QM=; b=ZCaPsQEDLmqhjC76YU3alE1pwZ
	dpCtFE+TQZEkJ7ijojPnW5bZJeA8feur4UHFTbMk36H+sCQlviIhGQiWte+UUSERAdfdDIo6YfHo4
	wp9TEOKBfxPGofpTwKQDh0pDOgGdahPGFL0JUkedp1ObbltFeTarIcGjO9g4RvVqJ8NK04j6VR3OA
	1FokvRZ8HC0OUoXwopDhQYz0NHtOWk53Scw8SG3q+6set03y/KVl5WdfcIklu/uBnUjHrNPM9iI7O
	RYWfOAShTpOkoC0e5YbUKYmJEwiIX0wvTinh4MBajlgj1cxCIJUge6+L1uQEH1n7iYS+p+1xYAgAU
	daopzFsA==;
Received: from mx0a-0031df01.pphosted.com ([205.220.168.131])
	by casper.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQIm-00000007yjc-03yf
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:34:33 +0000
Received: from pps.filterd (m0279867.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFYBkk2817395
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:25 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=umDxDcocUK3
	tITxxdq6eXyXEXgvhe4RPkX+phTYR2QM=; b=OM1SnQ6Qm8lwLkKUgsRwMYKHz21
	ugMtswq9PUzhjCSUgn8EZYHg5BfpXyqY5C5i7J/yROxrA9YiTm+w53xbrg30Bd60
	HIeilyzR2ODuC6BodsYi0C6nvbRjL9W1ZipPXuyP5JrL0+4ISElQ1u3phTehAdLT
	u9fS+ybtkQhEKgTVzaXt1++NvIN/6wYO9NCGo4nohdR0H/FHrvSeW0OgfnqsA7Zt
	g/LjL7lvxY7CGTIN/fbE3jVcz3LsH6lGV36ZK0tozekMtqNxu+flyY/TrpUC0kJD
	xh2vMEchogXl2yw46Dh4VOZH8ytUXJ53p5Tv4EHTKo63+6orseBV44+rYEQ==
Received: from mail-pl1-f200.google.com (mail-pl1-f200.google.com
 [209.85.214.200])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bpwpxh6bc-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:25 +0000 (GMT)
Received: by mail-pl1-f200.google.com with SMTP id
 d9443c01a7336-29f2b45ecffso16311035ad.2
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:34:25 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494865; x=1769099665;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=umDxDcocUK3tITxxdq6eXyXEXgvhe4RPkX+phTYR2QM=;
        b=LFxZTvow/KXcVRLQrjVejQrRvyUzAeck1gCqUZ2NlaY6fazVtwQBkxOGDdF9mJAeWO
         VRGk2Lp3wBNT1UQdhV25i8cD5D7VQ8QOUI0frnFzrGSfiqEJuNyL/00yplAtAhVUTBu/
         cbJAAt9YIyV8DJ2mJppsiCRyEfSgGqDrkkRx7H20svt6OOWSDys6zQq5W8tQZ8Lsfx3f
         y6rBB1+0uTAUsMHTwPvUNfbMOMgY4nemxYhH+oLLpvr1W0QT1IYmiFKdwzsGC6+2x4ud
         S3T5D5YTMezQ21sSCRFboLFAI6XOa1Vbk/jcIUAF1JmXKxldD40e1+C2laoKWHLbW5D5
         sKvw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494865; x=1769099665;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=umDxDcocUK3tITxxdq6eXyXEXgvhe4RPkX+phTYR2QM=;
        b=rdlu3fDa7/q3E1ZlB8+rgl3JSML1IIOasVCVwWn6EZFlBm7/mID7uyAUYWTz9cLWQ1
         uhjoYR8F3IzppUhRiCp4rRAMPRG8YE66Qp9X+ruehL9+uAPdE/a+5sn54XhtQ9Lz50Up
         iZ3rgg9yYshYjHXvGIGxxx4ymqU6KP7CdpJLdGqU6mMKwCycWop5QjmL6suMkSd8LaEQ
         vddElnfs2JbyBeDbXIXxUOjQuiyI0vlQzZvl9aJsFz9Nn1ajZbfpprXfzOteUibXze9y
         oSolwKuNRByXUpNREo2kpcKuW5VRcz9OIxSKei3JD7bHW3dfNpZuvtL4sdAHRzBRzIeM
         jiFQ==
X-Gm-Message-State: AOJu0YzQSIRqxnNs5W/Xq64LUXnpw0AbbgPw7EWGHc2gmm48CO5uPBbm
	g4weZzvgC6taw6ZGHN+7ftqSR8NkAQW4GNSswDAbGH5o8rDr4K5ioKeEg902Xt4vVU75prN9x2Z
	qRRF2RpUisQ+XLlA8nVhmyAsnKgJ0gfeYUufW+7t9gnluuXw2nqsHrueqkgLQlirl09iPH5M9
X-Gm-Gg: AY/fxX7ekbgLrwiyq9EvYEA5ZeqV0VVuUC41wotXXK8CbaLfqyCbzFVRoMwxYQ5i5zm
	kM4LgoCnunFF5wwiGk5Bxl/8tzxq18GkecemzG7gXuxWa8b9wFtk5bqFE83kRGxx2Oe16bRnP3P
	UdnrZaZtEVHAzynVC7qTaGq+2zYgGo5dTbLrxHtQRQedyqKqpiTMzZXwEs6OhvSBdG/HZhnZCAe
	ENLvQqKwbzYmxe8ygdXOZq9CjeeHk0biFGfrQomghJo/OX0cIm3l6CqwNWEi+brW+FJki3xP+6x
	0cLKK1BqvKF8J+76ZfSrl1Yx18ZODhS9qOU4qB6uu0oi1Tlkan6tTgRjoCjF//0U6AbtDm/n97O
	a/69i+n7JWe9GoMK7Ssn+4e8Pksh4zYpD6/DWUnYI
X-Received: by 2002:a17:903:b84:b0:2a0:d527:4d08 with SMTP id
 d9443c01a7336-2a7175bc05amr831255ad.41.1768494864886;
        Thu, 15 Jan 2026 08:34:24 -0800 (PST)
X-Received: by 2002:a17:903:b84:b0:2a0:d527:4d08 with SMTP id
 d9443c01a7336-2a7175bc05amr831035ad.41.1768494864328;
        Thu, 15 Jan 2026 08:34:24 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.34.22
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:34:24 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 26/27] tests: Enable CONFIG_ENC_ASSOC for hwsim hostapd
Date: Thu, 15 Jan 2026 22:03:05 +0530
Message-Id: <20260115163306.367753-27-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Authority-Analysis: v=2.4 cv=ZtPg6t7G c=1 sm=1 tr=0 ts=69691711 cx=c_pps
 a=IZJwPbhc+fLeJZngyXXI0A==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=EfQgyAHBdYhmdkLjkZoA:9 a=uG9DUKGECoFWVXl0Dc02:22
X-Proofpoint-GUID: i2WZneZUpYdT-A0Vx05R0tseaqyL0wOd
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX+5GQizujs+A1
 x/GzH6lJgyc75z8mLdZffBcWC/jG+99WOupn0XYq7Q2RS6hAwqSN33l0vEd8qktUjxm3x1BGg/Y
 d/o9Ocl0RJlvetJ9xWKAwFFIHBb8znzIeoXREg/zrrd+aJpAN1BRpT+mGeA/e3XqnKD0qE6n9rc
 xJjI10s68SWPa8th4XBd+uU3VUweXauBI5p90BGzA+XkYvfoBnxUeh7HxtA4PTS5r0K/sf4EIN5
 7uppVQAOztxt4KN+nuCCCdBR6JaRmVZKFKajQGEV12jA+UOnhG35TJ8Q1et/Jf302kcz9hba0qE
 eUtFrdjF9z6lza0ekivbskg8CYyH+hVdYojP7RaIqyX45qrLfKHRke4uZcRtYqAnRf/SbHN8udG
 pNTrupUKjv3NzPSdtVhutd51/affyitBid9bmWJ3UJ+kwD2+Ys4AIyRoAz0F9Fs2EaJTg7g0bdO
 T5xs2Gzkvxt3TQ2OC1A==
X-Proofpoint-ORIG-GUID: i2WZneZUpYdT-A0Vx05R0tseaqyL0wOd
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 spamscore=0 adultscore=0 phishscore=0 clxscore=1015 priorityscore=1501
 lowpriorityscore=0 impostorscore=0 malwarescore=0 bulkscore=0 suspectscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_163428_363942_C4343640 
X-CRM114-Status: GOOD (  11.93  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: SpamAssassin version 4.0.1 on casper.infradead.org summary:
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.168.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.168.131 listed in
 sa-trusted.bondedsender.org]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.168.131 listed in
 bl.score.senderscore.com]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.168.131 listed in list.dnswl.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

Enable CONFIG_ENC_ASSOC option for hostapd in hwsim
to run EPPKE related tests.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
---
 tests/hwsim/example-hostapd.config | 1 +
 1 file changed, 1 insertion(+)

diff --git a/tests/hwsim/example-hostapd.config b/tests/hwsim/example-hostapd.config
index 65e6d7e5e..cd2696b74 100644
--- a/tests/hwsim/example-hostapd.config
+++ b/tests/hwsim/example-hostapd.config
@@ -125,3 +125,4 @@ CONFIG_AIRTIME_POLICY=y
 CONFIG_IEEE80211BE=y
 CONFIG_NAN_USD=y
 CONFIG_PROCESS_COORDINATION=y
+CONFIG_ENC_ASSOC=y

From patchwork Thu Jan 15 16:33:06 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2184730
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=oxo6FlSI;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=UcnFMJax;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=Dia2Jj2S;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dsTbL0rxgz1xqf
	for <incoming@patchwork.ozlabs.org>; Fri, 16 Jan 2026 03:54:06 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=8ZauxhPjKLHgXZepBltT1lWvllMFd5oxNpou5Ie75Zk=; b=oxo6FlSIfRAHM6
	zsPNhq5pXK3wD648nzCe1xtRDWynsujvBEi/xJxFranrWh0uOHs0lf0VZVTH4vXM6AKIniuplI33n
	tynZTFyB4Gwyl5G1QONc8/ROL4xUm+F6eOVn3TB5Rwsew3baZNy+fZIqvekHfc19WVA9CFdZ9wJgL
	6lC+k0OMaMLusb3fwQ3nIaJkaGCTz9SIbhPMiyjUgrrKtrilscEdOYZHfOfsthHYXs0tlJd+1p7NN
	mAhTpzTZQ8e/6X9OAX9TBbxAKlSPdeSxie+EXyvpfNn4iSPYtbA0pIzewe53JqU1QD80VArNtqFOx
	f/9/LJOzPz+mEYMICXTQ==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQbF-0000000CnwD-0mPg;
	Thu, 15 Jan 2026 16:53:33 +0000
Received: from mx0a-0031df01.pphosted.com ([205.220.168.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vgQbB-0000000CnvC-3zUq
	for hostap@lists.infradead.org;
	Thu, 15 Jan 2026 16:53:32 +0000
Received: from pps.filterd (m0279862.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 60FFYMKe3202285
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:28 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=szX7ZY9guqq
	G8e18ocHlYqOhojJIyx11dDN91pYT4oY=; b=UcnFMJaxRZRcOFtsoypHZevYny6
	49Qizmk3elwMulpR7of1ZepKSZ50cv6XTryizvlhHZ/l6prRY5wp1MXkQ9T/XkrP
	i1d43pQ4BAs/Xs7h/VooHvHiH9VtKb9CxDkbf0FNjTJiZ77vLZUj53beMLqoOkv+
	rd+WR1U/VF4G+dCcyvGOw7Us70KHm0ch3b/4+vcmziTTQc+dcs36m/fl11no7x0V
	fTXTe/hzpU5hfP6KGeWIJh7HBkMk+PM/9fyAmIvvkz3jIONxJzU4D4ftfScXcnVP
	pyhVKfDyAV8/m9NIvOYWxuBl2MSczPi9HzF1mSJ8rz1XjMVvBn8cMnIOyMw==
Received: from mail-pg1-f198.google.com (mail-pg1-f198.google.com
 [209.85.215.198])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bpxhs90re-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Thu, 15 Jan 2026 16:34:28 +0000 (GMT)
Received: by mail-pg1-f198.google.com with SMTP id
 41be03b00d2f7-c1d27c65670so1141912a12.1
        for <hostap@lists.infradead.org>;
 Thu, 15 Jan 2026 08:34:28 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1768494868; x=1769099668;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=szX7ZY9guqqG8e18ocHlYqOhojJIyx11dDN91pYT4oY=;
        b=Dia2Jj2SsNOMD8XSWQ5cfhhaFazLZl+yGwEXTnadqaTkOm1Y7oUyrRd5ebKbXz/MuD
         2zpcMRrWMKRezsYvGRBekOd0/qRlxa1lER72ZZL+z75JisKoaX4bkZP2DtMN3usXRjSM
         1IR1133zb5zHDHjEkjl1uXk7EUJE5bm6+znwJOaw7C/e3XPRzJ6PoaRkYCrtoiRy+fpv
         iQBsvx+ZmE4vwqlABLx9GhyTf3dOjqoNPSqFZhOju8edxtqBRc7THSQ0w72mOYSDaRwH
         0UT9bHX9+T0c69tKjy8mqa1Htp0SYh14f0eEXOKPF7AINuIOSmTy4bX6lyVRFLS+ey9T
         DqJw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1768494868; x=1769099668;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=szX7ZY9guqqG8e18ocHlYqOhojJIyx11dDN91pYT4oY=;
        b=J0gWkrgGO4XYXuofR6hunDvPOd8/hMSBjTQKyB5T1boJynAYHSta4ViMts6fARhzy6
         IF5TxwjO9Qt8vhO+hIx29iSfd6WeFU2lEcqnxgAinxkkHwhr8PcBXWKzMa/dAFjc7Pyh
         4ooQ1mNPKaXc+DWX5d8WQtFw3uCtaDe8uf5AggX+o09r17M43qZSqyLPnPm9/SNfBRiB
         PhUyk9Y3TaUC1dZzWXMwqGxgjleCvkzRAG7iwTLPuvG/B1vHVeSde5WZUKEBczmX5kHJ
         ECr2gDxL36oZDIgnGxe1yu8irhmi+/uibkta2mRRA/7bbgovU5a8RwZ0DEf5dEuuc0OF
         Xh6g==
X-Gm-Message-State: AOJu0YzElwHrgJaaI0Ty5nyu+SAbbwkQpciPs0IhJRaqHg7999GGo8FH
	lq8RO7G4LVvQ5How+uahgZVtqptvrADsT30+u9WIT9ffLRfcDizTh7foYM+IwvoX2HHAINKHPwd
	vQ9QAIuWeNzhTv/rvmz2gLXjswRdKPPk6leiap31LpXii6uAyhxS1gDpiDwq0p7WzECnp7qOO
X-Gm-Gg: AY/fxX7oDmGYKdyuRwzE5PUCg7xSSlNT3wTN7ylK4JSf1nr547J1lWVpFgyughdei51
	kkGoka4tOGoPoFmVGAj4IDbYA+xKo0o4MJY/qLio1xUOrg32GNdDT3uuEM4QySLlwV0Op41PeAS
	dkyky4Rj7BKdC92LBQQNhfS8JOAS+TgYsD26ur/4PheU93Sipv0+5xjWOvQ9XDGKvluJbHTnCiD
	FX5bD/EYKYhjTkqhlzxcNWZCIvgkfshNxEnZ/DWl43nL/1dQmyDZwMU3BaEdg4QZOqtAE+exw78
	rX8sfwKVoP+IoSXUpMzJk8jsyv7vp3VCflgoJpgfB+SW9AgLl/iWze3LBYQf8GLhqUtMuiMMhoE
	MMXRA3tCEFlVVMvFZdVpZaO2uovv519SrNWep5dDM
X-Received: by 2002:a17:902:ebc8:b0:2a0:9238:881d with SMTP id
 d9443c01a7336-2a700a1c29fmr37564615ad.15.1768494867291;
        Thu, 15 Jan 2026 08:34:27 -0800 (PST)
X-Received: by 2002:a17:902:ebc8:b0:2a0:9238:881d with SMTP id
 d9443c01a7336-2a700a1c29fmr37564245ad.15.1768494866555;
        Thu, 15 Jan 2026 08:34:26 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d9443c01a7336-2a717d0f2basm86745ad.54.2026.01.15.08.34.24
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 15 Jan 2026 08:34:26 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com
Subject: [PATCH v3 27/27] tests: Add EPPKE authentication test cases
Date: Thu, 15 Jan 2026 22:03:06 +0530
Message-Id: <20260115163306.367753-28-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
References: <20260115163306.367753-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Authority-Analysis: v=2.4 cv=FI4WBuos c=1 sm=1 tr=0 ts=69691714 cx=c_pps
 a=Qgeoaf8Lrialg5Z894R3/Q==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=0chnKcmidDEIn7bz1UYA:9 a=OBVObgAlTMPheNul:21
 a=x9snwWr2DeNwDh03kgHS:22
X-Proofpoint-GUID: qEtmMWtStUbKCId1OGY-wmW8L1_GY44b
X-Proofpoint-ORIG-GUID: qEtmMWtStUbKCId1OGY-wmW8L1_GY44b
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTE1MDEyNiBTYWx0ZWRfX+9+CbpbGAG2R
 r+10gTptltK3NaOFjubSWTtxvcC6Hz+mKxc64pjHa8VTbu2esYFKndDpYx+Vc96WN3/IKYwkv1K
 gOUnoIA/ycNeEWa/jLBeVuPq1yaEry+BZggxTczeFzWe4borefnIPZ2267PVATMdzPaNtvhsVVv
 xDA8seC5c0xdRHfMsRCC64Sf8ewkR6E3cY0e0GYoHdxuzuf+kVtld7TLWEG3TCfhptFx2VuEXVN
 tSHGaRZOQ/c89zkXxDob/N67yWkbqiKbp9A4wk+LfWlq2nZSLk/e8Q/zqGfCmEcDTyiybPQJg9o
 u91mdnzbPD+cwWhf3MOH/5JiDfPV5zCMUEmQAK9dps7wgGFnkzOJJOHr/kzVE4eMnZJFxewgeEk
 PliGJ+CuBQX/i2y8WY2dre2GccUyg0js+s4dmUWJCt/JlOfL60+GlL0IBJJbJ+kZsCfstBZG4NM
 QTdS9xboiili8IfhYzQ==
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-15_05,2026-01-15_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 impostorscore=0 clxscore=1015 phishscore=0 spamscore=0 priorityscore=1501
 suspectscore=0 adultscore=0 malwarescore=0 lowpriorityscore=0 bulkscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601150126
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260115_085330_926771_8D6EC56E 
X-CRM114-Status: GOOD (  16.46  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com> Add
 hwsim
    test cases to verify EPPKE authentication, including (Re)Association frame
    encryption in multi-link and legacy 11ax scenarios. Tests cover AP and MLD
    configurations with SAE and SAE-EXT-KEY [...]
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.168.131 listed in
 bl.score.senderscore.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.168.131 listed in
 sa-trusted.bondedsender.org]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.168.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.168.131 listed in
 sa-accredit.habeas.com]
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.0 SPF_PASS               SPF: sender matches SPF record
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

Add hwsim test cases to verify EPPKE authentication,
including (Re)Association frame encryption in
multi-link and legacy 11ax scenarios. Tests cover AP and
MLD configurations with SAE and SAE-EXT-KEY base AKMs,
SAE-EXT-KEY AKM with different groups, PMKSA Caching,
validating RSNXE flags, AKM suite selection, and
authentication algorithm handling.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
---
 tests/hwsim/test_eppke.py | 675 ++++++++++++++++++++++++++++++++++++++
 1 file changed, 675 insertions(+)
 create mode 100644 tests/hwsim/test_eppke.py

diff --git a/tests/hwsim/test_eppke.py b/tests/hwsim/test_eppke.py
new file mode 100644
index 000000000..e52e96e1e
--- /dev/null
+++ b/tests/hwsim/test_eppke.py
@@ -0,0 +1,675 @@
+# Test cases for Enhanced Privacy Protection Key Exchange(EPPKE)
+# Copyright (c) 2025, Qualcomm Innovation Center, Inc.
+#
+# This software may be distributed under the terms of the BSD license.
+# See README for more details.
+
+import time
+
+import hostapd
+from wpasupplicant import WpaSupplicant
+from utils import *
+from hwsim import HWSimRadio
+from test_eht import eht_mld_ap_wpa2_params, eht_mld_enable_ap, traffic_test, eht_verify_status
+
+def test_eppke_akm_suite_and_rsnxe_feature_flags(dev, apdev):
+    """AP EPPKE AKM Advertisement with SAE base AKM and EPPKE related feature flags"""
+    ssid = "test-eppke-authentication"
+    params = hostapd.wpa3_params(ssid=ssid,
+                                 password = "1234567890")
+    params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+    params['assoc_frame_encryption'] = '1'
+    params['pmksa_caching_privacy'] = '1'
+    params['eap_using_authentication_frames'] = '1'
+    params['sae_pwe'] = '2'
+
+    hapd = hostapd.add_ap(apdev[0], params)
+    time.sleep(2)
+    #TODO: Add pcap file checks to validate correct
+    #RSNXE bits and AKM suite presence in Beacon frames
+
+    #Disable all EPPKE related RSNXE flags and test
+    params['assoc_frame_encryption'] = '0'
+    params['pmksa_caching_privacy'] = '0'
+    params['eap_using_authentication_frames'] = '0'
+    hapd = hostapd.add_ap(apdev[0], params)
+    time.sleep(2)
+
+def test_eppke_ap_with_base_akm_sae_legacy_client(dev, apdev):
+    """EPPKE authentication with a Non-MLO AP with base AKM SAE and legacy client"""
+    ssid = "test-eppke-authentication"
+    passphrase = '1234567890'
+    params = hostapd.wpa3_params(ssid=ssid,
+				 password = passphrase)
+    params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+    params['assoc_frame_encryption'] = '1'
+    params['pmksa_caching_privacy'] = '1'
+    params['eap_using_authentication_frames'] = '1'
+    params['sae_pwe'] = '2'
+    hapd = hostapd.add_ap(apdev[0], params)
+
+    try:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "1")
+        dev[0].connect(ssid, sae_password=passphrase, scan_freq="2412",
+                       key_mgmt="SAE", ieee80211w="2", beacon_prot="1",
+                       pairwise="CCMP")
+        hapd.wait_sta();
+        sta = hapd.get_sta(dev[0].own_addr())
+        if sta["AKMSuiteSelector"] != '00-0f-ac-8' or sta["auth_alg"] != '9':
+            raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+
+    finally:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "0")
+
+def run_eppke_sae_ext_key(dev, apdev, group):
+    """EPPKE authentication with a Non-MLO AP with base AKM SAE-EXT-KEY and legacy client"""
+    ssid = "test-eppke-authentication"
+    passphrase = '1234567890'
+    params = hostapd.wpa3_params(ssid=ssid,
+				 password = passphrase)
+    params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'SAE-EXT-KEY EPPKE'
+    params['assoc_frame_encryption'] = '1'
+    params['pmksa_caching_privacy'] = '1'
+    params['eap_using_authentication_frames'] = '1'
+    params['sae_pwe'] = '2'
+    params['pasn_groups'] = str(group)
+    params['sae_groups'] = str(group)
+    hapd = hostapd.add_ap(apdev[0], params)
+
+    try:
+        dev[0].set("sae_groups", str(group))
+        dev[0].set("sae_pwe", "1")
+        dev[0].connect(ssid, sae_password=passphrase, scan_freq="2412",
+                       key_mgmt="SAE-EXT-KEY", ieee80211w="2", beacon_prot="1",
+                       pairwise="CCMP")
+        hapd.wait_sta();
+        sta = hapd.get_sta(dev[0].own_addr())
+        if sta["AKMSuiteSelector"] != '00-0f-ac-24' or sta["auth_alg"] != '9':
+            raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+
+    finally:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "0")
+
+def test_eppke_ap_with_base_akm_sae_ext_legacy_client_19(dev, apdev):
+    """EPPKE authentication with a Non-MLO AP with base AKM SAE-EXT-KEY and legacy client, group 19"""
+    run_eppke_sae_ext_key(dev, apdev, 19)
+
+def test_eppke_ap_with_base_akm_sae_ext_legacy_client_20(dev, apdev):
+    """EPPKE authentication with a Non-MLO AP with base AKM SAE-EXT-KEY and legacy client, group 20"""
+    run_eppke_sae_ext_key(dev, apdev, 20)
+
+def test_eppke_ap_with_base_akm_sae_ext_legacy_client_21(dev, apdev):
+    """EPPKE authentication with a Non-MLO AP with base AKM SAE-EXT-KEY and legacy client, group 21"""
+    run_eppke_sae_ext_key(dev, apdev, 21)
+
+def test_eppke_mld_ap_with_base_akm_sae_legacy_client(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE and legacy client"""
+    with HWSimRadio(use_mlo=True) as (hapd_radio, hapd_iface):
+        passphrase = '1234567890'
+        ssid = "test-eppke-authentication"
+        params = eht_mld_ap_wpa2_params(ssid, passphrase,
+                                        key_mgmt="SAE", mfp="2", pwe='1')
+        params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+        params['assoc_frame_encryption'] = '1'
+        params['pmksa_caching_privacy'] = '1'
+        params['eap_using_authentication_frames'] = '1'
+        params['rsn_pairwise'] = "CCMP GCMP-256"
+
+        hapd0 = eht_mld_enable_ap(hapd_iface, 0, params)
+
+        params['channel'] = '6'
+        hapd1 = eht_mld_enable_ap(hapd_iface, 1, params)
+
+        try:
+            dev[0].set("sae_groups", "")
+            dev[0].set("sae_pwe", "1")
+            dev[0].connect(ssid, sae_password=passphrase, scan_freq="2412",
+                           key_mgmt="SAE", ieee80211w="2", beacon_prot="1",
+                           pairwise="CCMP GCMP-256")
+            bssid = dev[0].get_status_field("bssid")
+            if hapd0.own_addr() == bssid:
+                hapd0.wait_sta();
+                sta = hapd0.get_sta(dev[0].own_addr())
+                if sta["AKMSuiteSelector"] != '00-0f-ac-8' or sta["auth_alg"] != '9':
+                    raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+            elif hapd1.own_addr() == bssid:
+                hapd1.wait_sta();
+                sta = hapd1.get_sta(dev[0].own_addr())
+                if sta["AKMSuiteSelector"] != '00-0f-ac-8' or sta["auth_alg"] != '9':
+                    raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+            else:
+                raise Exception("Unknown BSSID: " + bssid)
+        finally:
+            dev[0].set("sae_groups", "")
+            dev[0].set("sae_pwe", "0")
+
+def test_eppke_mld_ap_with_base_akm_sae_ext_legacy_client(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE-EXT and legacy client"""
+    with HWSimRadio(use_mlo=True) as (hapd_radio, hapd_iface):
+        passphrase = '1234567890'
+        ssid = "test-eppke-authentication"
+        params = eht_mld_ap_wpa2_params(ssid, passphrase,
+                                        key_mgmt="SAE-EXT-KEY", mfp="2", pwe='1')
+        params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+        params['assoc_frame_encryption'] = '1'
+        params['pmksa_caching_privacy'] = '1'
+        params['eap_using_authentication_frames'] = '1'
+        params['rsn_pairwise'] = "CCMP GCMP-256"
+        hapd0 = eht_mld_enable_ap(hapd_iface, 0, params)
+
+        params['channel'] = '6'
+        hapd1 = eht_mld_enable_ap(hapd_iface, 1, params)
+
+        try:
+            dev[0].set("sae_groups", "")
+            dev[0].set("sae_pwe", "1")
+            dev[0].connect(ssid, sae_password=passphrase, scan_freq="2412",
+                           key_mgmt="SAE-EXT-KEY", ieee80211w="2", beacon_prot="1",
+                           pairwise="CCMP GCMP-256")
+            bssid = dev[0].get_status_field("bssid")
+            if hapd0.own_addr() == bssid:
+                hapd0.wait_sta();
+                sta = hapd0.get_sta(dev[0].own_addr())
+                if sta["AKMSuiteSelector"] != '00-0f-ac-24' or sta["auth_alg"] != '9':
+                    raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+            elif hapd1.own_addr() == bssid:
+                hapd1.wait_sta();
+                sta = hapd1.get_sta(dev[0].own_addr())
+                if sta["AKMSuiteSelector"] != '00-0f-ac-24' or sta["auth_alg"] != '9':
+                    raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+            else:
+                raise Exception("Unknown BSSID: " + bssid)
+        finally:
+            dev[0].set("sae_groups", "")
+            dev[0].set("sae_pwe", "0")
+
+def run_eppke_mld_two_links(dev, apdev, key_mgmt):
+    with HWSimRadio(use_mlo=True) as (hapd_radio, hapd_iface), \
+        HWSimRadio(use_mlo=True) as (wpas_radio, wpas_iface):
+
+        wpas = WpaSupplicant(global_iface='/tmp/wpas-wlan5')
+        wpas.interface_add(wpas_iface)
+
+        passphrase = '1234567890'
+        ssid = "test-eppke-authentication"
+        params = eht_mld_ap_wpa2_params(ssid, passphrase,
+                                        key_mgmt=key_mgmt, mfp="2", pwe='1',
+                                        beacon_prot=1)
+        params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+        params['assoc_frame_encryption'] = '1'
+        params['pmksa_caching_privacy'] = '1'
+        params['eap_using_authentication_frames'] = '1'
+        params['rsn_pairwise'] = "CCMP GCMP-256"
+        hapd0 = eht_mld_enable_ap(hapd_iface, 0, params)
+
+        params['channel'] = '6'
+        hapd1 = eht_mld_enable_ap(hapd_iface, 1, params)
+
+        wpas.set("sae_groups", "")
+        wpas.set("sae_pwe", "1")
+        wpas.connect(ssid, sae_password=passphrase, scan_freq="2412 2437",
+                     key_mgmt=key_mgmt, ieee80211w="2", beacon_prot="1",
+                     pairwise="CCMP GCMP-256")
+        eht_verify_status(wpas, hapd0, 2412, 20, is_ht=True, mld=True,
+                          valid_links=3, active_links=3)
+
+def run_eppke_mld_one_link(dev, apdev, key_mgmt):
+    with HWSimRadio(use_mlo=True) as (hapd_radio, hapd_iface), \
+        HWSimRadio(use_mlo=True) as (wpas_radio, wpas_iface):
+
+        wpas = WpaSupplicant(global_iface='/tmp/wpas-wlan5')
+        wpas.interface_add(wpas_iface)
+
+        passphrase = '1234567890'
+        ssid = "test-eppke-authentication"
+        params = eht_mld_ap_wpa2_params(ssid, passphrase,
+                                        key_mgmt=key_mgmt, mfp="2", pwe='1',
+                                        beacon_prot=1)
+        params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+        params['assoc_frame_encryption'] = '1'
+        params['pmksa_caching_privacy'] = '1'
+        params['eap_using_authentication_frames'] = '1'
+        params['rsn_pairwise'] = "CCMP GCMP-256"
+        hapd0 = eht_mld_enable_ap(hapd_iface, 0, params)
+
+        wpas.set("sae_groups", "")
+        wpas.set("sae_pwe", "1")
+        wpas.connect(ssid, sae_password=passphrase, scan_freq="2412",
+                     key_mgmt=key_mgmt, ieee80211w="2", beacon_prot="1",
+                     pairwise="CCMP GCMP-256")
+        eht_verify_status(wpas, hapd0, 2412, 20, is_ht=True, mld=True,
+                          valid_links=1, active_links=1)
+
+def test_eppke_with_base_akm_sae_single_link(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE and MLD client using single link"""
+    run_eppke_mld_one_link(dev, apdev, key_mgmt="SAE")
+
+def test_eppke_with_base_akm_sae_ext_single_link(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE-EXT and MLD client using single link"""
+    run_eppke_mld_one_link(dev, apdev, key_mgmt="SAE-EXT-KEY")
+
+def test_eppke_with_base_akm_sae_two_link(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE and MLD client using two links"""
+    run_eppke_mld_two_links(dev, apdev, key_mgmt="SAE")
+
+def test_eppke_with_base_akm_sae_ext_two_link(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE-EXT and MLD client using two links"""
+    run_eppke_mld_two_links(dev, apdev, key_mgmt="SAE-EXT-KEY")
+
+def test_eppke_ap_with_base_akm_sae_legacy_client_pmksa_cached(dev, apdev):
+    """EPPKE authentication with a Non-MLO AP with base AKM SAE and legacy client with PMKSA Caching"""
+    ssid = "test-eppke-authentication"
+    passphrase = '1234567890'
+    params = hostapd.wpa3_params(ssid=ssid,
+            password = passphrase)
+    params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+    params['assoc_frame_encryption'] = '1'
+    params['pmksa_caching_privacy'] = '1'
+    params['eap_using_authentication_frames'] = '1'
+    params['sae_pwe'] = '2'
+    hapd = hostapd.add_ap(apdev[0], params)
+
+    try:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "1")
+        dev[0].connect(ssid, sae_password=passphrase, scan_freq="2412",
+                key_mgmt="SAE", ieee80211w="2", beacon_prot="1",
+                pairwise="CCMP")
+        hapd.wait_sta();
+        sta = hapd.get_sta(dev[0].own_addr())
+        if sta["AKMSuiteSelector"] != '00-0f-ac-8' or sta["auth_alg"] != '9':
+            raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+
+        dev[0].request("DISCONNECT")
+        dev[0].wait_disconnected()
+        dev[0].request("RECONNECT")
+        dev[0].wait_connected(timeout=15, error="Reconnect timed out")
+        val = dev[0].get_status_field('sae_group')
+        if val is not None:
+            raise Exception("SAE group claimed to have been used: " + val)
+        sta = hapd.get_sta(dev[0].own_addr())
+        if sta['auth_alg'] != '9' or sta['AKMSuiteSelector'] != '00-0f-ac-8':
+            raise Exception("Incorrect Auth Algo/AKMSuiteSelector value after PMKSA caching")
+
+    finally:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "0")
+
+def test_eppke_ap_with_base_akm_sae_ext_legacy_client_pmksa_cached(dev, apdev):
+    """EPPKE authentication with a Non-MLO AP with base AKM SAE-EXT-KEY and legacy client"""
+    ssid = "test-eppke-authentication"
+    passphrase = '1234567890'
+    params = hostapd.wpa3_params(ssid=ssid,
+				 password = passphrase)
+    params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'SAE-EXT-KEY EPPKE'
+    params['assoc_frame_encryption'] = '1'
+    params['pmksa_caching_privacy'] = '1'
+    params['eap_using_authentication_frames'] = '1'
+    params['sae_pwe'] = '2'
+    hapd = hostapd.add_ap(apdev[0], params)
+
+    try:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "1")
+        dev[0].connect(ssid, sae_password=passphrase, scan_freq="2412",
+                       key_mgmt="SAE-EXT-KEY", ieee80211w="2", beacon_prot="1",
+                       pairwise="CCMP")
+        hapd.wait_sta();
+        sta = hapd.get_sta(dev[0].own_addr())
+        if sta["AKMSuiteSelector"] != '00-0f-ac-24' or sta["auth_alg"] != '9':
+            raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+
+        dev[0].request("DISCONNECT")
+        dev[0].wait_disconnected()
+        dev[0].request("RECONNECT")
+        dev[0].wait_connected(timeout=15, error="Reconnect timed out")
+        val = dev[0].get_status_field('sae_group')
+        if val is not None:
+            raise Exception("SAE group claimed to have been used: " + val)
+        sta = hapd.get_sta(dev[0].own_addr())
+        if sta['auth_alg'] != '9' or sta['AKMSuiteSelector'] != '00-0f-ac-24':
+            raise Exception("Incorrect Auth Algo/AKMSuiteSelector value after PMKSA caching")
+
+    finally:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "0")
+
+def test_eppke_mld_ap_with_base_akm_sae_legacy_client_pmksa_cached(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE and legacy client"""
+    with HWSimRadio(use_mlo=True) as (hapd_radio, hapd_iface):
+        passphrase = '1234567890'
+        ssid = "test-eppke-authentication"
+        params = eht_mld_ap_wpa2_params(ssid, passphrase,
+                                        key_mgmt="SAE", mfp="2", pwe='1')
+        params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+        params['assoc_frame_encryption'] = '1'
+        params['pmksa_caching_privacy'] = '1'
+        params['eap_using_authentication_frames'] = '1'
+        params['rsn_pairwise'] = "CCMP GCMP-256"
+
+        hapd0 = eht_mld_enable_ap(hapd_iface, 0, params)
+
+        params['channel'] = '6'
+        hapd1 = eht_mld_enable_ap(hapd_iface, 1, params)
+
+        try:
+            dev[0].set("sae_groups", "")
+            dev[0].set("sae_pwe", "1")
+            dev[0].connect(ssid, sae_password=passphrase, scan_freq="2412",
+                           key_mgmt="SAE", ieee80211w="2", beacon_prot="1",
+                           pairwise="CCMP GCMP-256")
+            bssid = dev[0].get_status_field("bssid")
+            if hapd0.own_addr() == bssid:
+                hapd0.wait_sta();
+                sta = hapd0.get_sta(dev[0].own_addr())
+                if sta["AKMSuiteSelector"] != '00-0f-ac-8' or sta["auth_alg"] != '9':
+                    raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+            elif hapd1.own_addr() == bssid:
+                hapd1.wait_sta();
+                sta = hapd1.get_sta(dev[0].own_addr())
+                if sta["AKMSuiteSelector"] != '00-0f-ac-8' or sta["auth_alg"] != '9':
+                    raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+            else:
+                raise Exception("Unknown BSSID: " + bssid)
+
+            dev[0].request("DISCONNECT")
+            dev[0].wait_disconnected()
+            dev[0].request("RECONNECT")
+            dev[0].wait_connected(timeout=15, error="Reconnect timed out")
+            val = dev[0].get_status_field('sae_group')
+            if val is not None:
+                raise Exception("SAE group claimed to have been used: " + val)
+
+            bssid = dev[0].get_status_field("bssid")
+            if hapd0.own_addr() == bssid:
+                hapd0.wait_sta();
+                sta = hapd0.get_sta(dev[0].own_addr())
+            elif hapd1.own_addr() == bssid:
+                hapd1.wait_sta();
+                sta = hapd1.get_sta(dev[0].own_addr())
+            else:
+                raise Exception("Unknown BSSID: " + bssid)
+
+            if sta['auth_alg'] != '9' or sta['AKMSuiteSelector'] != '00-0f-ac-8':
+                raise Exception("Incorrect Auth Algo/AKMSuiteSelector value after PMKSA caching")
+
+        finally:
+            dev[0].set("sae_groups", "")
+            dev[0].set("sae_pwe", "0")
+
+def test_eppke_mld_ap_with_base_akm_sae_ext_legacy_client_pmksa_cached(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE-EXT and legacy client"""
+    with HWSimRadio(use_mlo=True) as (hapd_radio, hapd_iface):
+        passphrase = '1234567890'
+        ssid = "test-eppke-authentication"
+        params = eht_mld_ap_wpa2_params(ssid, passphrase,
+                                        key_mgmt="SAE-EXT-KEY", mfp="2", pwe='1')
+        params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+        params['assoc_frame_encryption'] = '1'
+        params['pmksa_caching_privacy'] = '1'
+        params['eap_using_authentication_frames'] = '1'
+        params['rsn_pairwise'] = "CCMP GCMP-256"
+        hapd0 = eht_mld_enable_ap(hapd_iface, 0, params)
+
+        params['channel'] = '6'
+        hapd1 = eht_mld_enable_ap(hapd_iface, 1, params)
+
+        try:
+            dev[0].set("sae_groups", "")
+            dev[0].set("sae_pwe", "1")
+            dev[0].connect(ssid, sae_password=passphrase, scan_freq="2412",
+                           key_mgmt="SAE-EXT-KEY", ieee80211w="2", beacon_prot="1",
+                           pairwise="CCMP GCMP-256")
+            bssid = dev[0].get_status_field("bssid")
+            if hapd0.own_addr() == bssid:
+                hapd0.wait_sta();
+                sta = hapd0.get_sta(dev[0].own_addr())
+                if sta["AKMSuiteSelector"] != '00-0f-ac-24' or sta["auth_alg"] != '9':
+                    raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+            elif hapd1.own_addr() == bssid:
+                hapd1.wait_sta();
+                sta = hapd1.get_sta(dev[0].own_addr())
+                if sta["AKMSuiteSelector"] != '00-0f-ac-24' or sta["auth_alg"] != '9':
+                    raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+            else:
+                raise Exception("Unknown BSSID: " + bssid)
+
+            dev[0].request("DISCONNECT")
+            dev[0].wait_disconnected()
+            dev[0].request("RECONNECT")
+            dev[0].wait_connected(timeout=15, error="Reconnect timed out")
+            val = dev[0].get_status_field('sae_group')
+            if val is not None:
+                raise Exception("SAE group claimed to have been used: " + val)
+
+            bssid = dev[0].get_status_field("bssid")
+            if hapd0.own_addr() == bssid:
+                hapd0.wait_sta();
+                sta = hapd0.get_sta(dev[0].own_addr())
+            elif hapd1.own_addr() == bssid:
+                hapd1.wait_sta();
+                sta = hapd1.get_sta(dev[0].own_addr())
+            else:
+                raise Exception("Unknown BSSID: " + bssid)
+
+            if sta['auth_alg'] != '9' or sta['AKMSuiteSelector'] != '00-0f-ac-24':
+                raise Exception("Incorrect Auth Algo/AKMSuiteSelector value after PMKSA caching")
+
+        finally:
+            dev[0].set("sae_groups", "")
+            dev[0].set("sae_pwe", "0")
+
+def run_eppke_mld_one_link_pmksa_cached(dev, apdev, key_mgmt):
+    with HWSimRadio(use_mlo=True) as (hapd_radio, hapd_iface), \
+        HWSimRadio(use_mlo=True) as (wpas_radio, wpas_iface):
+
+        wpas = WpaSupplicant(global_iface='/tmp/wpas-wlan5')
+        wpas.interface_add(wpas_iface)
+
+        passphrase = '1234567890'
+        ssid = "test-eppke-authentication"
+        params = eht_mld_ap_wpa2_params(ssid, passphrase,
+                                        key_mgmt=key_mgmt, mfp="2", pwe='1',
+                                        beacon_prot=1)
+        params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+        params['assoc_frame_encryption'] = '1'
+        params['pmksa_caching_privacy'] = '1'
+        params['eap_using_authentication_frames'] = '1'
+        params['rsn_pairwise'] = "CCMP GCMP-256"
+        hapd0 = eht_mld_enable_ap(hapd_iface, 0, params)
+
+        wpas.set("sae_groups", "")
+        wpas.set("sae_pwe", "1")
+        wpas.connect(ssid, sae_password=passphrase, scan_freq="2412",
+                     key_mgmt=key_mgmt, ieee80211w="2", beacon_prot="1",
+                     pairwise="CCMP GCMP-256")
+        eht_verify_status(wpas, hapd0, 2412, 20, is_ht=True, mld=True,
+                          valid_links=1, active_links=1)
+
+        wpas.request("DISCONNECT")
+        wpas.wait_disconnected()
+        wpas.request("RECONNECT")
+        wpas.wait_connected(timeout=15, error="Reconnect timed out")
+        val = wpas.get_status_field('sae_group')
+        if val is not None:
+            raise Exception("SAE group claimed to have been used: " + val)
+        eht_verify_status(wpas, hapd0, 2412, 20, is_ht=True, mld=True,
+                          valid_links=1, active_links=1)
+
+def test_eppke_with_base_akm_sae_single_link_pmksa_cached(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE and MLD client using single link"""
+    run_eppke_mld_one_link_pmksa_cached(dev, apdev, key_mgmt="SAE")
+
+def test_eppke_with_base_akm_sae_ext_single_link_pmksa_cached(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE-EXT and MLD client using single link"""
+    run_eppke_mld_one_link_pmksa_cached(dev, apdev, key_mgmt="SAE-EXT-KEY")
+
+def run_eppke_mld_two_links_pmksa_cached(dev, apdev, key_mgmt):
+    with HWSimRadio(use_mlo=True) as (hapd_radio, hapd_iface), \
+        HWSimRadio(use_mlo=True) as (wpas_radio, wpas_iface):
+
+        wpas = WpaSupplicant(global_iface='/tmp/wpas-wlan5')
+        wpas.interface_add(wpas_iface)
+
+        passphrase = '1234567890'
+        ssid = "test-eppke-authentication"
+        params = eht_mld_ap_wpa2_params(ssid, passphrase,
+                                        key_mgmt=key_mgmt, mfp="2", pwe='1',
+                                        beacon_prot=1)
+        params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+        params['assoc_frame_encryption'] = '1'
+        params['pmksa_caching_privacy'] = '1'
+        params['eap_using_authentication_frames'] = '1'
+        params['rsn_pairwise'] = "CCMP GCMP-256"
+        hapd0 = eht_mld_enable_ap(hapd_iface, 0, params)
+
+        params['channel'] = '6'
+        hapd1 = eht_mld_enable_ap(hapd_iface, 1, params)
+
+        wpas.set("sae_groups", "")
+        wpas.set("sae_pwe", "1")
+        wpas.connect(ssid, sae_password=passphrase, scan_freq="2412 2437",
+                     key_mgmt=key_mgmt, ieee80211w="2", beacon_prot="1",
+                     pairwise="CCMP GCMP-256")
+        eht_verify_status(wpas, hapd0, 2412, 20, is_ht=True, mld=True,
+                          valid_links=3, active_links=3)
+
+        wpas.request("DISCONNECT")
+        wpas.wait_disconnected()
+        wpas.request("RECONNECT")
+        wpas.wait_connected(timeout=15, error="Reconnect timed out")
+        val = wpas.get_status_field('sae_group')
+        if val is not None:
+            raise Exception("SAE group claimed to have been used: " + val)
+        eht_verify_status(wpas, hapd0, 2412, 20, is_ht=True, mld=True,
+                          valid_links=3, active_links=3)
+
+def test_eppke_with_base_akm_sae_two_link_pmksa_cached(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE and MLD client using two links"""
+    run_eppke_mld_two_links_pmksa_cached(dev, apdev, key_mgmt="SAE")
+
+def test_eppke_with_base_akm_sae_ext_two_link_pmksa_cached(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE-EXT and MLD client using two links"""
+    run_eppke_mld_two_links_pmksa_cached(dev, apdev, key_mgmt="SAE-EXT-KEY")
+
+def test_eppke_ap_gtk_rekey_with_base_akm_sae_ext_legacy_client(dev, apdev):
+    """EPPKE AP and GTK rekey"""
+    ssid = "test-eppke-authentication"
+    passphrase = '1234567890'
+    params = hostapd.wpa3_params(ssid=ssid,
+				 password = passphrase)
+    params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'SAE-EXT-KEY EPPKE'
+    params['assoc_frame_encryption'] = '1'
+    params['pmksa_caching_privacy'] = '1'
+    params['eap_using_authentication_frames'] = '1'
+    params['sae_pwe'] = '2'
+    params['wpa_group_rekey'] = '1'
+    hapd = hostapd.add_ap(apdev[0], params)
+
+    try:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "1")
+        dev[0].connect(ssid, sae_password=passphrase, scan_freq="2412",
+                       key_mgmt="SAE-EXT-KEY", ieee80211w="2", beacon_prot="1",
+                       pairwise="CCMP")
+        hapd.wait_sta();
+        sta = hapd.get_sta(dev[0].own_addr())
+        if sta["AKMSuiteSelector"] != '00-0f-ac-24' or sta["auth_alg"] != '9':
+            raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+
+    finally:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "0")
+
+def test_eppke_ap_gtk_rekey_with_base_akm_sae_ext_key_one_link(dev, apdev):
+    """EPPKE AP and GTK rekey with MLO AP with 1 link"""
+    with HWSimRadio(use_mlo=True) as (hapd_radio, hapd_iface), \
+        HWSimRadio(use_mlo=True) as (wpas_radio, wpas_iface):
+
+        wpas = WpaSupplicant(global_iface='/tmp/wpas-wlan5')
+        wpas.interface_add(wpas_iface)
+
+        passphrase = '1234567890'
+        ssid = "test-eppke-authentication"
+        params = eht_mld_ap_wpa2_params(ssid, passphrase,
+                                        key_mgmt="SAE-EXT-KEY", mfp="2", pwe='1',
+                                        beacon_prot=1)
+        params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+        params['assoc_frame_encryption'] = '1'
+        params['pmksa_caching_privacy'] = '1'
+        params['eap_using_authentication_frames'] = '1'
+        params['rsn_pairwise'] = "CCMP GCMP-256"
+        params['wpa_group_rekey'] = '1'
+        hapd0 = eht_mld_enable_ap(hapd_iface, 0, params)
+
+        wpas.set("sae_groups", "")
+        wpas.set("sae_pwe", "1")
+        wpas.connect(ssid, sae_password=passphrase, scan_freq="2412",
+                     key_mgmt="SAE-EXT-KEY", ieee80211w="2", beacon_prot="1",
+                     pairwise="CCMP GCMP-256")
+        eht_verify_status(wpas, hapd0, 2412, 20, is_ht=True, mld=True,
+                          valid_links=1, active_links=1)
+
+def test_eppke_ap_gtk_rekey_with_base_akm_sae_ext_key_two_link(dev, apdev):
+    """EPPKE AP and GTK rekey with MLO AP with 2 links"""
+    with HWSimRadio(use_mlo=True) as (hapd_radio, hapd_iface), \
+        HWSimRadio(use_mlo=True) as (wpas_radio, wpas_iface):
+
+        wpas = WpaSupplicant(global_iface='/tmp/wpas-wlan5')
+        wpas.interface_add(wpas_iface)
+
+        passphrase = '1234567890'
+        ssid = "test-eppke-authentication"
+        params = eht_mld_ap_wpa2_params(ssid, passphrase,
+                                        key_mgmt="SAE-EXT-KEY", mfp="2", pwe='1',
+                                        beacon_prot=1)
+        params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+        params['assoc_frame_encryption'] = '1'
+        params['pmksa_caching_privacy'] = '1'
+        params['eap_using_authentication_frames'] = '1'
+        params['rsn_pairwise'] = "CCMP GCMP-256"
+        params['wpa_group_rekey'] = '1'
+        hapd0 = eht_mld_enable_ap(hapd_iface, 0, params)
+
+        params['channel'] = '6'
+        hapd1 = eht_mld_enable_ap(hapd_iface, 1, params)
+
+        wpas.set("sae_groups", "")
+        wpas.set("sae_pwe", "1")
+        wpas.connect(ssid, sae_password=passphrase, scan_freq="2412 2437",
+                     key_mgmt="SAE-EXT-KEY", ieee80211w="2", beacon_prot="1",
+                     pairwise="CCMP GCMP-256")
+        eht_verify_status(wpas, hapd0, 2412, 20, is_ht=True, mld=True,
+                          valid_links=3, active_links=3)
+
+def test_eppke_ap_ptk_rekey_with_base_akm_sae_ext_legacy_client(dev, apdev):
+    """EPPKE AP and PTK rekey"""
+    ssid = "test-eppke-authentication"
+    passphrase = '1234567890'
+    params = hostapd.wpa3_params(ssid=ssid,
+				 password = passphrase)
+    params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'SAE-EXT-KEY EPPKE'
+    params['assoc_frame_encryption'] = '1'
+    params['pmksa_caching_privacy'] = '1'
+    params['eap_using_authentication_frames'] = '1'
+    params['sae_pwe'] = '2'
+    params['wpa_ptk_rekey'] = '2'
+    hapd = hostapd.add_ap(apdev[0], params)
+
+    try:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "1")
+        dev[0].connect(ssid, sae_password=passphrase, scan_freq="2412",
+                       key_mgmt="SAE-EXT-KEY", ieee80211w="2", beacon_prot="1",
+                       pairwise="CCMP")
+        hapd.wait_sta();
+        sta = hapd.get_sta(dev[0].own_addr())
+        if sta["AKMSuiteSelector"] != '00-0f-ac-24' or sta["auth_alg"] != '9':
+            raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+
+    finally:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "0")
