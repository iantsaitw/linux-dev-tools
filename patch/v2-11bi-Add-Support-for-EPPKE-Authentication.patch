From patchwork Tue Jan  6 13:45:11 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180389
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=X5YDSzzo;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=Xgdiujcw;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=UwVMg1fa;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlssJ0Xcvz1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:46:44 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=9VlCSXnsMgrFMKfy0PkwwJEfSqv8lDC2QCOmM4urBWA=; b=X5YDSzzobftggN
	d4FQ4E44xCkhHaDnTZFu498Re0scUF3wzVly1sVwJsTLq6FK126s2b5VbMjyPDplsdkAa4yHjjaEL
	q8gnIJKmCJpChMKbHUbjK+xHEfahZlt0lbnPiIsJNEsCx6noANVc6Kr+dxGOKEpajqmX18lk+TV1U
	/dGnmCCbT6KhufrfWoNsV2m0BAyebGXb2iAsEyYGHl4XKcsP1rz5x7l/9iD34KcGFDO4a63ZehK+u
	TSlZgCPHkxQEIs1UQq7jqTP9NjfV3R/qOZ7b3gttSXMnGPQ6u/Za0FgrAr/z7RPhAgbr9Eh/Snmdg
	3dvPD1QzbrXdQun8WDvw==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Nr-0000000D7Sf-0b3c;
	Tue, 06 Jan 2026 13:46:03 +0000
Received: from mx0a-0031df01.pphosted.com ([205.220.168.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Nk-0000000D7RC-3Wjy
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:00 +0000
Received: from pps.filterd (m0279862.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606AhbBE3271609
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:45:56 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:content-type:date:from:in-reply-to
	:message-id:mime-version:references:subject:to; s=qcppdkim1; bh=
	ceexur8D+M58krTh5zp6CjZahc/lA8Gd5eF+xtxbhkc=; b=Xgdiujcwnt0upr3v
	vM+9JM/LRGgsZ5e/a7R4WJWNMC3vnKLLKSMJ6rKd2kWy+/GvDT9K/wasysqqTWfR
	xdF+kopEVeD79ixcuZATEp8DCeUv6kVx7Zm9W1Q/E2Tw9SvDXXlov3I9+XxlD3LE
	KIEpf+nBWiDvgWXQFSQHX2Wdz8W/HM5pxYD8pD5CTcOvafwOi6FglKtSFhnRAj+c
	jiDgxDWKYA6E1U8mM0i9mEgBhIxEx7duJhlcTj0XfQvBJORY+bORDNSql/2yu4x4
	b8uqVZcnJcu5kfKW+U3Jnv8h8ekX6kSdobYbhBH4WTNw1ZewgUonzzvCXxaTerQI
	OLnRgg==
Received: from mail-pf1-f197.google.com (mail-pf1-f197.google.com
 [209.85.210.197])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgfv03f3v-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:45:56 +0000 (GMT)
Received: by mail-pf1-f197.google.com with SMTP id
 d2e1a72fcca58-7b8a12f0cb4so1195875b3a.3
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:45:55 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707155; x=1768311955;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=ceexur8D+M58krTh5zp6CjZahc/lA8Gd5eF+xtxbhkc=;
        b=UwVMg1faYyh7bsSGZllv9E8aTkGrP3YOzY0RKaMD4ZunhRUmLzhZFeP0vNKHTiyRHO
         tTNWV59d0RFTkLluMCgZ/uD21hNgxsdohFtwKEA6XN+OygAjyP/DyJqR+mGoaXI9UHFE
         bzRIS4/bpTDUM5MO/1ZhfkvhIInEuKdF5WtDEMmiIn1O7BdaFtRIm6O9oSgXXmp1725a
         95hpWbfYbP05EvbUTxxT2HrJLSNBS3r1X9urn3bhEPDjGIzzXEo8YQk9pHZP705kFNh9
         d21Yc+cIJqrutcZ+O6mwbCDCYETbJnuDLb/2J9nPxOnduvMgIabl6Xld8YKlKGoXnmJ7
         eLoQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707155; x=1768311955;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=ceexur8D+M58krTh5zp6CjZahc/lA8Gd5eF+xtxbhkc=;
        b=F/P1WVg1d1oxUt1N2hb/kqfYG3sazdVGAWx5RG3uCvvtzVSSOfZZ+cn5hLeLnOnvaK
         eGqLAJlR1fcHJtFxAZxTfZxwLFn51ExhAysKXac6AntlLmdN5uoRNratpJ5Px74RyFZZ
         vz2X0HS/0o3qZg5pRf2r9kXAMYaQfT6nJXaAqY9vTxfC2r8O+7wvM95v+NzxQz8eG49p
         4MtOf7m9x3j2PMiTr8ecmkJhXwAgCsnFRCrsU7VZzpxUmVZhhs3Cjz/jOmzbCViUZMWK
         RJgfSA55xoN/sntul7Jqufp7cppWO1cy+oHzhpgPptznR+kZcWmjHFAxH3kYL9C9aLUR
         FFMA==
X-Gm-Message-State: AOJu0YyUqaZkdYUI7eH+nbPeLncesHhS/T0pTEwAqyJn/SeDzk1Z82+f
	beJ/AF48+WH8c0skQD+ypkVgP5uaXn4exWck1VzbU9dmJlreo7ivGnddVDdo69y0pmeaTMWn/nW
	iVJPxyJUlEd+/VXujY6MbuooyVdh9ZN3eJUpDOvQdZQKAM5+chyeXRZqvFNYbAFDz5+buAWIT
X-Gm-Gg: AY/fxX6KsSK12BDZHVeBxy9FLu72vnJxoxencimGp+rp8FIUuvJX1TQijHMmZn1CWQo
	i/ICVA4JF0FEMGbxHSagRpENsCf4oDIvaEwln249NkM7+lXuWOpJfNWu+Y3eaqBmyMNCmAekkvP
	PYk8ZGkrUf88yzQMKM6cOzGdGwcFg6xc6e4kc1+3L1R+wH0FrLGGiP0+FWZh5hbgLs3OLgz4I7g
	psFHl91UEvxNZu3mmJ/6qwUlJSYLEVc2hGTY1TNlk8Cnw0UmWrGOgE8nzNVFvtBkfjpLI6uit8b
	GC+txTPnqii5nZoF36F6LbswUCfluMmQB213DUeD3AZPnQY0VtZK9eZinahJHNduk2WgudfBKj3
	JJ6QOnPPqXxAkiGvnvIA7tlebxwJFP6w8iJFkVzAK
X-Received: by 2002:a05:6a00:440c:b0:7e8:43f5:bd4f with SMTP id
 d2e1a72fcca58-8187fd80a4cmr2728877b3a.59.1767707154814;
        Tue, 06 Jan 2026 05:45:54 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IHWtJb3Zp5f7BBony7mGwDNzkAw1nx6mBAip+1jdJ4Yjt9BJpKwxHDayQ/8Hk/DEVRwW0vCHA==
X-Received: by 2002:a05:6a00:440c:b0:7e8:43f5:bd4f with SMTP id
 d2e1a72fcca58-8187fd80a4cmr2728846b3a.59.1767707154053;
        Tue, 06 Jan 2026 05:45:54 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.45.52
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:45:53 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 01/28] Sync nl80211_copy.h with wireless-next
 linux/nl80211.h
Date: Tue,  6 Jan 2026 19:15:11 +0530
Message-Id: <20260106134538.2594232-2-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Authority-Analysis: v=2.4 cv=e9YLiKp/ c=1 sm=1 tr=0 ts=695d1214 cx=c_pps
 a=rEQLjTOiSrHUhVqRoksmgQ==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=IkcTkHD0fZMA:10 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10
 a=VkNPw1HP01LnGYTKEx00:22 a=EUspDBNiAAAA:8 a=ECiVajudmbMai59eoo4A:9
 a=3ZKOabzyN94A:10 a=QEXdDO2ut3YA:10 a=2VI0MkxyNR6bbpdq8BZq:22
X-Proofpoint-GUID: cT6oSH_x1_y_TohxnqA1Z5dev3jHWNk7
X-Proofpoint-ORIG-GUID: cT6oSH_x1_y_TohxnqA1Z5dev3jHWNk7
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfX9IewMW9OEtN7
 Eh8GUCWcrTLmJNftVsLyJiL8P1JDDk1btOw7WPM1MDAmO3aD2sgB0ZVKca5NDq899PiDO9zR/fs
 bNMSMLNZiZFjrcAjIRQGOnEEljEQp6PNQE8F4lw6xjjVaBFKM3/57OKYg2Ic21mRfsg9kJDsiX3
 LU3iZBe+NuPreRoumrM0awlIhBaxCFjmJfMwWAs3jv+GCJCa9M+bKUCVKgmZj2Ze1elDCVpZN1f
 xcYH13ScScQ8YpVAbU/h49674r9yyiHKlUFsyuWroNpoo3e9mdRbzm3gkAPmxSegLey8fxfhb3x
 LRBxKQVOUaeaGmxTblrDPj372NJS0AQT1z7qrb59TnsTc9usBUyn/Ezt0AM4fSLSS1WAoV8xI9h
 tOe7PgHQuXaCYYZBvc+juwwe2sq0HGUyiw1/KliOVRVf4IIbCoDWJqU0xNReM4XO87fTE+mubkI
 8oguNKtyWmGMbWCYFcg==
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 clxscore=1015 impostorscore=0 priorityscore=1501 phishscore=0 malwarescore=0
 suspectscore=0 lowpriorityscore=0 spamscore=0 bulkscore=0 adultscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_054556_894831_AA3324BD 
X-CRM114-Status: GOOD (  32.49  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
   Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com> ---
 src/drivers/nl80211_copy.h
    | 355 ++++++++++++++++++++++++++++++++++++- 1 file [...]
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.168.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.168.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.168.131 listed in
 sa-trusted.bondedsender.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.168.131 listed in
 bl.score.senderscore.com]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
---
 src/drivers/nl80211_copy.h | 355 ++++++++++++++++++++++++++++++++++++-
 1 file changed, 349 insertions(+), 6 deletions(-)

diff --git a/src/drivers/nl80211_copy.h b/src/drivers/nl80211_copy.h
index e9ccf43fe..81ada0c3a 100644
--- a/src/drivers/nl80211_copy.h
+++ b/src/drivers/nl80211_copy.h
@@ -1085,8 +1085,9 @@
  *	%NL80211_ATTR_NAN_MASTER_PREF attribute and optional
  *	%NL80211_ATTR_BANDS attributes.  If %NL80211_ATTR_BANDS is
  *	omitted or set to 0, it means don't-care and the device will
- *	decide what to use.  After this command NAN functions can be
- *	added.
+ *	decide what to use. Additional cluster configuration may be
+ *	optionally provided with %NL80211_ATTR_NAN_CONFIG.
+ *	After this command NAN functions can be added.
  * @NL80211_CMD_STOP_NAN: Stop the NAN operation, identified by
  *	its %NL80211_ATTR_WDEV interface.
  * @NL80211_CMD_ADD_NAN_FUNCTION: Add a NAN function. The function is defined
@@ -1115,6 +1116,10 @@
  *	current configuration is not changed.  If it is present but
  *	set to zero, the configuration is changed to don't-care
  *	(i.e. the device can decide what to do).
+ *	Additional parameters may be provided with
+ *	%NL80211_ATTR_NAN_CONFIG. User space should provide all previously
+ *	configured nested attributes under %NL80211_ATTR_NAN_CONFIG, even if
+ *	only a subset was changed.
  * @NL80211_CMD_NAN_MATCH: Notification sent when a match is reported.
  *	This will contain a %NL80211_ATTR_NAN_MATCH nested attribute and
  *	%NL80211_ATTR_COOKIE.
@@ -1330,12 +1335,32 @@
  *      TID to Link mapping for downlink/uplink traffic.
  *
  * @NL80211_CMD_ASSOC_MLO_RECONF: For a non-AP MLD station, request to
- *      add/remove links to/from the association.
+ *      add/remove links to/from the association. To indicate link
+ *      reconfiguration request results from the driver, this command is also
+ *      used as an event to notify userspace about the added links information.
+ *      For notifying the removed links information, the existing
+ *      %NL80211_CMD_LINKS_REMOVED command is used. This command is also used to
+ *      notify userspace about newly added links for the current connection in
+ *      case of AP-initiated link recommendation requests, received via
+ *      a BTM (BSS Transition Management) request or a link reconfig notify
+ *      frame, where the driver handles the link recommendation offload.
  *
  * @NL80211_CMD_EPCS_CFG: EPCS configuration for a station. Used by userland to
  *	control EPCS configuration. Used to notify userland on the current state
  *	of EPCS.
  *
+ * @NL80211_CMD_NAN_NEXT_DW_NOTIFICATION: This command is used to notify
+ *	user space about the next NAN Discovery Window (DW). User space may use
+ *	it to prepare frames to be sent in the next DW.
+ *	%NL80211_ATTR_WIPHY_FREQ is used to indicate the frequency of the next
+ *	DW. SDF transmission should be requested with %NL80211_CMD_FRAME and
+ *	the device/driver shall take care of the actual transmission timing.
+ *	This notification is only sent to the NAN interface owning socket
+ *	(see %NL80211_ATTR_SOCKET_OWNER flag).
+ * @NL80211_CMD_NAN_CLUSTER_JOINED: This command is used to notify
+ *	user space that the NAN new cluster has been joined. The cluster ID is
+ *	indicated by %NL80211_ATTR_MAC.
+ *
  * @NL80211_CMD_MAX: highest used command number
  * @__NL80211_CMD_AFTER_LAST: internal use
  */
@@ -1596,6 +1621,9 @@ enum nl80211_commands {
 	NL80211_CMD_ASSOC_MLO_RECONF,
 	NL80211_CMD_EPCS_CFG,
 
+	NL80211_CMD_NAN_NEXT_DW_NOTIFICATION,
+	NL80211_CMD_NAN_CLUSTER_JOINED,
+
 	/* add new commands above here */
 
 	/* used to define NL80211_CMD_MAX below */
@@ -1935,8 +1963,9 @@ enum nl80211_commands {
  *	The driver must also specify support for this with the extended
  *	features NL80211_EXT_FEATURE_BEACON_RATE_LEGACY,
  *	NL80211_EXT_FEATURE_BEACON_RATE_HT,
- *	NL80211_EXT_FEATURE_BEACON_RATE_VHT and
- *	NL80211_EXT_FEATURE_BEACON_RATE_HE.
+ *	NL80211_EXT_FEATURE_BEACON_RATE_VHT,
+ *	NL80211_EXT_FEATURE_BEACON_RATE_HE and
+ *	NL80211_EXT_FEATURE_BEACON_RATE_EHT.
  *
  * @NL80211_ATTR_FRAME_MATCH: A binary attribute which typically must contain
  *	at least one byte, currently used with @NL80211_CMD_REGISTER_FRAME.
@@ -2275,7 +2304,8 @@ enum nl80211_commands {
  * @NL80211_ATTR_PEER_AID: Association ID for the peer TDLS station (u16).
  *	This is similar to @NL80211_ATTR_STA_AID but with a difference of being
  *	allowed to be used with the first @NL80211_CMD_SET_STATION command to
- *	update a TDLS peer STA entry.
+ *	update a TDLS peer STA entry. For S1G interfaces, this is limited to
+ *	1600 for the current mac80211 implementation.
  *
  * @NL80211_ATTR_COALESCE_RULE: Coalesce rule information.
  *
@@ -2899,6 +2929,57 @@ enum nl80211_commands {
  *	APs Support". Drivers may set additional flags that they support
  *	in the kernel or device.
  *
+ * @NL80211_ATTR_WIPHY_RADIO_INDEX: (int) Integer attribute denoting the index
+ *	of the radio in interest. Internally a value of -1 is used to
+ *	indicate that the radio id is not given in user-space. This means
+ *	that all the attributes are applicable to all the radios. If there is
+ *	a radio index provided in user-space, the attributes will be
+ *	applicable to that specific radio only. If the radio id is greater
+ *	thank the number of radios, error denoting invalid value is returned.
+ *
+ * @NL80211_ATTR_S1G_LONG_BEACON_PERIOD: (u8) Integer attribute that represents
+ *	the number of beacon intervals between each long beacon transmission
+ *	for an S1G BSS with short beaconing enabled. This is a required
+ *	attribute for initialising an S1G short beaconing BSS. When updating
+ *	the short beacon data, this is not required. It has a minimum value of
+ *	2 (i.e 2 beacon intervals).
+ *
+ * @NL80211_ATTR_S1G_SHORT_BEACON: Nested attribute containing the short beacon
+ *	head and tail used to set or update the short beacon templates. When
+ *	bringing up a new interface, %NL80211_ATTR_S1G_LONG_BEACON_PERIOD is
+ *	required alongside this attribute. Refer to
+ *	@enum nl80211_s1g_short_beacon_attrs for the attribute definitions.
+ *
+ * @NL80211_ATTR_BSS_PARAM: nested attribute used with %NL80211_CMD_GET_WIPHY
+ *	which indicates which BSS parameters can be modified. The attribute can
+ *	also be used as flag attribute by user-space in %NL80211_CMD_SET_BSS to
+ *	indicate that it wants strict checking on the BSS parameters to be
+ *	modified.
+ *
+ * @NL80211_ATTR_NAN_CONFIG: Nested attribute for
+ *	extended NAN cluster configuration. This is used with
+ *	%NL80211_CMD_START_NAN and %NL80211_CMD_CHANGE_NAN_CONFIG.
+ *	See &enum nl80211_nan_conf_attributes for details.
+ *	This attribute is optional.
+ * @NL80211_ATTR_NAN_NEW_CLUSTER: Flag attribute indicating that a new
+ *	NAN cluster has been created. This is used with
+ *	%NL80211_CMD_NAN_CLUSTER_JOINED
+ * @NL80211_ATTR_NAN_CAPABILITIES: Nested attribute for NAN capabilities.
+ *	This is used with %NL80211_CMD_GET_WIPHY to indicate the NAN
+ *	capabilities supported by the driver. See &enum nl80211_nan_capabilities
+ *	for details.
+ *
+ * @NL80211_ATTR_S1G_PRIMARY_2MHZ: flag attribute indicating that the S1G
+ *	primary channel is 2 MHz wide, and the control channel designates
+ *	the 1 MHz primary subchannel within that 2 MHz primary.
+ *
+ * @NL80211_ATTR_EPP_PEER: A flag attribute to indicate if the peer is an EPP
+ *	STA. Used with %NL80211_CMD_NEW_STA and %NL80211_CMD_ADD_LINK_STA
+ *
+ * @NL80211_ATTR_EPP_FLAGS: A (u32) bitmap attribute to indicate the negotiated
+ *	EPP capabilities of an EPP AP and an EPP non-AP STA. See
+ *	&enum nl80211_epp_flags for details. Used with %NL80211_CMD_SET_STATION
+ *
  * @NUM_NL80211_ATTR: total number of nl80211_attrs available
  * @NL80211_ATTR_MAX: highest attribute number currently defined
  * @__NL80211_ATTR_AFTER_LAST: internal use
@@ -3456,6 +3537,21 @@ enum nl80211_attrs {
 
 	NL80211_ATTR_ASSOC_MLD_EXT_CAPA_OPS,
 
+	NL80211_ATTR_WIPHY_RADIO_INDEX,
+
+	NL80211_ATTR_S1G_LONG_BEACON_PERIOD,
+	NL80211_ATTR_S1G_SHORT_BEACON,
+	NL80211_ATTR_BSS_PARAM,
+	NL80211_ATTR_NAN_CONFIG,
+	NL80211_ATTR_NAN_NEW_CLUSTER,
+	NL80211_ATTR_NAN_CAPABILITIES,
+
+	NL80211_ATTR_S1G_PRIMARY_2MHZ,
+
+	NL80211_ATTR_EPP_PEER,
+
+	NL80211_ATTR_EPP_FLAGS,
+
 	/* add attributes here, update the policy in nl80211.c */
 
 	__NL80211_ATTR_AFTER_LAST,
@@ -3617,6 +3713,21 @@ enum nl80211_sta_flags {
 	NL80211_STA_FLAG_MAX = __NL80211_STA_FLAG_AFTER_LAST - 1
 };
 
+/**
+ * enum nl80211_epp_flags - EPP Flags
+ *
+ * Negotiated EPP capabilities of an EPP STA
+ *
+ * @NL80211_EPP_FLAG_ASSOC_FRAME_ENCRYPTION: (Re)Association
+ *	Request/Response frame encryption support
+ * @NL80211_EPP_FLAG_1X_UTILIZING_AUTHENTICATION_FRAMES:
+ *	IEEE 802.1X (EAP) Authentication utilizing Authentication frames
+ */
+enum nl80211_epp_flags {
+	NL80211_EPP_FLAG_ASSOC_FRAME_ENCRYPTION = 0,
+	NL80211_EPP_FLAG_1X_UTILIZING_AUTHENTICATION_FRAMES,
+};
+
 /**
  * enum nl80211_sta_p2p_ps_status - station support of P2P PS
  *
@@ -3701,6 +3812,22 @@ enum nl80211_eht_gi {
 	NL80211_RATE_INFO_EHT_GI_3_2,
 };
 
+/**
+ * enum nl80211_eht_ltf - EHT long training field
+ * @NL80211_RATE_INFO_EHT_1XLTF: 3.2 usec
+ * @NL80211_RATE_INFO_EHT_2XLTF: 6.4 usec
+ * @NL80211_RATE_INFO_EHT_4XLTF: 12.8 usec
+ * @NL80211_RATE_INFO_EHT_6XLTF: 19.2 usec
+ * @NL80211_RATE_INFO_EHT_8XLTF: 25.6 usec
+ */
+enum nl80211_eht_ltf {
+	NL80211_RATE_INFO_EHT_1XLTF,
+	NL80211_RATE_INFO_EHT_2XLTF,
+	NL80211_RATE_INFO_EHT_4XLTF,
+	NL80211_RATE_INFO_EHT_6XLTF,
+	NL80211_RATE_INFO_EHT_8XLTF,
+};
+
 /**
  * enum nl80211_eht_ru_alloc - EHT RU allocation values
  * @NL80211_RATE_INFO_EHT_RU_ALLOC_26: 26-tone RU allocation
@@ -4337,6 +4464,12 @@ enum nl80211_wmm_rule {
  *	very low power (VLP) AP, despite being NO_IR.
  * @NL80211_FREQUENCY_ATTR_ALLOW_20MHZ_ACTIVITY: This channel can be active in
  *	20 MHz bandwidth, despite being NO_IR.
+ * @NL80211_FREQUENCY_ATTR_NO_4MHZ: 4 MHz operation is not allowed on this
+ *	channel in current regulatory domain.
+ * @NL80211_FREQUENCY_ATTR_NO_8MHZ: 8 MHz operation is not allowed on this
+ *	channel in current regulatory domain.
+ * @NL80211_FREQUENCY_ATTR_NO_16MHZ: 16 MHz operation is not allowed on this
+ *	channel in current regulatory domain.
  * @NL80211_FREQUENCY_ATTR_MAX: highest frequency attribute number
  *	currently defined
  * @__NL80211_FREQUENCY_ATTR_AFTER_LAST: internal use
@@ -4382,6 +4515,9 @@ enum nl80211_frequency_attr {
 	NL80211_FREQUENCY_ATTR_CAN_MONITOR,
 	NL80211_FREQUENCY_ATTR_ALLOW_6GHZ_VLP_AP,
 	NL80211_FREQUENCY_ATTR_ALLOW_20MHZ_ACTIVITY,
+	NL80211_FREQUENCY_ATTR_NO_4MHZ,
+	NL80211_FREQUENCY_ATTR_NO_8MHZ,
+	NL80211_FREQUENCY_ATTR_NO_16MHZ,
 
 	/* keep last */
 	__NL80211_FREQUENCY_ATTR_AFTER_LAST,
@@ -5315,6 +5451,7 @@ enum nl80211_bss_status {
  * @NL80211_AUTHTYPE_FILS_SK: Fast Initial Link Setup shared key
  * @NL80211_AUTHTYPE_FILS_SK_PFS: Fast Initial Link Setup shared key with PFS
  * @NL80211_AUTHTYPE_FILS_PK: Fast Initial Link Setup public key
+ * @NL80211_AUTHTYPE_EPPKE: Enhanced Privacy Protection Key Exchange
  * @__NL80211_AUTHTYPE_NUM: internal
  * @NL80211_AUTHTYPE_MAX: maximum valid auth algorithm
  * @NL80211_AUTHTYPE_AUTOMATIC: determine automatically (if necessary by
@@ -5330,6 +5467,7 @@ enum nl80211_auth_type {
 	NL80211_AUTHTYPE_FILS_SK,
 	NL80211_AUTHTYPE_FILS_SK_PFS,
 	NL80211_AUTHTYPE_FILS_PK,
+	NL80211_AUTHTYPE_EPPKE,
 
 	/* keep last */
 	__NL80211_AUTHTYPE_NUM,
@@ -5447,6 +5585,10 @@ enum nl80211_key_attributes {
  *	see &struct nl80211_txrate_he
  * @NL80211_TXRATE_HE_GI: configure HE GI, 0.8us, 1.6us and 3.2us.
  * @NL80211_TXRATE_HE_LTF: configure HE LTF, 1XLTF, 2XLTF and 4XLTF.
+ * @NL80211_TXRATE_EHT: EHT rates allowed for TX rate selection,
+ *	see &struct nl80211_txrate_eht
+ * @NL80211_TXRATE_EHT_GI: configure EHT GI, (u8, see &enum nl80211_eht_gi)
+ * @NL80211_TXRATE_EHT_LTF: configure EHT LTF, (u8, see &enum nl80211_eht_ltf)
  * @__NL80211_TXRATE_AFTER_LAST: internal
  * @NL80211_TXRATE_MAX: highest TX rate attribute
  */
@@ -5459,6 +5601,9 @@ enum nl80211_tx_rate_attributes {
 	NL80211_TXRATE_HE,
 	NL80211_TXRATE_HE_GI,
 	NL80211_TXRATE_HE_LTF,
+	NL80211_TXRATE_EHT,
+	NL80211_TXRATE_EHT_GI,
+	NL80211_TXRATE_EHT_LTF,
 
 	/* keep last */
 	__NL80211_TXRATE_AFTER_LAST,
@@ -5491,6 +5636,15 @@ enum nl80211_txrate_gi {
 	NL80211_TXRATE_FORCE_LGI,
 };
 
+#define NL80211_EHT_NSS_MAX             16
+/**
+ * struct nl80211_txrate_eht - EHT MCS/NSS txrate bitmap
+ * @mcs: MCS bitmap table for each NSS (array index 0 for 1 stream, etc.)
+ */
+struct nl80211_txrate_eht {
+	__u16 mcs[NL80211_EHT_NSS_MAX];
+};
+
 /**
  * enum nl80211_band - Frequency band
  * @NL80211_BAND_2GHZ: 2.4 GHz ISM band
@@ -6615,6 +6769,18 @@ enum nl80211_feature_flags {
  *	(signaling and payload protected) A-MSDUs and this shall be advertised
  *	in the RSNXE.
  *
+ * @NL80211_EXT_FEATURE_BEACON_RATE_EHT: Driver supports beacon rate
+ *	configuration (AP/mesh) with EHT rates.
+ *
+ * @NL80211_EXT_FEATURE_EPPKE: Driver supports Enhanced Privacy Protection
+ *	Key Exchange (EPPKE) with user space SME (NL80211_CMD_AUTHENTICATE)
+ *	in non-AP STA mode.
+ *
+ * @NL80211_EXT_FEATURE_ASSOC_FRAME_ENCRYPTION: This specifies that the
+ *	driver supports encryption of (Re)Association Request and Response
+ *	frames in both nonâ€‘AP STA and AP mode as specified in
+ *	"IEEE P802.11bi/D3.0, 12.16.6".
+ *
  * @NUM_NL80211_EXT_FEATURES: number of extended features.
  * @MAX_NL80211_EXT_FEATURES: highest extended feature index.
  */
@@ -6690,6 +6856,9 @@ enum nl80211_ext_feature_index {
 	NL80211_EXT_FEATURE_OWE_OFFLOAD_AP,
 	NL80211_EXT_FEATURE_DFS_CONCURRENT,
 	NL80211_EXT_FEATURE_SPP_AMSDU_SUPPORT,
+	NL80211_EXT_FEATURE_BEACON_RATE_EHT,
+	NL80211_EXT_FEATURE_EPPKE,
+	NL80211_EXT_FEATURE_ASSOC_FRAME_ENCRYPTION,
 
 	/* add new features before the definition below */
 	NUM_NL80211_EXT_FEATURES,
@@ -7244,6 +7413,105 @@ enum nl80211_nan_match_attributes {
 	NL80211_NAN_MATCH_ATTR_MAX = NUM_NL80211_NAN_MATCH_ATTR - 1
 };
 
+/**
+ * enum nl80211_nan_band_conf_attributes - NAN band configuration attributes
+ * @__NL80211_NAN_BAND_CONF_INVALID: Invalid.
+ * @NL80211_NAN_BAND_CONF_BAND: Band for which the configuration is
+ *	being set. The value is according to &enum nl80211_band (u8).
+ * @NL80211_NAN_BAND_CONF_FREQ: Discovery frequency. This attribute shall not
+ *	be present on 2.4 GHZ band. On 5 GHz band its presence is optional.
+ *	The allowed values are 5220 (channel 44) or 5745 (channel 149).
+ *	If not present, channel 149 is used if allowed, otherwise channel 44
+ *	will be selected. The value is in MHz (u16).
+ * @NL80211_NAN_BAND_CONF_RSSI_CLOSE: RSSI close threshold used for NAN state
+ *	transition algorithm as described in chapters 3.3.6 and 3.3.7 "NAN
+ *	Device Role and State Transition" of Wi-Fi Aware (TM) Specification
+ *	v4.0. If not specified, default device value is used. The value should
+ *	be greater than -60 dBm (s8).
+ * @NL80211_NAN_BAND_CONF_RSSI_MIDDLE: RSSI middle threshold used for NAN state
+ *	transition algorithm as described in chapters 3.3.6 and 3.3.7 "NAN
+ *	Device Role and State Transition" of Wi-Fi Aware (TM) Specification
+ *	v4.0. If not present, default device value is used. The value should be
+ *	greater than -75 dBm and less than %NL80211_NAN_BAND_CONF_RSSI_CLOSE
+ *	(s8).
+ * @NL80211_NAN_BAND_CONF_WAKE_DW: Committed DW information (values 0-5).
+ *	Value 0 means that the device will not wake up during the
+ *	discovery window. Values 1-5 mean that the device will wake up
+ *	during each 2^(n - 1) discovery window, where n is the value of
+ *	this attribute. Setting this attribute to 0 is not allowed on
+ *	2.4 GHz band (u8). This is an optional parameter (default is 1).
+ * @NL80211_NAN_BAND_CONF_DISABLE_SCAN: Optional flag attribute to disable
+ *	scanning (for cluster merge) on the band. If set, the device will not
+ *	scan on this band anymore. Disabling scanning on 2.4 GHz band is not
+ *	allowed.
+ * @NUM_NL80211_NAN_BAND_CONF_ATTR: Internal.
+ * @NL80211_NAN_BAND_CONF_ATTR_MAX: Highest NAN band configuration attribute.
+ *
+ * These attributes are used to configure NAN band-specific parameters. Note,
+ * that both RSSI attributes should be configured (or both left unset).
+ */
+enum nl80211_nan_band_conf_attributes {
+	__NL80211_NAN_BAND_CONF_INVALID,
+	NL80211_NAN_BAND_CONF_BAND,
+	NL80211_NAN_BAND_CONF_FREQ,
+	NL80211_NAN_BAND_CONF_RSSI_CLOSE,
+	NL80211_NAN_BAND_CONF_RSSI_MIDDLE,
+	NL80211_NAN_BAND_CONF_WAKE_DW,
+	NL80211_NAN_BAND_CONF_DISABLE_SCAN,
+
+	/* keep last */
+	NUM_NL80211_NAN_BAND_CONF_ATTR,
+	NL80211_NAN_BAND_CONF_ATTR_MAX = NUM_NL80211_NAN_BAND_CONF_ATTR - 1,
+};
+
+/**
+ * enum nl80211_nan_conf_attributes - NAN configuration attributes
+ * @__NL80211_NAN_CONF_INVALID: Invalid attribute, used for validation.
+ * @NL80211_NAN_CONF_CLUSTER_ID: ID for the NAN cluster. This is a MAC
+ *	address that can take values from 50-6F-9A-01-00-00 to
+ *	50-6F-9A-01-FF-FF. This attribute is optional. If not present,
+ *	a random Cluster ID will be chosen.
+ * @NL80211_NAN_CONF_EXTRA_ATTRS: Additional NAN attributes to be
+ *	published in the beacons. This is an optional byte array.
+ * @NL80211_NAN_CONF_VENDOR_ELEMS: Vendor-specific elements that will
+ *	be published in the beacons. This is an optional byte array.
+ * @NL80211_NAN_CONF_BAND_CONFIGS: This is a nested array attribute,
+ *	containing multiple entries for each supported band. Each band
+ *	configuration consists of &enum nl80211_nan_band_conf_attributes.
+ * @NL80211_NAN_CONF_SCAN_PERIOD: Scan period in seconds. If not configured,
+ *	device default is used. Zero value will disable scanning.
+ *	This is u16 (optional).
+ * @NL80211_NAN_CONF_SCAN_DWELL_TIME: Scan dwell time in TUs per channel.
+ *	Only non-zero values are valid. If not configured the device default
+ *	value is used. This is u16 (optional)
+ * @NL80211_NAN_CONF_DISCOVERY_BEACON_INTERVAL: Discovery beacon interval
+ *	in TUs. Valid range is 50-200 TUs. If not configured the device default
+ *	value is used. This is u8 (optional)
+ * @NL80211_NAN_CONF_NOTIFY_DW: If set, the driver will notify userspace about
+ *	the upcoming discovery window with
+ *	%NL80211_CMD_NAN_NEXT_DW_NOTIFICATION.
+ *	This is a flag attribute.
+ * @NUM_NL80211_NAN_CONF_ATTR: Internal.
+ * @NL80211_NAN_CONF_ATTR_MAX: Highest NAN configuration attribute.
+ *
+ * These attributes are used to configure NAN-specific parameters.
+ */
+enum nl80211_nan_conf_attributes {
+	__NL80211_NAN_CONF_INVALID,
+	NL80211_NAN_CONF_CLUSTER_ID,
+	NL80211_NAN_CONF_EXTRA_ATTRS,
+	NL80211_NAN_CONF_VENDOR_ELEMS,
+	NL80211_NAN_CONF_BAND_CONFIGS,
+	NL80211_NAN_CONF_SCAN_PERIOD,
+	NL80211_NAN_CONF_SCAN_DWELL_TIME,
+	NL80211_NAN_CONF_DISCOVERY_BEACON_INTERVAL,
+	NL80211_NAN_CONF_NOTIFY_DW,
+
+	/* keep last */
+	NUM_NL80211_NAN_CONF_ATTR,
+	NL80211_NAN_CONF_ATTR_MAX = NUM_NL80211_NAN_CONF_ATTR - 1,
+};
+
 /**
  * enum nl80211_external_auth_action - Action to perform with external
  *     authentication request. Used by NL80211_ATTR_EXTERNAL_AUTH_ACTION.
@@ -8088,6 +8356,7 @@ enum nl80211_ap_settings_flags {
  *	and contains attributes defined in &enum nl80211_if_combination_attrs.
  * @NL80211_WIPHY_RADIO_ATTR_ANTENNA_MASK: bitmask (u32) of antennas
  *	connected to this radio.
+ * @NL80211_WIPHY_RADIO_ATTR_RTS_THRESHOLD: RTS threshold (u32) of this radio.
  *
  * @__NL80211_WIPHY_RADIO_ATTR_LAST: Internal
  * @NL80211_WIPHY_RADIO_ATTR_MAX: Highest attribute
@@ -8099,6 +8368,7 @@ enum nl80211_wiphy_radio_attrs {
 	NL80211_WIPHY_RADIO_ATTR_FREQ_RANGE,
 	NL80211_WIPHY_RADIO_ATTR_INTERFACE_COMBINATION,
 	NL80211_WIPHY_RADIO_ATTR_ANTENNA_MASK,
+	NL80211_WIPHY_RADIO_ATTR_RTS_THRESHOLD,
 
 	/* keep last */
 	__NL80211_WIPHY_RADIO_ATTR_LAST,
@@ -8128,4 +8398,77 @@ enum nl80211_wiphy_radio_freq_range {
 	NL80211_WIPHY_RADIO_FREQ_ATTR_MAX = __NL80211_WIPHY_RADIO_FREQ_ATTR_LAST - 1,
 };
 
+/**
+ * enum nl80211_s1g_short_beacon_attrs - S1G short beacon data
+ *
+ * @__NL80211_S1G_SHORT_BEACON_ATTR_INVALID: Invalid
+ *
+ * @NL80211_S1G_SHORT_BEACON_ATTR_HEAD: Short beacon head (binary).
+ * @NL80211_S1G_SHORT_BEACON_ATTR_TAIL: Short beacon tail (binary).
+ *
+ * @__NL80211_S1G_SHORT_BEACON_ATTR_LAST: Internal
+ * @NL80211_S1G_SHORT_BEACON_ATTR_MAX: Highest attribute
+ */
+enum nl80211_s1g_short_beacon_attrs {
+	__NL80211_S1G_SHORT_BEACON_ATTR_INVALID,
+
+	NL80211_S1G_SHORT_BEACON_ATTR_HEAD,
+	NL80211_S1G_SHORT_BEACON_ATTR_TAIL,
+
+	/* keep last */
+	__NL80211_S1G_SHORT_BEACON_ATTR_LAST,
+	NL80211_S1G_SHORT_BEACON_ATTR_MAX =
+		__NL80211_S1G_SHORT_BEACON_ATTR_LAST - 1
+};
+
+/**
+ * enum nl80211_nan_capabilities - NAN (Neighbor Aware Networking)
+ *	capabilities.
+ *
+ * @__NL80211_NAN_CAPABILITIES_INVALID: Invalid.
+ * @NL80211_NAN_CAPA_CONFIGURABLE_SYNC: Flag attribute indicating that
+ *	the device supports configurable synchronization. If set, the device
+ *	should be able to handle %NL80211_ATTR_NAN_CONFIG
+ *	attribute in the %NL80211_CMD_START_NAN (and change) command.
+ * @NL80211_NAN_CAPA_USERSPACE_DE: Flag attribute indicating that
+ *	NAN Discovery Engine (DE) is not offloaded and the driver assumes
+ *	user space DE implementation. When set, %NL80211_CMD_ADD_NAN_FUNCTION,
+ *	%NL80211_CMD_DEL_NAN_FUNCTION and %NL80211_CMD_NAN_MATCH commands
+ *	should not be used. In addition, the device/driver should support
+ *	sending discovery window (DW) notifications using
+ *	%NL80211_CMD_NAN_NEXT_DW_NOTIFICATION and handling transmission and
+ *	reception of NAN SDF frames on NAN device interface during DW windows.
+ *	(%NL80211_CMD_FRAME is used to transmit SDFs)
+ * @NL80211_NAN_CAPA_OP_MODE: u8 attribute indicating the supported operation
+ *	modes as defined in Wi-Fi Aware (TM) specification Table 81 (Operation
+ *	Mode field format).
+ * @NL80211_NAN_CAPA_NUM_ANTENNAS: u8 attribute indicating the number of
+ *	TX and RX antennas supported by the device. Lower nibble indicates
+ *	the number of TX antennas and upper nibble indicates the number of RX
+ *	antennas. Value 0 indicates the information is not available.
+ *	See table 79 of Wi-Fi Aware (TM) specification (Number of
+ *	Antennas field).
+ * @NL80211_NAN_CAPA_MAX_CHANNEL_SWITCH_TIME: u16 attribute indicating the
+ *	maximum time in microseconds that the device requires to switch
+ *	channels.
+ * @NL80211_NAN_CAPA_CAPABILITIES: u8 attribute containing the
+ *	capabilities of the device as defined in Wi-Fi Aware (TM)
+ *	specification Table 79 (Capabilities field).
+ * @__NL80211_NAN_CAPABILITIES_LAST: Internal
+ * @NL80211_NAN_CAPABILITIES_MAX: Highest NAN capability attribute.
+ */
+enum nl80211_nan_capabilities {
+	__NL80211_NAN_CAPABILITIES_INVALID,
+
+	NL80211_NAN_CAPA_CONFIGURABLE_SYNC,
+	NL80211_NAN_CAPA_USERSPACE_DE,
+	NL80211_NAN_CAPA_OP_MODE,
+	NL80211_NAN_CAPA_NUM_ANTENNAS,
+	NL80211_NAN_CAPA_MAX_CHANNEL_SWITCH_TIME,
+	NL80211_NAN_CAPA_CAPABILITIES,
+	/* keep last */
+	__NL80211_NAN_CAPABILITIES_LAST,
+	NL80211_NAN_CAPABILITIES_MAX = __NL80211_NAN_CAPABILITIES_LAST - 1,
+};
+
 #endif /* __LINUX_NL80211_H */

From patchwork Tue Jan  6 13:45:12 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180386
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=Cm3JjvDI;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=Bl3fK9K6;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=P9ma8ppd;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlssC660Hz1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:46:39 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=lii8rGRQvL+ooo1NEwjuHT8hZUeTt8zS9tyPbjzS0Zo=; b=Cm3JjvDIrsgqyw
	BsMGqecPAneQihrPwd7SPveRaHOxvPQ019pnYeVIMjIuumZtaui08HSGfHDHSgcsa+wHGKAY+9eVa
	J8oWp9G2yh1ROiX86Ln7Da/aaMmly29wDtXNEIC6rrzNI1LQpZbv8ZODKMZDanXIFhz8+qf5Ie/ES
	ZAMH+q2iYuGbS4dQO2QMAj8lSqXzNn7qiN4fltzP08d+SkDMhe8s3751qJvDw7jxjKcJyO8Qc8Bb2
	5DlqMEW7OuxjCkMeNq8Z6KJMoFkWv76IxKayyttP+lMIxzVR3/uLuHF/t3bIHKzOYcT7X4S5OOH4e
	Io5tYCd7b4Ul41zf5tNg==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Ns-0000000D7TE-0IlG;
	Tue, 06 Jan 2026 13:46:04 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Nn-0000000D7Rg-2w5w
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:01 +0000
Received: from pps.filterd (m0279870.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606Aq18A3052764
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:45:59 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=mNwukrLswZo
	cJHMOvKUu8YWTXcjnSc4Z5dxcmPq5YFc=; b=Bl3fK9K6wF0EA9MyTxhDvZ8C9l4
	yVOkTLkPQ6Fj590n30EOobdBsdm7qfdXM9Vw6BbFhPd7m90PQ8fl+T7XzRAFPNJl
	UQkRLCP0BPloL1gVAPesPg2yItCp86LCmWaDybCH8L2W3cmny+5isxWf+butixqE
	kxY/+ph0M9l2nQuP6c+w4DbybQWLMz/hVW2Rs2FxUc7jUhNZS2yZvoaA79nUz2y3
	55eStZNHByZgK/zdBtVZTxAkuWYxk9/VU0jsh1cuHALAgKSFk/CvNLN/GXWxMG7y
	OV2FuoPyT48uODVBHbxurgQ9tF79PJ2VBdaDhfOzviHqstVgHtxsfr35MBw==
Received: from mail-pf1-f200.google.com (mail-pf1-f200.google.com
 [209.85.210.200])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgpn9t6my-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:45:58 +0000 (GMT)
Received: by mail-pf1-f200.google.com with SMTP id
 d2e1a72fcca58-804c73088daso729205b3a.0
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:45:58 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707157; x=1768311957;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=mNwukrLswZocJHMOvKUu8YWTXcjnSc4Z5dxcmPq5YFc=;
        b=P9ma8ppdlMY/rwzehUWisuA1smCpcEV+92EP9M/4iF79Vkmjsj6pURjrYL2tvcfEZj
         s2nKgzkpiDbrhu6lgJGVbYaID67MJi9g24Dt4v3XkNPgYS6KG847lb9awZGsz8ymxPqu
         CuTjgTPTL31l+oc5iqIexvF5hdmu6/n4y67HIcROdczfuw8HmeZvGA1SgzhbfKb3hMk/
         Uank5C6tyYES+gXszVsFm3AJX6epd0BCFyR3AI4NE/R0bdWJ0HoNZ2iiJzoytNO++5yM
         FYZ5eXjmFxP8MEvQxGhJY47SGm4HZJAwMoMlWtvbdYNdbSzdZ0/db6KFxCX6dFkr2j/S
         oKuA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707157; x=1768311957;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=mNwukrLswZocJHMOvKUu8YWTXcjnSc4Z5dxcmPq5YFc=;
        b=xP9NDEVGIs3Zbvmksx/fFTZFhlclfyiGHPqpo0HD9WPhcaTU9ABJ1WwTNQSBKQCQoS
         qzLC+Hi7iWwsBBfR+gUfXJAzuASdc2IhHC8/d9KoopHUnRqsfean1/jBsjxGyb8pOCvC
         cXS4Woc1YnVQaFijLEfzzR3Cvilg/B1aXn1v61j5wtlx+JbSIN0rFETE5HqLC2fQx1X4
         PuDl0jgzF1s0YRfQDu8JeiFrefISeK9QPTkDrLPT+pMJYNw0CaKKnRC4A7pJiqGeT/J8
         2/fHeVRhq7LNhQzny6s0HyWCd6Fz9yrqpFn47JmDDV1NWXh2CfRq0RStdPOqmDmOMcuu
         lwMQ==
X-Gm-Message-State: AOJu0YyBhs+qyeIdbPNuDQXJpT2uJ6PZTc/47NwaQIesuCtk75CRrvh7
	8LJQ05Oq6wcm54vddqy+/AEUJeFTyT/QbgaIbVFFvnn8ZQj3iooSID0dI+amn3u1iRctxTqNh9x
	02yYpFEES2rajFgMy8TIcNuG9sItBj4Yco/eEp14PWyQ7Br61u8n6tk6Hx69nA25JNghLK3H9
X-Gm-Gg: AY/fxX4WbZ3Bm4QvUwvO2Rx8lNanp6MYShIlPxH7fpmDif7MfY++5wDD3rbFcW2o7k1
	m3U2qfpK9qA4yyeel1BNjnsQOtYP3WrlCfQLUmut1w6kAMhPBGXE8t4ta/mWoX0OMTjAXVYaa+L
	cOZkL0kmOdirerfWitfBRul4PyOo8f9bI4bAqDWE43wF+LBmBKt7rglYsfnoseBJkDqnLh3rd89
	rQm9ZSa8j34fZwYWkBi5FxUwcvv0BbY6TztvYa+MU08C0Ca+13B7e6pHTqfKdDs53Jl9rSLE6BC
	TABK0LYXun/z/VuwUmjO1gSlWEzw81plM5s4Zp98srqC9FW6E3a2nizXq5pDlyLJSpnvb+E6TKC
	7vsNc4Ldn3ff7ZkmsDIIuY2IkzQq9fsX1twzFcluW
X-Received: by 2002:a05:6a00:4307:b0:781:1110:f175 with SMTP id
 d2e1a72fcca58-819440ce89amr3004538b3a.14.1767707157217;
        Tue, 06 Jan 2026 05:45:57 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IFYRUKgZAfprUB0QmO++j8t7OaODJ1McK2qlUxQxLb03uVhzZ+7AmiwS1/WsDcpcqx3ntC+hQ==
X-Received: by 2002:a05:6a00:4307:b0:781:1110:f175 with SMTP id
 d2e1a72fcca58-819440ce89amr3004492b3a.14.1767707156402;
        Tue, 06 Jan 2026 05:45:56 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.45.54
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:45:56 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 02/28] 11bi: Rename FILS nonce element and related
 constants to generic 'nonce'
Date: Tue,  6 Jan 2026 19:15:12 +0530
Message-Id: <20260106134538.2594232-3-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-ORIG-GUID: z3R6P2ct8jDyAxHu8D_rCsMYfPG_d7Ng
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfX5v3GSEuHisWv
 4V/o9/21d/Xc7B00PEIzGEoS6YhVrEP+hWqlhI+DGy4z7Zt36fYjURXGdEjg4KKoA73rlZLtwq3
 8R978afxl8zkEqAgKwOJphuL11BaQI8X+NVciNvkL1V9rFNqxmNMUq9AQ+Kl23RjPnIycHL/2NU
 YeVR+44PHJuocyR2nDq5anjcPb99lj9X/5PLcQs36PzS725tXxTYftPZ36LJSynQtKtEIlf9zIv
 M/ylWx1tFlFRZozJRPZjAJod6oUFQY9sdZ+eX+0BQSdbYa/3Pv2yBb9DqKa8cKG+xH5Gs8/UtQv
 jVf9o+PNrRFB7Rj8qYkMDZAxyMbHagnrrax5H8muIPIXkMvvb0DZ6kcrVTKZS1kRH5OInqHxYGQ
 mWWsJX/+7hDPGKKiWF/e0Hc1zysxk3cHn+DWYmMjW9JZIjw/DxqgITMoJjs+f8RaSujEcLM/d0X
 c8Ma0koJBBjnfRvTUjQ==
X-Proofpoint-GUID: z3R6P2ct8jDyAxHu8D_rCsMYfPG_d7Ng
X-Authority-Analysis: v=2.4 cv=KfnfcAYD c=1 sm=1 tr=0 ts=695d1216 cx=c_pps
 a=mDZGXZTwRPZaeRUbqKGCBw==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=G8hjbcGCKmAzj2wXGVcA:9 a=zc0IvFSfCIW2DFIPzwfm:22
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 phishscore=0 priorityscore=1501 clxscore=1015 spamscore=0 adultscore=0
 suspectscore=0 malwarescore=0 impostorscore=0 bulkscore=0 lowpriorityscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_054600_011936_442A0941 
X-CRM114-Status: GOOD (  23.24  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  Previously,
 the nonce element and related constants were used
    exclusively in FILS authentication frames. Rename the nonce element and
 related
    constants to reflect their broader usage beyond FILS authentication
 frames,
    as specified in P802.11bi/D2.1,9.4.2.188.
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

Previously, the nonce element and related constants were used
exclusively in FILS authentication frames.

Rename the nonce element and related constants to reflect their
broader usage beyond FILS authentication frames, as specified in
P802.11bi/D2.1,9.4.2.188.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/ap/ieee802_11.c            | 32 +++++++++++++++---------------
 src/ap/sta_info.h              |  2 +-
 src/ap/wpa_auth.c              | 12 ++++++------
 src/common/ieee802_11_common.c | 10 +++++-----
 src/common/ieee802_11_common.h |  2 +-
 src/common/ieee802_11_defs.h   |  4 ++--
 src/common/wpa_common.c        | 36 +++++++++++++++++-----------------
 src/drivers/driver_atheros.c   |  8 ++++----
 src/pasn/pasn_common.h         |  4 ++--
 src/pasn/pasn_initiator.c      | 20 +++++++++----------
 src/pasn/pasn_responder.c      |  6 +++---
 src/rsn_supp/wpa.c             | 20 +++++++++----------
 src/rsn_supp/wpa_i.h           |  4 ++--
 wlantest/rx_mgmt.c             | 14 ++++++-------
 wpa_supplicant/sme.c           |  6 +++---
 15 files changed, 90 insertions(+), 90 deletions(-)

diff --git a/src/ap/ieee802_11.c b/src/ap/ieee802_11.c
index 24ef8b75f..611017da1 100644
--- a/src/ap/ieee802_11.c
+++ b/src/ap/ieee802_11.c
@@ -2299,14 +2299,14 @@ void handle_auth_fils(struct hostapd_data *hapd, struct sta_info *sta,
 	if (resp != WLAN_STATUS_SUCCESS)
 		goto fail;
 
-	if (!elems.fils_nonce) {
+	if (!elems.nonce) {
 		wpa_printf(MSG_DEBUG, "FILS: No FILS Nonce field");
 		resp = WLAN_STATUS_UNSPECIFIED_FAILURE;
 		goto fail;
 	}
-	wpa_hexdump(MSG_DEBUG, "FILS: SNonce", elems.fils_nonce,
-		    FILS_NONCE_LEN);
-	os_memcpy(sta->fils_snonce, elems.fils_nonce, FILS_NONCE_LEN);
+	wpa_hexdump(MSG_DEBUG, "FILS: SNonce", elems.nonce,
+		    NONCE_LEN);
+	os_memcpy(sta->fils_snonce, elems.nonce, NONCE_LEN);
 
 	/* PMKID List */
 	if (rsn.pmkid && rsn.num_pmkid > 0) {
@@ -2414,7 +2414,7 @@ prepare_auth_resp_fils(struct hostapd_data *hapd,
 		       const u8 *msk, size_t msk_len,
 		       int *is_pub)
 {
-	u8 fils_nonce[FILS_NONCE_LEN];
+	u8 fils_nonce[NONCE_LEN];
 	size_t ielen;
 	struct wpabuf *data = NULL;
 	const u8 *ie;
@@ -2449,12 +2449,12 @@ prepare_auth_resp_fils(struct hostapd_data *hapd,
 		ie = ie_buf;
 	}
 
-	if (random_get_bytes(fils_nonce, FILS_NONCE_LEN) < 0) {
+	if (random_get_bytes(fils_nonce, NONCE_LEN) < 0) {
 		*resp = WLAN_STATUS_UNSPECIFIED_FAILURE;
 		goto fail;
 	}
 	wpa_hexdump(MSG_DEBUG, "RSN: Generated FILS Nonce",
-		    fils_nonce, FILS_NONCE_LEN);
+		    fils_nonce, NONCE_LEN);
 
 #ifdef CONFIG_FILS_SK_PFS
 	if (sta->fils_dh_ss && sta->fils_ecdh) {
@@ -2506,10 +2506,10 @@ prepare_auth_resp_fils(struct hostapd_data *hapd,
 
 	/* FILS Nonce */
 	wpabuf_put_u8(data, WLAN_EID_EXTENSION); /* Element ID */
-	wpabuf_put_u8(data, 1 + FILS_NONCE_LEN); /* Length */
+	wpabuf_put_u8(data, 1 + NONCE_LEN); /* Length */
 	/* Element ID Extension */
-	wpabuf_put_u8(data, WLAN_EID_EXT_FILS_NONCE);
-	wpabuf_put_data(data, fils_nonce, FILS_NONCE_LEN);
+	wpabuf_put_u8(data, WLAN_EID_EXT_NONCE);
+	wpabuf_put_data(data, fils_nonce, NONCE_LEN);
 
 	/* FILS Session */
 	wpabuf_put_u8(data, WLAN_EID_EXTENSION); /* Element ID */
@@ -2795,13 +2795,13 @@ static void pasn_fils_auth_resp(struct hostapd_data *hapd,
 		goto fail;
 	}
 
-	if (random_get_bytes(fils->anonce, FILS_NONCE_LEN) < 0) {
+	if (random_get_bytes(fils->anonce, NONCE_LEN) < 0) {
 		wpa_printf(MSG_DEBUG, "PASN: FILS: Failed to get ANonce");
 		goto fail;
 	}
 
 	wpa_hexdump(MSG_DEBUG, "RSN: Generated FILS ANonce",
-		    fils->anonce, FILS_NONCE_LEN);
+		    fils->anonce, NONCE_LEN);
 
 	ret = fils_rmsk_to_pmk(pasn_get_akmp(pasn), msk, msk_len, fils->nonce,
 			       fils->anonce, NULL, 0, pmk, &pmk_len);
@@ -2913,7 +2913,7 @@ static int pasn_wd_handle_fils(struct hostapd_data *hapd, struct sta_info *sta,
 		return -1;
 	}
 
-	if (!elems.rsn_ie || !elems.fils_nonce || !elems.fils_nonce ||
+	if (!elems.rsn_ie || !elems.nonce || !elems.nonce ||
 	    !elems.wrapped_data || !elems.fils_session) {
 		wpa_printf(MSG_DEBUG, "PASN: FILS: Missing IEs");
 		return -1;
@@ -2938,9 +2938,9 @@ static int pasn_wd_handle_fils(struct hostapd_data *hapd, struct sta_info *sta,
 		return -1;
 	}
 
-	wpa_hexdump(MSG_DEBUG, "PASN: FILS: Nonce", elems.fils_nonce,
-		    FILS_NONCE_LEN);
-	os_memcpy(fils->nonce, elems.fils_nonce, FILS_NONCE_LEN);
+	wpa_hexdump(MSG_DEBUG, "PASN: FILS: Nonce", elems.nonce,
+		    NONCE_LEN);
+	os_memcpy(fils->nonce, elems.nonce, NONCE_LEN);
 
 	wpa_hexdump(MSG_DEBUG, "PASN: FILS: Session", elems.fils_session,
 		    FILS_SESSION_LEN);
diff --git a/src/ap/sta_info.h b/src/ap/sta_info.h
index 4f41f7028..3fb97edd5 100644
--- a/src/ap/sta_info.h
+++ b/src/ap/sta_info.h
@@ -262,7 +262,7 @@ struct sta_info {
 #endif /* CONFIG_TAXONOMY */
 
 #ifdef CONFIG_FILS
-	u8 fils_snonce[FILS_NONCE_LEN];
+	u8 fils_snonce[NONCE_LEN];
 	u8 fils_session[FILS_SESSION_LEN];
 	u8 fils_erp_pmkid[PMKID_LEN];
 	u8 *fils_pending_assoc_req;
diff --git a/src/ap/wpa_auth.c b/src/ap/wpa_auth.c
index 49268b21e..620e55387 100644
--- a/src/ap/wpa_auth.c
+++ b/src/ap/wpa_auth.c
@@ -3131,8 +3131,8 @@ int fils_auth_pmk_to_ptk(struct wpa_state_machine *sm, const u8 *pmk,
 	forced_memzero(ick, sizeof(ick));
 
 	/* Store nonces for (Re)Association Request/Response frame processing */
-	os_memcpy(sm->SNonce, snonce, FILS_NONCE_LEN);
-	os_memcpy(sm->ANonce, anonce, FILS_NONCE_LEN);
+	os_memcpy(sm->SNonce, snonce, NONCE_LEN);
+	os_memcpy(sm->ANonce, anonce, NONCE_LEN);
 
 	return res;
 }
@@ -3349,10 +3349,10 @@ int fils_decrypt_assoc(struct wpa_state_machine *sm, const u8 *fils_session,
 	aad_len[1] = ETH_ALEN;
 	/* The STA's nonce */
 	aad[2] = sm->SNonce;
-	aad_len[2] = FILS_NONCE_LEN;
+	aad_len[2] = NONCE_LEN;
 	/* The AP's nonce */
 	aad[3] = sm->ANonce;
-	aad_len[3] = FILS_NONCE_LEN;
+	aad_len[3] = NONCE_LEN;
 	/*
 	 * The (Re)Association Request frame from the Capability Information
 	 * field to the FILS Session element (both inclusive).
@@ -3408,10 +3408,10 @@ int fils_encrypt_assoc(struct wpa_state_machine *sm, u8 *buf,
 	aad_len[1] = ETH_ALEN;
 	/* The AP's nonce */
 	aad[2] = sm->ANonce;
-	aad_len[2] = FILS_NONCE_LEN;
+	aad_len[2] = NONCE_LEN;
 	/* The STA's nonce */
 	aad[3] = sm->SNonce;
-	aad_len[3] = FILS_NONCE_LEN;
+	aad_len[3] = NONCE_LEN;
 	/*
 	 * The (Re)Association Response frame from the Capability Information
 	 * field (the same offset in both Association and Reassociation
diff --git a/src/common/ieee802_11_common.c b/src/common/ieee802_11_common.c
index 5d1e02f81..451f6eb3a 100644
--- a/src/common/ieee802_11_common.c
+++ b/src/common/ieee802_11_common.c
@@ -362,10 +362,10 @@ static int ieee802_11_parse_extension(const u8 *pos, size_t elen,
 		elems->fils_pk = pos;
 		elems->fils_pk_len = elen;
 		break;
-	case WLAN_EID_EXT_FILS_NONCE:
-		if (elen != FILS_NONCE_LEN)
+	case WLAN_EID_EXT_NONCE:
+		if (elen != NONCE_LEN)
 			break;
-		elems->fils_nonce = pos;
+		elems->nonce = pos;
 		break;
 	case WLAN_EID_EXT_OWE_DH_PARAM:
 		if (elen < 2)
@@ -941,8 +941,8 @@ void ieee802_11_elems_clear_ext_ids(struct ieee802_11_elems *elems,
 			elems->fils_pk = NULL;
 			elems->fils_pk_len = 0;
 			break;
-		case WLAN_EID_EXT_FILS_NONCE:
-			elems->fils_nonce = NULL;
+		case WLAN_EID_EXT_NONCE:
+			elems->nonce = NULL;
 			break;
 		case WLAN_EID_EXT_OWE_DH_PARAM:
 			elems->owe_dh = NULL;
diff --git a/src/common/ieee802_11_common.h b/src/common/ieee802_11_common.h
index 09bd0675a..7f6f387c2 100644
--- a/src/common/ieee802_11_common.h
+++ b/src/common/ieee802_11_common.h
@@ -94,7 +94,7 @@ struct ieee802_11_elems {
 	const u8 *key_delivery;
 	const u8 *wrapped_data;
 	const u8 *fils_pk;
-	const u8 *fils_nonce;
+	const u8 *nonce;
 	const u8 *owe_dh;
 	const u8 *power_capab;
 	const u8 *roaming_cons_sel;
diff --git a/src/common/ieee802_11_defs.h b/src/common/ieee802_11_defs.h
index 89f0a1bf8..1b964439b 100644
--- a/src/common/ieee802_11_defs.h
+++ b/src/common/ieee802_11_defs.h
@@ -504,7 +504,7 @@
 #define WLAN_EID_EXT_EXTENDED_REQUEST 10
 #define WLAN_EID_EXT_ESTIMATED_SERVICE_PARAMS 11
 #define WLAN_EID_EXT_FILS_PUBLIC_KEY 12
-#define WLAN_EID_EXT_FILS_NONCE 13
+#define WLAN_EID_EXT_NONCE 13
 #define WLAN_EID_EXT_FUTURE_CHANNEL_GUIDANCE 14
 #define WLAN_EID_EXT_OWE_DH_PARAM 32
 #define WLAN_EID_EXT_PASSWORD_IDENTIFIER 33
@@ -974,7 +974,7 @@ enum lci_req_subelem {
 	LCI_REQ_SUBELEM_MAX_AGE = 4,
 };
 
-#define FILS_NONCE_LEN 16
+#define NONCE_LEN 16
 #define FILS_SESSION_LEN 8
 #define FILS_CACHE_ID_LEN 2
 #define FILS_MAX_KEY_AUTH_LEN 48
diff --git a/src/common/wpa_common.c b/src/common/wpa_common.c
index 8b0d92201..d1a6e86a4 100644
--- a/src/common/wpa_common.c
+++ b/src/common/wpa_common.c
@@ -681,7 +681,7 @@ int fils_rmsk_to_pmk(int akmp, const u8 *rmsk, size_t rmsk_len,
 		     const u8 *snonce, const u8 *anonce, const u8 *dh_ss,
 		     size_t dh_ss_len, u8 *pmk, size_t *pmk_len)
 {
-	u8 nonces[2 * FILS_NONCE_LEN];
+	u8 nonces[2 * NONCE_LEN];
 	const u8 *addr[2];
 	size_t len[2];
 	size_t num_elem;
@@ -698,12 +698,12 @@ int fils_rmsk_to_pmk(int akmp, const u8 *rmsk, size_t rmsk_len,
 		return -1;
 
 	wpa_hexdump_key(MSG_DEBUG, "FILS: rMSK", rmsk, rmsk_len);
-	wpa_hexdump(MSG_DEBUG, "FILS: SNonce", snonce, FILS_NONCE_LEN);
-	wpa_hexdump(MSG_DEBUG, "FILS: ANonce", anonce, FILS_NONCE_LEN);
+	wpa_hexdump(MSG_DEBUG, "FILS: SNonce", snonce, NONCE_LEN);
+	wpa_hexdump(MSG_DEBUG, "FILS: ANonce", anonce, NONCE_LEN);
 	wpa_hexdump(MSG_DEBUG, "FILS: DHss", dh_ss, dh_ss_len);
 
-	os_memcpy(nonces, snonce, FILS_NONCE_LEN);
-	os_memcpy(&nonces[FILS_NONCE_LEN], anonce, FILS_NONCE_LEN);
+	os_memcpy(nonces, snonce, NONCE_LEN);
+	os_memcpy(&nonces[NONCE_LEN], anonce, NONCE_LEN);
 	addr[0] = rmsk;
 	len[0] = rmsk_len;
 	num_elem = 1;
@@ -713,10 +713,10 @@ int fils_rmsk_to_pmk(int akmp, const u8 *rmsk, size_t rmsk_len,
 		num_elem++;
 	}
 	if (wpa_key_mgmt_sha384(akmp))
-		res = hmac_sha384_vector(nonces, 2 * FILS_NONCE_LEN, num_elem,
+		res = hmac_sha384_vector(nonces, 2 * NONCE_LEN, num_elem,
 					 addr, len, pmk);
 	else
-		res = hmac_sha256_vector(nonces, 2 * FILS_NONCE_LEN, num_elem,
+		res = hmac_sha256_vector(nonces, 2 * NONCE_LEN, num_elem,
 					 addr, len, pmk);
 	if (res == 0)
 		wpa_hexdump_key(MSG_DEBUG, "FILS: PMK", pmk, *pmk_len);
@@ -779,7 +779,7 @@ int fils_pmk_to_ptk(const u8 *pmk, size_t pmk_len, const u8 *spa, const u8 *aa,
 	 * KDK = L(FILS-Key-Data, ICK_bits + KEK_bits + TK_bits + FILS-FT_bits,
 	 *	   KDK_bits)
 	 */
-	data_len = 2 * ETH_ALEN + 2 * FILS_NONCE_LEN + dhss_len;
+	data_len = 2 * ETH_ALEN + 2 * NONCE_LEN + dhss_len;
 	data = os_malloc(data_len);
 	if (!data)
 		goto err;
@@ -788,10 +788,10 @@ int fils_pmk_to_ptk(const u8 *pmk, size_t pmk_len, const u8 *spa, const u8 *aa,
 	pos += ETH_ALEN;
 	os_memcpy(pos, aa, ETH_ALEN);
 	pos += ETH_ALEN;
-	os_memcpy(pos, snonce, FILS_NONCE_LEN);
-	pos += FILS_NONCE_LEN;
-	os_memcpy(pos, anonce, FILS_NONCE_LEN);
-	pos += FILS_NONCE_LEN;
+	os_memcpy(pos, snonce, NONCE_LEN);
+	pos += NONCE_LEN;
+	os_memcpy(pos, anonce, NONCE_LEN);
+	pos += NONCE_LEN;
 	if (dhss)
 		os_memcpy(pos, dhss, dhss_len);
 
@@ -845,8 +845,8 @@ int fils_pmk_to_ptk(const u8 *pmk, size_t pmk_len, const u8 *spa, const u8 *aa,
 
 	wpa_printf(MSG_DEBUG, "FILS: PTK derivation - SPA=" MACSTR
 		   " AA=" MACSTR, MAC2STR(spa), MAC2STR(aa));
-	wpa_hexdump(MSG_DEBUG, "FILS: SNonce", snonce, FILS_NONCE_LEN);
-	wpa_hexdump(MSG_DEBUG, "FILS: ANonce", anonce, FILS_NONCE_LEN);
+	wpa_hexdump(MSG_DEBUG, "FILS: SNonce", snonce, NONCE_LEN);
+	wpa_hexdump(MSG_DEBUG, "FILS: ANonce", anonce, NONCE_LEN);
 	if (dhss)
 		wpa_hexdump_key(MSG_DEBUG, "FILS: DHss", dhss, dhss_len);
 	wpa_hexdump_key(MSG_DEBUG, "FILS: PMK", pmk, pmk_len);
@@ -902,8 +902,8 @@ int fils_key_auth_sk(const u8 *ick, size_t ick_len, const u8 *snonce,
 	wpa_printf(MSG_DEBUG, "FILS: Key-Auth derivation: STA-MAC=" MACSTR
 		   " AP-BSSID=" MACSTR, MAC2STR(sta_addr), MAC2STR(bssid));
 	wpa_hexdump_key(MSG_DEBUG, "FILS: ICK", ick, ick_len);
-	wpa_hexdump(MSG_DEBUG, "FILS: SNonce", snonce, FILS_NONCE_LEN);
-	wpa_hexdump(MSG_DEBUG, "FILS: ANonce", anonce, FILS_NONCE_LEN);
+	wpa_hexdump(MSG_DEBUG, "FILS: SNonce", snonce, NONCE_LEN);
+	wpa_hexdump(MSG_DEBUG, "FILS: ANonce", anonce, NONCE_LEN);
 	wpa_hexdump(MSG_DEBUG, "FILS: gSTA", g_sta, g_sta_len);
 	wpa_hexdump(MSG_DEBUG, "FILS: gAP", g_ap, g_ap_len);
 
@@ -913,9 +913,9 @@ int fils_key_auth_sk(const u8 *ick, size_t ick_len, const u8 *snonce,
 	 *                      [ || gSTA || gAP ])
 	 */
 	addr[0] = snonce;
-	len[0] = FILS_NONCE_LEN;
+	len[0] = NONCE_LEN;
 	addr[1] = anonce;
-	len[1] = FILS_NONCE_LEN;
+	len[1] = NONCE_LEN;
 	addr[2] = sta_addr;
 	len[2] = ETH_ALEN;
 	addr[3] = bssid;
diff --git a/src/drivers/driver_atheros.c b/src/drivers/driver_atheros.c
index 94db413eb..eec0adc70 100644
--- a/src/drivers/driver_atheros.c
+++ b/src/drivers/driver_atheros.c
@@ -1083,17 +1083,17 @@ atheros_sta_auth(void *priv, struct wpa_driver_sta_auth_params *params)
 		wpa_printf(MSG_DEBUG, "%s: im_op IEEE80211_MLME_AUTH_FILS",
 			   __func__);
 		os_memcpy(mlme.fils_aad.ANonce, params->fils_anonce,
-			  IEEE80211_FILS_NONCE_LEN);
+			  IEEE80211_NONCE_LEN);
 		os_memcpy(mlme.fils_aad.SNonce, params->fils_snonce,
-			  IEEE80211_FILS_NONCE_LEN);
+			  IEEE80211_NONCE_LEN);
 		os_memcpy(mlme.fils_aad.kek, params->fils_kek,
 			  IEEE80211_MAX_WPA_KEK_LEN);
 		mlme.fils_aad.kek_len = params->fils_kek_len;
 		mlme.im_op = IEEE80211_MLME_AUTH_FILS;
 		wpa_hexdump(MSG_DEBUG, "FILS: ANonce",
-			    mlme.fils_aad.ANonce, FILS_NONCE_LEN);
+			    mlme.fils_aad.ANonce, NONCE_LEN);
 		wpa_hexdump(MSG_DEBUG, "FILS: SNonce",
-			    mlme.fils_aad.SNonce, FILS_NONCE_LEN);
+			    mlme.fils_aad.SNonce, NONCE_LEN);
 		wpa_hexdump_key(MSG_DEBUG, "FILS: KEK",
 				mlme.fils_aad.kek, mlme.fils_aad.kek_len);
 	} else {
diff --git a/src/pasn/pasn_common.h b/src/pasn/pasn_common.h
index 578e7b122..ded679a4d 100644
--- a/src/pasn/pasn_common.h
+++ b/src/pasn/pasn_common.h
@@ -29,8 +29,8 @@ enum pasn_fils_state {
 
 struct pasn_fils {
 	u8 state;
-	u8 nonce[FILS_NONCE_LEN];
-	u8 anonce[FILS_NONCE_LEN];
+	u8 nonce[NONCE_LEN];
+	u8 anonce[NONCE_LEN];
 	u8 session[FILS_SESSION_LEN];
 	u8 erp_pmkid[PMKID_LEN];
 	bool completed;
diff --git a/src/pasn/pasn_initiator.c b/src/pasn/pasn_initiator.c
index 445ac17ae..74dde993b 100644
--- a/src/pasn/pasn_initiator.c
+++ b/src/pasn/pasn_initiator.c
@@ -273,12 +273,12 @@ static struct wpabuf * wpas_pasn_fils_build_auth(struct pasn_data *pasn)
 		return NULL;
 	}
 
-	if (random_get_bytes(pasn->fils.nonce, FILS_NONCE_LEN) < 0 ||
+	if (random_get_bytes(pasn->fils.nonce, NONCE_LEN) < 0 ||
 	    random_get_bytes(pasn->fils.session, FILS_SESSION_LEN) < 0)
 		goto fail;
 
 	wpa_hexdump(MSG_DEBUG, "PASN: FILS: Nonce", pasn->fils.nonce,
-		    FILS_NONCE_LEN);
+		    NONCE_LEN);
 
 	wpa_hexdump(MSG_DEBUG, "PASN: FILS: Session", pasn->fils.session,
 		    FILS_SESSION_LEN);
@@ -301,9 +301,9 @@ static struct wpabuf * wpas_pasn_fils_build_auth(struct pasn_data *pasn)
 
 	/* FILS Nonce */
 	wpabuf_put_u8(buf, WLAN_EID_EXTENSION);
-	wpabuf_put_u8(buf, 1 + FILS_NONCE_LEN);
-	wpabuf_put_u8(buf, WLAN_EID_EXT_FILS_NONCE);
-	wpabuf_put_data(buf, pasn->fils.nonce, FILS_NONCE_LEN);
+	wpabuf_put_u8(buf, 1 + NONCE_LEN);
+	wpabuf_put_u8(buf, WLAN_EID_EXT_NONCE);
+	wpabuf_put_data(buf, pasn->fils.nonce, NONCE_LEN);
 
 	/* FILS Session */
 	wpabuf_put_u8(buf, WLAN_EID_EXTENSION);
@@ -366,7 +366,7 @@ static int wpas_pasn_wd_fils_rx(struct pasn_data *pasn, struct wpabuf *wd)
 	struct wpa_ie_data rsne_data;
 	u8 rmsk[ERP_MAX_KEY_LEN];
 	size_t rmsk_len;
-	u8 anonce[FILS_NONCE_LEN];
+	u8 anonce[NONCE_LEN];
 	const u8 *data;
 	size_t buf_len;
 	struct wpabuf *fils_wd = NULL;
@@ -410,7 +410,7 @@ static int wpas_pasn_wd_fils_rx(struct pasn_data *pasn, struct wpabuf *wd)
 		return -1;
 	}
 
-	if (!elems.rsn_ie || !elems.fils_nonce || !elems.fils_nonce ||
+	if (!elems.rsn_ie || !elems.nonce || !elems.nonce ||
 	    !elems.wrapped_data) {
 		wpa_printf(MSG_DEBUG, "PASN: FILS: Missing IEs");
 		return -1;
@@ -435,9 +435,9 @@ static int wpas_pasn_wd_fils_rx(struct pasn_data *pasn, struct wpabuf *wd)
 		return -1;
 	}
 
-	wpa_hexdump(MSG_DEBUG, "PASN: FILS: ANonce", elems.fils_nonce,
-		    FILS_NONCE_LEN);
-	os_memcpy(anonce, elems.fils_nonce, FILS_NONCE_LEN);
+	wpa_hexdump(MSG_DEBUG, "PASN: FILS: ANonce", elems.nonce,
+		    NONCE_LEN);
+	os_memcpy(anonce, elems.nonce, NONCE_LEN);
 
 	wpa_hexdump(MSG_DEBUG, "PASN: FILS: FILS Session", elems.fils_session,
 		    FILS_SESSION_LEN);
diff --git a/src/pasn/pasn_responder.c b/src/pasn/pasn_responder.c
index 8a09a7a88..568442e28 100644
--- a/src/pasn/pasn_responder.c
+++ b/src/pasn/pasn_responder.c
@@ -305,9 +305,9 @@ static struct wpabuf * pasn_get_fils_wd(struct pasn_data *pasn)
 
 	/* FILS Nonce */
 	wpabuf_put_u8(buf, WLAN_EID_EXTENSION);
-	wpabuf_put_u8(buf, 1 + FILS_NONCE_LEN);
-	wpabuf_put_u8(buf, WLAN_EID_EXT_FILS_NONCE);
-	wpabuf_put_data(buf, fils->anonce, FILS_NONCE_LEN);
+	wpabuf_put_u8(buf, 1 + NONCE_LEN);
+	wpabuf_put_u8(buf, WLAN_EID_EXT_NONCE);
+	wpabuf_put_data(buf, fils->anonce, NONCE_LEN);
 
 	/* FILS Session */
 	wpabuf_put_u8(buf, WLAN_EID_EXTENSION);
diff --git a/src/rsn_supp/wpa.c b/src/rsn_supp/wpa.c
index 70812f4b1..01ca1679d 100644
--- a/src/rsn_supp/wpa.c
+++ b/src/rsn_supp/wpa.c
@@ -6059,12 +6059,12 @@ struct wpabuf * fils_build_auth(struct wpa_sm *sm, int dh_group, const u8 *md)
 		goto fail;
 	}
 
-	if (random_get_bytes(sm->fils_nonce, FILS_NONCE_LEN) < 0 ||
+	if (random_get_bytes(sm->fils_nonce, NONCE_LEN) < 0 ||
 	    random_get_bytes(sm->fils_session, FILS_SESSION_LEN) < 0)
 		goto fail;
 
 	wpa_hexdump(MSG_DEBUG, "FILS: Generated FILS Nonce",
-		    sm->fils_nonce, FILS_NONCE_LEN);
+		    sm->fils_nonce, NONCE_LEN);
 	wpa_hexdump(MSG_DEBUG, "FILS: Generated FILS Session",
 		    sm->fils_session, FILS_SESSION_LEN);
 
@@ -6129,10 +6129,10 @@ struct wpabuf * fils_build_auth(struct wpa_sm *sm, int dh_group, const u8 *md)
 
 	/* FILS Nonce */
 	wpabuf_put_u8(buf, WLAN_EID_EXTENSION); /* Element ID */
-	wpabuf_put_u8(buf, 1 + FILS_NONCE_LEN); /* Length */
+	wpabuf_put_u8(buf, 1 + NONCE_LEN); /* Length */
 	/* Element ID Extension */
-	wpabuf_put_u8(buf, WLAN_EID_EXT_FILS_NONCE);
-	wpabuf_put_data(buf, sm->fils_nonce, FILS_NONCE_LEN);
+	wpabuf_put_u8(buf, WLAN_EID_EXT_NONCE);
+	wpabuf_put_data(buf, sm->fils_nonce, NONCE_LEN);
 
 	/* FILS Session */
 	wpabuf_put_u8(buf, WLAN_EID_EXTENSION); /* Element ID */
@@ -6257,12 +6257,12 @@ int fils_process_auth(struct wpa_sm *sm, const u8 *bssid, const u8 *data,
 		goto fail;
 	}
 
-	if (!elems.fils_nonce) {
+	if (!elems.nonce) {
 		wpa_printf(MSG_DEBUG, "FILS: No FILS Nonce field");
 		goto fail;
 	}
-	os_memcpy(sm->fils_anonce, elems.fils_nonce, FILS_NONCE_LEN);
-	wpa_hexdump(MSG_DEBUG, "FILS: ANonce", sm->fils_anonce, FILS_NONCE_LEN);
+	os_memcpy(sm->fils_anonce, elems.nonce, NONCE_LEN);
+	wpa_hexdump(MSG_DEBUG, "FILS: ANonce", sm->fils_anonce, NONCE_LEN);
 
 #ifdef CONFIG_IEEE80211R
 	if (wpa_key_mgmt_ft(sm->key_mgmt)) {
@@ -6722,10 +6722,10 @@ struct wpabuf * fils_build_assoc_req(struct wpa_sm *sm, const u8 **kek,
 	wpa_hexdump_key(MSG_DEBUG, "FILS: KEK for AEAD", *kek, *kek_len);
 	*snonce = sm->fils_nonce;
 	wpa_hexdump(MSG_DEBUG, "FILS: SNonce for AEAD AAD",
-		    *snonce, FILS_NONCE_LEN);
+		    *snonce, NONCE_LEN);
 	*anonce = sm->fils_anonce;
 	wpa_hexdump(MSG_DEBUG, "FILS: ANonce for AEAD AAD",
-		    *anonce, FILS_NONCE_LEN);
+		    *anonce, NONCE_LEN);
 
 	return buf;
 }
diff --git a/src/rsn_supp/wpa_i.h b/src/rsn_supp/wpa_i.h
index 9f9a032f1..d0c3541b5 100644
--- a/src/rsn_supp/wpa_i.h
+++ b/src/rsn_supp/wpa_i.h
@@ -205,9 +205,9 @@ struct wpa_sm {
 #endif /* CONFIG_TESTING_OPTIONS */
 
 #ifdef CONFIG_FILS
-	u8 fils_nonce[FILS_NONCE_LEN];
+	u8 fils_nonce[NONCE_LEN];
 	u8 fils_session[FILS_SESSION_LEN];
-	u8 fils_anonce[FILS_NONCE_LEN];
+	u8 fils_anonce[NONCE_LEN];
 	u8 fils_key_auth_ap[FILS_MAX_KEY_AUTH_LEN];
 	u8 fils_key_auth_sta[FILS_MAX_KEY_AUTH_LEN];
 	size_t fils_key_auth_len;
diff --git a/wlantest/rx_mgmt.c b/wlantest/rx_mgmt.c
index be4d53c6d..b27946b27 100644
--- a/wlantest/rx_mgmt.c
+++ b/wlantest/rx_mgmt.c
@@ -987,16 +987,16 @@ static void process_fils_auth(struct wlantest *wt, struct wlantest_bss *bss,
 		sta->pairwise_cipher = data.pairwise_cipher;
 	}
 
-	if (!elems.fils_nonce) {
+	if (!elems.nonce) {
 		add_note(wt, MSG_INFO,
 			 "FILS Authentication frame missing nonce");
 		return;
 	}
 
 	if (ether_addr_equal(mgmt->sa, mgmt->bssid))
-		os_memcpy(sta->anonce, elems.fils_nonce, FILS_NONCE_LEN);
+		os_memcpy(sta->anonce, elems.nonce, NONCE_LEN);
 	else
-		os_memcpy(sta->snonce, elems.fils_nonce, FILS_NONCE_LEN);
+		os_memcpy(sta->snonce, elems.nonce, NONCE_LEN);
 }
 
 
@@ -1365,10 +1365,10 @@ static int try_rmsk(struct wlantest *wt, struct wlantest_bss *bss,
 	aad_len[1] = ETH_ALEN;
 	/* The STA's nonce */
 	aad[2] = sta->snonce;
-	aad_len[2] = FILS_NONCE_LEN;
+	aad_len[2] = NONCE_LEN;
 	/* The AP's nonce */
 	aad[3] = sta->anonce;
-	aad_len[3] = FILS_NONCE_LEN;
+	aad_len[3] = NONCE_LEN;
 	/*
 	 * The (Re)Association Request frame from the Capability Information
 	 * field to the FILS Session element (both inclusive).
@@ -1586,10 +1586,10 @@ static void decrypt_fils_assoc_resp(struct wlantest *wt,
 	aad_len[1] = ETH_ALEN;
 	/* The AP's nonce */
 	aad[2] = sta->anonce;
-	aad_len[2] = FILS_NONCE_LEN;
+	aad_len[2] = NONCE_LEN;
 	/* The STA's nonce */
 	aad[3] = sta->snonce;
-	aad_len[3] = FILS_NONCE_LEN;
+	aad_len[3] = NONCE_LEN;
 	/*
 	 * The (Re)Association Response frame from the Capability Information
 	 * field to the FILS Session element (both inclusive).
diff --git a/wpa_supplicant/sme.c b/wpa_supplicant/sme.c
index 860b75f92..fba6508bc 100644
--- a/wpa_supplicant/sme.c
+++ b/wpa_supplicant/sme.c
@@ -2291,7 +2291,7 @@ void sme_associate(struct wpa_supplicant *wpa_s, enum wpas_mode mode,
 	struct ieee802_11_elems elems;
 	struct wpa_ssid *ssid = wpa_s->current_ssid;
 #ifdef CONFIG_FILS
-	u8 nonces[2 * FILS_NONCE_LEN];
+	u8 nonces[2 * NONCE_LEN];
 #endif /* CONFIG_FILS */
 #ifdef CONFIG_HT_OVERRIDES
 	struct ieee80211_ht_capabilities htcaps;
@@ -2383,8 +2383,8 @@ void sme_associate(struct wpa_supplicant *wpa_s, enum wpas_mode mode,
 			    wpa_s->sme.assoc_req_ie,
 			    wpa_s->sme.assoc_req_ie_len);
 
-		os_memcpy(nonces, snonce, FILS_NONCE_LEN);
-		os_memcpy(nonces + FILS_NONCE_LEN, anonce, FILS_NONCE_LEN);
+		os_memcpy(nonces, snonce, NONCE_LEN);
+		os_memcpy(nonces + NONCE_LEN, anonce, NONCE_LEN);
 		params.fils_nonces = nonces;
 		params.fils_nonces_len = sizeof(nonces);
 	}

From patchwork Tue Jan  6 13:45:13 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180388
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=fR3P9mxr;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=D4V02eFm;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=RxQ/gyzX;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlssD24PKz1xsX
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:46:40 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=yuHSN5CWSl9A14uV4wQk5QPqWAnw5uLxJiM8DXATM9U=; b=fR3P9mxrcyaM+y
	tHAKhN9bjWHonSv12y05Ro+zkSZkzT+pyahtjGo3KD2MSQE+k23w5U9JjuX7j4nafw56fKpxmEMmE
	EDUaG4klR7uSUeimZpTB3h2oFSWJk66WrnLRl2zSf/5P/V9pW2+vB4HP2tgA1qduoSYR4HD7i1/BG
	N/oWYR/0MPlpYDiY7rXqNIqZf8n9W57Oy6bib6EsAzGASaCz08yGSMyHg8EF4VccuFPeNyNQmShCC
	ucQcL2VjOS4fbhfjsUBuvuqvpAlMcjeY/LUCP5btp0g+F8P8DxR6cmPBPN4i/I7yh7+aAHWA8Nli7
	bcUfu/vph3LXlkPmN0Gw==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Ns-0000000D7Tk-284E;
	Tue, 06 Jan 2026 13:46:04 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Np-0000000D7S7-2nnU
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:02 +0000
Received: from pps.filterd (m0279869.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606BfNPt307852
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:00 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=BNx1gFqXItX
	6df9dzEoJlNjlPuq2VFH4Fs37OxHdgC0=; b=D4V02eFm0hDdjXeefWHLTwNb3d9
	e/4RbJsOhAwnLRX5vaOpYEPdUCuNSDLbhWINISpnoizSYefFXfghCfdRYsNy7RrY
	umumfUiChinked1fHkKhSfuyjrS/MmFgCFiLeuu7wS0lQYIlpKg99Vm+Vp2uQugM
	BOtivNQn2K7AMEvE6KyPHFUibg9jYiUQ0eFz7K8KMpLtTaYCZl9dyEBKnGOQ+IgT
	nDKbggbyLk19/8O8uo2tUNbm+zvqhvZVoArPz+VeKaLNwbl1iA5t3X4xjJDCalJG
	ZHktju0JKpZP8yf5SZLmmLqJN7aiKo3uap7UEOg+kpAJBxeDM/biqKDXmHw==
Received: from mail-pf1-f199.google.com (mail-pf1-f199.google.com
 [209.85.210.199])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bh1r6gays-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:00 +0000 (GMT)
Received: by mail-pf1-f199.google.com with SMTP id
 d2e1a72fcca58-7b4933bc4aeso1245077b3a.2
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:00 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707159; x=1768311959;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=BNx1gFqXItX6df9dzEoJlNjlPuq2VFH4Fs37OxHdgC0=;
        b=RxQ/gyzXegA5G83Dh5yOY9H8aebrBy1uBDC50DNEyZx9h76yWMLsUsEN96ZmrjGgi8
         zMvNNmWxMWneflR8u9+7FXDGl+FPB8KEB17Zy6qDrekLiZvjUzZa9lo2o6OrSTEOSZBt
         U5hjyHaUK6qV/SBxIcLmOb/DQyTCZatt7A23zqsvU64rXM4PHLVTVLtvGFMJn7vYYCk1
         sLvZ+8zBCqnodEnFuVYYwyaWR6yfmvjJFMw83xtWd8FTCsYtR6C4kUbxTDMBoTQk7x90
         eNC14T9Qd8j2zEIlPLytyTKuiZCGcOyw/hm3yzdVO92zzEY6zJSrSXpe4cIVx3T2HstQ
         G/Bg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707159; x=1768311959;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=BNx1gFqXItX6df9dzEoJlNjlPuq2VFH4Fs37OxHdgC0=;
        b=pgDZOIuiShe7DA9TEaiMyny4EzCD7cenbrNfM6kDIKOP96xnQDBDSCGuZd0pboAmlE
         BYhcnn9q+MrZ9pEFuQUuzV6rcLZkI7hKrHeT1WrNZ5K6xQ9+OLXmS3tBq46ioRd49v16
         aklhR52C1pPRfwWOJS10pFA7I7JG06jGDY2V83Z7tDWa25yfI+GlkAGbSJlLaQF7zYeb
         l6qWXAF5Xjc2UhjwK2FRheuMCdlXKZm2FEj+vlBm7QmjXuqE3DytthquB4TKfsMUYYDK
         JG10hEzoMEsvKh6M7dd+x2IGDN4Px9Sn07fK7vOvUOzx1fMYtxr7GeoqfK6p8gtUMZlQ
         vvbA==
X-Gm-Message-State: AOJu0YymAQTAjcWDCPwM1b+84iQOtMv7p7zdnRTOhRAtTzVkKYCygpwM
	7YKNzMuTf9xQjQAPC/cOF9QpHM+fw15Fqj/8C3YnB3GjWflppy1ezCZdnYVYMZ66zjDYUqlENsn
	/p/Yn9ytINdoTBGW3eWyCsymoE5FGWIeH6yuIEQmi9TgEFCk95RKt6sPIiJO3tdypiaqMY9H9
X-Gm-Gg: AY/fxX6VW9XBXiDQTPdBKHjk8Lg9a20XuTmW+CttlWe3mCwaIW/T0Y2nrZzs5f/sqSU
	brM+UBfvnf2Mc8fmM1+RB6i7UdRojabgIoT2ht1+i9Js2A+gSv2+gRUyHKFQKn9xfPoEgKkHJmO
	PiOmp8E98WlJVwqs5qAS40fyoBgEShGn35tbiu267Xbf5Z/xPc+5PPUgAlErUHfCTRyPDbYsNVP
	A6huhrbXhZfHxBRuWuIE4pgXCUwObvpDyT43I2YMFwqB9s+LvBOrdWpdDFtAZF+UCEdobeX05m2
	YfD/gLII9VvEAEk4dtt4BcFpFzfmlT7fY7vQso8XdqG8O/1NhMCT/qlK2fHb2h3ssAlH8oy+IMC
	UqJ+96jLI20VgYh1ijoNYiHplIh3Qo3dnyV9ltkJu
X-Received: by 2002:a05:6a00:4c11:b0:7e8:43f5:bd41 with SMTP id
 d2e1a72fcca58-8187f78da0bmr2832308b3a.45.1767707159236;
        Tue, 06 Jan 2026 05:45:59 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IHUg+Rq6mtbMlWc8HxnIK65Y8NJkQvKlSgGk2zkNBmoeBhYEu4ZknzfzRyI1sE0Ks/X0s6L7g==
X-Received: by 2002:a05:6a00:4c11:b0:7e8:43f5:bd41 with SMTP id
 d2e1a72fcca58-8187f78da0bmr2832280b3a.45.1767707158730;
        Tue, 06 Jan 2026 05:45:58 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.45.56
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:45:58 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 03/28] 11bi: Add wiphy capability flag for (Re)Association
 frame encryption support
Date: Tue,  6 Jan 2026 19:15:13 +0530
Message-Id: <20260106134538.2594232-4-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-GUID: KkYXhSq7RnVlL19U350u93SK-agy4Rpu
X-Proofpoint-ORIG-GUID: KkYXhSq7RnVlL19U350u93SK-agy4Rpu
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfXyGzeqyy+Zg2T
 XNDr7OrTL4ndyjijSP/Lud8XnyQ220Socw4y2Gfv9DmH3W37pgn50ogJMUu5wDYp2Syklyhiid0
 C3Z+Xu1n9Lb9sAaZuvIIwXvYRW4XhhDnyUeYWmqu9qaWTDGjzs4I1K9OrUAA8eQfWAsyZlFG6+B
 9fGArcjTi6y3fwSktsJO6zftTwWiFCI5/j4Co9x5LjrMZzQOnPnz6UWRrfRynmaxkqxXTBQt6Nh
 q/U7MK3Ca3jVKU5hlCZUGnmpzdcZfjaPZgVVuhD/pizFzsnvvlAmTijGcN1+y0oKlvyf1svYsCj
 wQZTnDMFTTB1GyAuqZb+sd52HYvyi0Xy0gqnd4fQdNe0UxukQ3ig+aNnhP5YzP7qsiNMsRAERjm
 TkvuEExIhAY+CpgOrCw/RxjVdHsCJVLI6rFFAzMICW9Z3drEZjRKN4D/xn3HYiWthLuZ7Ff5aMa
 dJEIHuJq76Ak19tRa3w==
X-Authority-Analysis: v=2.4 cv=Ctuys34D c=1 sm=1 tr=0 ts=695d1218 cx=c_pps
 a=WW5sKcV1LcKqjgzy2JUPuA==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=YeHZmkfSTWfftN-zYOIA:9 a=OpyuDcXvxspvyRM73sMx:22
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 clxscore=1015 suspectscore=0 lowpriorityscore=0 spamscore=0
 priorityscore=1501 malwarescore=0 bulkscore=0 impostorscore=0 phishscore=0
 adultscore=0 classifier=typeunknown authscore=0 authtc= authcc=
 route=outbound adjust=0 reason=mlx scancount=1 engine=8.22.0-2512120000
 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_054601_846732_7C723AA8 
X-CRM114-Status: GOOD (  14.58  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
 Introduce
    a new wiphy capability flag to allow AP/STA to fetch driver support for
 (Re)Association
    request/response frame encryption via the netlink interface
 NL80211_CMD_GET_WIPHY.    
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

Introduce a new wiphy capability flag to allow AP/STA to
fetch driver support for (Re)Association request/response frame
encryption via the netlink interface NL80211_CMD_GET_WIPHY.

Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
Signed-off-by: Rohan Dutta <drohan@qti.qualcomm.com>
Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/drivers/driver.h              | 2 ++
 src/drivers/driver_nl80211_capa.c | 4 ++++
 2 files changed, 6 insertions(+)

diff --git a/src/drivers/driver.h b/src/drivers/driver.h
index 69f1158f4..172a89aa3 100644
--- a/src/drivers/driver.h
+++ b/src/drivers/driver.h
@@ -2433,6 +2433,8 @@ struct wpa_driver_capa {
 #define WPA_DRIVER_FLAGS2_NON_TRIGGER_BASED_RESPONDER   0x0000000020000000ULL
 /** Driver supports non-trigger based ranging initiator functionality */
 #define WPA_DRIVER_FLAGS2_NON_TRIGGER_BASED_INITIATOR	0x0000000040000000ULL
+/** Driver supports (Re)Association Request/Response frame encryption */
+#define WPA_DRIVER_FLAGS2_ASSOCIATION_FRAME_ENCRYPTION	0x0000000080000000ULL
 
 	u64 flags2;
 
diff --git a/src/drivers/driver_nl80211_capa.c b/src/drivers/driver_nl80211_capa.c
index aed2774dc..7b5b87496 100644
--- a/src/drivers/driver_nl80211_capa.c
+++ b/src/drivers/driver_nl80211_capa.c
@@ -722,6 +722,10 @@ static void wiphy_info_ext_feature_flags(struct wiphy_info_data *info,
 	if (ext_feature_isset(ext_features, len,
 			      NL80211_EXT_FEATURE_SPP_AMSDU_SUPPORT))
 		capa->flags2 |= WPA_DRIVER_FLAGS2_SPP_AMSDU;
+
+	if (ext_feature_isset(ext_features, len,
+			      NL80211_EXT_FEATURE_ASSOC_FRAME_ENCRYPTION))
+		capa->flags2 |= WPA_DRIVER_FLAGS2_ASSOCIATION_FRAME_ENCRYPTION;
 }
 
 

From patchwork Tue Jan  6 13:45:14 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180387
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=m+ahwfZV;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=iHP1vhO9;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=WGgfx5ih;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlssC6b2Cz1xrJ
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:46:39 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=G22H6F+zEYJrkGbaH4hTHrqHUvThQRruMd6qgDRWa/s=; b=m+ahwfZV2xz1ZE
	YtoHmqp/Ujz9wxDa43UJeEH6ufwr5uS+xWUGRI+mcGwd6VE4L4jpGCS8JjgjNKvWfN8MR87zfs/Mh
	bUUxYZ+yYqd3m4ibcC/izG+/y/7S88RsHV3k4zvcKDTYLxpkVlY+Ua4WB4Fd6UxumQ2BZ7GOIGV3A
	iq+SHM9LgkGzikFyCG/5xIWKiRMlvVUWQmb1B9ynzj98EMa/QBj95vr3exsaWMD1OJm49P09FGDqp
	X2NPwXRDy6daG4zwrcnZQwmrjyYuM2D2XvMbqJtGN52EFgqXQEyIAryHAoHyD0wPYCXGomIwkPnzF
	MpOXn2Dle63cQJ8w4dYw==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Nu-0000000D7Uk-34kW;
	Tue, 06 Jan 2026 13:46:06 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Nr-0000000D7Sp-3pgz
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:05 +0000
Received: from pps.filterd (m0279873.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606B7t8i2253728
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:03 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=nrI3LVClbDU
	r15N4KaRqaozpwv8ex9DsqgrFP36sv8M=; b=iHP1vhO9DQtPwtojOwi8ki5+sZ5
	xgUolfUdO79TeWJ1jaaF3G+NntdoayD4jDytmOBIF/unnYtszxALO/pkezFvgsMS
	uktbFJFxunep4vQuaGEQ9SZvxVoD+Njx2OaMusVNVkH91mxupAcsMWNf0CyV08T8
	XhvEcNBP2l9lgU8JH/DtiJNONJjtPCSbQrFTdsDHw93SKXwkk43vnNs4ASRK92g/
	gY4/R8lDf4VaGrbNn2yU5cUaOG13YQkESULNaHcHaX005o9JD0Ndn/I5Lvsj9ADV
	VIKfGIQNETS8mXvoKKzl0Tq+wSFUQ6w9co1V7OfG8VPdpQq1+07yq6nTpnQ==
Received: from mail-pf1-f198.google.com (mail-pf1-f198.google.com
 [209.85.210.198])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgu421jhx-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:02 +0000 (GMT)
Received: by mail-pf1-f198.google.com with SMTP id
 d2e1a72fcca58-7a9fb6fcc78so894545b3a.3
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:02 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707162; x=1768311962;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=nrI3LVClbDUr15N4KaRqaozpwv8ex9DsqgrFP36sv8M=;
        b=WGgfx5ih0rEN11NWwbxESwMLkpyT/Nx/pUOXcTwvLSqj9gnCrZxKQybayjHNErP64C
         qM7jz7IQik0lkJt1owbtpOVyp7X42/rdhpknak8jd+57TFllIuSivjTiB+LxUgFLxFXV
         HjMIAoE1X/1BhiwSnuesN2y6Y0k0YlFxIGLq0df66aj+jQWR5HKLAgB8Y80GoB3zPcL0
         KcDsCPXa4iwPMIHwUzaaNAjlUxxGj/gHEEJdSDLReOZx7Gy/P+haZRSxysxy2A7EWQ9t
         KPRMRNfEcoiNXrdtD2DeHk7gCEkcrHbkFrRR8xGoR+OFMEam850QdkZvfMdZ1iKqF3MR
         lx8Q==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707162; x=1768311962;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=nrI3LVClbDUr15N4KaRqaozpwv8ex9DsqgrFP36sv8M=;
        b=Csdh5cjMlYQq/AEV2febmRaJBBQHqsdBm0rVsM4RDForioMJlvWmveFj8osIqm91Fr
         l43RAHuGH6t+ZnS/vBx0aiunp0/CuMOg6Kk8BPmVRWtuQEd76uiPTQmbHZIZ4J/ZEmpJ
         +q2TDOBKBJSPfA1uqwDGhKuUwsR8XOGLpAd9gJ4/wO/byWIi5ivCkFrKwUlCnqtIRgi1
         TN2KkrSgo+Mk3uvD5iN8/LEB5QwtlPSlLZd4RKyYpMbDsbtgjk6FUqRrz/weiyBLm7PL
         mdpjZUZ+tGx5gA5PkVZQmVZCJyeLivFlj0uXHKkwzswcwsEMsKx1crFeLkl7NAk5DrnY
         vbKw==
X-Gm-Message-State: AOJu0YymUQU4Ttq4gLXV1LKFG71PvxZKsUhbm+8DT7OUYHxey+PXgtO8
	8ARctwA3BNxz942oe6DxoS9HSThxhxmhvhnGZkh9oaHfeq9arK1qKbder0Un6/G5tVrlswjECNW
	JUC+6zNJcBRA3Q6ntMfbsOUG5ycIXKCjwT2ZQNlvoJNjdc8Q4gAk2W/zIKlYT2bXsPqmyYQMs
X-Gm-Gg: AY/fxX4tg+KB3C4bzuIhrd7xzxFP5ytIbfDmdBVLCoyzlx1aHtHpXVsWoUQbr2G7p3R
	86f7pJ386L9X8VD6zVeTI2ZxPXrpzu2b+H/+m5NxhvgRTV+Ugzs1JSheg9DAbwQKzxm8ESnwxDA
	WUOcsZrIrCNa83Ho3AWVbtBAgMbjGV7vtZSsXvNp/SOfc2BfCs+O1p3On9Ull/iMk5skrKuLpi4
	tM4RavobBe7IDEni7Gi42qIemA24a9P2GLsFbSu2XCY4EPntAdizoAT9XgKcc5BPwyOsSjfx/vF
	o7DtlG/FCdYkPCJMT6GmBoZzGq8x4N3Nj4JXGuIgTqmPawRLrT5v2N7l6zBhP3XQtWB8M4YUGoD
	Szbbf2iJpzarIUbDe7wHyBSXQae5zd2aPyDPOaYkc
X-Received: by 2002:a05:6a00:440a:b0:7e8:4587:e8c4 with SMTP id
 d2e1a72fcca58-818834c6380mr2849864b3a.55.1767707161674;
        Tue, 06 Jan 2026 05:46:01 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IF5h6fn93KIOyZmSEAoDVDEZch8li3+MxR1wIi8/tvqMonB/hSbSLuk3X2qHrTfi6pQPa5hdw==
X-Received: by 2002:a05:6a00:440a:b0:7e8:4587:e8c4 with SMTP id
 d2e1a72fcca58-818834c6380mr2849831b3a.55.1767707161115;
        Tue, 06 Jan 2026 05:46:01 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.45.59
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:00 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 04/28] PASN: Extend RSNXE capability field to 32 bits
Date: Tue,  6 Jan 2026 19:15:14 +0530
Message-Id: <20260106134538.2594232-5-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Authority-Analysis: v=2.4 cv=dYuNHHXe c=1 sm=1 tr=0 ts=695d121a cx=c_pps
 a=m5Vt/hrsBiPMCU0y4gIsQw==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=SsaMQA-KyUgChBRtuhYA:9 a=IoOABgeZipijB_acs4fv:22
X-Proofpoint-GUID: 2fDAgty0k0aKXQARM-KWJ4r46NUWtoOi
X-Proofpoint-ORIG-GUID: 2fDAgty0k0aKXQARM-KWJ4r46NUWtoOi
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfXwX6r2sJSEDJE
 VBJc1sh2/7281z2jhVkhyUgqkMVaOi4kPLIeAvygiC/J4iznyPn5dePEt89nGSZnweRZKJPf090
 M4Cce/p1zrfvyITQoHyLGPZe5OiQwBwFDv5pNCH60lMyPL3RqnsMHKdPg3HMcW/tQjirszU9UcE
 DiBAHSuw+TqG7H+HYSs9lHq6Vqm0GI/GGkUtCIAi2qNhg5KdBSn732pqZUz17i22UD3gJFxxk3h
 f5nDpGQ/UV9ksDVmUKxw4Nz3I/IsfzMi3mhRDfLVu17ZSkH82BmyKoVl9PkBEFpz1cHErogjS2X
 hK7nkyMwpetEE+WptoclUKp/J8ZJ5++y2lVCB5meCQDEj1OGjcy51SJMRb7+cbs8QSHtwXNr7uT
 c9KssqpmDqZKkmleC8aSDJRgfhvvN5mT30jYzIHqjYczblp3YJ33j1me7PtPcbdDNnlEeoKdlzX
 qRwMKNZ6bJcCO7UQu4g==
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 priorityscore=1501 adultscore=0 malwarescore=0 impostorscore=0 phishscore=0
 clxscore=1015 spamscore=0 lowpriorityscore=0 suspectscore=0 bulkscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_054604_094117_8AFAF4B9 
X-CRM114-Status: GOOD (  19.09  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  Extend RSNXE capability representation from u16 to u32 to
   support use cases requiring more than 16 bits. Update wpa_pasn_add_rsnxe(),
    pasn_data structure and related APIs to use u32 for rsnxe_capab.
 Signed-off-by:
    Ainy Kumari <ainy.kumari@oss.qualcomm.com> --- src/common/wpa_common.c |
   31 ++++++++++++++++++++++++------- src/common/wpa_common.h | 2 +-
 src/pasn/pasn_common.c
    | 2 +- src/pasn/pasn_co [...]
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

Extend RSNXE capability representation from u16 to u32 to support
use cases requiring more than 16 bits. Update wpa_pasn_add_rsnxe(),
pasn_data structure and related APIs to use u32 for rsnxe_capab.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/common/wpa_common.c          | 31 ++++++++++++++++++++++++-------
 src/common/wpa_common.h          |  2 +-
 src/pasn/pasn_common.c           |  2 +-
 src/pasn/pasn_common.h           |  4 ++--
 wpa_supplicant/pasn_supplicant.c |  2 +-
 5 files changed, 29 insertions(+), 12 deletions(-)

diff --git a/src/common/wpa_common.c b/src/common/wpa_common.c
index d1a6e86a4..4a32ede9a 100644
--- a/src/common/wpa_common.c
+++ b/src/common/wpa_common.c
@@ -4381,23 +4381,40 @@ int wpa_pasn_parse_parameter_ie(const u8 *data, u8 len, bool from_ap,
 }
 
 
-void wpa_pasn_add_rsnxe(struct wpabuf *buf, u16 capab)
+void wpa_pasn_add_rsnxe(struct wpabuf *buf, u32 capab)
 {
 	size_t flen;
 
-	flen = (capab & 0xff00) ? 2 : 1;
 	if (!capab)
 		return; /* no supported extended RSN capabilities */
+
+	/* Determine how many bytes are needed to represent capab */
+	if (capab & 0xFF000000)
+		flen = 4;
+	else if (capab & 0x00FF0000)
+		flen = 3;
+	else if (capab & 0x0000FF00)
+		flen = 2;
+	else
+		flen = 1;
+
 	if (wpabuf_tailroom(buf) < 2 + flen)
 		return;
-	capab |= flen - 1; /* bit 0-3 = Field length (n - 1) */
+
+	/* Set field length bits (bit 0-3 = Field length (n - 1)) */
+	capab |= (flen - 1);
 
 	wpabuf_put_u8(buf, WLAN_EID_RSNX);
 	wpabuf_put_u8(buf, flen);
-	wpabuf_put_u8(buf, capab & 0x00ff);
-	capab >>= 8;
-	if (capab)
-		wpabuf_put_u8(buf, capab);
+
+	/* Write the capability field byte-by-byte (little-endian) */
+	wpabuf_put_u8(buf, capab & 0x000000FF);
+	if (flen > 1)
+		wpabuf_put_u8(buf, (capab >> 8) & 0x000000FF);
+	if (flen > 2)
+		wpabuf_put_u8(buf, (capab >> 16) & 0x000000FF);
+	if (flen > 3)
+		wpabuf_put_u8(buf, (capab >> 24) & 0x000000FF);
 }
 
 
diff --git a/src/common/wpa_common.h b/src/common/wpa_common.h
index 255f5b0c7..a3b4d4df9 100644
--- a/src/common/wpa_common.h
+++ b/src/common/wpa_common.h
@@ -812,7 +812,7 @@ int wpa_pasn_validate_rsne(const struct wpa_ie_data *data);
 int wpa_pasn_parse_parameter_ie(const u8 *data, u8 len, bool from_ap,
 				struct wpa_pasn_params_data *pasn_params);
 
-void wpa_pasn_add_rsnxe(struct wpabuf *buf, u16 capab);
+void wpa_pasn_add_rsnxe(struct wpabuf *buf, u32 capab);
 int wpa_pasn_add_extra_ies(struct wpabuf *buf, const u8 *extra_ies, size_t len);
 
 void rsn_set_snonce_cookie(u8 *snonce);
diff --git a/src/pasn/pasn_common.c b/src/pasn/pasn_common.c
index ef8649b08..11916bd18 100644
--- a/src/pasn/pasn_common.c
+++ b/src/pasn/pasn_common.c
@@ -153,7 +153,7 @@ void pasn_set_rsn_pairwise(struct pasn_data *pasn, int rsn_pairwise)
 }
 
 
-void pasn_set_rsnxe_caps(struct pasn_data *pasn, u16 rsnxe_capab)
+void pasn_set_rsnxe_caps(struct pasn_data *pasn, u32 rsnxe_capab)
 {
 	if (!pasn)
 		return;
diff --git a/src/pasn/pasn_common.h b/src/pasn/pasn_common.h
index ded679a4d..58e11e44b 100644
--- a/src/pasn/pasn_common.h
+++ b/src/pasn/pasn_common.h
@@ -58,7 +58,7 @@ struct pasn_data {
 	const char *password;
 	int wpa_key_mgmt;
 	int rsn_pairwise;
-	u16 rsnxe_capab;
+	u32 rsnxe_capab;
 	u8 *rsnxe_ie;
 	bool custom_pmkid_valid;
 	u8 custom_pmkid[PMKID_LEN];
@@ -236,7 +236,7 @@ void pasn_set_noauth(struct pasn_data *pasn, bool noauth);
 void pasn_set_password(struct pasn_data *pasn, const char *password);
 void pasn_set_wpa_key_mgmt(struct pasn_data *pasn, int key_mgmt);
 void pasn_set_rsn_pairwise(struct pasn_data *pasn, int rsn_pairwise);
-void pasn_set_rsnxe_caps(struct pasn_data *pasn, u16 rsnxe_capab);
+void pasn_set_rsnxe_caps(struct pasn_data *pasn, u32 rsnxe_capab);
 void pasn_set_rsnxe_ie(struct pasn_data *pasn, const u8 *rsnxe_ie);
 void pasn_set_custom_pmkid(struct pasn_data *pasn, const u8 *pmkid);
 int pasn_set_extra_ies(struct pasn_data *pasn, const u8 *extra_ies,
diff --git a/wpa_supplicant/pasn_supplicant.c b/wpa_supplicant/pasn_supplicant.c
index 9d93aedbf..392ad1b08 100644
--- a/wpa_supplicant/pasn_supplicant.c
+++ b/wpa_supplicant/pasn_supplicant.c
@@ -624,7 +624,7 @@ static void wpas_pasn_auth_start_cb(struct wpa_radio_work *work, int deinit)
 	const u8 *indic;
 	u16 fils_info;
 #endif /* CONFIG_FILS */
-	u16 capab = 0;
+	u32 capab = 0;
 	bool derive_kdk;
 	int ret;
 

From patchwork Tue Jan  6 13:45:15 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180390
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=H/haSkqI;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=LGamV7e6;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=JDV0g3/X;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlssW0SqMz1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:46:55 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=JBhlhtQZX8m2sYgOJAcBeHr19RiSaeuwNRfyWAjFaNE=; b=H/haSkqIgIXyWU
	l/y/zqbos/q8VH2yxsb1mC/hUUWa33/qQIutPqNKOdj76lSCBal7wJYEukvLCD3f1li5iP5nnfRy1
	7F9LCglnTXT8Tr52lnju1uZD8xPyUUM2eCvTd4scH2bFnCoFvoOfHyvAbmLwQn86hQowTC8toLA/Z
	IFW1MKjSYyHh/9Vpb3FvOwKzLUvhhct3UfNPZOAAOwYIOv7MJk6mQ0HXasJx2I1R4+jetMeBEsbo6
	d/ZI2yR09Wje2aj2O5gzpPQOUJ/DLJf/N6QJv09l4kwhToS1WZ1cTtEXUfCbhJjQf9MIcLv+B3U17
	6WMJheEhYIALY88YLtpg==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7O8-0000000D7aK-497n;
	Tue, 06 Jan 2026 13:46:20 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7O5-0000000D7WP-37N7
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:19 +0000
Received: from pps.filterd (m0279870.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606AmZBE3052660
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:05 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=lppUKuw1ASP
	YP4mEnEhTMICOmC0I8PDYPq0IpCcWgLk=; b=LGamV7e6sj8qJlKLluDW79V/5bf
	tdQIP0ITOBMiLsB9nN98LlIyEPKp6H8oK1HzxnjViHLXGKQIxqMNswQCAXb1i8/m
	tD7J+fGaW1e4Ola+QfK29/QGraT+mcrPMiCB65UWSJFNDJkqQ8TjmPbJY19EzQmO
	ZeL1QBUubCaUX7YtsNsfiBReSPKs9hpqjFOWUdCS5taM1HNddTIGZgdCHUbUyCSY
	Asv+EBKW/kYiGqb9QsGVnIUfLX1ruXbkuEx0bXi7vsBJ4Tdz+nAV4TwYzrK1/ctz
	M/R6HSJ5/sp5vRdmVO42ZcS6uCabNamH7PDu9Jn4zIqumzw85HF5Am/cD4g==
Received: from mail-pf1-f197.google.com (mail-pf1-f197.google.com
 [209.85.210.197])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgpn9t6nc-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:05 +0000 (GMT)
Received: by mail-pf1-f197.google.com with SMTP id
 d2e1a72fcca58-7d481452732so1802797b3a.1
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:05 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707164; x=1768311964;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=lppUKuw1ASPYP4mEnEhTMICOmC0I8PDYPq0IpCcWgLk=;
        b=JDV0g3/XPsQM7yiBAuoGuV7Twd5NAKQWVpybzQTNq3UTjia3MWxtFm3+yFDw3jZgtk
         qlhwuqOc6UhkQhXkRXEO9D9WbMgpSt86JDm5kpditCFk2IIHh6FmXif0EuOuqUf4LMPr
         +Oi7C2raR9LQ7dyfor8o9aefZT6Vj6RpIw4G2EUzNkeXBoaw/Iubw8YzdMajelxY58ND
         5nWuzY7V/SZfflY7ISqdso6tXSl6tNriS9qXeeVXl4clpK7zkJu7A/x7FTmHwjuQd4Qr
         uvWbqWR7vFA+KwEtAHGJnO2r75kvgS1JCpDKL+VgXjKw/gmn0I1JTOc3f/qCOjk7Qswl
         4RbQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707164; x=1768311964;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=lppUKuw1ASPYP4mEnEhTMICOmC0I8PDYPq0IpCcWgLk=;
        b=GwAr7+6QjzPizSFXLzVPloDXhVgCLZAT4iJZ7Ljwor/GPqZFbkijDzVGaulaE/yChi
         gZSI1iXqcvnY8f+vtbCMaXAkoQKemmsNkeYOqEjBLHjs8WNpVF+DRjDq6TH1tcbMKS0H
         WjnPgk4f+j3soyFuw4CxfVsqTXYdPbLkh7Qa+VOpC+h4Z7G+9KnIcHWXtkcnmE0HnxtY
         0ueQDF86F/yDptV6nmRu3QBqAuCXUgPzfO/+kTNLwdnU30ecGzjf7/Bx83+ZELsyhLFN
         Nf8NbSUc4WoFUakWz4fziqhurqRVPY5G3bvXOsCgHwxQ5wjVvIwvVFvcow8cJNCWbxEh
         UHpQ==
X-Gm-Message-State: AOJu0YyFDy1qdFUm9BeuubEm8jomFH0Ao9Nr7HehRF95w1FO1Qeckjcz
	C85M7FuzDVRKS1tNQuIS6qRGyXK8RCu2q4u5LJ0ZVZLhesxIiziMxIeETvRXrxToyCPjtKlFOc/
	I5BrmkqJygHq93tWTnF0nN17CSUudIzI/jf8TNoq2LdLmH+BNiGyUMLbMEOYP9UUZrXB1TxXX
X-Gm-Gg: AY/fxX6LS+uoQlRGusQBzg00tweI1yMQvY9z/F2jw/nO6PrnmcG7lm05mRqc+G0vJu0
	WX0x/74D1SxPNQ9Zoz6MzVNBfrEzROmHKbbirDtDvyzyKBitTSTUjuBaTBWLaPIneG+emvnKJHF
	INARO1EL1PvRrK99U/sv7mm3GOqe6EJCLM85Glk37Qw99X+FVYSqVdYK5mawcRj53IvkUBS1PDK
	A9Ecghwcd2dgfWAKQjxNixc+DOshhix1kboxry+Q58ReiJmkI2h8KMykEJO9JzSJhQl44IsWB3r
	uphv6DONtQv+hUNz7QTmCr/zIO9iFgi8wMu7HSyfePcAzm0NRpGkA+Lax9/Z9WEEBya3wLtZrwC
	h/lmL2dUIfXZ1QRhZ5SiiZbYqFR0Kj8oIxfr2r3e0
X-Received: by 2002:a05:6a00:2886:b0:7a2:8929:ec with SMTP id
 d2e1a72fcca58-81880390e20mr3032643b3a.6.1767707163974;
        Tue, 06 Jan 2026 05:46:03 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IFH4m8RWdd9AskboSYdnXgWZuOFS9dz2Zn+JzP6I1saWtValHuBpWpU9SXqgpVXUVwTsQWp+g==
X-Received: by 2002:a05:6a00:2886:b0:7a2:8929:ec with SMTP id
 d2e1a72fcca58-81880390e20mr3032619b3a.6.1767707163426;
        Tue, 06 Jan 2026 05:46:03 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.01
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:03 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 05/28] EPPKE: Add wiphy capability flag for EPPKE
 authentication
Date: Tue,  6 Jan 2026 19:15:15 +0530
Message-Id: <20260106134538.2594232-6-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-ORIG-GUID: SgSLQzbQRS3cUDk52kVzcRe2LT4WR7IH
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfX59njyUP4eo+g
 Lq5Ofy7tzAmQmydfGyMuJI50QZ6dw/hJ+9pKg8zyXgK66uC6Ct+F24gABR6vz7vDR9JQQKlohCh
 6kpUzcklaX8XFLj+JC4gSaqY9QJH3hVmehUuBRMDL0I45Uf9W+Q2kfYiNKdzjWaavfBospnpKsJ
 6AHldabxlO7PoTpnwhiME9nrZDPtaEIPMh//V1Zb0rwjEddmVmqIMOnHLTuUpGjL3AHwcSxLjv4
 VLh19Xqb6K1L0C+JXiqLRi0nrVKq5DD/IQFrThk1wWIjhKIaprztRWqLzUOtCPH4du1PnIcu0bv
 UHUOqMVVZu7pVyCodPU0OMr/oBafFuAiNVXfoF9AMyr50BULMHBNuQqiWsKdmtGcScON5KnU9iT
 pzZlrL0zj+uQXleYKwmjU6Ml3MR7cjGlu42pKAiP5G0mpwXg6WfyNWkc6lcPcxv3IJkX3pxIwpK
 5v8BOdlDWbJliMvKklg==
X-Proofpoint-GUID: SgSLQzbQRS3cUDk52kVzcRe2LT4WR7IH
X-Authority-Analysis: v=2.4 cv=KfnfcAYD c=1 sm=1 tr=0 ts=695d121d cx=c_pps
 a=rEQLjTOiSrHUhVqRoksmgQ==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=y_t11D8O1H_K84lGlygA:9 a=2VI0MkxyNR6bbpdq8BZq:22
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 phishscore=0 priorityscore=1501 clxscore=1015 spamscore=0 adultscore=0
 suspectscore=0 malwarescore=0 impostorscore=0 bulkscore=0 lowpriorityscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_054618_025868_DB97318A 
X-CRM114-Status: GOOD (  14.53  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  Introduce a wiphy capability flag to allow the supplicant
   to query EPPKE authentication support in STA mode via NL80211_CMD_GET_WIPHY
    netlink interface. Signed-off-by: Ainy Kumari
 <ainy.kumari@oss.qualcomm.com>
    --- src/drivers/driver.h | 3 +++ src/drivers/driver_nl80211_capa.c | 5
 +++++
    2 files changed, 8 insertions(+)
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

Introduce a wiphy capability flag to allow the supplicant
to query EPPKE authentication support in STA mode via
NL80211_CMD_GET_WIPHY netlink interface.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/drivers/driver.h              | 3 +++
 src/drivers/driver_nl80211_capa.c | 5 +++++
 2 files changed, 8 insertions(+)

diff --git a/src/drivers/driver.h b/src/drivers/driver.h
index 172a89aa3..2ed0282eb 100644
--- a/src/drivers/driver.h
+++ b/src/drivers/driver.h
@@ -2435,6 +2435,9 @@ struct wpa_driver_capa {
 #define WPA_DRIVER_FLAGS2_NON_TRIGGER_BASED_INITIATOR	0x0000000040000000ULL
 /** Driver supports (Re)Association Request/Response frame encryption */
 #define WPA_DRIVER_FLAGS2_ASSOCIATION_FRAME_ENCRYPTION	0x0000000080000000ULL
+/** Driver supports EPPKE authentication */
+#define WPA_DRIVER_FLAGS2_EPPKE				0x0000000100000000ULL
+
 
 	u64 flags2;
 
diff --git a/src/drivers/driver_nl80211_capa.c b/src/drivers/driver_nl80211_capa.c
index 7b5b87496..e1afeb715 100644
--- a/src/drivers/driver_nl80211_capa.c
+++ b/src/drivers/driver_nl80211_capa.c
@@ -726,6 +726,11 @@ static void wiphy_info_ext_feature_flags(struct wiphy_info_data *info,
 	if (ext_feature_isset(ext_features, len,
 			      NL80211_EXT_FEATURE_ASSOC_FRAME_ENCRYPTION))
 		capa->flags2 |= WPA_DRIVER_FLAGS2_ASSOCIATION_FRAME_ENCRYPTION;
+
+	if (ext_feature_isset(ext_features, len, NL80211_EXT_FEATURE_EPPKE)) {
+		capa->flags2 |= WPA_DRIVER_FLAGS2_EPPKE;
+		capa->flags2 |= WPA_DRIVER_FLAGS2_ASSOCIATION_FRAME_ENCRYPTION;
+	}
 }
 
 

From patchwork Tue Jan  6 13:45:16 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180391
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=EaYsPPsD;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=E66GwFvV;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=BosVJLJl;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlssW1H2Mz1xrJ
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:46:55 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=Aw7JNZC20EBnb9iQORN8Wa5f8lJn0LmRTVlbIwQeha0=; b=EaYsPPsDmO0X6o
	fGkPL0JIz64jFNErIl0BvqEZhV8d8JmFuEpGqikDzz8pJ+aC1WKbBo1UqsZX4PzdTYSTrDIQ9D3mQ
	Z422R6eWUTfiwBOz4FBybX1TTJdUYpo3bfBwV5nkIsXiHCMA5+e3ubr35ER3muSFsWLCXP1SOkulQ
	IsjZcFNDkgjtp8KsW2x1roSIr5WXaa1dpdMN0kACFz44tKMeUuFo6PNSTrGixcUGpisDFm7CoA/v7
	ezuCGFqQkW/Z5pEG7iKzMPsQsJwqs8QRWHReZVS3TZ5SCAUxsvLNGHrfOLEANVPJDEUjcKzsIrO2J
	OozQ1dEcRplvwUhrghDA==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7O7-0000000D7Yx-0SuK;
	Tue, 06 Jan 2026 13:46:19 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Ny-0000000D7VS-2In5
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:18 +0000
Received: from pps.filterd (m0279873.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606BJfLU2253762
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:09 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=TUkY8ZKs9+w
	4etrODBRyj6r4Lm8+7zpggJ7mn4optn0=; b=E66GwFvVfRlMlNgF+CYkl0t6z3Q
	EbmITCdIQiB1/kaGRGS+knBtHVZu7+dio5jom8nsZ+VME7fRUMop8MqBXXJAdyHz
	GjQy91ZJ2ucBzy9iuiSGTBDGtb0Sksh3pSO43QQPvc/+j+wq07YnyA5pauvabAk7
	LryhmeOINIlXex8o7d994v5MwpNytq9FAL5KiqJrM5wpS0Sr2wgEK9QgaPG/itie
	P+YOHUzTnahpL8GTIhw8zb7W7SbkOtUcsVnpMPRPpCiO5S2lORJWneHnKWz/gVMb
	eUKHOMbr2oGlPlfQvjtAhk6zy30FfiyyKPV944skC38ZleQYFAB4B5xKJpw==
Received: from mail-pf1-f199.google.com (mail-pf1-f199.google.com
 [209.85.210.199])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgu421jj7-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:07 +0000 (GMT)
Received: by mail-pf1-f199.google.com with SMTP id
 d2e1a72fcca58-7aa148105a2so993275b3a.1
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:07 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707166; x=1768311966;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=TUkY8ZKs9+w4etrODBRyj6r4Lm8+7zpggJ7mn4optn0=;
        b=BosVJLJlqrqLsorDHVP4fYUkckl5GeNFTiJB3JbPgYP+ss8VVjn1xpxjc5Ai92UT3U
         BLBXTThp9FJTVOcIn0/zy/ks7s2knL7N8gzxRjc+gU+nOdFGuuO9wl/A64F7QvFbQVkA
         FFYdZkav4VJH8HQHbH6wIpXaRlRBJRMIPieXLBOyPY7L86SZM2BA5u57DU/8QSGoI3jQ
         r/ii2LxIbwA3DHhDBnULOeJEKqH1ZQdvlfYMiNpl+Esjt+LldhZr3mxuBbDV1LJaXzjN
         kUQqE7zkfOt+nwb4ZPA0EdPMoLv1YnTE69S8huhNP3lGOiKwQmRRJmoO+NKyq2KVxVwH
         E2MQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707166; x=1768311966;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=TUkY8ZKs9+w4etrODBRyj6r4Lm8+7zpggJ7mn4optn0=;
        b=H7kC/CqfJa/Ode4vgPJ4WWgAr3VIvb+4YGYNw59ZErNFzU/i5BMAW0hWCu0nwvByxg
         q021B8Ah6fetqd2wTqWixc54a/Sp1k1NUczYPDDinNqF9IawICeuXOs/yqYjePGFzPUv
         xhr2pMB89LbnwXmQ9RyIFEkMikR87Att8ge7QFlYZ7G8EnuMwGp0AmSuIlUmiOKh4T2D
         i1I7hIp1+zFhmumjDS9WRHx1RiLb4RuE+sQGXtKxjUeqoNxmQ70aBCNz2oYpy32lv/3Z
         rGmjAQMQK1dJ//I9On7wllXRJRu5w6Y58BT+6H8yjc73gF1apCoXjuKonbEwbOzhLgSu
         qIVw==
X-Gm-Message-State: AOJu0YyOdOfYx+2rVc3yIXLi92QIiVNPBVReD8Xi8OATov1YiAyC0CXa
	PlKX818o5zKkfyOfPuTnAoqz631kM//+kBxs28xdbF7UcQ7RNEPsZS2y3mRGNZaptgqXJV0ic8w
	PWwcprG5Zt00D4oC5TDVxQAhAWbEauyGUEDahJq1w/GyY3ujky03vMsf4Txbzfflc1a2vELFd
X-Gm-Gg: AY/fxX4a6lh7AYKN5efoESKwTdzjubGFEJtLbFYDusC4S+gyHnzD8vBZgbJLA7zil9M
	IXowJWRVQ8lvVvRj9Ij5JWew0VnApdwe37z9PZjCsCE7/roxMe/gUZIUXMgsl9wpUxvI/hTdfyK
	P1T5GMfsxuVTRXRADJBHvioF4DEuTuFnS+eeX+Nl4qQy+BS0rcyod6bhp9USbzdxjVCmDJVShBN
	06uCBUKfrPEk3RyI8SHOQ6wAkTttv6YZ9ROQ76YSCyqwVsFk+IcAG+lKiUPzqCa08xmx6VIpgkW
	fEbqkgtaF+2zq68fdDQK4tZnuVw272qGl69+H7DWG4e6QfnUh7+3W/iEOFneIz2fZMWbSLVEhnH
	acVRpPgYaOJHVlOAvQJC+lQCsk/mB3IFSt8q14bCe
X-Received: by 2002:a05:6a00:3305:b0:81b:31e7:114e with SMTP id
 d2e1a72fcca58-81b31e713f6mr139959b3a.22.1767707166271;
        Tue, 06 Jan 2026 05:46:06 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IGQexdjT8apirqRB4xdaHuRa/+1DEx917kFLVTxVH4IYQ2dKHTwqXBLeTyna29zpLwSRGRIWw==
X-Received: by 2002:a05:6a00:3305:b0:81b:31e7:114e with SMTP id
 d2e1a72fcca58-81b31e713f6mr139936b3a.22.1767707165722;
        Tue, 06 Jan 2026 05:46:05 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.03
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:05 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 06/28] 11bi: Enhanced Privacy Protection (EPP) related
 definitions
Date: Tue,  6 Jan 2026 19:15:16 +0530
Message-Id: <20260106134538.2594232-7-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Authority-Analysis: v=2.4 cv=dYuNHHXe c=1 sm=1 tr=0 ts=695d121f cx=c_pps
 a=WW5sKcV1LcKqjgzy2JUPuA==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=eaxH8IqBzdGlCjipp8sA:9 a=OpyuDcXvxspvyRM73sMx:22
X-Proofpoint-GUID: 7kzaMEip1Vrgp16-P3CXxgCBWkBJQ_2r
X-Proofpoint-ORIG-GUID: 7kzaMEip1Vrgp16-P3CXxgCBWkBJQ_2r
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfX2om+BWYYd2k/
 Xz3JDTwehiDpJRrTkujv/p4ZWHgEzWoHyqXsbVnmb+iAE6LhjsLfKLTZjLeYpMHw2XqX8dst7Aw
 7Sr+bw8bg4py0Tac6RKj3wmJnRrEm3Yv96/FL6pRXqPfTlPokLSNDDfha5DqMW6c7kX0I1dVibe
 LQN19sVbXupUDu/NSDvLMQj2JqsY+8xY9qPb/Rg6q18OktCdvILxBHUZNfMt7xky77mUriAV32i
 9MLdFLehbrBAAjd+AyoNr8FI66JJ+OUqh/b6vLrFq/zVK5OCSita+SuJq+igCO27retZLFBYGft
 af/0ehibJgP/NOEnIpXiM5XD+qeH/1xaKZD8wCbUeRKH0tgWRMl2cw5CGjbxmTuq3CX8TJUyypH
 MMuFClw3oKOfA6KGIw5ju7JPxQPklLA05D2g7Zf3festjjWlvLh/L75KGqcus7snZUolFknNsxk
 URFgbuTdkyJUj6+naPw==
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 priorityscore=1501 adultscore=0 malwarescore=0 impostorscore=0 phishscore=0
 clxscore=1015 spamscore=0 lowpriorityscore=0 suspectscore=0 bulkscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_054617_405296_0BCAEE42 
X-CRM114-Status: GOOD (  15.90  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com> As a
 preparation
    to support EPPKE authentication,
 add additional definitions required to support
    the flow. The definitions pertain to the following features introduced in
    draft IEEE P802.11bi/D2.0: -( [...]
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

As a preparation to support EPPKE authentication,
add additional definitions required to support the flow.
The definitions pertain to the following features
introduced in draft IEEE P802.11bi/D2.0:
-(Re)Association Request/Response frame Encryption
-IEEE802.1x (EAP) Utilizing Authentication farmes
-PMKSA Caching privacy

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
Signed-off-by: Rohan Dutta <drohan@qti.qualcomm.com>
Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
---
 src/common/defs.h            | 7 +++++++
 src/common/ieee802_11_defs.h | 5 +++++
 src/common/wpa_common.c      | 6 ++++++
 src/common/wpa_common.h      | 1 +
 src/drivers/driver_nl80211.c | 2 ++
 5 files changed, 21 insertions(+)

diff --git a/src/common/defs.h b/src/common/defs.h
index 0a79ba2a6..eb410386a 100644
--- a/src/common/defs.h
+++ b/src/common/defs.h
@@ -52,6 +52,7 @@
 #define WPA_KEY_MGMT_SAE_EXT_KEY BIT(26)
 #define WPA_KEY_MGMT_FT_SAE_EXT_KEY BIT(27)
 #define WPA_KEY_MGMT_IEEE8021X_SHA384 BIT(28)
+#define WPA_KEY_MGMT_EPPKE BIT(29)
 
 
 #define WPA_KEY_MGMT_FT (WPA_KEY_MGMT_FT_PSK | \
@@ -210,12 +211,18 @@ static inline int wpa_key_mgmt_cross_akm(int akm)
 #define WPA_AUTH_ALG_SAE BIT(4)
 #define WPA_AUTH_ALG_FILS BIT(5)
 #define WPA_AUTH_ALG_FILS_SK_PFS BIT(6)
+#define WPA_AUTH_ALG_EPPKE BIT(10)
 
 static inline int wpa_auth_alg_fils(int alg)
 {
 	return !!(alg & (WPA_AUTH_ALG_FILS | WPA_AUTH_ALG_FILS_SK_PFS));
 }
 
+static inline int wpa_auth_alg_eppke(int alg)
+{
+	return !!(alg & WPA_AUTH_ALG_EPPKE);
+}
+
 enum wpa_alg {
 	WPA_ALG_NONE,
 	WPA_ALG_WEP,
diff --git a/src/common/ieee802_11_defs.h b/src/common/ieee802_11_defs.h
index 1b964439b..35e7852ec 100644
--- a/src/common/ieee802_11_defs.h
+++ b/src/common/ieee802_11_defs.h
@@ -98,6 +98,8 @@
 #define WLAN_AUTH_FILS_SK_PFS		5
 #define WLAN_AUTH_FILS_PK		6
 #define WLAN_AUTH_PASN			7
+#define WLAN_AUTH_1X_UTILIZING_AUTHENTICATION_FRAMES     8
+#define WLAN_AUTH_EPPKE			9
 #define WLAN_AUTH_LEAP			128
 
 /* Authentication transaction sequence number */
@@ -633,6 +635,9 @@
 #define WLAN_RSNX_CAPAB_URNM_MFPR 15
 #define WLAN_RSNX_CAPAB_KEK_IN_PASN 18
 #define WLAN_RSNX_CAPAB_SSID_PROTECTION 21
+#define WLAN_RSNX_CAPAB_ASSOC_FRAME_ENCRYPTION 27
+#define WLAN_RSNX_CAPAB_1X_UTILIZING_AUTHENTICATION_FRAMES 28
+#define WLAN_RSNX_CAPAB_PMKSA_CACHING_PRIVACY 29
 #define WLAN_RSNX_CAPAB_SAE_PW_ID_CHANGE 34
 
 /* Multiple BSSID element subelements */
diff --git a/src/common/wpa_common.c b/src/common/wpa_common.c
index 4a32ede9a..9bf675984 100644
--- a/src/common/wpa_common.c
+++ b/src/common/wpa_common.c
@@ -217,6 +217,8 @@ int rsn_key_mgmt_to_wpa_akm(u32 akm_suite)
 	case RSN_AUTH_KEY_MGMT_PASN:
 		return WPA_KEY_MGMT_PASN;
 #endif /* CONFIG_PASN */
+	case RSN_AUTH_KEY_MGMT_EPPKE:
+		return WPA_KEY_MGMT_EPPKE;
 	default:
 		return 0;
 	}
@@ -2910,6 +2912,8 @@ const char * wpa_key_mgmt_txt(int key_mgmt, int proto)
 		return "PASN";
 	case WPA_KEY_MGMT_IEEE8021X_SHA384:
 		return "WPA2-EAP-SHA384";
+	case WPA_KEY_MGMT_EPPKE:
+		return "EPPKE";
 	default:
 		return "UNKNOWN";
 	}
@@ -2964,6 +2968,8 @@ u32 wpa_akm_to_suite(int akm)
 	if (akm & WPA_KEY_MGMT_PASN)
 		return RSN_AUTH_KEY_MGMT_PASN;
 #endif /* CONFIG_PASN */
+	if (akm & WPA_KEY_MGMT_EPPKE)
+		return RSN_AUTH_KEY_MGMT_EPPKE;
 	return 0;
 }
 
diff --git a/src/common/wpa_common.h b/src/common/wpa_common.h
index a3b4d4df9..8a3f23872 100644
--- a/src/common/wpa_common.h
+++ b/src/common/wpa_common.h
@@ -98,6 +98,7 @@ WPA_CIPHER_BIP_CMAC_256)
 #define RSN_AUTH_KEY_MGMT_802_1X_SHA384 RSN_SELECTOR(0x00, 0x0f, 0xac, 23)
 #define RSN_AUTH_KEY_MGMT_SAE_EXT_KEY RSN_SELECTOR(0x00, 0x0f, 0xac, 24)
 #define RSN_AUTH_KEY_MGMT_FT_SAE_EXT_KEY RSN_SELECTOR(0x00, 0x0f, 0xac, 25)
+#define RSN_AUTH_KEY_MGMT_EPPKE RSN_SELECTOR(0x00, 0x0f, 0xac, 29)
 
 #define RSN_AUTH_KEY_MGMT_CCKM RSN_SELECTOR(0x00, 0x40, 0x96, 0x00)
 #define RSN_AUTH_KEY_MGMT_DPP RSN_SELECTOR(0x50, 0x6f, 0x9a, 0x02)
diff --git a/src/drivers/driver_nl80211.c b/src/drivers/driver_nl80211.c
index 24516637e..30433548e 100644
--- a/src/drivers/driver_nl80211.c
+++ b/src/drivers/driver_nl80211.c
@@ -4278,6 +4278,8 @@ static enum nl80211_auth_type get_nl_auth_type(int wpa_auth_alg)
 		return NL80211_AUTHTYPE_FILS_SK;
 	if (wpa_auth_alg & WPA_AUTH_ALG_FILS_SK_PFS)
 		return NL80211_AUTHTYPE_FILS_SK_PFS;
+	if (wpa_auth_alg & WPA_AUTH_ALG_EPPKE)
+		return NL80211_AUTHTYPE_EPPKE;
 
 	return NL80211_AUTHTYPE_MAX + 1;
 }

From patchwork Tue Jan  6 13:45:17 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180396
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=sttUQ83k;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=Gz3toS9U;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=SgAMZ7IO;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlssg4GKFz1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:47:03 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=vp4Vu15ySHImCEje7sBN4F3cKe+ahA4dfsR5Va/ieqA=; b=sttUQ83k3dYskC
	MXbopaNiPjG7jM1jgvmJlbF90Y8A1NAyjwbWUCjKEccSFnTrYpsLmcu4Tkpl3GbyWHVrAv62CcHDA
	RtRqKCQvV/2O6lSsqbO6imnm9vW1NELgEPvekQA08ay41soLVtx72iXzBLWK4c7YZ5PXAWMKV78K+
	Wsr4B1vm/IEvOlarG/wZRZVVD7J76wUN1RfVlWIUN64QdNEoEKEHlIw7JujqseVdBVFUafkIBp1WV
	hBqiWth3jBu2sc+7TtfL6Z50q1Fxq7szYh4o4674YaEniVZBXQ6b/+OrE6gZYo0k5H9s5u5FbVHVd
	HIFvDxvOD+Q5cDwEZMHQ==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7OH-0000000D7mB-1rtC;
	Tue, 06 Jan 2026 13:46:29 +0000
Received: from mx0a-0031df01.pphosted.com ([205.220.168.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7OC-0000000D7ee-1eGn
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:25 +0000
Received: from pps.filterd (m0279862.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606AiuvY3271952
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:09 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=U+BnfqyYWZS
	o6akiHhAORQfnKjqhUpQKIhoip+xktU8=; b=Gz3toS9UKopHYdTVtHA3Ie7yArq
	VlP3b3+yE6F8xJtlJPBPEB+uVPu8cpkIXKt0S18rShP1OhWCjKnxauOiAOuqV76g
	2nQIOYo46r0W7hjcmu7VCjc9pUMvcPWscKgkJdH3k4dhm+lJMotgaYsrf8ibPK4p
	2FKDQ2axMfCum2XL+D2mWDo15CGjijRTcsBO3pP9kZZ9uvUlvdUHflNcL78BABfw
	1+1CdxY5rYyeq4WK4RMur0AqsXeL1xmhS21dORQXpXOEGfCUXw+ANtJgtM9jcAQx
	b7jAJxp3sUsBpPJd6UspXK8V8c60U4wjCJrae+2Mc/kPgLyts911F/dbqHw==
Received: from mail-pg1-f197.google.com (mail-pg1-f197.google.com
 [209.85.215.197])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgfv03f4g-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:09 +0000 (GMT)
Received: by mail-pg1-f197.google.com with SMTP id
 41be03b00d2f7-bddf9ce4931so1741250a12.0
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:09 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707169; x=1768311969;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=U+BnfqyYWZSo6akiHhAORQfnKjqhUpQKIhoip+xktU8=;
        b=SgAMZ7IOgUS40x8A3ppg50ojaC8G+oV0DqV0HSTPMARaIoAK55xO02GQeTbApMsZ+O
         /aApxdOGMX2gbP1Y/++1mXD0UtUdEwjed73WwzWh2BPNOuojHknelGfJwSOHyntwTgVx
         gxgRSu7ymbX/ZOhT3k96tHs+lU9wfftLkU8vno4PwDNF53FjNYe4btERF3NCAH2Gnb64
         qtGTuMhT7FdqpcbHHWTf3bshdI/I3RGsfmslGkaGCVFJpALyZxnbXK5xuidGZrGryJNU
         P3F8l/9oXhbLSZ4sZPjMFpG1rhauHMAbE1cbgJj2Lk9qtc3TQJhItGdk59CrqdE4OJPI
         u4Bw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707169; x=1768311969;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=U+BnfqyYWZSo6akiHhAORQfnKjqhUpQKIhoip+xktU8=;
        b=LUNMXvkfkfeEh1fumSb1QdLp7s7d/cLB/gQGN67Wl67Ocz6ouMvr04nK4V5RoXo6+F
         oB880p0g4Xm17qNedqERdIIUGwYdRQ7nreHgZlQsLb5mToWGmGGWOq6lMpAqcLrJC7fY
         Dn1kz94YDiwYNrdkVV/+w5L0UeexkS7nrUc9VI87NJaADFWGSAro4L/e28vSLolCIHf8
         y1N/T+GHQAxHKfv812OhbaAzRxRd6dt+F7BkhYq5gL21ijEVlI36JB5CnAZBeGhhe6GG
         ql1MnpNpICnxZTjZGYl0FZnXy2UeD1Bp2xRR51kuGx4Ggf7/NLpiyLtBTNiL662MEof2
         4UKA==
X-Gm-Message-State: AOJu0YxlxouJLxSDW+Y1NxoiuV7uTgB4l6N2idEyP++78CP/TVAYzVtO
	RtCbHYbb/JskbcsHBpA8/xw4tQBlnRJfe7WFhzAWy7mECEkYMDrsMUBFgGiRRSHvzHZ+xJ/fTrq
	TUrIdBmoEsDAtgFP8t1pSayxNq9kbG5PzdIhqMONGhknwWG6l7cJuLxZvlRN/dznXBbwPvoHm
X-Gm-Gg: AY/fxX6q2jIRsMhXcdt84ccCXDBxnhF0w41qpdbUD9pBTsPef5tkC3dTdbM4WeppREA
	Di3W1PkiprZZoqiJByb9KO4ofO1BC/n4gpIbRmJmsuWKAGKT60TzJ+tBlZe4VWPxW9nIPE2sxZi
	X8pRUi78P5zqV25O0m06nX+H00IRMZsVXpPOBh9MEcX2q9F6iTB/t8fX9yWuFLbzTtTDM4UB1hx
	sjjwjnOHmCKdOroTASUukl30MJ5bp9PWABoBT64VDJUYSTETv9cfSDcGA9NTeCGOPuRAhju8aAg
	dm4C61i0f6urC9xkpSS1msR0Z0B8L5iBVZNzncxox3dpd7NXKA2P0/LPF9tbK/7RSftkB8EhnKQ
	mW1Jv0Cg6cVQVPlyGGgGapJlT7PqlrcabrEWIKwx+
X-Received: by 2002:a05:6a00:2c85:b0:7e8:4471:ae5e with SMTP id
 d2e1a72fcca58-818825f2a7bmr3066702b3a.42.1767707168621;
        Tue, 06 Jan 2026 05:46:08 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IFcwLzHN7fTtC/UZYMlNYi+EQoLECaLIMvDemoqJ0jlQ2d/hs14p4lFQke7CgoIgEDakxfL3g==
X-Received: by 2002:a05:6a00:2c85:b0:7e8:4471:ae5e with SMTP id
 d2e1a72fcca58-818825f2a7bmr3066669b3a.42.1767707168051;
        Tue, 06 Jan 2026 05:46:08 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.06
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:07 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 07/28] 11bi: Configuration options to control EPP feature
 support in AP mode
Date: Tue,  6 Jan 2026 19:15:17 +0530
Message-Id: <20260106134538.2594232-8-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Authority-Analysis: v=2.4 cv=e9YLiKp/ c=1 sm=1 tr=0 ts=695d1221 cx=c_pps
 a=rz3CxIlbcmazkYymdCej/Q==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=GNP3BF6is-2k_EN8WVkA:9 a=bFCP_H2QrGi7Okbo017w:22
X-Proofpoint-GUID: Bj4PCuWSV1HKrE_Rmqw_dp-uYaI-GrYA
X-Proofpoint-ORIG-GUID: Bj4PCuWSV1HKrE_Rmqw_dp-uYaI-GrYA
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfX4Dm9VjNQsICY
 1uxwkdWI2A0cP9k7hUg9Lm5E+KKpU4IwnjTl77CTmHDt2ni83GgCBmrVAT40Y8PsuZW39LvLqWd
 4y1rrygtp9kCltIfbpyajA76m7bhIeikCBItUqqNbgux/6+wwVBw9Daap6FJN4+aZu9VPVJRyRf
 pwDI+WS7ErGM7FQooTnNnG+ulQEGBI91E6oyunWxMy8ML2rpH1krL42Noxlq8k6Nh1nTaDmvnIv
 lARwRcd8YyaFiOfXERX+SbptvA4Lu6dQR3YR4l0t6vnVipR3h1klkAkBNu8OrARQ+sRKxCbrCIO
 wgsdzToTVDErCUpuZywOb9thveCtZtMRtVd3A/NWHVw/flnfm3SWysopqLamvSko+SHlGnfiyHI
 CHwxFyNbAPpNFYJUPZwlkc8kfL4k/s3Ywj1cn6nm9mRJ6r61bIBzGE6YdKjwdo7wzspaDJz07Pt
 Owo+hcXxKeUlTzGLyiA==
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 clxscore=1015 impostorscore=0 priorityscore=1501 phishscore=0 malwarescore=0
 suspectscore=0 lowpriorityscore=0 spamscore=0 bulkscore=0 adultscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_054624_457283_E6ED748B 
X-CRM114-Status: GOOD (  20.45  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
 Introduce
    additional configuration options to control the enablement of each of the
    below EPP features in AP: -(Re)Association Request/Response frame
 encryption
    support -PMKSA Caching Privacy Support [...]
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.168.131 listed in
 bl.score.senderscore.com]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.168.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.168.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.168.131 listed in
 sa-trusted.bondedsender.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

Introduce additional configuration options to control the
enablement of each of the below EPP features in AP:
-(Re)Association Request/Response frame encryption support
-PMKSA Caching Privacy Support
-IEEE 802.1X Authentication Utilizing Authentication Frame Support

Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
Signed-off-by: Rohan Dutta <drohan@qti.qualcomm.com>
---
 hostapd/config_file.c  |  8 ++++++++
 hostapd/hostapd.conf   | 23 +++++++++++++++++++++++
 src/ap/ap_config.c     |  5 +++++
 src/ap/ap_config.h     |  5 +++++
 src/ap/wpa_auth.h      |  6 +++++-
 src/ap/wpa_auth_glue.c | 25 +++++++++++++++++++++++++
 6 files changed, 71 insertions(+), 1 deletion(-)

diff --git a/hostapd/config_file.c b/hostapd/config_file.c
index 8d5c1433a..ff85ed765 100644
--- a/hostapd/config_file.c
+++ b/hostapd/config_file.c
@@ -2865,6 +2865,14 @@ static int hostapd_config_fill(struct hostapd_config *conf,
 			return 1;
 		}
 		bss->extended_key_id = val;
+#ifdef CONFIG_ENC_ASSOC
+	} else if (os_strcmp(buf, "assoc_frame_encryption") == 0) {
+		bss->assoc_frame_encryption = atoi(pos);
+	} else if (os_strcmp(buf, "pmksa_caching_privacy") == 0) {
+		bss->pmksa_caching_privacy = atoi(pos);
+	} else if (os_strcmp(buf, "eap_using_authentication_frames") == 0) {
+		bss->eap_using_authentication_frames = atoi(pos);
+#endif /* CONFIG_ENC_ASSOC  */
 	} else if (os_strcmp(buf, "wpa_group_rekey") == 0) {
 		bss->wpa_group_rekey = atoi(pos);
 		bss->wpa_group_rekey_set = 1;
diff --git a/hostapd/hostapd.conf b/hostapd/hostapd.conf
index c76801965..996fa4484 100644
--- a/hostapd/hostapd.conf
+++ b/hostapd/hostapd.conf
@@ -3529,3 +3529,26 @@ own_ip_addr=127.0.0.1
 #bridge=br-lan
 #wpa_key_mgmt=SAE
 #bssid=00:03:7f:12:84:85
+
+##### IEEE 802.11bi related configuration #####################################
+
+#IEEE Std 802.11bi D2.0 introduces following EPP feature capabilities
+#(Re)Association Request/Response frame Encryption: Indicates if AP supports
+#encryption of (Re)Association Request and Response frames
+# 0 = disabled (default)
+# 1 = enabled
+#association_frame_encryption_support=0
+
+#PMKSA Caching privacy: Indicates if the AP would recompute the PMKID after the
+#indicated PMKID in the RSNE identifies a cached PMKSA and a PTKSA was established
+#using the identified PMKSA. The recomputed PMKID will be delivered to the non-AP
+#STA in the key delivery element added in the encrypted (Re)Association Response frame
+# 0 = disabled (default)
+# 1 = enabled
+#pmksa_caching_privacy=0
+
+#IEEE802.1X (EAP) Authentication utilizing Authentication frames: Indicates if
+#the EAP PDU will be encapsulated within the IEEE802.1X authentication frames
+# 0 = disabled (default)
+# 1 = enabled
+#eap_using_authentication_frames=0
diff --git a/src/ap/ap_config.c b/src/ap/ap_config.c
index a92940d75..23c44cef8 100644
--- a/src/ap/ap_config.c
+++ b/src/ap/ap_config.c
@@ -179,6 +179,11 @@ void hostapd_config_defaults_bss(struct hostapd_bss_config *bss)
 #endif /* CONFIG_PASN */
 	bss->urnm_mfpr_x20 = -1;
 	bss->urnm_mfpr = -1;
+#ifdef CONFIG_ENC_ASSOC
+	bss->assoc_frame_encryption = 0;
+	bss->pmksa_caching_privacy = 0;
+	bss->eap_using_authentication_frames = 0;
+#endif /* CONFIG_ENC_ASSOC */
 }
 
 
diff --git a/src/ap/ap_config.h b/src/ap/ap_config.h
index b427a972e..065f43f55 100644
--- a/src/ap/ap_config.h
+++ b/src/ap/ap_config.h
@@ -990,6 +990,11 @@ struct hostapd_bss_config {
 	int mbssid_index;
 
 	bool spp_amsdu;
+#ifdef CONFIG_ENC_ASSOC
+	unsigned int assoc_frame_encryption:1;
+	unsigned int pmksa_caching_privacy:1;
+	unsigned int eap_using_authentication_frames:1;
+#endif /* CONFIG_ENC_ASSOC  */
 };
 
 /**
diff --git a/src/ap/wpa_auth.h b/src/ap/wpa_auth.h
index 12a8b6b1a..36954a19a 100644
--- a/src/ap/wpa_auth.h
+++ b/src/ap/wpa_auth.h
@@ -290,7 +290,11 @@ struct wpa_auth_config {
 	unsigned int secure_ltf:1;
 	unsigned int secure_rtt:1;
 	unsigned int prot_range_neg:1;
-
+#ifdef CONFIG_ENC_ASSOC
+	unsigned int assoc_frame_encryption:1;
+	unsigned int pmksa_caching_privacy:1;
+	unsigned int eap_using_authentication_frames:1;
+#endif /* CONFIG_ENC_ASSOC  */
 	int owe_ptk_workaround;
 	u8 transition_disable;
 #ifdef CONFIG_DPP2
diff --git a/src/ap/wpa_auth_glue.c b/src/ap/wpa_auth_glue.c
index 8418bf8f0..8c59da3d5 100644
--- a/src/ap/wpa_auth_glue.c
+++ b/src/ap/wpa_auth_glue.c
@@ -81,6 +81,25 @@ static void hostapd_wpa_auth_config_update(struct hostapd_data *hapd,
 		!!(hapd->iface->drv_flags2 &
 		   WPA_DRIVER_FLAGS2_PROT_RANGE_NEG_AP);
 
+#ifdef CONFIG_ENC_ASSOC
+	if (_conf->assoc_frame_encryption &&
+	    (hapd->iface->drv_flags2 &
+		WPA_DRIVER_FLAGS2_ASSOCIATION_FRAME_ENCRYPTION))
+		_conf->assoc_frame_encryption = 1;
+	else
+		_conf->assoc_frame_encryption = 0;
+
+	if (_conf->pmksa_caching_privacy)
+		_conf->pmksa_caching_privacy = 1;
+	else
+		_conf->pmksa_caching_privacy = 0;
+
+	if (_conf->eap_using_authentication_frames)
+		_conf->eap_using_authentication_frames = 1;
+	else
+		_conf->eap_using_authentication_frames = 0;
+#endif /* CONFIG_ENC_ASSOC  */
+
 #ifdef CONFIG_IEEE80211BE
 	_conf->mld_addr = NULL;
 	_conf->link_id = -1;
@@ -112,6 +131,12 @@ static void hostapd_wpa_auth_conf(struct hostapd_iface *iface,
 
 	os_memset(wconf, 0, sizeof(*wconf));
 	wconf->wpa = conf->wpa;
+#ifdef CONFIG_ENC_ASSOC
+	wconf->assoc_frame_encryption = conf->assoc_frame_encryption;
+	wconf->pmksa_caching_privacy = conf->pmksa_caching_privacy;
+	wconf->eap_using_authentication_frames =
+		conf->eap_using_authentication_frames;
+#endif /* CONFIG_ENC_ASSOC  */
 	wconf->extended_key_id = conf->extended_key_id;
 	wconf->wpa_key_mgmt = conf->wpa_key_mgmt;
 	wconf->rsn_override_key_mgmt = conf->rsn_override_key_mgmt;

From patchwork Tue Jan  6 13:45:18 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180395
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=E+x1vKph;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=WphaIrca;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=h/yPwFsZ;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlssd41sYz1xrJ
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:47:01 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=sso9FzdIMtX3Hzozjvq9lqPujnsfRZhOqN+1CdS6998=; b=E+x1vKphsVnTsW
	7o+YAzv6qFpKoKu6iQ7OyWAVNBzTtyqiaDkrTVHvLccBCdShf44g9r7iO++zegleo8oyeA1pnus4g
	jPiETWTah0aCorF9B+zXN51PEhKQFk9/NS8qvBDOLt5dCXUuoKizR/BvySZNIniaTU4FYQyCNpeGw
	YRNbMzZhQYhgUqLhyo9qx5MyfMnx2cz8+BaztEASoMKmqRnwrVRuOyLNdRX29xLFizab9GhNX23vI
	vquDB2+7YP8TPhdGT9Ih79a/JF/T3p60+aM/vRlK1/i5Kjc5CFyMnywcVxl9agoQ/PtV97fWHX9ph
	GIvB9l9GSd+TSbkGUNWg==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7OD-0000000D7gn-1vYR;
	Tue, 06 Jan 2026 13:46:25 +0000
Received: from mx0a-0031df01.pphosted.com ([205.220.168.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7OA-0000000D7cM-2SC3
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:23 +0000
Received: from pps.filterd (m0279864.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606AgnmQ1462600
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:12 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=smzktlG5R6V
	7rHy6VHwdVJ3IZ4SC/c4+3PjQgO7eWXQ=; b=WphaIrcaiZcw4GOybqmaq9D4EEJ
	54PYsuKypuEa5iUl2jxJj1nVbB2DDC/oY/3QS8HgETUtgOCvjW2ldWiMc6UBcUfn
	BvdVcBFpD664QFI09xMlGUl3ZVX1NAqbrPP8MVsdX+quMg5Xn1aJ1tsgf4B7hp6k
	FBGy9fSnt+Az2b3Pp7vILb1qRVNzCYxdwLQVLvIhMoJ6fNdM5GamuXh2EKLz7vWi
	rX+YpP1OW2lBn2+y51R9219vpncJYg9LR4pYvUSn7VVDpc8/cS3E7miWosdlJWgN
	q1m4BA+ieDkqtdm5CutmG2Powo11mHjclx35T/8Wda7Md7NlJOUoX9pEeGw==
Received: from mail-pf1-f200.google.com (mail-pf1-f200.google.com
 [209.85.210.200])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bh0vm0fcd-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:11 +0000 (GMT)
Received: by mail-pf1-f200.google.com with SMTP id
 d2e1a72fcca58-7b9c91b814cso2864015b3a.2
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:11 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707171; x=1768311971;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=smzktlG5R6V7rHy6VHwdVJ3IZ4SC/c4+3PjQgO7eWXQ=;
        b=h/yPwFsZcccCM484NYKIVJb9MHld47qI1G9tdNVYOJW/zmkfCprnRhrSUnL14fcce0
         ySoXUOoyKYeAAoVprb34okWaLETyShr1M2MjaAzWuIosC+I5isabHUz08nHK/m00UjR5
         HoyHSsVhGBnQEztJUNMhE90cBJapyPtD8G9hfnme4XSARgy7lfgkavfsFj8++UwSiakG
         NpFUqfZWCKYrEHKhbbeRMc9H5bw/6tadzd5hwU+ZMwTXiXCjNe1CU2KZ+2tT7J/NgfOX
         t2rCpJaIdiHsVAOYeGj4Ql7xzNsrDmYSCXNr4/JPXE3zRZ5cReG3UjcsGjJGhtUOQwSM
         VjGQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707171; x=1768311971;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=smzktlG5R6V7rHy6VHwdVJ3IZ4SC/c4+3PjQgO7eWXQ=;
        b=l3DcXcegCr9EzBTLgY0C+esmaoAQgE7Q7ETJmEGIMayJ6tXUcIlyIJEy+8C9ptYBJ4
         pU6Q7hRzPEmTD3AA0t19Ggv5yd7FeMWmsXNSGeiEo9ptY+9VUiyFZfwPvQqPi7q9CQil
         Km38Z/0MWCeVyVwKAeCVoXlf5SWBKXnsJQXYe+9RCGnWzt0FUZJhGfzJq+0eM8oc3a/Q
         nL7Oi9TBGxRnyBK4xGuTAR6dVxXga0ZIrgGddFOdiR9vopaG458T4Kr6ZNV0W91a0Ct1
         M8SNoYnAO01/H5lmFR23FGbf0NgSzHOjQceyLdgoR3WL0n3e6ocAjeoYdD4hau5tOrg9
         hpyw==
X-Gm-Message-State: AOJu0YyySZcA9tPvprMj0kaXGMEjn7iUYwzALox9D7zetSkO7BZr9HXE
	1jzJme/aNV20u+9sN9tJhThIY0P8k9sQMUTvC3A2V0JQ1R22FgyZwD55XbFOz6Vtu6ny/uE6ISf
	5ovwX93dhtGUKPENOzmslY5e3XkAA0Ji0Salu8p4odSz00eCjmbe3dh7yT/tToqAQWt23pfzD
X-Gm-Gg: AY/fxX7sxbI7UuAKsEFwwUgJOZFF+VNCtkRh2pV5FmhUa/sjoW985C/QfKkW5oesvJ6
	bCOWemGiixZ+Yf86ckYb/sbTLVysu6umLNy5LDJBcgSuj8DQ09IM9+K9Ugsnu0gE/Ryj4ONHQwC
	frcxrumutVU13oRHNYGuflWNi4BPX8W93B12B5UZhyFtH5ERVvfiGU9fATXfqejNAWgfn5ysUhs
	EXWh/R7b5OOwhkacGVZhIBHCjZP90p0UvluYnqUnigEjE0D7dPfu3G2saCKlVqv53U2wkanZvYl
	wBCeLEXjm8uW3dKob5yek2uP6QVDXl9SYgREUn/+5Nj5PAjQEmGMpDAsp4zXVp1uqpJLefVE8bw
	fYwExvuOctW167jkUGUNPq+/dnUT2qtOnSvsFkiXa
X-Received: by 2002:a05:6a00:1ca4:b0:7b6:363b:c678 with SMTP id
 d2e1a72fcca58-8188115f71bmr3322776b3a.6.1767707170848;
        Tue, 06 Jan 2026 05:46:10 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IHn1BK3VCxuiRKgzSUfdWm8upsqu95iohowilmJ9OjZs8YoEBC4GioDDsR06EvC4Bx2XtRRXQ==
X-Received: by 2002:a05:6a00:1ca4:b0:7b6:363b:c678 with SMTP id
 d2e1a72fcca58-8188115f71bmr3322754b3a.6.1767707170341;
        Tue, 06 Jan 2026 05:46:10 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.08
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:10 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 08/28] 11bi: RSNE/RSNXE capability Extensions in AP mode
Date: Tue,  6 Jan 2026 19:15:18 +0530
Message-Id: <20260106134538.2594232-9-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Authority-Analysis: v=2.4 cv=Pa3yRyhd c=1 sm=1 tr=0 ts=695d1223 cx=c_pps
 a=mDZGXZTwRPZaeRUbqKGCBw==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=7b7psht5NXxcJgnpxG4A:9 a=zc0IvFSfCIW2DFIPzwfm:22
X-Proofpoint-GUID: 34iQp50PTiXLkeIE0LR-Cwke1yhEpjdv
X-Proofpoint-ORIG-GUID: 34iQp50PTiXLkeIE0LR-Cwke1yhEpjdv
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfXzUxvp5rR1RtL
 wD470xCV3B/6KMMsXwZDjuXDRFn7DX/f8NnZKpO8vnlNxvBNE0AG2ZhTZdPfTM6jq+ZVOjSTBeN
 y0azfGe2n6LGrpIVbrH+7ujaTBNFkxemHw6qK4IBar7I0Pvsb6ldd9glVY8gCR136id3ERpuS4k
 StPwiL8y+VHqgahOYxaLALEbQpH9f3fPvGU1zbalVM/DVjCs79tYs64PdjQ/l7FJtDgpfeBjDAq
 9kvLHLAHGAz0bBTsw4Ybe0IyFR1lvDIGxc/ewPey20cVm50l/lnJx+nmHwYd/2rgC11kEv2l7+H
 BbILoYNDfv+qqvyp1sMnwrWAjfGlcIudWmMWi2hZ01Np2Gi/d23pMAh2Z/R0NVvx66MAKWHisJF
 A0zFlDXQLDS99WQEPhvYu/L0YB8T/sME3lUHY7og1eCwQDey1oF25nC520dgKFnUvfSgrbK0z77
 IykT4GBAP/ZnrermzVQ==
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 impostorscore=0 clxscore=1015 priorityscore=1501 lowpriorityscore=0
 spamscore=0 adultscore=0 suspectscore=0 phishscore=0 malwarescore=0
 bulkscore=0 classifier=typeunknown authscore=0 authtc= authcc= route=outbound
 adjust=0 reason=mlx scancount=1 engine=8.22.0-2512120000
 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_054622_699155_63377F1E 
X-CRM114-Status: GOOD (  18.57  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
 Advertise
    EPPKE AKM suite in RSN IE of Beacons/Probe Response frames Add support to
    include RSNXE capability indications for the following features in
 beacons/probe
    response frames and EPPKE Authentic [...]
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.168.131 listed in
 bl.score.senderscore.com]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.168.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.168.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.168.131 listed in
 sa-trusted.bondedsender.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

Advertise EPPKE AKM suite in RSN IE of Beacons/Probe
Response frames
Add support to include RSNXE capability indications
for the following features in beacons/probe response
frames and EPPKE Authentication frame 2:
-(Re)Association Request/Response frame encryption
-IEEE802.1X (EAP) Authentication Utilizing Authentication
 frames
-PMKSA Caching Privacy

Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
---
 hostapd/config_file.c      |  4 ++++
 src/ap/ieee802_11_shared.c | 16 ++++++++++++++++
 src/ap/wpa_auth_ie.c       | 23 +++++++++++++++++++++--
 3 files changed, 41 insertions(+), 2 deletions(-)

diff --git a/hostapd/config_file.c b/hostapd/config_file.c
index ff85ed765..5e9ed06e8 100644
--- a/hostapd/config_file.c
+++ b/hostapd/config_file.c
@@ -717,6 +717,10 @@ static int hostapd_config_parse_key_mgmt(int line, const char *value)
 		else if (os_strcmp(start, "PASN") == 0)
 			val |= WPA_KEY_MGMT_PASN;
 #endif /* CONFIG_PASN */
+#ifdef CONFIG_ENC_ASSOC
+		else if (os_strcmp(start, "EPPKE") == 0)
+			val |= WPA_KEY_MGMT_EPPKE;
+#endif /* CONFIG_ENC_ASSOC */
 		else {
 			wpa_printf(MSG_ERROR, "Line %d: invalid key_mgmt '%s'",
 				   line, start);
diff --git a/src/ap/ieee802_11_shared.c b/src/ap/ieee802_11_shared.c
index 750891425..05fb35bf3 100644
--- a/src/ap/ieee802_11_shared.c
+++ b/src/ap/ieee802_11_shared.c
@@ -1153,6 +1153,22 @@ u8 * hostapd_eid_rsnxe(struct hostapd_data *hapd, u8 *eid, size_t len)
 	if ((hapd->iface->drv_flags2 & WPA_DRIVER_FLAGS2_SPP_AMSDU) &&
 	    hapd->conf->spp_amsdu)
 		capab |= BIT(WLAN_RSNX_CAPAB_SPP_A_MSDU);
+#ifdef CONFIG_ENC_ASSOC
+	/* Per IEEE802.11bi/D1.2, 12.16.7 PMKSA caching privacy
+	 * A STA that sets the PMKSA Caching Privacy Support
+	 * field in the RSNXE to 1 shall set the (Re)Association
+	 * Frame Encryption Support field in the RSNXE to 1
+	 */
+	if ((hapd->iface->drv_flags2 &
+	     WPA_DRIVER_FLAGS2_ASSOCIATION_FRAME_ENCRYPTION) &&
+	    (hapd->conf->assoc_frame_encryption ||
+	    hapd->conf->pmksa_caching_privacy))
+		capab |= BIT(WLAN_RSNX_CAPAB_ASSOC_FRAME_ENCRYPTION);
+	if (hapd->conf->pmksa_caching_privacy)
+		capab |= BIT(WLAN_RSNX_CAPAB_PMKSA_CACHING_PRIVACY);
+	if (hapd->conf->eap_using_authentication_frames)
+		capab |= BIT(WLAN_RSNX_CAPAB_1X_UTILIZING_AUTHENTICATION_FRAMES);
+#endif /* CONFIG_ENC_ASSOC */
 
 	if (!capab)
 		return eid; /* no supported extended RSN capabilities */
diff --git a/src/ap/wpa_auth_ie.c b/src/ap/wpa_auth_ie.c
index 220ac809f..6ae1350a0 100644
--- a/src/ap/wpa_auth_ie.c
+++ b/src/ap/wpa_auth_ie.c
@@ -303,7 +303,13 @@ static u8 * rsne_write_data(u8 *buf, size_t len, u8 *pos, int group,
 		num_suites++;
 	}
 #endif /* CONFIG_PASN */
-
+#ifdef CONFIG_ENC_ASSOC
+	if (key_mgmt & WPA_KEY_MGMT_EPPKE) {
+		RSN_SELECTOR_PUT(pos, RSN_AUTH_KEY_MGMT_EPPKE);
+		pos += RSN_SELECTOR_LEN;
+		num_suites++;
+	}
+#endif /* CONFIG_ENC_ASSOC */
 #ifdef CONFIG_RSN_TESTING
 	if (rsn_testing) {
 		RSN_SELECTOR_PUT(pos, RSN_SELECTOR(0x12, 0x34, 0x56, 2));
@@ -503,7 +509,20 @@ static u32 rsnxe_capab(struct wpa_auth_config *conf, int key_mgmt)
 		capab |= BIT(WLAN_RSNX_CAPAB_SSID_PROTECTION);
 	if (conf->spp_amsdu)
 		capab |= BIT(WLAN_RSNX_CAPAB_SPP_A_MSDU);
-
+#ifdef CONFIG_ENC_ASSOC
+	/* Per IEEE802.11bi/D2.0, 12.16.7 PMKSA caching privacy
+	 * A STA that sets the PMKSA Caching Privacy Support
+	 * field in the RSNXE to 1 shall set the (Re)Association
+	 * Frame Encryption Support field in the RSNXE to 1
+	 */
+	if (conf->assoc_frame_encryption ||
+	    conf->pmksa_caching_privacy)
+		capab |= BIT(WLAN_RSNX_CAPAB_ASSOC_FRAME_ENCRYPTION);
+	if (conf->pmksa_caching_privacy)
+		capab |= BIT(WLAN_RSNX_CAPAB_PMKSA_CACHING_PRIVACY);
+	if (conf->eap_using_authentication_frames)
+		capab |= BIT(WLAN_RSNX_CAPAB_1X_UTILIZING_AUTHENTICATION_FRAMES);
+#endif /* CONFIG_ENC_ASSOC */
 	return capab;
 }
 

From patchwork Tue Jan  6 13:45:19 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180392
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=VOweTvBx;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=OmpRWCGL;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=IB28HfjM;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlssZ0J90z1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:46:58 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=84GqvPK4ZUyu5auCDofXPrKtPM/EpTR06J82qKTdp5E=; b=VOweTvBx83gtiq
	BM2VaoETQa3sB8A/ceiIlgLvsIsLpPQCI8XOlOBsec/xvdmrkLNC2IY2YjHlk7OAoqbZy3qJz6n1X
	iYAohX2SNNoQ6v+l94O0enPglUuNLpt93f8JeZOPwOoartMZj5Hmn8rcFwjeTb1MEUpWKEeRQQVf/
	yAa0UPsfha5iev7AglAMPdicdSU1kQKnrC9+9hUCjNRa+fIbtgC5KhQZqu4zAdXf9MkJOxOelALVz
	QuG9l/TEwqUFA24LHbh5yME110S0A7SPj1lOHxQn6fKBhM5Rg2YSGN11N85+NrdR7hk6CKrg1uRHf
	EZljcs4fuxTTEdvHePBA==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7OA-0000000D7bl-0Ham;
	Tue, 06 Jan 2026 13:46:22 +0000
Received: from mx0a-0031df01.pphosted.com ([205.220.168.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7O7-0000000D7ZL-3FWj
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:20 +0000
Received: from pps.filterd (m0279865.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606AMLjN3074172
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:14 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=lsQTdiSDdi2
	5z8DdfCMYZul3gsuxrsm2oGjI5hzJufQ=; b=OmpRWCGLGsFBlTJhOBIT/DLniWJ
	0ko7//GFN6FlYn2TAbVE6Oim1vLN2sPdcbfx/xDZt6SgE0I5iG5ADM1gJACy/VF1
	LovuB5BASRqRBbwwhh5f+sZFxBl/IoxKRUbQrQ66y3Ac/Tdo3EDvSkiPFlsXZLCg
	CG4b1IipGtAmoV6v+ZJOi5uTuHZeBujBNFps2nAgChPNM3/d7VFNBNCDer9MPMLE
	pCsqTHoLcZHvbjVtPzDpZ5yOSgP7gOKUuV2ifMgvBwQvi3t7cLrTLiAslnEW/gkd
	/j8tjnH4HsJBIsWzqqg8DXE6cuylvVYFwuU1PFTvK7ZG2Ef23F/79aYS0YA==
Received: from mail-pj1-f70.google.com (mail-pj1-f70.google.com
 [209.85.216.70])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgrf7hyv6-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:14 +0000 (GMT)
Received: by mail-pj1-f70.google.com with SMTP id
 98e67ed59e1d1-34c43f8ef9bso2542565a91.1
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:14 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707173; x=1768311973;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=lsQTdiSDdi25z8DdfCMYZul3gsuxrsm2oGjI5hzJufQ=;
        b=IB28HfjM6y/9t3V8TUOiwT54snH1VFpt+HriS4/AwTNlsrdUicl66FIe+ftqKAIN3Z
         JF161sidOY9u+gAZ6i+Hh2N+KxgdSUNkpzKN25tidEEwOWM86ZtVTBduTX7ZJsV8nk93
         fKfQU+uaUfFpzLshYwjaTFJ9CIsy3VVcuhn4o16gBJxRbqPMihy0LjGcyoNU+NWDhpOq
         bMvKOWzljtJCrL+mZJBNcg8hBcc25lVQjcvs8fgvC5QKyXAVY9Uvs7MZv2R7YyzAxddA
         grE+LKh7uy1zDsHWSo7U6XZFsiawWjaiD9f+HeiKE6ewtyVsG060iK9S1hV/AZumrRt6
         zjKw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707173; x=1768311973;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=lsQTdiSDdi25z8DdfCMYZul3gsuxrsm2oGjI5hzJufQ=;
        b=LjVQTsW+Pp6Cx2qN2FW8XGFdSCbet8RtIe5vWAZcRvP0H1FU1b3uWeez7F4N8izeom
         fOWQWJIsjvRVdgmdnyJVzU1qufS7//nUTvknw4HFIaZsaKDrpkAzse/Yr21ViLqXgz3u
         adpdREuLm5YCUqDgKVBhFk5U6dnM5xShyNSqojwW3UTqAdLXd4fYUN4XotPy29QiBG42
         Y9+orOPp8CZjuxuYQdi63Gd5Q7oDxp3SpXJkz78Dpiplq6xiBySfUiQX2M3XvQREIfP7
         kNGxbeONCjZj3gNJtwy/7a9Snte2ibHirujbPH+EtHPp/oTYG7jF/7pJqFLGe7jTdmS/
         xEOw==
X-Gm-Message-State: AOJu0YwT1GeTdi4jC54j0mcmqsm45/ple6Lpg1koorf7we3q3hpzOJ6U
	dRsL9r5Idy2qG4zP1HwalUV4P5+e7NR5Nvodq4oI1cn6xMgsnukJNf0NawE9RL/HOFCQ0yrzCNv
	YxN7i8kYoTQU0vVFlYbc3o5QtcVw99ZjvgQotv6y05SzqsINKo5DEygRWRdCskjzzuyN+kpBZ
X-Gm-Gg: AY/fxX6NGwkp9gfEkcFeixSeP2sZ+eksy9pvdD5gawNSykdkQd8jiQsf+9eKTgCEDbT
	fxRXJdWRKAoRhXISlS/z6fxGunw6sEw3qgCa9OU5hyrpURIH1m4KCRrJh2iLz6/mbCwI6vl+51K
	z5zEcl5mzRbzRmJcpoVO62/Hdj0eTeOmbM0dV+2uEkBJbDUoAfoqlKgu+j1F93Ks+nNcxBZOa3m
	Ts8E1xZmT+m9WudU2vm4/yzFle9NHuQfym/e9ZWeRsNj04ya/FbvzGYkMbtnTBIeBTgu9huY2j1
	4su5a7sdBWicHpDM9jCY9FagtANhTKkfoZ+KeYz9TOgAadyMNW3FfKZNuIQv5PUWLvT57m2y+jq
	vHntDmx9eQZNrbLHecnxXvnj8XFzqCk5SxlYHXYDD
X-Received: by 2002:a17:90b:57e8:b0:34b:75f4:96d3 with SMTP id
 98e67ed59e1d1-34f5f84a9cfmr2231066a91.5.1767707173197;
        Tue, 06 Jan 2026 05:46:13 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IEnhVo3Sn/C8uH6maw0sHzTJa7OZNagcoJEzfVAMvF91Es6FfFSVzfZZ5usy2+eXckmNRosIA==
X-Received: by 2002:a17:90b:57e8:b0:34b:75f4:96d3 with SMTP id
 98e67ed59e1d1-34f5f84a9cfmr2231044a91.5.1767707172640;
        Tue, 06 Jan 2026 05:46:12 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.10
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:12 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 09/28] wpa_supplicant: Add CONFIG_ENC_ASSOC for association
 frame encryption support
Date: Tue,  6 Jan 2026 19:15:19 +0530
Message-Id: <20260106134538.2594232-10-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-ORIG-GUID: NQLxQLZgk8eLEx44zRx-lSwBGCimz_wQ
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfXwB/dUDmd9cuN
 YISoalWePAXkQoabGWMZJTDZSf+4KUGGoFyjdqFitxmAyt6TBo6xPe90/Dmk3SEloIe4DCZTK4J
 m2xeps14orATHbATu+HHKRCElDZ6Kagxf6LtcuDonUP2ZRa1FPOFyrT35vcZxCrbBk2SG2VhvY7
 czvN8ybihuh3AeMxUPUudX5LObj5IANCy6Aj/g6DuFueT8wUVcNyFrWacEE75H1WkfabeVpeQH+
 8pT03dctRm4hp+40z9Z9q4k5lzz/sMJqKF0Dh+2UVhzZQbk/uMErJ399d7xG+wJBEL9qBWrJt9r
 FKpgVJEGQ4FthEMHSNzETgEZYK13jyFE+scAL/fFhVdVX407bXJKryHAg4veOKyocEe5oP2/+0Z
 Qm7ngopHtYo5TvkS7vjctsg9nkrG2TSSvt2JShystQk7hxNWf3R34qGmKLhJC0Ifeqw1E2aUSFb
 0eEudSFyI3Zid9RAU3g==
X-Proofpoint-GUID: NQLxQLZgk8eLEx44zRx-lSwBGCimz_wQ
X-Authority-Analysis: v=2.4 cv=FK0WBuos c=1 sm=1 tr=0 ts=695d1226 cx=c_pps
 a=0uOsjrqzRL749jD1oC5vDA==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=v5wKuGWGPaTtaeehA4MA:9 a=mQ_c8vxmzFEMiUWkPHU9:22
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 suspectscore=0 spamscore=0 impostorscore=0 bulkscore=0 malwarescore=0
 lowpriorityscore=0 phishscore=0 priorityscore=1501 clxscore=1015 adultscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_054619_816779_62F833A1 
X-CRM114-Status: GOOD (  13.02  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  Introduce CONFIG_ENC_ASSOC in defconfig and update Makefile
    to enable association frame encryption. When enabled,
 also set CONFIG_PASN,
    since EPPKE authentication requires association frame encryption [...]
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.168.131 listed in list.dnswl.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.168.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.168.131 listed in
 sa-trusted.bondedsender.org]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.168.131 listed in
 bl.score.senderscore.com]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

Introduce CONFIG_ENC_ASSOC in defconfig and update Makefile to enable
association frame encryption. When enabled, also set CONFIG_PASN,
since EPPKE authentication requires association frame encryption and
relies on the PASN base code.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 wpa_supplicant/Makefile  | 5 +++++
 wpa_supplicant/defconfig | 3 +++
 2 files changed, 8 insertions(+)

diff --git a/wpa_supplicant/Makefile b/wpa_supplicant/Makefile
index b92b1e3f2..3bff566fd 100644
--- a/wpa_supplicant/Makefile
+++ b/wpa_supplicant/Makefile
@@ -444,6 +444,11 @@ OBJS += ../src/pasn/pasn_common.o
 OBJS += pasn_supplicant.o
 endif
 
+ifdef CONFIG_ENC_ASSOC
+CONFIG_PASN=y
+CFLAGS += -DCONFIG_ENC_ASSOC
+endif
+
 ifdef CONFIG_HS20
 OBJS += hs20_supplicant.o
 CFLAGS += -DCONFIG_HS20
diff --git a/wpa_supplicant/defconfig b/wpa_supplicant/defconfig
index 84ac8ba12..5861edc9c 100644
--- a/wpa_supplicant/defconfig
+++ b/wpa_supplicant/defconfig
@@ -682,3 +682,6 @@ CONFIG_DPP2=y
 
 # Wi-Fi Aware unsynchronized service discovery (NAN USD)
 #CONFIG_NAN_USD=y
+
+# IEEE P802.11bi/D2.0 Support (Enhanced service with Privacy Protection)
+#CONFIG_ENC_ASSOC =y

From patchwork Tue Jan  6 13:45:20 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180393
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=xy4Zi+TQ;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=QXbnmgwY;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=kUIe6X+N;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlssc1BGlz1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:47:00 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=HacrPOiEecK+kGcv0tz9Q/1fa3dYuEqdGTThVEkPgtI=; b=xy4Zi+TQ6nMlFY
	WWQeI9yaj287BHheLn/Rx/8ijz8qfib8s2/yfr6RhEf5RQHzGqikb6hBFGLWcsI8IsxxC2lisxaN7
	gvMze3LtgLJizQoEvFqJMW1sS9TUlKPl9b9x+ZKbONr711CWzNGH3qLQiZf7blTyw3W8LYYvrKri8
	Gp1QTXoWrOV3ZtMwinR/3Q2UBcwYSr8WDlNF8VJmK1neIQD9Md08S4qJTXW7VvsT8ELXZEytSlRln
	WMrDel77n3JWfLLK9M4EyPAjL5mseTDN5fCnmeRCAa4mXOsygokaiOG/FDpPuBJOIhrYloZDbKy81
	rtGZQ3r0Cnr/q/X/U0Bw==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7O9-0000000D7aj-1myy;
	Tue, 06 Jan 2026 13:46:21 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7O5-0000000D7WQ-3NsR
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:19 +0000
Received: from pps.filterd (m0279873.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606BVcmu2253955
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:17 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:content-type:date:from:in-reply-to
	:message-id:mime-version:references:subject:to; s=qcppdkim1; bh=
	ebnOucrcEqzmh/RZr8XDi6LDcDGSxJb1OuGI2mAGQ9g=; b=QXbnmgwYPiS5vzvW
	2/ZWISHO4w8/DuQL6wL4bU+92wWhLKW4ysWjRUnuxCT0dCENiaRIp9CZ2oGIpxNO
	G5ZvbbRgW7xbhMLcRkmUVxBLPrhPSb0GkXdUJ4h43T64WOmIB+7d2XVxi23KWH35
	DbA6epAqSSrKetu5+WJ9qc3aj/OqOPC3QM0nRiGbFi8pT6Vme/Pbax4CdOVuwhwI
	QMFyP4+3FbpfasYW4HcPRlw38RgElNSTV4av+fHcL6hz4U9FhPPpeWgLhrNfzHKM
	i74HVjl+dss4+Xbcm5KdISMN6kK0uIm6X7EqzhozgAlA35rnJTpcfHP4+sX9y0q/
	CoRL0g==
Received: from mail-pf1-f200.google.com (mail-pf1-f200.google.com
 [209.85.210.200])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgu421jjm-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:16 +0000 (GMT)
Received: by mail-pf1-f200.google.com with SMTP id
 d2e1a72fcca58-7f66686710fso2863193b3a.3
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:16 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707175; x=1768311975;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=ebnOucrcEqzmh/RZr8XDi6LDcDGSxJb1OuGI2mAGQ9g=;
        b=kUIe6X+NjsUCRTvooCE5/TZebexd2nD9ab9QFVXFt92D7tYHlYU9s1FoChAq5h3URt
         2BxOVHUmgloI92nIkCbxN0hSwmhWkeLWjczxbKoB9D7jmrOP5hNy7SZeSSeqROKhY+RX
         vQ4fbb0QSkVNoxgwrKeZ/YQ8fCyWtuII6EmHJPky9ZrRNLt37v2Ki7pKdoeG43oUNyCF
         P/0VECZ8Ag5ZYdU1NTK3fArq/BAE0+pWlKocX9DuWGfHzrj9OnT3Ck4LBUe4tK6xLBqw
         MYUe1cdqjopxm1M4dZB6hILNE6kVVxAILhLRAjWMSt8exgIFlZud5aVrBcYOJQZPjS3m
         8tug==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707175; x=1768311975;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=ebnOucrcEqzmh/RZr8XDi6LDcDGSxJb1OuGI2mAGQ9g=;
        b=jm7ThWihADStDtn2g80y1yZGcC+eblHkxFHUtxBAeCtHfi5bIrTQc7feZib63XuYtQ
         kbQpP+JNJhsFD9s22PEaV7jV5fAnzk1lUSbSyZs4IEPgbp7ffM6zvpbvb22qHGc4InYz
         5Sg7bCxlGDNXnzp3RLK1ZMLK7/iy1O3IE1Vtg4Fpb8Mg9iH9pL2s7KxIC83hX/5yDbS/
         +6R5sQpFya3fd2wGT39urnmLEV5WUJ5Rymx7hSNs5O8AxMnzhrbT/p6dQQ5FmsdCXNSD
         KSdaOhJZJ2ib8Uj+YQ+GwZ40lwnrO0JGO/OKyLoF1HL9l7pFwcpP4c8eRy5KEcMEnDfT
         IeUw==
X-Gm-Message-State: AOJu0YzqHHUdXkux4VtfHjxudhAyHDh2RFE9/i1bPKIsTXwog9QmRm7O
	rDvq9Y8EYF8DaCC0bNzzmyYeDZj+fS5ltwpaUfutXe66rNOkj7oyAsMGSJyTjQ+ONqo7N5lZIwM
	Ew7/UhhF86GwbouXPDmENVHBQ8fCSzUZ/kgG2nCrA6Ba2mRwG3EgcwPKsV8IxVVydQ3dd0oe0
X-Gm-Gg: AY/fxX5UTy46kj75qZxt7Oh0iNl4u7R3adIYwg49NZyZjfRMecjJMWhIiEUMBoDeI/S
	4ypleq0nRazbapA/k2QyAoZRW/ym3ljid3Rf23vWHBvjuQXPwHAzpy0I5lbJ7AzV+Eb5j1bI1fP
	x6kF4obuTgJOPtKZhQSvUYKkqLyCGv4zD3bUkTacEmdtYzqXwflx7dr9PS9MMM3qzWwoaJS8Xv5
	srDeqEjEPd2FuwDcHFH7qVdkmuVmjCE589zR2TFw9S9WWNVGu9JEJFe7NArcDnMCpx6wPo9xU7r
	VAVWRp8l7JhEodeIudo9sjZ2ZadEeezafF3Qe4CFAfjZur+a7i9U5QjyQWCIQGXiNQASc1sHkHP
	jvEzIm5QF2GO/4We3X6YV0r+5+M6e9uHmeqRB6rc/
X-Received: by 2002:a05:6a00:3690:b0:7f6:6011:b0fd with SMTP id
 d2e1a72fcca58-81883996bb0mr2684384b3a.58.1767707175416;
        Tue, 06 Jan 2026 05:46:15 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IHxBVrp8VyfTBVcJ9tGxAt+KF6UgVrQ8mEmQwbW79nSalUHPRgu6c8KGp49aLw2Fcjdksq6aw==
X-Received: by 2002:a05:6a00:3690:b0:7f6:6011:b0fd with SMTP id
 d2e1a72fcca58-81883996bb0mr2684362b3a.58.1767707174952;
        Tue, 06 Jan 2026 05:46:14 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.12
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:14 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 10/28] EPPKE: Add EPPKE support to PASN PTK derivation per
 IEEE P802.11bi/D2.0
Date: Tue,  6 Jan 2026 19:15:20 +0530
Message-Id: <20260106134538.2594232-11-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Authority-Analysis: v=2.4 cv=dYuNHHXe c=1 sm=1 tr=0 ts=695d1228 cx=c_pps
 a=mDZGXZTwRPZaeRUbqKGCBw==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=IkcTkHD0fZMA:10 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10
 a=VkNPw1HP01LnGYTKEx00:22 a=EUspDBNiAAAA:8 a=I1L7H4vTCBpQMSOqNl8A:9
 a=3ZKOabzyN94A:10 a=QEXdDO2ut3YA:10 a=zc0IvFSfCIW2DFIPzwfm:22
X-Proofpoint-GUID: _qNXIHIk7PuyH4OsAP84U5u91lWGEgLL
X-Proofpoint-ORIG-GUID: _qNXIHIk7PuyH4OsAP84U5u91lWGEgLL
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfX9GwsEhTLKwn5
 HUqUy1qhj95ZdOXFq1sSkWh+SSQi9haMRCdtGxPzN3aWdbWlmAL7GLg0OMdk2m1/PESvEDvykLr
 rnf2FxdKgwtwsrINyafvo9VcSSUqkk08hOiJ71J3/5pSwoKxVm7i/jnm8Bp4yv/1UAcFi6MuJOu
 imxwZ+Y6aooOixaXE4t6u4g9NEw/a958B+L1QT/1BgG/+AhA4F3PW4VmQsrVTBX5jwdv7053e0q
 IFzJgNcnB3KkKoyStARWg+WwaNOV2laHMG8zQ2tIiBeSDj7sIBXt39lfMop5ibhiSy2pQOaB1eF
 wlEvJI95EnabG9iK4aXFsDzzUrRLvwGkc1NhbZ7X6AIsgc99O9VOkbvwy0ffAZsqD94FsW2NDys
 LuVuh14Y8E0FIDLOcdW6CQ+dHfCMnB45TRpYlvR0orc/muiTxTaQFxYYRTfatqWvsfsP5Htut0U
 wWOaIzjZKwQAqZBjHiQ==
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 priorityscore=1501 adultscore=0 malwarescore=0 impostorscore=0 phishscore=0
 clxscore=1015 spamscore=0 lowpriorityscore=0 suspectscore=0 bulkscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_054618_071177_523208D9 
X-CRM114-Status: GOOD (  19.01  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  Extend PASN PTK derivation to support EPPKE authentication
    as specified in IEEE P802.11bi/D2.0, section 12.16.9.3.4. Update the PTK
   derivation label and debug logging to distinguish between PASN and E [...]    
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

Extend PASN PTK derivation to support EPPKE authentication as specified
in IEEE P802.11bi/D2.0, section 12.16.9.3.4. Update the PTK derivation
label and debug logging to distinguish between PASN and EPPKE
authentication. Update all relevant function calls to pass the
new is_eppke parameter.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/ap/ieee802_11.c              |  3 ++-
 src/common/common_module_tests.c |  2 +-
 src/common/wpa_common.c          | 12 +++++++++---
 src/common/wpa_common.h          |  3 ++-
 src/pasn/pasn_common.h           |  1 +
 src/pasn/pasn_initiator.c        |  3 ++-
 src/pasn/pasn_responder.c        |  3 ++-
 7 files changed, 19 insertions(+), 8 deletions(-)

diff --git a/src/ap/ieee802_11.c b/src/ap/ieee802_11.c
index 611017da1..c1ff3fa8a 100644
--- a/src/ap/ieee802_11.c
+++ b/src/ap/ieee802_11.c
@@ -2815,7 +2815,8 @@ static void pasn_fils_auth_resp(struct hostapd_data *hapd,
 			      wpabuf_len(pasn->secret),
 			      pasn_get_ptk(sta->pasn), pasn_get_akmp(sta->pasn),
 			      pasn_get_cipher(sta->pasn), sta->pasn->kdk_len,
-			      sta->pasn->kek_len, &sta->pasn->hash_alg);
+			      sta->pasn->kek_len, &sta->pasn->hash_alg,
+			      pasn->auth_alg == WLAN_AUTH_EPPKE);
 	if (ret) {
 		wpa_printf(MSG_DEBUG, "PASN: FILS: Failed to derive PTK");
 		goto fail;
diff --git a/src/common/common_module_tests.c b/src/common/common_module_tests.c
index 6b528eabd..bb6b9cf97 100644
--- a/src/common/common_module_tests.c
+++ b/src/common/common_module_tests.c
@@ -655,7 +655,7 @@ static int pasn_test_pasn_auth(void)
 			      spa_addr, bssid,
 			      dhss, sizeof(dhss),
 			      &ptk, WPA_KEY_MGMT_PASN, WPA_CIPHER_CCMP,
-			      WPA_KDK_MAX_LEN, 0, &hash_alg);
+			      WPA_KDK_MAX_LEN, 0, &hash_alg, false);
 
 	if (ret)
 		return ret;
diff --git a/src/common/wpa_common.c b/src/common/wpa_common.c
index 9bf675984..092365f24 100644
--- a/src/common/wpa_common.c
+++ b/src/common/wpa_common.c
@@ -1568,7 +1568,7 @@ static enum rsn_hash_alg pasn_select_hash_alg(int akmp, int cipher,
 
 
 /**
- * pasn_pmk_to_ptk - Calculate PASN PTK from PMK, addresses, etc.
+ * pasn_pmk_to_ptk - Calculate PASN/EPPKE PTK from PMK, addresses, etc.
  * @pmk: Pairwise master key
  * @pmk_len: Length of PMK
  * @spa: Suppplicant address
@@ -1582,13 +1582,15 @@ static enum rsn_hash_alg pasn_select_hash_alg(int akmp, int cipher,
  * @kdk_len: the length in octets that should be derived for HTLK. Can be zero.
  * @kek_len: The length in octets that should be derived for KEK. Can be zero.
  * @alg: Output variable for indicating the selected hash algorithm
+ * @is_eppke: EPPKE authentication
  * Returns: 0 on success, -1 on failure
  */
 int pasn_pmk_to_ptk(const u8 *pmk, size_t pmk_len,
 		    const u8 *spa, const u8 *bssid,
 		    const u8 *dhss, size_t dhss_len,
 		    struct wpa_ptk *ptk, int akmp, int cipher,
-		    size_t kdk_len, size_t kek_len, enum rsn_hash_alg *alg)
+		    size_t kdk_len, size_t kek_len, enum rsn_hash_alg *alg,
+		    bool is_eppke)
 {
 	u8 tmp[WPA_KCK_MAX_LEN + WPA_KEK_MAX_LEN + WPA_TK_MAX_LEN +
 	       WPA_KDK_MAX_LEN];
@@ -1596,7 +1598,8 @@ int pasn_pmk_to_ptk(const u8 *pmk, size_t pmk_len,
 	u8 *data;
 	size_t data_len, ptk_len;
 	int ret = -1;
-	const char *label = "PASN PTK Derivation";
+	const char *label = is_eppke ? "EPPKE PTK Derivation" :
+			    "PASN PTK Derivation";
 
 	if (!pmk || !pmk_len) {
 		wpa_printf(MSG_ERROR, "PASN: No PMK set for PTK derivation");
@@ -1609,6 +1612,9 @@ int pasn_pmk_to_ptk(const u8 *pmk, size_t pmk_len,
 	}
 
 	/*
+	 * Use "EPPKE PTK Derivation" instead of â€œPASN PTK Derivationâ€ for
+	 * EPPKE Authentication per IEEE P802.11bi/D2.0, section 12.16.9.3.4.
+	 *
 	 * PASN-PTK = KDF(PMK, â€œPASN PTK Derivationâ€, SPA || BSSID || DHss)
 	 *
 	 * KCK = L(PASN-PTK, 0, 256)
diff --git a/src/common/wpa_common.h b/src/common/wpa_common.h
index 8a3f23872..c90b44fab 100644
--- a/src/common/wpa_common.h
+++ b/src/common/wpa_common.h
@@ -780,7 +780,8 @@ int pasn_pmk_to_ptk(const u8 *pmk, size_t pmk_len,
 		    const u8 *spa, const u8 *bssid,
 		    const u8 *dhss, size_t dhss_len,
 		    struct wpa_ptk *ptk, int akmp, int cipher,
-		    size_t kdk_len, size_t kek_len, enum rsn_hash_alg *alg);
+		    size_t kdk_len, size_t kek_len, enum rsn_hash_alg *alg,
+		    bool is_eppke);
 
 size_t pasn_mic_len(enum rsn_hash_alg alg);
 
diff --git a/src/pasn/pasn_common.h b/src/pasn/pasn_common.h
index 58e11e44b..e71393496 100644
--- a/src/pasn/pasn_common.h
+++ b/src/pasn/pasn_common.h
@@ -49,6 +49,7 @@ struct pasn_data {
 	bool derive_kdk;
 	size_t kdk_len;
 	void *cb_ctx;
+	unsigned int auth_alg;
 
 #ifdef CONFIG_SAE
 	struct sae_pt *pt;
diff --git a/src/pasn/pasn_initiator.c b/src/pasn/pasn_initiator.c
index 74dde993b..a5091b562 100644
--- a/src/pasn/pasn_initiator.c
+++ b/src/pasn/pasn_initiator.c
@@ -1316,7 +1316,8 @@ int wpa_pasn_auth_rx(struct pasn_data *pasn, const u8 *data, size_t len,
 			      pasn->own_addr, pasn->peer_addr,
 			      wpabuf_head(secret), wpabuf_len(secret),
 			      &pasn->ptk, pasn->akmp, pasn->cipher,
-			      pasn->kdk_len, pasn->kek_len, &pasn->hash_alg);
+			      pasn->kdk_len, pasn->kek_len, &pasn->hash_alg,
+			      pasn->auth_alg == WLAN_AUTH_EPPKE);
 	if (ret) {
 		wpa_printf(MSG_DEBUG, "PASN: Failed to derive PTK");
 		goto fail;
diff --git a/src/pasn/pasn_responder.c b/src/pasn/pasn_responder.c
index 568442e28..21cf33cb3 100644
--- a/src/pasn/pasn_responder.c
+++ b/src/pasn/pasn_responder.c
@@ -414,7 +414,8 @@ pasn_derive_keys(struct pasn_data *pasn,
 			      wpabuf_head(secret), wpabuf_len(secret),
 			      &pasn->ptk, pasn->akmp,
 			      pasn->cipher, pasn->kdk_len, pasn->kek_len,
-			      &pasn->hash_alg);
+			      &pasn->hash_alg,
+			      pasn->auth_alg == WLAN_AUTH_EPPKE);
 	if (ret) {
 		wpa_printf(MSG_DEBUG, "PASN: Failed to derive PTK");
 		return -1;

From patchwork Tue Jan  6 13:45:21 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180394
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=T/JWU57/;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=QEMODbag;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=THMaPFeE;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlssd5SGYz1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:47:01 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=+VRtw27EKt7xQT0NmMcJqKs2yUR2nwdCUKIyQbfIz9s=; b=T/JWU57/EW55Jm
	tBPcKqPkFORTG6aQ+bW8O6YwzElpJB8WZwetQ/epgJSZToLaqOhn3urgZxQzWpocMNDGlsGeC5pJa
	AaXE9SqBpBm9CmTg+a9saa4QEItsa7PgaBFFOciD6EXC2IqN3Icb6jqOrbIsWSjt49bEDDhmcbHIV
	HK/FbOSM7wTxluWGH+cHrxiDWr/7rOUKuXuBP1CjV9pevh7VGEg0jeJkFduW84TuonUJ5jSkEhPnB
	ihd52aMBgKORPYvuuhfVBVg0TT1MXreWxO8b8ZyGzXV4kcGoT1qN2ShDfHrSAvI674vKbc/eg5O/c
	AvmLONTiOfQ6EsHRp5Gw==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7OF-0000000D7jX-0jTx;
	Tue, 06 Jan 2026 13:46:27 +0000
Received: from mx0a-0031df01.pphosted.com ([205.220.168.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7OC-0000000D7ec-0qtf
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:25 +0000
Received: from pps.filterd (m0279862.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606AsLRQ3272137
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:18 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=GCSBSLaHjLn
	7BufNu9sdpI2zWZyz6NNroEUyhQV0+Fg=; b=QEMODbagdIiDdhEBHFaAuzZRj2I
	DNL+Ndg5K4A4fsnvClbPZWmV/wQ+IJeiyzfCLeEe3KGY09bCUhpICoACb0gKTEv7
	OGJDSEUqMzMUefdu9jFeE0v2bTPHgqdZpd/RSlyLT1w0iwZG8aPUlWIT37aMTsFx
	Ix/uuoMVESfr13XS0rNJ5qQ8jM8xzklESk6zL+Gu6HNMG7aF0NpRGtngaw+pbzlc
	usu5IjY0rrL4JwaIqEX5OzLflK1GlpckDBIcXlT9NpEMI6TGjN1c3UlYiWpBl+3i
	u28JPPKFiM5347go10gCwJXUririNHlESdMRn+lWSiB5bpRttJeZj/E3JaQ==
Received: from mail-pf1-f197.google.com (mail-pf1-f197.google.com
 [209.85.210.197])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgfv03f4t-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:18 +0000 (GMT)
Received: by mail-pf1-f197.google.com with SMTP id
 d2e1a72fcca58-7bf5cdef41dso1808349b3a.0
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:18 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707178; x=1768311978;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=GCSBSLaHjLn7BufNu9sdpI2zWZyz6NNroEUyhQV0+Fg=;
        b=THMaPFeEaf+A4zEQcoccSLieUo7udnQDfHceuE9DqKIbWL0SEk3YpTI6XpLGf58CkA
         gFSGYXrNTwKpbOgus2Blthbp0sP4/tluKrUXa7FQZ48xDcaIfXc2wN3O7+sEzY7lR0Kv
         iy3s866/ZqsblOSwgYl+GlvN4J7Vb9c645etHkK21WBNslI+/gVNV2rlX0BGJUDo+Q7i
         FK0hnFVRjpjkXrG20SKJ+ILRNFHBo++OGlb/5rWC2vUzB7vmyIk6JQYKSauFzRAabREq
         Ooe67c25j33NekbkQQTxIHCTTE7jGKTDhqWYfIhj6zLMpcns6tJ3Nai8VVYFqY1yf63s
         IJwg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707178; x=1768311978;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=GCSBSLaHjLn7BufNu9sdpI2zWZyz6NNroEUyhQV0+Fg=;
        b=ORGU1pTsUN7zra7UrsB17PI9Bp8nQVTL512pte9cKzh+VWj+XVylgLGQJNCh7d7om7
         j6+ofLZVWokIeGx8YQqlTN3hInLoiw7peZwt3y9k4kCJBipkis/dwwt7IT8m/YvENNrF
         iIn1/5PKYpUtBPN5vvD+HQDWPIfkmZWfHFoLjgTNpbO3n8LYAA+y9clAcitM8BHIT9QM
         f9xZuP+AHaiQobf1Z0ZctQvWu77VJb5hAr0u/jURelKo1YaTgPQeKCu1iwC0sU4L9YfM
         dkfF+eKZTC+HZdKGw+0P4ZV1PGJvDSl24/iYa8tCQGbmGUrEm959irW0atY8kmXsqs7E
         7KYw==
X-Gm-Message-State: AOJu0Yxa+iRPMTsuY/wnOQYgbqGY33zKm246mYOPwWCuulaQbdoLLkRG
	5c/9zNHcHM4W+3Y0TGt1oQBJXTgxnIptdg4eVwEq8hTEEYBM2SGkjauNmr/ZF9Hog8tzbOgmbvX
	HX+EBHsywHbREufnhv0mCg9SBy1r9VOEY2khdJ1csWtqqNB8CDC592tPjHIjAKsSOO6vH9Pdl
X-Gm-Gg: AY/fxX7xgP4/jZQUD7FriVZE7ooqHnkNSCUpVdTyIXdtFMpBnbjSCLnhZ4iVVHq9Ih+
	dLIsEwjuGQJMz8V5LKxgFJ2jcR7mX88IbDjWqZ7U6zp8morgAQ7AfSzAdrTIKs8SaHlAWfE1gFq
	u0FUbseUIUr/uEKW/PiSwr//6uOOcQXq4QR9GEqvlxb3EaElecZ4pD1d1t43dqOJOCW51Z7XUT6
	acOY3WoxhMNC4/x/yKb8iwZMZPBGDE97NPTK2/tY7uDfEmOuDDaJawFW1UImoFUNDhQjBc3WUKq
	2U0glkk2mS6w4s98/JPdXvIkxH2fgikWn7L73NcKmeE+1xvmCNVnd44RO0gir5ODq9FYf/WDAd4
	+p3SU0Hrz0IFct3+on1YgEQMGxKQFj4DjzqLiOMLU
X-Received: by 2002:a05:6a00:4209:b0:7aa:2cc6:8c38 with SMTP id
 d2e1a72fcca58-81880689362mr2445103b3a.2.1767707177749;
        Tue, 06 Jan 2026 05:46:17 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IHKavZRY+urXmdPaFHlFm8JrihMEmu94TLCiA/wZXbPPss7TmS+8OuYJE0PnONx2FievYo4Fg==
X-Received: by 2002:a05:6a00:4209:b0:7aa:2cc6:8c38 with SMTP id
 d2e1a72fcca58-81880689362mr2445088b3a.2.1767707177222;
        Tue, 06 Jan 2026 05:46:17 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.15
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:16 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 11/28] PASN: Modify PASN Authentication frame header APIs
 based on auth_algo
Date: Tue,  6 Jan 2026 19:15:21 +0530
Message-Id: <20260106134538.2594232-12-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Authority-Analysis: v=2.4 cv=e9YLiKp/ c=1 sm=1 tr=0 ts=695d122a cx=c_pps
 a=rEQLjTOiSrHUhVqRoksmgQ==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=0Y48sV1_-8SCTj8G_BoA:9 a=2VI0MkxyNR6bbpdq8BZq:22
X-Proofpoint-GUID: TMEzRxCnr2VJCLKrI9iPnWiC99CnNX61
X-Proofpoint-ORIG-GUID: TMEzRxCnr2VJCLKrI9iPnWiC99CnNX61
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfX+zOAfYj/4G/s
 LgXaVRU9/C+EHhTDf4lrBrjxrL782Co1YAUhowqUOr1OlwoCL9cxQKJvg9RDYSTXq/ZqrcExnsw
 d52dHhanHcGTrscTMpSNQLkNYyJv1V60NPazmtUi3Qon0nUuTAOAmNkR6605LOa0RCx/qjLuqzW
 ATiyCiohwdSoh3PiHi9QAovelb6SXjQ1Kbxmccspp5/j4gqc0VRw+1iWLnEBefNOEg+yDvKgL8s
 VyXExyGPWD0QNhgv97qtxTp7gG/KTePDKdUROmJFmkE6fYI6OZ4RgbmbOa03orD6mA+bmyScuG8
 uNG/ECZpXPfVx1VVpIUDvkl6SB1KXbR9xQXXc9bi0zPqE8i/qsKB2etTGF8qaFCPHztEemW3E8Y
 2p9Ukglmuzggk+NRhegHns39hotMczqHtnhGhbUJzV9sqDEZsQO6uNz8zCgSRD6pJtvmtbid6Gd
 lBjvjKz+uarI7KX19bg==
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 clxscore=1015 impostorscore=0 priorityscore=1501 phishscore=0 malwarescore=0
 suspectscore=0 lowpriorityscore=0 spamscore=0 bulkscore=0 adultscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_054624_260197_CD211B62 
X-CRM114-Status: GOOD (  16.56  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com> Modify
    PASN Authentication frame header API - wpa_pasn_build_auth_header() to
 build
    EPPKE Authentication frame header if auth_algo is WLAN_AUTH_EPPKE else
 build
    a PASN Authentication frame header
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.168.131 listed in
 bl.score.senderscore.com]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.168.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.168.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.168.131 listed in
 sa-trusted.bondedsender.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

Modify PASN Authentication frame header API -
wpa_pasn_build_auth_header() to build EPPKE Authentication
frame header if auth_algo is WLAN_AUTH_EPPKE else build a
PASN Authentication frame header

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
Signed-off-by: Rohan Dutta <drohan@qti.qualcomm.com>
Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
---
 src/common/wpa_common.c   | 10 ++++++----
 src/common/wpa_common.h   |  2 +-
 src/pasn/pasn_initiator.c |  6 ++++--
 src/pasn/pasn_responder.c |  5 +++--
 4 files changed, 14 insertions(+), 9 deletions(-)

diff --git a/src/common/wpa_common.c b/src/common/wpa_common.c
index 092365f24..16c956aa8 100644
--- a/src/common/wpa_common.c
+++ b/src/common/wpa_common.c
@@ -3963,15 +3963,17 @@ int wpa_parse_kde_ies(const u8 *buf, size_t len, struct wpa_eapol_ie_parse *ie)
  * @dst: Destination address
  * @trans_seq: Authentication transaction sequence number
  * @status: Authentication status
+ * @is_eppke: EPPKE authentication
  */
 void wpa_pasn_build_auth_header(struct wpabuf *buf, const u8 *bssid,
 				const u8 *src, const u8 *dst,
-				u8 trans_seq, u16 status)
+				u8 trans_seq, u16 status, bool is_eppke)
 {
 	struct ieee80211_mgmt *auth;
+	u16 auth_alg = is_eppke ? WLAN_AUTH_EPPKE : WLAN_AUTH_PASN;
 
-	wpa_printf(MSG_DEBUG, "PASN: Add authentication header. trans_seq=%u",
-		   trans_seq);
+	wpa_printf(MSG_DEBUG, "%s: Add authentication header trans_seq=%u",
+		   is_eppke ? "EPPKE" : "PASN", trans_seq);
 
 	auth = wpabuf_put(buf, offsetof(struct ieee80211_mgmt,
 					u.auth.variable));
@@ -3984,7 +3986,7 @@ void wpa_pasn_build_auth_header(struct wpabuf *buf, const u8 *bssid,
 	os_memcpy(auth->bssid, bssid, ETH_ALEN);
 	auth->seq_ctrl = 0;
 
-	auth->u.auth.auth_alg = host_to_le16(WLAN_AUTH_PASN);
+	auth->u.auth.auth_alg = host_to_le16(auth_alg);
 	auth->u.auth.auth_transaction = host_to_le16(trans_seq);
 	auth->u.auth.status_code = host_to_le16(status);
 }
diff --git a/src/common/wpa_common.h b/src/common/wpa_common.h
index c90b44fab..fcd7168e2 100644
--- a/src/common/wpa_common.h
+++ b/src/common/wpa_common.h
@@ -797,7 +797,7 @@ int pasn_auth_frame_hash(enum rsn_hash_alg alg, const u8 *data, size_t len,
 
 void wpa_pasn_build_auth_header(struct wpabuf *buf, const u8 *bssid,
 				const u8 *src, const u8 *dst,
-				u8 trans_seq, u16 status);
+				u8 trans_seq, u16 status, bool is_eppke);
 
 int wpa_pasn_add_rsne(struct wpabuf *buf, const u8 *pmkid,
 		      int akmp, int cipher);
diff --git a/src/pasn/pasn_initiator.c b/src/pasn/pasn_initiator.c
index a5091b562..68a4f09fa 100644
--- a/src/pasn/pasn_initiator.c
+++ b/src/pasn/pasn_initiator.c
@@ -611,7 +611,8 @@ static struct wpabuf * wpas_pasn_build_auth_1(struct pasn_data *pasn,
 
 	wpa_pasn_build_auth_header(buf, pasn->bssid,
 				   pasn->own_addr, pasn->peer_addr,
-				   pasn->trans_seq + 1, WLAN_STATUS_SUCCESS);
+				   pasn->trans_seq + 1, WLAN_STATUS_SUCCESS,
+				   pasn->auth_alg == WLAN_AUTH_EPPKE);
 
 	pmkid = NULL;
 	if (wpa_key_mgmt_ft(pasn->akmp)) {
@@ -707,7 +708,8 @@ static struct wpabuf * wpas_pasn_build_auth_3(struct pasn_data *pasn)
 	wpa_pasn_build_auth_header(buf, pasn->bssid,
 				   pasn->own_addr, pasn->peer_addr,
 				   WLAN_AUTH_TR_SEQ_PASN_AUTH3,
-				   WLAN_STATUS_SUCCESS);
+				   WLAN_STATUS_SUCCESS,
+				   pasn->auth_alg == WLAN_AUTH_EPPKE);
 
 	wrapped_data_buf = wpas_pasn_get_wrapped_data(pasn);
 
diff --git a/src/pasn/pasn_responder.c b/src/pasn/pasn_responder.c
index 21cf33cb3..95d7b2e3c 100644
--- a/src/pasn/pasn_responder.c
+++ b/src/pasn/pasn_responder.c
@@ -452,7 +452,8 @@ static void handle_auth_pasn_comeback(struct pasn_data *pasn,
 		return;
 
 	wpa_pasn_build_auth_header(buf, pasn->bssid, own_addr, peer_addr, 2,
-				   WLAN_STATUS_ASSOC_REJECTED_TEMPORARILY);
+				   WLAN_STATUS_ASSOC_REJECTED_TEMPORARILY,
+				   pasn->auth_alg == WLAN_AUTH_EPPKE);
 
 	/*
 	 * Do not include the group as a part of the token since it is not going
@@ -510,7 +511,7 @@ int handle_auth_pasn_resp(struct pasn_data *pasn, const u8 *own_addr,
 		goto fail;
 
 	wpa_pasn_build_auth_header(buf, pasn->bssid, own_addr, peer_addr, 2,
-				   status);
+				   status, pasn->auth_alg == WLAN_AUTH_EPPKE);
 
 	if (status != WLAN_STATUS_SUCCESS)
 		goto done;

From patchwork Tue Jan  6 13:45:22 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180406
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=4Fb+Ojzj;
	dkim=fail reason="signature verification failed" (2048-bit key;
 secure) header.d=infradead.org header.i=@infradead.org header.a=rsa-sha256
 header.s=casper.20170209 header.b=duGapW/p;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=cljtjpG1;
	dkim=neutral header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=QW6+3ZAL;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlsvB3pqRz1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:48:22 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=A2C2VJbAgMVqDdflQPzqzOnbUTlWq830mUfvpl4FL3o=; b=4Fb+Ojzjc1NbKK
	ZL6cNfvgrrKOR8WAbFV+jvvtx708GzeMfZ6nquLLcU3apGD3RFWlPzRx4kO8OoRhuFL5Nt/Ft7DGp
	Rv27/hQ/Ed+42s1x2aWlvBY97n+ED1n6YQ2Jm10HmnUQfUNrsq73JMRJc0iC4kOro+tS0ultIjucX
	cdlfxsky3mv+aZNqcmHqusPRpimojFKpmg73437U1UrN2insuSisd7Ff313DxpJ43GMAkESP+gvUq
	ghg0jkktaJVi1iSqU1z5eDlqToVkPn8WDMA18cwfO8mdgmB02Khxtx3SPo7mlL+zK62SIC7SbByxv
	/EusIZ4rRe4pnChWjtnA==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7PO-0000000D9Iw-2Ia1;
	Tue, 06 Jan 2026 13:47:38 +0000
Received: from casper.infradead.org ([2001:8b0:10b:1236::1])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Oj-0000000D8OC-28nB
	for hostap@bombadil.infradead.org;
	Tue, 06 Jan 2026 13:46:58 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=infradead.org; s=casper.20170209; h=Content-Transfer-Encoding:MIME-Version:
	References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender:Reply-To:
	Content-Type:Content-ID:Content-Description;
	bh=GeamitfDF/FzEcMt/w55W+TLCB7uLPIoglBDT1RsAQk=; b=duGapW/pHZM4LtvOtA1B2ZX2S+
	VVPQ9NCjH004IVUncejJTZajjWce5luaHKeeY/bvP1Ht/lvBH1AL86XoF4vlFw+0UH6VdO/bTb1Mw
	G4rpaAe06LXQEyLsuIJapJm4Qg1WUsq6JyjvcsAup9E35v9ttBe/ZgThaUPULD9j61dIXV18kPSyL
	bidHum4Y7ntcBVbmvMoSJuBAykTJhkrcxVvrGw3ziv3VSNhufeR/sQHAeXp+idRrIX2wk5bahAXTp
	RFhMJKNdztoPj0bglGXFXpHBaY6KxxXTt0rqqauNq23IMZXNTzCyX8BjhfXC+UC+yZGXu0LBihaQR
	um8NizIw==;
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by casper.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Od-0000000BqPz-4A8R
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:55 +0000
Received: from pps.filterd (m0279868.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606BSdHh2684117
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:22 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=GeamitfDF/F
	zEcMt/w55W+TLCB7uLPIoglBDT1RsAQk=; b=cljtjpG1eDfNa3HzmRVLfhtVYH4
	2IdSGcynDDQAmD6OWNjjzJpg9KJEqplJglAlawtXwEDQiA7UrQzhHtk7glE5ZZ9R
	BZt4WEhHH/Xo0Z5LnqyxYlhbkLHrKUQ5EBVifNhpl0VbO1tjFr45bXnvcT8bc1Xs
	hQo3HeKP01u0tA2dV1CWMZvizs1+Y4MudIRe3yjgur8fbPj38zWiSf8Vc9zTPbRI
	gWkoTW4AmZ1adMgCiUAPaO7A0LjQ49Hmg/lVUwcFvUx0TYgbC59jcDc4/wKGeNH9
	IljOHlFm8WzAgdojtDbOH1XdSj7bBXcQGWng+cy9+ig/a5nkEq/sB+4ynQQ==
Received: from mail-pl1-f199.google.com (mail-pl1-f199.google.com
 [209.85.214.199])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgty5hjxh-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:21 +0000 (GMT)
Received: by mail-pl1-f199.google.com with SMTP id
 d9443c01a7336-29f29ae883bso13378495ad.3
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:21 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707180; x=1768311980;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=GeamitfDF/FzEcMt/w55W+TLCB7uLPIoglBDT1RsAQk=;
        b=QW6+3ZALNFieyrkl3RRe1Nl4UIXmme/7+pqSyOh8xsCLFhNksG7jLBjMMprQvZZX26
         KLIxaOWEGIFNt4ByjKvevP6GFP18Rwxf/bHajsvLfVIWbAaZJdcQcEmo4oUyX9V2j+UM
         JlU38zH0lg8UUjs192VPcIH+OUTElBL6tj9Sm3ncmDA83nNPeMpMwX8tzD5iG6WTewgj
         RpXzRL94Hr2LmqY2iL8kM2ztA1oTNyOVhvvRUxhKLyO6ZSuZfNbXMavRI0sVHp4/ellq
         MXQ2c0UF55lmPs6IB0HHA9Zquc2OZzkzC97lHcP4wwVNwSknbZ6Lg3IZ6RxvM04zp/C/
         JvXQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707180; x=1768311980;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=GeamitfDF/FzEcMt/w55W+TLCB7uLPIoglBDT1RsAQk=;
        b=HJFtl6afxdK53bJZuwEoOYjrsLIsmUZVARthGFB07ZiXOB/mn4fVZ3B1KTtyKzXP+v
         z0ccRJRMrE3xW5hMtjccLxe+zYo9AIm5lVeEGb4+yth0/NEDL56lRoJDXNZTtL8pFjOM
         YW6oWIRacvVSomDU/bMQmjvtA9Wi0rdWRTlx9emVrcu5dwNnwjFKB20uubpn/JZdcyWx
         0ab7nFEBcUwiXEc1fgcDEc/C7BOfcBPRfzi+PLvlowtjCAgO7T74LXdC0iYhRH2U/MJl
         jqJcq8YDJDuGrEm3h6PB71U2u4x+D93tj7ScEzdZuBUWZfU7DGI2XVoYcFpT4CZtyEz1
         fDyQ==
X-Gm-Message-State: AOJu0YzowZwFc0rfDB9AtmXGOQ1PlT5YXRf/xiivd9YPbkZEKY272n4d
	Jpg0zNbBN747SXC0DMFANRzItv27Yppl/I6iqH5fjBgZpaOAlV8yApyW5YKFy3E/HoPJK7410dw
	8uqHD7+XSYEEJv4xXP1imRB+CfiwTwbzPyXZBrgAs2H9eKNyI5YwhaI5jxGsNOxqMR7TBvDat
X-Gm-Gg: AY/fxX7XTvOqkWEz/u+lmHQCRFobZC/I3AJu6yJChItY6A+T7f/FtwhMsCO0f1otWU3
	jhJeET+o815oIUWr4NWTslN3bxA3oxL63/QoXyrCRq4ijnjA7Vxr9z3Q8PPXEYnctlEtNBj8o1C
	V/SpdkExrXpOnOqprIvQZrPKil5qLkbBCJ5qQRePcLUWjH6Df5j/uWA7AbaUHk746CUar7p0v3r
	54z3Yj6nzHO7Y85oLyxUwQLLD0wULC+Y+rbJaAKiW8NAUW+PbK/XK7ykah9s+1XetP8VGFrVRer
	JaJ8Gklic3SfgjB4odyR12KKy9pe/919+GelkTN41tK1wZAuOISbbCjYLAOJDo3iODEZMPwo+hy
	yNJmLcZWinK9IK4S5ksN0FM+2FgI2Oow/dare3F75
X-Received: by 2002:a17:903:298f:b0:2a0:ccee:b35a with SMTP id
 d9443c01a7336-2a3e2d0d993mr30369925ad.46.1767707180222;
        Tue, 06 Jan 2026 05:46:20 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IGpx8cxTOrv8WNpLkIU+f0zEepY0cMwmUvFL6y8p25hFmKsOyH3KqR1wuaeJfj3v2/VJvSdnw==
X-Received: by 2002:a17:903:298f:b0:2a0:ccee:b35a with SMTP id
 d9443c01a7336-2a3e2d0d993mr30369585ad.46.1767707179562;
        Tue, 06 Jan 2026 05:46:19 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.17
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:19 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 12/28] EPPKE: Extend existing PASN APIs for EPPKE
 Authentication
Date: Tue,  6 Jan 2026 19:15:22 +0530
Message-Id: <20260106134538.2594232-13-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfX/E+/YnkSElbS
 r64Vg/WJGYwZraJnMncOsAIh3XgShxuFpOc94nJnnaiBxTYYEEclQX/YjXIatB0xcNZF+WGs1wu
 IpDZIKpXNKXqBnl509oBV4MCbTlY/0VMdSxM9V49YCFxsSv0kg9hCRT+aleibnLYpYFVIx0UmnO
 0GAMMKycCrdNVKFW+D1esQru6PNzqsAFpdF27W6KFm0uT28tTCqJD2YoCobm116sOmksfGIXTx9
 N1a1L31I1rrJkKxr1Cadq0izKRMfPvqjfQrBZI9UPyxrO0N775jSeOV3VUlMm9KQd/2wtT8BNgQ
 gvFwmnpwzx3AX8c2HniKjiogqFuEHIRjk1JQwO6xFMj2e5h66RpLQNNHdP9cFxsIa6cwLyHuhlt
 7oFpqegQIUJFUaLzSqVCVXRMeGg4BpRDbYZhFIXFS/4LEVciPixGh5V+d9+zWsVnXoMN4ULYEuG
 tvMV+eYmgIsuHMv7PBQ==
X-Authority-Analysis: v=2.4 cv=Rfidyltv c=1 sm=1 tr=0 ts=695d122d cx=c_pps
 a=JL+w9abYAAE89/QcEU+0QA==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=-p00wUXRotJ8S6rdUekA:9 a=324X-CrmTo6CU4MGRt3R:22
X-Proofpoint-GUID: KyI_wsIaqPW2reIHxSEONdP2YbivG_1H
X-Proofpoint-ORIG-GUID: KyI_wsIaqPW2reIHxSEONdP2YbivG_1H
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 malwarescore=0 lowpriorityscore=0 priorityscore=1501 clxscore=1015
 suspectscore=0 adultscore=0 bulkscore=0 spamscore=0 impostorscore=0
 phishscore=0 classifier=typeunknown authscore=0 authtc= authcc=
 route=outbound adjust=0 reason=mlx scancount=1 engine=8.22.0-2512120000
 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_134652_276696_F8805A05 
X-CRM114-Status: GOOD (  21.41  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: SpamAssassin version 4.0.1 on casper.infradead.org summary:
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

As per IEEE P802.11bi/D2.0, 12.16.9.3.2 (EPPKE
Frame Construction and Processing), PASN frame construction
and processing apply for EPPKE authentication with few
differences. So Extend the existing PASN APIs to
accommodate EPPKE authentication

This change adds following extensions for AP Responder:
  -Skip sta object deletion after Authentication frame 3
   processing
  -Bypass the vendor interface to set keys to driver
   (QCA_NL80211_VENDOR_SUBCMD_SECURE_RANGING_CONTEXT).
  -NL80211_CMD_NEW_KEY will be used to set keys to driver
   for EPPK initiated link after processing of EPPKE
   Authentication frame 1
  -For MLO Association:
   Provision PMK to be cached in ML PMK cache
   Include Basic MLE in Authentication frame 2

To support the EPPKE flow, extend pasn_data structure to hold:
   AP MLD Address
   ML STA indication

Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
Signed-off-by: Rohan Dutta <drohan@qti.qualcomm.com>
---
 hostapd/Makefile          |  5 +++
 hostapd/defconfig         |  3 ++
 src/ap/ieee802_11.c       | 77 +++++++++++++++++++++++++++++++++------
 src/ap/ieee802_11_eht.c   |  1 +
 src/ap/sta_info.h         |  4 +-
 src/ap/wpa_auth.c         |  4 +-
 src/ap/wpa_auth.h         |  2 +-
 src/pasn/pasn_common.c    | 10 +++++
 src/pasn/pasn_common.h    |  3 ++
 src/pasn/pasn_responder.c | 38 ++++++++++++++++++-
 10 files changed, 131 insertions(+), 16 deletions(-)

diff --git a/hostapd/Makefile b/hostapd/Makefile
index 70029bb0d..b9992530e 100644
--- a/hostapd/Makefile
+++ b/hostapd/Makefile
@@ -615,6 +615,11 @@ OBJS += ../src/ap/nan_usd_ap.o
 CFLAGS += -DCONFIG_NAN_USD
 endif
 
+ifdef CONFIG_ENC_ASSOC
+CONFIG_PASN=y
+CFLAGS += -DCONFIG_ENC_ASSOC
+endif
+
 ifdef CONFIG_PASN
 CFLAGS += -DCONFIG_PASN
 CFLAGS += -DCONFIG_PTKSA_CACHE
diff --git a/hostapd/defconfig b/hostapd/defconfig
index 2dd132831..dddd75d95 100644
--- a/hostapd/defconfig
+++ b/hostapd/defconfig
@@ -418,3 +418,6 @@ CONFIG_DPP2=y
 
 # Wi-Fi Aware unsynchronized service discovery (NAN USD)
 #CONFIG_NAN_USD=y
+
+# Feature support based on IEEE P802.11bi/D2.0
+#CONFIG_ENC_ASSOC=y
diff --git a/src/ap/ieee802_11.c b/src/ap/ieee802_11.c
index c1ff3fa8a..2e0b9eb95 100644
--- a/src/ap/ieee802_11.c
+++ b/src/ap/ieee802_11.c
@@ -3001,6 +3001,10 @@ static void hapd_initialize_pasn(struct hostapd_data *hapd,
 	pasn_register_callbacks(pasn, hapd, hapd_pasn_send_mlme, NULL);
 	pasn_set_bssid(pasn, hapd->own_addr);
 	pasn_set_own_addr(pasn, hapd->own_addr);
+#if defined(CONFIG_IEEE80211BE) && defined(CONFIG_ENC_ASSOC)
+	if (hapd->conf->mld_ap)
+		pasn_set_own_mld_addr(pasn, hapd->mld->mld_addr);
+#endif /* CONFIG_IEEE80211BE && CONFIG_ENC_ASSOC */
 	pasn_set_peer_addr(pasn, sta->addr);
 	pasn_set_wpa_key_mgmt(pasn, hapd->conf->wpa_key_mgmt);
 	pasn_set_rsn_pairwise(pasn, hapd->conf->rsn_pairwise);
@@ -3021,8 +3025,15 @@ static void hapd_initialize_pasn(struct hostapd_data *hapd,
 	pasn->rsn_ie = wpa_auth_get_wpa_ie(hapd->wpa_auth, &pasn->rsn_ie_len);
 	pasn_set_rsnxe_ie(pasn, hostapd_wpa_ie(hapd, WLAN_EID_RSNX));
 	pasn->disable_pmksa_caching = hapd->conf->disable_pmksa_caching;
+#ifdef CONFIG_ENC_ASSOC
 	pasn_set_responder_pmksa(pasn,
-				 wpa_auth_get_pmksa_cache(hapd->wpa_auth));
+				 wpa_auth_get_pmksa_cache(hapd->wpa_auth,
+							  (sta->epp_sta ?
+							  ap_sta_is_mld(hapd, sta) : false)));
+#else
+	pasn_set_responder_pmksa(pasn,
+				 wpa_auth_get_pmksa_cache(hapd->wpa_auth, false));
+#endif /* CONFIG_ENC_ASSOC */
 
 	pasn->comeback_after = hapd->conf->pasn_comeback_after;
 	pasn->comeback_idx = hapd->comeback_idx;
@@ -3098,7 +3109,12 @@ static void hapd_pasn_update_params(struct hostapd_data *hapd,
 		wpa_printf(MSG_DEBUG, "PASN: Mismatch in AKMP/cipher");
 		return;
 	}
-
+#ifdef CONFIG_ENC_ASSOC
+	pasn->auth_alg = mgmt->u.auth.auth_alg;
+#ifdef CONFIG_IEEE80211BE
+	pasn->is_ml_peer = sta->mld_info.mld_sta;
+#endif
+#endif /* CONFIG_ENC_ASSOC */
 	pasn_set_akmp(pasn, rsn_data.key_mgmt);
 	pasn_set_cipher(pasn, rsn_data.pairwise_cipher);
 
@@ -3237,19 +3253,31 @@ static void handle_auth_pasn(struct hostapd_data *hapd, struct sta_info *sta,
 			return;
 		}
 
-		if (handle_auth_pasn_3(sta->pasn, hapd->own_addr,
-				       sta->addr, mgmt, len) == 0) {
+		if ((ret = handle_auth_pasn_3(sta->pasn, hapd->own_addr,
+					      sta->addr, mgmt, len)) == 0) {
+#ifdef CONFIG_ENC_ASSOC
+			if (sta->epp_sta) {
+				sta->auth_alg = WLAN_AUTH_EPPKE;
+				sta->flags |= WLAN_STA_AUTH;
+			}
+#endif /* CONFIG_ENC_ASSOC */
 			ptksa_cache_add(hapd->ptksa, hapd->own_addr, sta->addr,
 					pasn_get_cipher(sta->pasn), 43200,
 					pasn_get_ptk(sta->pasn), NULL, NULL,
 					pasn_get_akmp(sta->pasn));
+#ifdef CONFIG_ENC_ASSOC
+			if (!sta->epp_sta)
+#endif /* CONFIG_ENC_ASSOC */
+				pasn_set_keys_from_cache(hapd, hapd->own_addr,
+							 sta->addr,
+							 pasn_get_cipher(sta->pasn),
+							 pasn_get_akmp(sta->pasn));
+		}
+#ifdef CONFIG_ENC_ASSOC
+		if (!sta->epp_sta || (sta->epp_sta && ret < 0))
+#endif /* CONFIG_ENC_ASSOC */
+			ap_free_sta(hapd, sta);
 
-			pasn_set_keys_from_cache(hapd, hapd->own_addr,
-						 sta->addr,
-						 pasn_get_cipher(sta->pasn),
-						 pasn_get_akmp(sta->pasn));
-		}
-		ap_free_sta(hapd, sta);
 	} else {
 		wpa_printf(MSG_DEBUG,
 			   "PASN: Invalid transaction %u - ignore", trans_seq);
@@ -3339,6 +3367,17 @@ static void handle_auth(struct hostapd_data *hapd,
 	}
 #endif /* CONFIG_NO_RC4 */
 
+#ifdef CONFIG_ENC_ASSOC
+	if (auth_alg == WLAN_AUTH_EPPKE &&
+	    !hapd->conf->assoc_frame_encryption) {
+		wpa_printf(MSG_INFO,
+			   "Unsupported EPPKE authentication algorithm (%d)",
+			   auth_alg);
+		resp = WLAN_STATUS_NOT_SUPPORTED_AUTH_ALG;
+		goto fail;
+	}
+#endif /* CONFIG_ENC_ASSOC */
+
 	if (hapd->tkip_countermeasures) {
 		wpa_printf(MSG_DEBUG,
 			   "Ongoing TKIP countermeasures (Michael MIC failure) - reject authentication");
@@ -3371,6 +3410,11 @@ static void handle_auth(struct hostapd_data *hapd,
 	       (hapd->conf->wpa_key_mgmt & WPA_KEY_MGMT_PASN) &&
 	       auth_alg == WLAN_AUTH_PASN) ||
 #endif /* CONFIG_PASN */
+#ifdef CONFIG_ENC_ASSOC
+		(hapd->conf->wpa &&
+		 (hapd->conf->wpa_key_mgmt & WPA_KEY_MGMT_EPPKE) &&
+		 auth_alg == WLAN_AUTH_EPPKE) ||
+#endif /* CONFIG_ENC_ASSOC */
 	      ((hapd->conf->auth_algs & WPA_AUTH_ALG_SHARED) &&
 	       auth_alg == WLAN_AUTH_SHARED_KEY))) {
 		wpa_printf(MSG_INFO, "Unsupported authentication algorithm (%d)",
@@ -3388,6 +3432,9 @@ static void handle_auth(struct hostapd_data *hapd,
 	      (auth_alg == WLAN_AUTH_PASN &&
 	       auth_transaction == WLAN_AUTH_TR_SEQ_PASN_AUTH3) ||
 #endif /* CONFIG_PASN */
+#ifdef CONFIG_ENC_ASSOC
+	      (auth_alg == WLAN_AUTH_EPPKE && auth_transaction == 3) ||
+#endif /* CONFIG_ENC_ASSOC */
 	      (auth_alg == WLAN_AUTH_SHARED_KEY && auth_transaction == 3))) {
 		wpa_printf(MSG_INFO, "Unknown authentication transaction number (%d)",
 			   auth_transaction);
@@ -3565,7 +3612,12 @@ static void handle_auth(struct hostapd_data *hapd,
 			goto fail;
 		}
 	}
-
+#ifdef CONFIG_ENC_ASSOC
+	if (auth_alg == WLAN_AUTH_EPPKE) {
+		wpa_printf(MSG_DEBUG, "Mark the station as an EPP Peer");
+		sta->epp_sta = true;
+	}
+#endif /* CONFIG_ENC_ASSOC */
 #ifdef CONFIG_IEEE80211BE
 	/* Set the non-AP MLD information based on the initial Authentication
 	 * frame. Once the STA entry has been added to the driver, the driver
@@ -3730,6 +3782,9 @@ static void handle_auth(struct hostapd_data *hapd,
 				 handle_auth_fils_finish);
 		return;
 #endif /* CONFIG_FILS */
+#ifdef CONFIG_ENC_ASSOC
+	case WLAN_AUTH_EPPKE:
+#endif /* CONFIG_ENC_ASSOC */
 #ifdef CONFIG_PASN
 	case WLAN_AUTH_PASN:
 		handle_auth_pasn(hapd, sta, mgmt, len, auth_transaction,
diff --git a/src/ap/ieee802_11_eht.c b/src/ap/ieee802_11_eht.c
index feeb77ebe..cb63a5b22 100644
--- a/src/ap/ieee802_11_eht.c
+++ b/src/ap/ieee802_11_eht.c
@@ -1060,6 +1060,7 @@ static const u8 * auth_skip_fixed_fields(struct hostapd_data *hapd,
 	 * (Presence of fields and elements in Authentications frames) */
 	switch (auth_alg) {
 	case WLAN_AUTH_OPEN:
+	case WLAN_AUTH_EPPKE:
 		return pos;
 #ifdef CONFIG_SAE
 	case WLAN_AUTH_SAE:
diff --git a/src/ap/sta_info.h b/src/ap/sta_info.h
index 3fb97edd5..18218b949 100644
--- a/src/ap/sta_info.h
+++ b/src/ap/sta_info.h
@@ -99,7 +99,9 @@ struct sta_info {
 	u8 supported_rates[WLAN_SUPP_RATES_MAX];
 	int supported_rates_len;
 	u8 qosinfo; /* Valid when WLAN_STA_WMM is set */
-
+#ifdef CONFIG_ENC_ASSOC
+	bool epp_sta; /* Indicates if the station is an EPP peer */
+#endif /* CONFIG_ENC_ASSOC */
 #ifdef CONFIG_MESH
 	enum mesh_plink_state plink_state;
 	u16 peer_lid;
diff --git a/src/ap/wpa_auth.c b/src/ap/wpa_auth.c
index 620e55387..040efd4a4 100644
--- a/src/ap/wpa_auth.c
+++ b/src/ap/wpa_auth.c
@@ -6895,11 +6895,11 @@ int wpa_auth_pmksa_add_entry(struct wpa_authenticator *wpa_auth,
 
 
 struct rsn_pmksa_cache *
-wpa_auth_get_pmksa_cache(struct wpa_authenticator *wpa_auth)
+wpa_auth_get_pmksa_cache(struct wpa_authenticator *wpa_auth, bool is_ml)
 {
 	if (!wpa_auth || !wpa_auth->pmksa)
 		return NULL;
-	return wpa_auth->pmksa;
+	return is_ml ? wpa_auth->ml_pmksa : wpa_auth->pmksa;
 }
 
 
diff --git a/src/ap/wpa_auth.h b/src/ap/wpa_auth.h
index 36954a19a..4883e2db9 100644
--- a/src/ap/wpa_auth.h
+++ b/src/ap/wpa_auth.h
@@ -541,7 +541,7 @@ wpa_auth_pmksa_create_entry(const u8 *aa, const u8 *spa, const u8 *pmk,
 int wpa_auth_pmksa_add_entry(struct wpa_authenticator *wpa_auth,
 			     struct rsn_pmksa_cache_entry *entry);
 struct rsn_pmksa_cache *
-wpa_auth_get_pmksa_cache(struct wpa_authenticator *wpa_auth);
+wpa_auth_get_pmksa_cache(struct wpa_authenticator *wpa_auth, bool is_ml);
 struct rsn_pmksa_cache_entry *
 wpa_auth_pmksa_get(struct wpa_authenticator *wpa_auth, const u8 *sta_addr,
 		   const u8 *pmkid);
diff --git a/src/pasn/pasn_common.c b/src/pasn/pasn_common.c
index 11916bd18..bd197bebd 100644
--- a/src/pasn/pasn_common.c
+++ b/src/pasn/pasn_common.c
@@ -100,6 +100,16 @@ void pasn_set_own_addr(struct pasn_data *pasn, const u8 *addr)
 }
 
 
+#ifdef CONFIG_ENC_ASSOC
+void pasn_set_own_mld_addr(struct pasn_data *pasn, const u8 *addr)
+{
+	if (!pasn || !addr)
+		return;
+	os_memcpy(pasn->mld_addr, addr, ETH_ALEN);
+}
+#endif /* CONFIG_ENC_ASSOC */
+
+
 void pasn_set_peer_addr(struct pasn_data *pasn, const u8 *addr)
 {
 	if (!pasn || !addr)
diff --git a/src/pasn/pasn_common.h b/src/pasn/pasn_common.h
index e71393496..f5e22c1d9 100644
--- a/src/pasn/pasn_common.h
+++ b/src/pasn/pasn_common.h
@@ -50,6 +50,8 @@ struct pasn_data {
 	size_t kdk_len;
 	void *cb_ctx;
 	unsigned int auth_alg;
+	u8 mld_addr[ETH_ALEN];
+	bool is_ml_peer;
 
 #ifdef CONFIG_SAE
 	struct sae_pt *pt;
@@ -212,6 +214,7 @@ void pasn_disable_kdk_derivation(struct pasn_data *pasn);
 void pasn_set_akmp(struct pasn_data *pasn, int akmp);
 void pasn_set_cipher(struct pasn_data *pasn, int cipher);
 void pasn_set_own_addr(struct pasn_data *pasn, const u8 *addr);
+void pasn_set_own_mld_addr(struct pasn_data *pasn, const u8 *addr);
 void pasn_set_peer_addr(struct pasn_data *pasn, const u8 *addr);
 void pasn_set_bssid(struct pasn_data *pasn, const u8 *addr);
 void pasn_set_initiator_pmksa(struct pasn_data *pasn,
diff --git a/src/pasn/pasn_responder.c b/src/pasn/pasn_responder.c
index 95d7b2e3c..8ad6ff03c 100644
--- a/src/pasn/pasn_responder.c
+++ b/src/pasn/pasn_responder.c
@@ -147,7 +147,10 @@ static int pasn_wd_handle_sae_commit(struct pasn_data *pasn,
 		wpa_printf(MSG_DEBUG, "PASN: No SAE PT found");
 		return -1;
 	}
-
+#ifdef CONFIG_ENC_ASSOC
+	if (pasn->auth_alg == WLAN_AUTH_EPPKE && pasn->is_ml_peer)
+		own_addr = pasn->mld_addr;
+#endif
 	ret = sae_prepare_commit_pt(&pasn->sae, pasn->pt, own_addr, peer_addr,
 				    NULL, NULL);
 	if (ret) {
@@ -575,6 +578,17 @@ int handle_auth_pasn_resp(struct pasn_data *pasn, const u8 *own_addr,
 		pasn->prepare_data_element(pasn->cb_ctx, peer_addr);
 
 	wpa_pasn_add_extra_ies(buf, pasn->extra_ies, pasn->extra_ies_len);
+#ifdef CONFIG_ENC_ASSOC
+	if (pasn->auth_alg == WLAN_AUTH_EPPKE && pasn->is_ml_peer) {
+		wpa_printf(MSG_DEBUG, "EPPKE: Add Multi Link IE");
+		wpabuf_put_u8(buf, WLAN_EID_EXTENSION);
+		wpabuf_put_u8(buf, 10);
+		wpabuf_put_u8(buf, WLAN_EID_EXT_MULTI_LINK);
+		wpabuf_put_le16(buf, MULTI_LINK_CONTROL_TYPE_BASIC);
+		wpabuf_put_u8(buf, ETH_ALEN + 1);
+		wpabuf_put_data(buf, pasn->mld_addr, ETH_ALEN);
+	}
+#endif /* CONFIG_ENC_ASSOC */
 
 	/* Add the mic */
 	mic_len = pasn_mic_len(pasn->hash_alg);
@@ -728,6 +742,18 @@ int handle_auth_pasn_1(struct pasn_data *pasn,
 		goto send_resp;
 	}
 
+#ifdef CONFIG_ENC_ASSOC
+	/* IEEE802.11 bi D2.0 12.16.9 Enhanced Data Privacy Key Exchange
+	 * allows the use of SAE/SAE-EXT/FT-SAE/FT-SAE-EXT as base AKMP
+	 */
+	if (mgmt->u.auth.auth_alg == WLAN_AUTH_EPPKE &&
+	    !wpa_key_mgmt_sae(rsn_data.key_mgmt)) {
+		wpa_printf(MSG_DEBUG, "EPPKE: Invalid Base AKM");
+		status = WLAN_STATUS_INVALID_RSNIE;
+		goto send_resp;
+	}
+#endif /* CONFIG_ENC_ASSOC */
+
 	if (!(rsn_data.key_mgmt & pasn->wpa_key_mgmt) ||
 	    !(rsn_data.pairwise_cipher & pasn->rsn_pairwise)) {
 		wpa_printf(MSG_DEBUG, "PASN: Mismatch in AKMP/cipher");
@@ -758,6 +784,16 @@ int handle_auth_pasn_1(struct pasn_data *pasn,
 
 	wpa_printf(MSG_DEBUG, "PASN: kek_len=%zu", pasn->kek_len);
 
+	if (mgmt->u.auth.auth_alg == WLAN_AUTH_EPPKE &&
+	    !ieee802_11_rsnx_capab_len(elems.rsnxe, elems.rsnxe_len,
+				       WLAN_RSNX_CAPAB_ASSOC_FRAME_ENCRYPTION)) {
+		wpa_printf(MSG_DEBUG,
+			   "EPPKE: Missing (Re)Association Request/Response frame "
+			   "enryption support in RSNXE");
+		status = WLAN_STATUS_UNSPECIFIED_FAILURE;
+		goto send_resp;
+	}
+
 	if (!elems.pasn_params || !elems.pasn_params_len) {
 		wpa_printf(MSG_DEBUG,
 			   "PASN: No PASN Parameters element found");

From patchwork Tue Jan  6 13:45:23 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180397
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=Z591EBKy;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=eoE5PHnn;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=AsFRHuND;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlssl2qRRz1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:47:07 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=/7CNwbISmrrTErksZkdbAVpXTbAx75HaAIr5kOmmPv4=; b=Z591EBKy5kJFxm
	MZcSSIgGp3L/PX+KqXbyEh1dma4d4LmfedRNJ4RvjxxDpJara5hdLie93Fr76TxW5rCrIL4/yQI6j
	R0rgmfyi2OTb0auNBcVccIfWlf6sA4Ygg3nY0mIu4r8AULWTSA4elHHxPFJVyoT61BwfI1hX2vnXe
	YQRKjD6175pvGGnfyVBJvw327h1y81vOJOvrGkyABydFysdKLJu364s03sAVs1KAutmIf+WpXXLfS
	/47LCj8BvJfXMftqt9OGNBCRXj1Zdpwp1DtZbYce1aqupo+iWj+WOa3eBZ3sa9EQ6ftRfmHspQyqc
	C6I2+76YzqF6Qu3Nn0uA==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7OJ-0000000D7qE-3NJn;
	Tue, 06 Jan 2026 13:46:31 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7OD-0000000D7fA-02KR
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:26 +0000
Received: from pps.filterd (m0279870.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606AXDKY3053771
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:24 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=ZG+1W6pCc6A
	gnSl+VIdTag+M13X2pbzPJrUgMwZMrpA=; b=eoE5PHnniX2bCE5VZK1DM9ir7uP
	66cpnz5orlfCOW4GWHTLmCqFzo44srZ/nXwQu8dRAhC8f+DmoM4drugl/Ylreq+X
	VQXS7PKJ8YoZEigZ9q1cW7KlsVrq/eskGE9pvcdhYmOovZO7PXAYXVG9QTLTx7w8
	+/Qu1huUohriKSnKUH5G15BGbalZkbw8CvH170YnrKZDXZWsFCKRiIBCGWN8G8G4
	KaPK1MAHxFQvwhmwsXestyn9ouK2cBssDDEjfde721eAC6B8hLu5M59GAL2Bq+f2
	1jLeSAVjIRic2hfixhayN5iH/u9aMZzzOtnKm5U3tHvK7bC3TpDEKE04Z1g==
Received: from mail-pf1-f197.google.com (mail-pf1-f197.google.com
 [209.85.210.197])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgpn9t6pb-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:23 +0000 (GMT)
Received: by mail-pf1-f197.google.com with SMTP id
 d2e1a72fcca58-7f66686710fso2863361b3a.3
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:23 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707183; x=1768311983;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=ZG+1W6pCc6AgnSl+VIdTag+M13X2pbzPJrUgMwZMrpA=;
        b=AsFRHuNDKD4OmBhOEvB7p6t6GrosQtyJl7fkInowgvtlw8mfIoFEIm/px8cqlufSG9
         twnvYVW3m5uC1ZxRk0A2vMKJ04pWLt6Hsce5nw2LMNSvM9VYXAxyscCRgVLxlxRX/jgf
         mWwDw4/fsQLY1dgNxhAkzkviE8c5jjZCCbZXA7FIZ1Dw1OjyNP3YHh9wdvsHFM47AI5U
         3j4atBFviLWDr+jH6GvkCq3kMnlWi19XHbDTNGpdfnnQUAZgw2NA5Rj4yTDMy2MQI5vM
         ZGc27LbPWZydo/uTREYF9TP9iNRZIzoDyjEq5yvulyQ7jL6PzVg6Vp5TDegJd/r+ukYE
         LyAQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707183; x=1768311983;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=ZG+1W6pCc6AgnSl+VIdTag+M13X2pbzPJrUgMwZMrpA=;
        b=sKELuyR++K6ib0Ff9jeXLfLYB3dTTzDqBOTbJchqm3ebLJiNfmSFVxMOnsdhveyejh
         tXi/ko/aWayxn3QwMJMUX8HMgGVh+z0C8RF1tpau6xgW2YKVMWjeePQU9C3gz3gTRD6m
         Yqfxp4qa36qymvk+3FG4cqgva3ttpWW60R/X9t+wzkPNTkmhtzBXwji0PVvokcTcMcbv
         MEGijpYr7H+asoJgU94XrxH6tULX1X6egcyZxp8U6JpPR4OaDvOL0ic3IgY7neCCwszX
         ttbMhhVqfsnwpa3Buav3eT4egQEGfpr6ZbsSd7fTLxCACQTSRvE5g8Rkh2McuZwJ6ywY
         rYTQ==
X-Gm-Message-State: AOJu0YxA2Pu/8NrdLETEiEECRbhxMHnXVIsGqpOB/g9iho56byDzrltk
	lZxgYxYg8SO2pqiL+HVRz9Cy/RazdvSNOeOg2JsBTQ/s9gxd2S34GbMfcblq4PE3k7UYFUyLrJV
	+vNmIC2y6IBYO8iuSWiM4jZGaYQWwVcqoJ08JZ0rb1pzUi8gP30GP838HWb72byFaCLL+3oYM
X-Gm-Gg: AY/fxX7/tcUc4dBDbHQtGgQSKuUsDsXscoGKps//8gU1JR+o/S8+rxed0GiBL84x4U3
	OcPzYPNi9f9+xSgwPOKLkLF8do5zevlAs7CRQV9zU6mPz2XrVptGKUq7wPdVWvy8MJGbKQ/PCz+
	EeK7l+bBM1htFWmR8qNFfPb6tjFoCoC0qqUbI9LuTxBnWzrispKKDyCpdDQ6CzteQ4UiT+NBOpV
	emOs/Bs8nen4jZAp+s8KS8N/WOiLyOdrMBuvCCAj/hZNu2s7GqIGBv2mhBlMHUX+jqspI8/yhKQ
	tMOzyT9PSLeo7IkFAyGd8Lo3JyLM7vH/zH7o2bwp8VxNvkFCZHF1wXYv17I4/3lT8VpuHdufvm0
	W6Y5k1R6QgOKhH+kpQZHcwq+O4n5SnzKAIFcOiesV
X-Received: by 2002:a05:6a00:e8c:b0:7b8:16af:3bbc with SMTP id
 d2e1a72fcca58-81881e0b984mr2567089b3a.31.1767707182474;
        Tue, 06 Jan 2026 05:46:22 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IGazNkzP957m2CQZ/Eq/YYT1xl7rfc4uo+c1HEN3fRfMdUHmHJZs9FqmVp7A7r29utaLMHsHA==
X-Received: by 2002:a05:6a00:e8c:b0:7b8:16af:3bbc with SMTP id
 d2e1a72fcca58-81881e0b984mr2567065b3a.31.1767707181915;
        Tue, 06 Jan 2026 05:46:21 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.19
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:21 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 13/28] EPPKE: PTK/MIC Computation and key installation
 changes in Responder mode
Date: Tue,  6 Jan 2026 19:15:23 +0530
Message-Id: <20260106134538.2594232-14-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-ORIG-GUID: cxTfeGsaw78n6dSdm8oVqjWZBJp-Otzb
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfX2l052yGH+fRK
 KlyldHJCXslmuWWjOux/KrM5a3XAbEiDaYmZFovMfchWnizWlWjz4EeaXV3yl/fLtZtB/0s0Sn/
 x/yarD70k3pGj9Mr6tdz3C0sgHFcu3XEqJGdOnePlT9H+f3UO+J8zclb1hrSS803P6JHG3r8xZ7
 SKB5Q9MgATH0A/JxfF2aziA8IefVMANIMdwrPan/9fersUbq1fszlRDBsK/oIsZhXhAInU6CrQU
 QMqxIMvT/umiyj6spI0MGZT8H5UBQQ4m+uhXg5wJlf8URUWb1hpIQWWa9+/xkv4zwVRvLL5ZcPD
 F3Quk5wl9Cdc/2iMqkT2tV0/VIiRuBsYpO32BjlBHpnCzmdGurPwz906lOceVoZFLp2dDliEF2F
 WwPiqI/g4IaKqNNG9BaB6bLrqHm0LpNDiuYiNLkqLZWhzrgjvfVl4P0zfR6WFdwpEYW7vIqBc6U
 PmkS9uaMDS22zIofxxA==
X-Proofpoint-GUID: cxTfeGsaw78n6dSdm8oVqjWZBJp-Otzb
X-Authority-Analysis: v=2.4 cv=KfnfcAYD c=1 sm=1 tr=0 ts=695d122f cx=c_pps
 a=rEQLjTOiSrHUhVqRoksmgQ==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=WGb3iPcmAAAA:8 a=9c2JfzCumqVceNjkUsYA:9
 a=jKcKK7Of1z-IfGoh:21 a=2VI0MkxyNR6bbpdq8BZq:22 a=9JPlHzl_CvN4BZy81pxD:22
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 phishscore=0 priorityscore=1501 clxscore=1015 spamscore=0 adultscore=0
 suspectscore=0 malwarescore=0 impostorscore=0 bulkscore=0 lowpriorityscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_054625_174495_306F5032 
X-CRM114-Status: GOOD (  24.99  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com> As per
    IEEE P802.11bi/D2.0,
 12.16.9.3.4 (PTKSA derivation and MIC computation with
    EPPKE authentication) For MLO, the following modifications shall be used:
    -The AP MLD MAC address is used instead of [...]
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

As per IEEE P802.11bi/D2.0, 12.16.9.3.4 (PTKSA derivation
and MIC computation with EPPKE authentication)
For MLO, the following modifications shall be used:
 -The AP MLD MAC address is used instead of the BSSID.
 -The non-AP MLD MAC address is used instead of the SPA.

In AP Responder mode, if the peer is in unauthorized state,
and processing of the EPPKE Authentication frame 1 received from
initiator is successful and results in a PTKSA derivation,
Install the pairwise key TK to the driver and if the peer is
already in an authorized state, wait until EPPKE Authentication
frame 3 validation is successful to install the pairwise key to
the driver.

Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
Signed-off-by: Rohan Dutta <drohan@qti.qualcomm.com>
---
 src/ap/ieee802_11.c              | 32 +++++++++++++++++++++++++++++---
 src/common/wpa_common.c          | 21 +++++++++++++++------
 src/p2p/p2p.c                    |  3 ++-
 src/pasn/pasn_common.c           |  8 +++++++-
 src/pasn/pasn_common.h           | 14 +++++++++++++-
 src/pasn/pasn_responder.c        | 27 +++++++++++++++++++++++++++
 wpa_supplicant/pasn_supplicant.c |  4 ++--
 7 files changed, 95 insertions(+), 14 deletions(-)

diff --git a/src/ap/ieee802_11.c b/src/ap/ieee802_11.c
index 2e0b9eb95..dbc2ceea8 100644
--- a/src/ap/ieee802_11.c
+++ b/src/ap/ieee802_11.c
@@ -2993,12 +2993,29 @@ static int hapd_pasn_send_mlme(void *ctx, const u8 *data, size_t data_len,
 }
 
 
+#ifdef CONFIG_ENC_ASSOC
+static int eppk_set_key(void *ctx, enum wpa_alg alg,
+			const u8 *addr, const u8 *key,
+			size_t key_len)
+{
+	struct hostapd_data *hapd = ctx;
+
+	return hostapd_drv_set_key(hapd->conf->iface, hapd, alg, addr,
+				   0, 0, 1, NULL, 0, key, key_len,
+				   KEY_FLAG_PAIRWISE_RX_TX);
+}
+#else
+#define eppk_set_key NULL
+#endif /* CONFIG_ENC_ASSOC */
+
+
 static void hapd_initialize_pasn(struct hostapd_data *hapd,
 				 struct sta_info *sta)
 {
 	struct pasn_data *pasn = sta->pasn;
 
-	pasn_register_callbacks(pasn, hapd, hapd_pasn_send_mlme, NULL);
+	pasn_register_callbacks(pasn, hapd, hapd_pasn_send_mlme,
+				NULL, eppk_set_key);
 	pasn_set_bssid(pasn, hapd->own_addr);
 	pasn_set_own_addr(pasn, hapd->own_addr);
 #if defined(CONFIG_IEEE80211BE) && defined(CONFIG_ENC_ASSOC)
@@ -3026,6 +3043,7 @@ static void hapd_initialize_pasn(struct hostapd_data *hapd,
 	pasn_set_rsnxe_ie(pasn, hostapd_wpa_ie(hapd, WLAN_EID_RSNX));
 	pasn->disable_pmksa_caching = hapd->conf->disable_pmksa_caching;
 #ifdef CONFIG_ENC_ASSOC
+	pasn->tk_configured = false;
 	pasn_set_responder_pmksa(pasn,
 				 wpa_auth_get_pmksa_cache(hapd->wpa_auth,
 							  (sta->epp_sta ?
@@ -3111,6 +3129,7 @@ static void hapd_pasn_update_params(struct hostapd_data *hapd,
 	}
 #ifdef CONFIG_ENC_ASSOC
 	pasn->auth_alg = mgmt->u.auth.auth_alg;
+	pasn->authorized = ap_sta_is_authorized(sta);
 #ifdef CONFIG_IEEE80211BE
 	pasn->is_ml_peer = sta->mld_info.mld_sta;
 #endif
@@ -3219,7 +3238,8 @@ static void handle_auth_pasn(struct hostapd_data *hapd, struct sta_info *sta,
 			return;
 		}
 
-		sta->pasn = pasn_data_init();
+		if (!sta->pasn)
+			sta->pasn = pasn_data_init();
 		if (!sta->pasn) {
 			wpa_printf(MSG_DEBUG,
 				   "PASN: Failed to allocate PASN context");
@@ -3266,7 +3286,13 @@ static void handle_auth_pasn(struct hostapd_data *hapd, struct sta_info *sta,
 					pasn_get_ptk(sta->pasn), NULL, NULL,
 					pasn_get_akmp(sta->pasn));
 #ifdef CONFIG_ENC_ASSOC
-			if (!sta->epp_sta)
+			if (sta->epp_sta && !sta->pasn->tk_configured)
+				sta->pasn->eppk_set_key(sta->pasn->cb_ctx,
+							wpa_cipher_to_alg(sta->pasn->cipher),
+							sta->addr,
+							sta->pasn->ptk.tk,
+							sta->pasn->ptk.tk_len);
+			else if (!sta->epp_sta)
 #endif /* CONFIG_ENC_ASSOC */
 				pasn_set_keys_from_cache(hapd, hapd->own_addr,
 							 sta->addr,
diff --git a/src/common/wpa_common.c b/src/common/wpa_common.c
index 16c956aa8..5effba077 100644
--- a/src/common/wpa_common.c
+++ b/src/common/wpa_common.c
@@ -1571,8 +1571,12 @@ static enum rsn_hash_alg pasn_select_hash_alg(int akmp, int cipher,
  * pasn_pmk_to_ptk - Calculate PASN/EPPKE PTK from PMK, addresses, etc.
  * @pmk: Pairwise master key
  * @pmk_len: Length of PMK
- * @spa: Suppplicant address
- * @bssid: AP BSSID
+ * @spa: As per IEEE802.11bi/D2.0, 12.16.9.3.4, for EPPKE authentication,
+ *	Non-AP MLD MAC address is used for MLO. For PASN authentication or
+ *	EPPKE authentication for Non-MLO, Non-AP Link MAC address is used.
+ * @bssid: As per IEEE802.11bi/D2.0, 12.16.9.3.4, for EPPKE authentication,
+ *	AP MLD MAC address is used for MLO. For PASN authentication or EPPKE
+ *	authentication for Non-MLO, AP BSSID is used.
  * @dhss: Is the shared secret (DHss) derived from the PASN ephemeral key
  *	exchange encoded as an octet string
  * @dhss_len: The length of dhss in octets
@@ -1799,10 +1803,15 @@ int wpa_ltf_keyseed(struct wpa_ptk *ptk, int akmp, int cipher)
  * @alg: Selected hash algorithm from pasn_pmk_to_ptk()
  * @kck: The key confirmation key for the PASN PTKSA
  * @kck_len: KCK length in octets
- * @addr1: For the 2nd PASN frame supplicant address; for the 3rd frame the
- *	BSSID
- * @addr2: For the 2nd PASN frame the BSSID; for the 3rd frame the supplicant
- *	address
+ * @addr1: For the 2nd PASN/EPPKE frame supplicant address is used for Non-MLO;
+ *	for MLO, 2nd EPPKE authentication to use Non-AP MLD MAC address.
+ *	For the 3rd PASN/EPPKE frame BSSID is used for Non-MLO. for MLO, 3rd EPPKE
+ *	authentication to use AP MLD MAC address as per IEEE802.11bi/D2.0, 12.16.9.3.4
+ * @addr2: For the 2nd PASN/EPPKE frame BSSID is used for Non-MLO;
+ *	for MLO, 2nd EPPKE authentication to use AP MLD MAC address.
+ *	For the 3rd PASN/EPPKE frame supplicant address is used for Non-MLO.
+ *	for MLO, 3rd EPPKE authentication frame to use Non-AP MLD MAC address as
+ *	per IEEE802.11bi/D2.0, 12.16.9.3.4
  * @data: For calculating the MIC for the 2nd PASN frame, this should hold the
  *	Beacon frame RSNE + RSNXE. For calculating the MIC for the 3rd PASN
  *	frame, this should hold the hash of the body of the PASN 1st frame.
diff --git a/src/p2p/p2p.c b/src/p2p/p2p.c
index 711c7343c..25a89d7a0 100644
--- a/src/p2p/p2p.c
+++ b/src/p2p/p2p.c
@@ -7243,7 +7243,8 @@ int p2p_pasn_auth_rx(struct p2p_data *p2p, const struct ieee80211_mgmt *mgmt,
 
 	pasn_register_callbacks(pasn, p2p->cfg->cb_ctx,
 				p2p->cfg->pasn_send_mgmt,
-				p2p->cfg->pasn_validate_pmkid);
+				p2p->cfg->pasn_validate_pmkid,
+				NULL);
 	auth_transaction = le_to_host16(mgmt->u.auth.auth_transaction);
 
 	if (dev->role == P2P_ROLE_PAIRING_INITIATOR &&
diff --git a/src/pasn/pasn_common.c b/src/pasn/pasn_common.c
index bd197bebd..f9ec5ca9c 100644
--- a/src/pasn/pasn_common.c
+++ b/src/pasn/pasn_common.c
@@ -47,7 +47,10 @@ void pasn_register_callbacks(struct pasn_data *pasn, void *cb_ctx,
 					      unsigned int wait),
 			     int (*validate_custom_pmkid)(void *ctx,
 							  const u8 *addr,
-							  const u8 *pmkid))
+							  const u8 *pmkid),
+			     int (*eppke_set_key)(void *ctx, enum wpa_alg alg,
+						  const u8 *addr, const u8 *key,
+						  size_t key_len))
 {
 	if (!pasn)
 		return;
@@ -55,6 +58,9 @@ void pasn_register_callbacks(struct pasn_data *pasn, void *cb_ctx,
 	pasn->cb_ctx = cb_ctx;
 	pasn->send_mgmt = send_mgmt;
 	pasn->validate_custom_pmkid = validate_custom_pmkid;
+#ifdef CONFIG_ENC_ASSOC
+	pasn->eppk_set_key = eppke_set_key;
+#endif /* CONFIG_ENC_ASSOC */
 }
 
 
diff --git a/src/pasn/pasn_common.h b/src/pasn/pasn_common.h
index f5e22c1d9..45ac3b4ce 100644
--- a/src/pasn/pasn_common.h
+++ b/src/pasn/pasn_common.h
@@ -140,6 +140,10 @@ struct pasn_data {
 	u16 comeback_idx;
 	u16 *comeback_pending_idx;
 	struct wpabuf *frame;
+#ifdef CONFIG_ENC_ASSOC
+	bool authorized;
+	bool tk_configured;
+#endif /* CONFIG_ENC_ASSOC */
 
 	/**
 	 * send_mgmt - Function handler to transmit a Management frame
@@ -165,6 +169,10 @@ struct pasn_data {
 	int (*prepare_data_element)(void *ctx, const u8 *peer_addr);
 
 	int (*parse_data_element)(void *ctx, const u8 *data, size_t len);
+#ifdef CONFIG_ENC_ASSOC
+	int (*eppk_set_key)(void *ctx, enum wpa_alg alg, const u8 *addr,
+			    const u8 *key, size_t key_len);
+#endif /* CONFIG_ENC_ASSOC */
 };
 
 /* Initiator */
@@ -207,7 +215,11 @@ void pasn_register_callbacks(struct pasn_data *pasn, void *cb_ctx,
 					      unsigned int wait),
 			     int (*validate_custom_pmkid)(void *ctx,
 							  const u8 *addr,
-							  const u8 *pmkid));
+							  const u8 *pmkid),
+			     int (*eppke_set_key)(void *ctx, enum wpa_alg alg,
+						  const u8 *addr, const u8 *key,
+						  size_t key_len));
+
 void pasn_enable_kdk_derivation(struct pasn_data *pasn);
 void pasn_disable_kdk_derivation(struct pasn_data *pasn);
 
diff --git a/src/pasn/pasn_responder.c b/src/pasn/pasn_responder.c
index 8ad6ff03c..1aa72de11 100644
--- a/src/pasn/pasn_responder.c
+++ b/src/pasn/pasn_responder.c
@@ -413,6 +413,13 @@ pasn_derive_keys(struct pasn_data *pasn,
 
 	pasn->pmk_len = pmk_len;
 	os_memcpy(pasn->pmk, pmk, pmk_len);
+
+#ifdef CONFIG_ENC_ASSOC
+	if (pasn->auth_alg == WLAN_AUTH_EPPKE &&
+	    pasn->is_ml_peer)
+		own_addr = pasn->mld_addr;
+#endif /* CONFIG_ENC_ASSOC */
+
 	ret = pasn_pmk_to_ptk(pmk, pmk_len, peer_addr, own_addr,
 			      wpabuf_head(secret), wpabuf_len(secret),
 			      &pasn->ptk, pasn->akmp,
@@ -641,6 +648,12 @@ int handle_auth_pasn_resp(struct pasn_data *pasn, const u8 *own_addr,
 		data = rsn_ie;
 	}
 
+#ifdef CONFIG_ENC_ASSOC
+	if (pasn->auth_alg == WLAN_AUTH_EPPKE &&
+	    pasn->is_ml_peer)
+		own_addr = pasn->mld_addr;
+#endif /* CONFIG_ENC_ASSOC */
+
 	ret = pasn_mic(pasn->hash_alg, pasn->ptk.kck, pasn->ptk.kck_len,
 		       own_addr, peer_addr, data, data_len,
 		       frame, frame_len, mic);
@@ -1013,6 +1026,14 @@ int handle_auth_pasn_1(struct pasn_data *pasn,
 		goto send_resp;
 	}
 
+#ifdef CONFIG_ENC_ASSOC
+	if (pasn->auth_alg == WLAN_AUTH_EPPKE && !pasn->authorized) {
+		pasn->eppk_set_key(pasn->cb_ctx, wpa_cipher_to_alg(pasn->cipher),
+				   peer_addr, pasn->ptk.tk, pasn->ptk.tk_len);
+		pasn->tk_configured = true;
+	}
+#endif /* CONFIG_ENC_ASSOC */
+
 	wpabuf_free(pasn->auth1);
 	pasn->auth1 = wpabuf_alloc_copy(((const u8 *) mgmt) + IEEE80211_HDRLEN,
 					len - IEEE80211_HDRLEN);
@@ -1094,6 +1115,12 @@ int handle_auth_pasn_3(struct pasn_data *pasn, const u8 *own_addr,
 		goto fail;
 	}
 
+#ifdef CONFIG_ENC_ASSOC
+	if (pasn->auth_alg == WLAN_AUTH_EPPKE &&
+	    pasn->is_ml_peer)
+		own_addr = pasn->mld_addr;
+#endif /* CONFIG_ENC_ASSOC */
+
 	/* Verify the MIC */
 	copy_len = len - offsetof(struct ieee80211_mgmt, u.auth);
 	mic_offset = elems.mic - (const u8 *) &mgmt->u.auth;
diff --git a/wpa_supplicant/pasn_supplicant.c b/wpa_supplicant/pasn_supplicant.c
index 392ad1b08..7f91e192a 100644
--- a/wpa_supplicant/pasn_supplicant.c
+++ b/wpa_supplicant/pasn_supplicant.c
@@ -716,7 +716,7 @@ static void wpas_pasn_auth_start_cb(struct wpa_radio_work *work, int deinit)
 		capab |= BIT(WLAN_RSNX_CAPAB_SPP_A_MSDU);
 
 	pasn_set_rsnxe_caps(pasn, capab);
-	pasn_register_callbacks(pasn, wpa_s, wpas_pasn_send_mlme, NULL);
+	pasn_register_callbacks(pasn, wpa_s, wpas_pasn_send_mlme, NULL, NULL);
 	ssid = wpa_config_get_network(wpa_s->conf, awork->network_id);
 
 #ifdef CONFIG_SAE
@@ -974,7 +974,7 @@ int wpas_pasn_auth_rx(struct wpa_supplicant *wpa_s,
 	wpabuf_free(pasn->frame);
 	pasn->frame = NULL;
 
-	pasn_register_callbacks(pasn, wpa_s, wpas_pasn_send_mlme, NULL);
+	pasn_register_callbacks(pasn, wpa_s, wpas_pasn_send_mlme, NULL, NULL);
 	ret = wpa_pasn_auth_rx(pasn, (const u8 *) mgmt, len, &pasn_data);
 	if (ret == 0) {
 		ptksa_cache_add(wpa_s->ptksa, pasn->own_addr, pasn->peer_addr,

From patchwork Tue Jan  6 13:45:24 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180398
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=OMiSkPH4;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=YR4Q55fG;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=blw/h8Qw;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlsst1NLqz1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:47:14 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=CvcbmPA6Te8SXiYjwncLbeslBpu7ARyM6rD/uu7nadU=; b=OMiSkPH4ZULn0R
	xS0jBlKO1cSbdMIB7t2+W3GL6p5KrzTgCMNa+ROCN43i6egs/HhgsuLV5IpYRecRXrZbZmPKeFwoX
	APwi4m7JrbE4SMtRXnNqOTWiEeyeIrmH1Cc6agLBb5PIQ9GgSySjiJwyFhf3Q6ZvkerS+01jV04t1
	PX0V1IU3GU1oewNCekPeD/YgxLtvgBB32BWsvcb9SdZvSRDabLcXg1SsLt3YeGz7hzmCU4LwDfWce
	XKLlCimAivyVuvlBn1PNXV63bD30sI3mY+gs24LxqjPVyp8V94cYKcwTxiJP6fGZtyxCK7PQ4h9kV
	I8TKJwRfOUJ1cODhm0eA==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7OO-0000000D7xO-1EM6;
	Tue, 06 Jan 2026 13:46:36 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7OF-0000000D7ik-0ZO3
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:28 +0000
Received: from pps.filterd (m0279873.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606BUxbF2253808
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:26 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=wM56H1Rk2UE
	V+zJykzOT4Az1Tm0mkjtKOwKHb0J4dMM=; b=YR4Q55fGUxEHK1Q4OHc78t5xK7W
	fOnIhaGLG8ssIJLiNb3lODEvyiswaLl/+G1rZikUPAdCYKI2JlmX5fWJjWekACjW
	vnEfs9wFUDNvmBr8OjNXdnQQPsXovaUALoGIUnYhQRDMlyFV6ppsHtYv1LrZ8O3/
	JVYelHSsCy2nzAVMuEpQ8aklfnHzjtJodtyFb19eplOkWkqFp9GSrdNL0OfNZ7ry
	+34mxSt5PVZvPT9X3KTZxKgUm45Fji2grgWuitk0sLO4KKkAiRHGfnqNJ75A5pQV
	oSAFgB0X1qjc6eTnixnDBJAKMln4n297V0MXOiFxN+/SMFDj4rox9tdD6AA==
Received: from mail-pf1-f197.google.com (mail-pf1-f197.google.com
 [209.85.210.197])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgu421jk7-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:26 +0000 (GMT)
Received: by mail-pf1-f197.google.com with SMTP id
 d2e1a72fcca58-7ba92341f38so1250211b3a.0
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:25 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707185; x=1768311985;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=wM56H1Rk2UEV+zJykzOT4Az1Tm0mkjtKOwKHb0J4dMM=;
        b=blw/h8QwUOYU2U/Nlk5VpM3lArx1Vv7KmNfcO+W/g3AP7iP/cqN1sJ5Qxu9ZwRJWxF
         0YS9Oe9s4ma16bpM5Emrx3CaC/jVWWF1fFdaYeO8iTb8C7TTH9Ou/y7Dq6C2JFsQMrXc
         g95dT5azfLQ5c0gEt3SeMeORr7+rmvzNr3HdSNQWzBHyhiKU6wp6RLmDnPfs0vju6hig
         9WoEvBADbFNTz566KOy+N1vZO50yrHYo5Tt8Q9WdnhVTdrSGhKP+TyUjMIn6NLh+OrbW
         C0oxHLiV6oCRZe0wHt57GgrIvHR3HnhzkmaQz9lWavpdCy7Dd47lBtMAYA/K8iukEKTh
         iBrw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707185; x=1768311985;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=wM56H1Rk2UEV+zJykzOT4Az1Tm0mkjtKOwKHb0J4dMM=;
        b=OorzxOLrxvAWrVK3EBi1YucGdbSBVRRPiEFaKUd8oeTVI6k3pogrkQ8k/OsGCLAh6a
         5H2iQB/ZUygVgpDS+pIC9N/GKVq23M06eanE8tZQ8I4mx5sINwVq5PHa4FzIZmmSg+fC
         gBbgE1aU06oobTak1EwJH9X1xTkXeXBxPieHHM/FuZGQvyjbePUg4Xn0QdFDRrrzB32C
         dGE3NPzKhDi2F0EFk7dkRxj8lUz06D82Tb41ss046O23DZlgLoI0RlE8NJHTMjk9R1pT
         kCRSD+XX7fqjSFPRkmNGaAHQwWhtLmPl8c4i9ksGXo3joSqzzDLXAjD0w/CUi5IqKVgH
         VG+A==
X-Gm-Message-State: AOJu0YztgD9/CvPCbtP7xYesP6gqA0h/SZfxqwbC6D0LCy3+2uibuXhQ
	mA6Qb6y/a9O2OYO4DZ5hgiwObcR5og+wugb3B0givyF/wXEJAREPhLTcEcUPwuM6QCiLyiBUU+h
	+9EtREy1jd9iVbBBSPpsyTiAPqS1WWHRRHqzd7xIBYuMti//zh+La/p4sMd2Dk3m1dx7eeJ7L
X-Gm-Gg: AY/fxX4r3XbY3HfJrZvbgugwncSjteNfmKfAgjmerf9wpL88bu+23yk+GhGDknYIsOB
	8/4nnc/oUdPbm/bVYOEXQ/2LqUHNZDXcxYWL3yjS6QJ9jMDwJZUsRkqX2H/XIjLxZ9mtmtgnN5g
	mXVO5m7OWTpY8JVEb7NlY22ZR0LYazpLyf/XqpZQwb/H1XHWb587Rt+a6GgVY2g0AYz18sm7SMM
	NlBW4yYPUOLJtvl5fPMIjd3onFL9mybi40EqsBh5jzJA6+DvcjCfzmpYkJ3RZOeCcK3HI82tx/f
	NW/Qr0eP8UQDTsgVBrCcBSMksuizfWTV24nRr7FDnSFmUqwCoDcz/2qEu7UklfzNb3CVPBqg2wB
	G4II/1zClBNut68aM24goK7NlgNsWry54GIGjNJXV
X-Received: by 2002:a05:6a20:6a21:b0:343:72ff:af80 with SMTP id
 adf61e73a8af0-389823e90afmr2986892637.58.1767707184721;
        Tue, 06 Jan 2026 05:46:24 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IEkeqMs1pUnfhxzVKgEzNaXGs/12c5C9IAHQN4YcuH1JhmWCUCdwn9EaXXHIF/UQFHAcxLIKQ==
X-Received: by 2002:a05:6a20:6a21:b0:343:72ff:af80 with SMTP id
 adf61e73a8af0-389823e90afmr2986865637.58.1767707184163;
        Tue, 06 Jan 2026 05:46:24 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.22
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:23 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 14/28] EPPKE: EPP peer indication to driver
Date: Tue,  6 Jan 2026 19:15:24 +0530
Message-Id: <20260106134538.2594232-15-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Authority-Analysis: v=2.4 cv=dYuNHHXe c=1 sm=1 tr=0 ts=695d1232 cx=c_pps
 a=rEQLjTOiSrHUhVqRoksmgQ==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=YZ6FbwD5D2sa2JcNKG0A:9 a=2VI0MkxyNR6bbpdq8BZq:22
X-Proofpoint-GUID: cpWbPSd8U-LYDAEhx2mI5N09xWhpTIAP
X-Proofpoint-ORIG-GUID: cpWbPSd8U-LYDAEhx2mI5N09xWhpTIAP
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfX4gxUhuGruxE0
 saqCiGSmEYlmAdP7/fIrnEGisglVtf6lyq/lyNUvwfb+9Z5u0a1eMLzR1AuaxJ8zcaTXUWl6oMA
 aH1tg7pDCWjn5mLOekmfkIeH0jFEHQ2fNBrGEU5nGqemAG556q47nFVz9R8JctXcFUjdYzjmDU/
 0APT8tmK8otJ4QRIyitTg1Zcj9IKfnBua1fS/rttYpkoNURRa/Vp7RUXnZmKbsZrwtW39V/IFAC
 3K3bA5BoyeT4OuixcJ5I1FqZ89NvXLrwwFWYnIDuSB9l0f+7fsk72IKhS8JPsDFUINh63CeQDTW
 BwUFybbXKGnpjusiu0fjvkYtYfQe89F439/bH35aChpAS2Zz3hyHleNQnM+O//3ZxunJUEMPbqu
 p2u957jT+vmqvu/ny1HQEMyDgRaX+zgHGgh+qzjQcE/G+qLfESSS8KyomK3xElkjyCUgNA3R4Fz
 vzs/tFM7eVUgRlH+Yog==
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 priorityscore=1501 adultscore=0 malwarescore=0 impostorscore=0 phishscore=0
 clxscore=1015 spamscore=0 lowpriorityscore=0 suspectscore=0 bulkscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_054627_321210_EAAAE464 
X-CRM114-Status: GOOD (  21.84  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
 Indicate
    that a peer is an Enhanced Privacy Protection (EPP) peer via the netlink
   attribute @NL80211_ATTR_EPP_PEER in @NL80211_CMD_NEW_STA and
 @NL80211_CMD_ADD_LINK_STA    
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

Indicate that a peer is an Enhanced Privacy
Protection (EPP) peer via the netlink attribute
@NL80211_ATTR_EPP_PEER in @NL80211_CMD_NEW_STA
and @NL80211_CMD_ADD_LINK_STA

Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
Signed-off-by: Rohan Dutta <drohan@qti.qualcomm.com>
---
 src/ap/ap_drv_ops.c          |  6 ++++--
 src/ap/ap_drv_ops.h          |  2 +-
 src/ap/ieee802_11.c          | 15 ++++++++++++---
 src/ap/sta_info.c            |  8 ++++++--
 src/drivers/driver.h         |  3 +++
 src/drivers/driver_nl80211.c |  8 ++++++++
 6 files changed, 34 insertions(+), 8 deletions(-)

diff --git a/src/ap/ap_drv_ops.c b/src/ap/ap_drv_ops.c
index 18bf01772..11c209c6f 100644
--- a/src/ap/ap_drv_ops.c
+++ b/src/ap/ap_drv_ops.c
@@ -480,7 +480,7 @@ int hostapd_sta_add(struct hostapd_data *hapd,
 		    const struct ieee80211_he_6ghz_band_cap *he_6ghz_capab,
 		    u32 flags, u8 qosinfo, u8 vht_opmode, int supp_p2p_ps,
 		    int set, const u8 *link_addr, bool mld_link_sta,
-		    u16 eml_cap)
+		    u16 eml_cap, bool epp_sta)
 {
 	struct hostapd_sta_add_params params;
 
@@ -510,7 +510,9 @@ int hostapd_sta_add(struct hostapd_data *hapd,
 	params.support_p2p_ps = supp_p2p_ps;
 	params.set = set;
 	params.mld_link_id = -1;
-
+#ifdef CONFIG_ENC_ASSOC
+	params.epp_sta = epp_sta;
+#endif
 #ifdef CONFIG_IEEE80211BE
 	/*
 	 * An AP MLD needs to always specify to what link the station needs
diff --git a/src/ap/ap_drv_ops.h b/src/ap/ap_drv_ops.h
index 517c16e35..671b99042 100644
--- a/src/ap/ap_drv_ops.h
+++ b/src/ap/ap_drv_ops.h
@@ -50,7 +50,7 @@ int hostapd_sta_add(struct hostapd_data *hapd,
 		    const struct ieee80211_he_6ghz_band_cap *he_6ghz_capab,
 		    u32 flags, u8 qosinfo, u8 vht_opmode, int supp_p2p_ps,
 		    int set, const u8 *link_addr, bool mld_link_sta,
-		    u16 eml_cap);
+		    u16 eml_cap, bool epp_sta);
 int hostapd_set_privacy(struct hostapd_data *hapd, int enabled);
 int hostapd_set_generic_elem(struct hostapd_data *hapd, const u8 *elem,
 			     size_t elem_len);
diff --git a/src/ap/ieee802_11.c b/src/ap/ieee802_11.c
index dbc2ceea8..910025f49 100644
--- a/src/ap/ieee802_11.c
+++ b/src/ap/ieee802_11.c
@@ -4488,7 +4488,11 @@ static int __check_assoc_ies(struct hostapd_data *hapd, struct sta_info *sta,
 	const u8 *wpa_ie;
 	size_t wpa_ie_len;
 	const u8 *p2p_dev_addr = NULL;
+	bool epp_sta = false;
 
+#ifdef CONFIG_ENC_ASSOC
+	epp_sta = sta->epp_sta;
+#endif
 	if (type != LINK_PARSE_RECONF) {
 		resp = check_ssid(hapd, sta, elems->ssid, elems->ssid_len);
 		if (resp != WLAN_STATUS_SUCCESS)
@@ -4777,7 +4781,7 @@ static int __check_assoc_ies(struct hostapd_data *hapd, struct sta_info *sta,
 			wpa_printf(MSG_DEBUG, "SAE: " MACSTR
 				   " using PMKSA caching", MAC2STR(sta->addr));
 			sae_assign_vlan(hapd, sta, sa->sae_vlan_id);
-		} else if (wpa_auth_uses_sae(sta->wpa_sm) &&
+		} else if (!epp_sta && wpa_auth_uses_sae(sta->wpa_sm) &&
 			   sta->auth_alg != WLAN_AUTH_SAE &&
 			   !(sta->auth_alg == WLAN_AUTH_FT &&
 			     wpa_auth_uses_ft_sae(sta->wpa_sm))) {
@@ -5359,9 +5363,13 @@ static int add_associated_sta(struct hostapd_data *hapd,
 	struct ieee80211_eht_capabilities eht_cap;
 	int set = 1;
 	const u8 *mld_link_addr = NULL;
-	bool mld_link_sta = false;
+	bool mld_link_sta = false, epp_sta = false;
 	u16 eml_cap = 0;
 
+#ifdef CONFIG_ENC_ASSOC
+	epp_sta = sta->epp_sta;
+#endif
+
 #ifdef CONFIG_IEEE80211BE
 	if (ap_sta_is_mld(hapd, sta)) {
 		u8 mld_link_id = hapd->mld_link_id;
@@ -5452,7 +5460,8 @@ static int add_associated_sta(struct hostapd_data *hapd,
 			    sta->he_6ghz_capab,
 			    sta->flags | WLAN_STA_ASSOC, sta->qosinfo,
 			    sta->vht_opmode, sta->p2p_ie ? 1 : 0,
-			    set, mld_link_addr, mld_link_sta, eml_cap)) {
+			    set, mld_link_addr, mld_link_sta, eml_cap,
+			    epp_sta)) {
 		hostapd_logger(hapd, sta->addr,
 			       HOSTAPD_MODULE_IEEE80211, HOSTAPD_LEVEL_NOTICE,
 			       "Could not %s STA to kernel driver",
diff --git a/src/ap/sta_info.c b/src/ap/sta_info.c
index 6670174cd..6d2a15176 100644
--- a/src/ap/sta_info.c
+++ b/src/ap/sta_info.c
@@ -1986,9 +1986,12 @@ static void ap_sta_remove_link_sta(struct hostapd_data *hapd,
 int ap_sta_re_add(struct hostapd_data *hapd, struct sta_info *sta)
 {
 	const u8 *mld_link_addr = NULL;
-	bool mld_link_sta = false;
+	bool mld_link_sta = false, epp_sta = false;
 	u16 eml_cap = 0;
 
+#ifdef CONFIG_ENC_ASSOC
+	epp_sta = sta->epp_sta;
+#endif
 	/*
 	 * If a station that is already associated to the AP, is trying to
 	 * authenticate again, remove the STA entry, in order to make sure the
@@ -2022,7 +2025,8 @@ int ap_sta_re_add(struct hostapd_data *hapd, struct sta_info *sta)
 			    sta->supported_rates_len,
 			    0, NULL, NULL, NULL, 0, NULL, 0, NULL,
 			    sta->flags, 0, 0, 0, 0,
-			    mld_link_addr, mld_link_sta, eml_cap)) {
+			    mld_link_addr, mld_link_sta, eml_cap,
+			    epp_sta)) {
 		hostapd_logger(hapd, sta->addr,
 			       HOSTAPD_MODULE_IEEE80211,
 			       HOSTAPD_LEVEL_NOTICE,
diff --git a/src/drivers/driver.h b/src/drivers/driver.h
index 2ed0282eb..e727dabf9 100644
--- a/src/drivers/driver.h
+++ b/src/drivers/driver.h
@@ -2668,6 +2668,9 @@ struct hostapd_sta_add_params {
 	size_t eht_capab_len;
 	u32 flags; /* bitmask of WPA_STA_* flags */
 	u32 flags_mask; /* unset bits in flags */
+#ifdef CONFIG_ENC_ASSOC
+	bool epp_sta;
+#endif
 #ifdef CONFIG_MESH
 	enum mesh_plink_state plink_state;
 	u16 peer_aid;
diff --git a/src/drivers/driver_nl80211.c b/src/drivers/driver_nl80211.c
index 30433548e..86a1d7557 100644
--- a/src/drivers/driver_nl80211.c
+++ b/src/drivers/driver_nl80211.c
@@ -6217,6 +6217,14 @@ static int wpa_driver_nl80211_sta_add(void *priv,
 			goto fail;
 	}
 
+#ifdef CONFIG_ENC_ASSOC
+	if (params->epp_sta) {
+		wpa_printf(MSG_DEBUG, "EPP STA");
+		if (nla_put_flag(msg, NL80211_ATTR_EPP_PEER))
+			goto fail;
+	}
+#endif
+
 	ret = send_and_recv_cmd(drv, msg);
 	msg = NULL;
 	if (ret)

From patchwork Tue Jan  6 13:45:25 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180399
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=hPJnxWWf;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=AwlAfArE;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=YOdN8TH0;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlst04RX0z1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:47:20 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=XgFaTtTnbQUznox3x3vQ4QfFtaGM0xhwMfrot9DDr70=; b=hPJnxWWf1yiClr
	1uL9LEx62+uPk++3Fwrj6tHlKwiXgYvey127uHRVzY0jwV4DLZp241vHCmUAgFZp9lX+IiwSNPqsy
	JmFuicozu4XMpbHIyCYVxZyyPaz1Go/udEtuJ/7b9iRv7TE90Add5rPKEjmXY7FufZ8SQG9khMiFF
	2PIU3lp38Jez3nYNZaAD8SZ1REa6vZV/D8uJNUOaFc/LG+Ur5r8XSRXcb0Sq1OqG83QJ2KKlgxVR9
	+kKgu5m2ANPV2RH300MvkJAcwyAq9q2kNOoI3k6VE0pO6LI/FdYdRg+Rps35mYhp8WuSgs1UKyC9N
	i4/zAYslIpAu8ofuu6+Q==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7OW-0000000D89I-28xj;
	Tue, 06 Jan 2026 13:46:44 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7OH-0000000D7kr-2Bro
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:31 +0000
Received: from pps.filterd (m0279869.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606BfODg308003
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:28 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=BZqy5Df4nOL
	ReJQloQgtsnBI02wuFhS3Vih0OorN79k=; b=AwlAfArE+5IabV9thHUpNk33T68
	SwXwtUp6ApMn9I5SsELUiJuO9q4SqoEZAUnpA7IYlAsS4ZY6oUDl54jSm9b9QfES
	iiK4bUZYcFitmPAUfWCcSYtvpT2bqv2taaSkTunCLAyWWz/GStnSrscrLGnrWnRk
	U49tQ7ygk5q42vzY5MMPE0Wf82XX2XJG1w2mnsXM7pggsaud4mJb/ZQos21iw+5P
	WrFj4Mltu2Saa3Z3ficfC/QYD5VMP9AegHoxQjtLzZ1mARTgQiiLbx2jaEuBoGeN
	h4GlelNuLDdv9yiyAw28Pnd49/HzdS5CAJ5gJR4RkFUiHbcph83dU60X3Qw==
Received: from mail-pf1-f198.google.com (mail-pf1-f198.google.com
 [209.85.210.198])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bh1r6gb13-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:28 +0000 (GMT)
Received: by mail-pf1-f198.google.com with SMTP id
 d2e1a72fcca58-7b952a966d7so2367689b3a.3
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:28 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707187; x=1768311987;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=BZqy5Df4nOLReJQloQgtsnBI02wuFhS3Vih0OorN79k=;
        b=YOdN8TH0hEmKGgx8xAe0OnZZTLKeclyIRdTBO8HR7GhsNb3uIymixH0sKpP52poRDX
         ieca0eEydrF4mC3DdPP8VNsS7yv6MtQDaTAzC0Ot0ETrwQMQ5qiNQZJL/pi3hlMc0OEA
         tXAhQlNlcrzyUOWBdFTrVqXErMC+Qr/CYkz/c+WLgTr7E/nwW6Rb+PQIrfB0NpAou5w9
         1vK81pI7dkunTNB7nC6oVlnsVc33+M7+P18cF8UJX3GzZPAB55lTs2D6CmqSmG/At6FH
         uP6cYcfZ598YiBJHsAQLlMpiWDV3C94YgFOU7mJxm2YEW0GItXnQe8ieMMfj+00q7UKl
         nlyQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707187; x=1768311987;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=BZqy5Df4nOLReJQloQgtsnBI02wuFhS3Vih0OorN79k=;
        b=ajqTRkvtNmw3Mgz8R/KAkXWBmtNRggo/uFpsFFtrSXo819I6aE+ESagSklrXUm5bEM
         unDQtOOlBFRSBJNfRyxuC1ZI3mgCW5hI0DDOTNSnLXhronbp1QrpZVBCvGOOCUjdF5mr
         5lT1DZhwBnl1WUUHFTSyqZ7lVPowE0gbgDMW2CddChVKu7ISrFZ0T8V3zrgjfsCFjgUJ
         5bmnTO9f+vxHU1EWDzeF7KeaGdikoOfy+GdYzzlT2CAJzZOcaw5vr9uQzJSN4K+xJDqd
         sa95FSGZHRzxQoPJpbLsQAlFa/5IEBvbtWkUKwmGkB2CaAD14R+7idIjAQ2C1ScNi0aJ
         xhxw==
X-Gm-Message-State: AOJu0YxrXMMybWRXLn+m5XsNzgtTpkr5gzpG5oLytp1k3PQSNUxSmycG
	DW1j7PlCN2rXeX7vJ+D9+hUXtQunHdosLnP0X2eb5bS62I+KVGjSCh7QttySz3FdUSL2XGIDQ/m
	fXMDmhd3FJM3sAWUMbP2Uqy3pBpOjonv4hcKawMu1lekrLC8huqzs5hXLKN0uwG6j2AM+I2Q/
X-Gm-Gg: AY/fxX5LzYeH/o7JAq2UjbobAjgIC47TZ4kLL10cBGQrA2IL2VpeqNNn9YmJKtFJb7g
	zVBpwWYyycOKLBscWs62460Mtl6u3TvicqKq1wvzc4K7K03sZ/7LvxeGu1cBcW9f3FXz99klmRi
	foyc3yJFYT83xYYglxHYexyRsqsR3BqrKblmIFVHO27a7/VFXVWgpC4RpJrVC/J5NMezqkVjTtq
	mwX1BxyO045jTMbakxtcc65xTD8svRzkiwXkEdEX8KFQcM1fqMZ1Nolftgxxu0xO6MZ6oFQCrtt
	IqFLHF1Ej5sj0oYuyf7Ql4IkmpwBvYCo+ThL2j9FtyC2LFxn1RaCIfSOhPNXICjOJYN9lGNerwF
	V3JXYksY8mBE4uiNrDNrwGGHuEGVTCPfrDpKYa7Hb
X-Received: by 2002:aa7:8893:0:b0:819:baee:ee8e with SMTP id
 d2e1a72fcca58-819baeefc82mr2386521b3a.0.1767707187024;
        Tue, 06 Jan 2026 05:46:27 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IEVBHWUw3G/LpwiIu6g0HBnzAb0sLbXO7JcRCSXOyhICje7ilc1R5RXux5wGO4HzQddSrN1wA==
X-Received: by 2002:aa7:8893:0:b0:819:baee:ee8e with SMTP id
 d2e1a72fcca58-819baeefc82mr2386492b3a.0.1767707186494;
        Tue, 06 Jan 2026 05:46:26 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.24
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:26 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 15/28] EPPKE: EPP capabilities negotiation indication
Date: Tue,  6 Jan 2026 19:15:25 +0530
Message-Id: <20260106134538.2594232-16-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-GUID: NOP4nvL8rtBCf3iSqaHq3-5mU4gsGD90
X-Proofpoint-ORIG-GUID: NOP4nvL8rtBCf3iSqaHq3-5mU4gsGD90
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfX7dZ2l8Hfcq0N
 keZQt+YXqB/Gu1PkxJkbNcIc5NMFuXawstc6J549hZF1hSQpVt3tGDfZKHkes3VC70bf9k4nHvG
 1cdRa8vknAeyGHcC8f+1GW9w4IpYc9woHJ6l3iYtVgS4VCyZhRjVORsGNW5qLEvJtoG/+uBpijE
 LEIg3a6Dv7GfUpjs1D78z6CD6yQCVPjBWOLQ/PM7e0AF5yvzwVkz02iMx0Bc9pj9h5doj4QhjBU
 LuIqLmLO18bGYzai8Y1CoFCyq97KQQa9C19IZchhdqEohZPeO0fa1OsLswSk5UeOJqTjdWyxB1e
 fmOjItQ50Mpj/D/jLjrm6dP75W68yWu6yIEo9LoCQ/V2gqmNf66IuokT16tp1l5UwdmCWCcT1Sz
 Xk43DBS2IV71/ZHpmj0IBBtLG5cD0kM2RPKIQmDx18GKmhXV1p3ZREp3bCoDKrR+TKB9Z9Ykemj
 V8Sja967dRndtXNuE8Q==
X-Authority-Analysis: v=2.4 cv=Ctuys34D c=1 sm=1 tr=0 ts=695d1234 cx=c_pps
 a=m5Vt/hrsBiPMCU0y4gIsQw==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=WznoQZ4MjUOgNWTLqyUA:9 a=IoOABgeZipijB_acs4fv:22
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 clxscore=1015 suspectscore=0 lowpriorityscore=0 spamscore=0
 priorityscore=1501 malwarescore=0 bulkscore=0 impostorscore=0 phishscore=0
 adultscore=0 classifier=typeunknown authscore=0 authtc= authcc=
 route=outbound adjust=0 reason=mlx scancount=1 engine=8.22.0-2512120000
 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_054629_735598_52F34920 
X-CRM114-Status: GOOD (  21.19  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
 Indicate
    the negotiated EPP capabilities in (Re)Association Request frame via
 netlink
    attribute @NL80211_ATTR_EPP_FLAGS in @NL80211_CMD_SET_STATION
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

Indicate the negotiated EPP capabilities in
(Re)Association Request frame via netlink
attribute @NL80211_ATTR_EPP_FLAGS in
@NL80211_CMD_SET_STATION

The Extended RSN capabilities for EPP that an EPP AP and
an EPP non-AP STA can negotiate are as per
IEEE P802.11bi/D2.0, 9.4.2.240 (RSNXE), few of which are
driver dependent, hence need them to be communicated from
userspace for later use.

Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
Signed-off-by: Rohan Dutta <drohan@qti.qualcomm.com>
---
 src/ap/ap_drv_ops.c          |  3 ++-
 src/ap/ap_drv_ops.h          |  2 +-
 src/ap/ieee802_11.c          |  4 +++-
 src/ap/sta_info.c            |  2 +-
 src/ap/wpa_auth.c            | 32 ++++++++++++++++++++++++++++++++
 src/ap/wpa_auth.h            |  4 +++-
 src/ap/wpa_auth_i.h          |  3 +++
 src/ap/wpa_auth_ie.c         |  3 +++
 src/drivers/driver.h         |  8 ++++++++
 src/drivers/driver_nl80211.c | 19 +++++++++++++++++++
 10 files changed, 75 insertions(+), 5 deletions(-)

diff --git a/src/ap/ap_drv_ops.c b/src/ap/ap_drv_ops.c
index 11c209c6f..3b7f2434d 100644
--- a/src/ap/ap_drv_ops.c
+++ b/src/ap/ap_drv_ops.c
@@ -480,7 +480,7 @@ int hostapd_sta_add(struct hostapd_data *hapd,
 		    const struct ieee80211_he_6ghz_band_cap *he_6ghz_capab,
 		    u32 flags, u8 qosinfo, u8 vht_opmode, int supp_p2p_ps,
 		    int set, const u8 *link_addr, bool mld_link_sta,
-		    u16 eml_cap, bool epp_sta)
+		    u16 eml_cap, bool epp_sta, u32 epp_flags)
 {
 	struct hostapd_sta_add_params params;
 
@@ -512,6 +512,7 @@ int hostapd_sta_add(struct hostapd_data *hapd,
 	params.mld_link_id = -1;
 #ifdef CONFIG_ENC_ASSOC
 	params.epp_sta = epp_sta;
+	params.epp_flags = epp_flags;
 #endif
 #ifdef CONFIG_IEEE80211BE
 	/*
diff --git a/src/ap/ap_drv_ops.h b/src/ap/ap_drv_ops.h
index 671b99042..4e8745a97 100644
--- a/src/ap/ap_drv_ops.h
+++ b/src/ap/ap_drv_ops.h
@@ -50,7 +50,7 @@ int hostapd_sta_add(struct hostapd_data *hapd,
 		    const struct ieee80211_he_6ghz_band_cap *he_6ghz_capab,
 		    u32 flags, u8 qosinfo, u8 vht_opmode, int supp_p2p_ps,
 		    int set, const u8 *link_addr, bool mld_link_sta,
-		    u16 eml_cap, bool epp_sta);
+		    u16 eml_cap, bool epp_sta, u32 epp_flags);
 int hostapd_set_privacy(struct hostapd_data *hapd, int enabled);
 int hostapd_set_generic_elem(struct hostapd_data *hapd, const u8 *elem,
 			     size_t elem_len);
diff --git a/src/ap/ieee802_11.c b/src/ap/ieee802_11.c
index 910025f49..bf81e3835 100644
--- a/src/ap/ieee802_11.c
+++ b/src/ap/ieee802_11.c
@@ -5365,9 +5365,11 @@ static int add_associated_sta(struct hostapd_data *hapd,
 	const u8 *mld_link_addr = NULL;
 	bool mld_link_sta = false, epp_sta = false;
 	u16 eml_cap = 0;
+	u32 epp_flags = 0;
 
 #ifdef CONFIG_ENC_ASSOC
 	epp_sta = sta->epp_sta;
+	epp_flags = wpa_auth_get_epp_flags(sta->wpa_sm);
 #endif
 
 #ifdef CONFIG_IEEE80211BE
@@ -5461,7 +5463,7 @@ static int add_associated_sta(struct hostapd_data *hapd,
 			    sta->flags | WLAN_STA_ASSOC, sta->qosinfo,
 			    sta->vht_opmode, sta->p2p_ie ? 1 : 0,
 			    set, mld_link_addr, mld_link_sta, eml_cap,
-			    epp_sta)) {
+			    epp_sta, epp_flags)) {
 		hostapd_logger(hapd, sta->addr,
 			       HOSTAPD_MODULE_IEEE80211, HOSTAPD_LEVEL_NOTICE,
 			       "Could not %s STA to kernel driver",
diff --git a/src/ap/sta_info.c b/src/ap/sta_info.c
index 6d2a15176..252c47023 100644
--- a/src/ap/sta_info.c
+++ b/src/ap/sta_info.c
@@ -2026,7 +2026,7 @@ int ap_sta_re_add(struct hostapd_data *hapd, struct sta_info *sta)
 			    0, NULL, NULL, NULL, 0, NULL, 0, NULL,
 			    sta->flags, 0, 0, 0, 0,
 			    mld_link_addr, mld_link_sta, eml_cap,
-			    epp_sta)) {
+			    epp_sta, 0)) {
 		hostapd_logger(hapd, sta->addr,
 			       HOSTAPD_MODULE_IEEE80211,
 			       HOSTAPD_LEVEL_NOTICE,
diff --git a/src/ap/wpa_auth.c b/src/ap/wpa_auth.c
index 040efd4a4..28824438b 100644
--- a/src/ap/wpa_auth.c
+++ b/src/ap/wpa_auth.c
@@ -107,6 +107,16 @@ static const u8 * wpa_auth_get_spa(const struct wpa_state_machine *sm)
 }
 
 
+#ifdef CONFIG_ENC_ASSOC
+const u32  wpa_auth_get_epp_flags(struct wpa_state_machine *sm)
+{
+	if (!sm)
+		return 0;
+	return sm->epp_flags;
+}
+#endif /* CONFIG_ENC_ASSOC */
+
+
 static void wpa_gkeydone_sta(struct wpa_state_machine *sm)
 {
 #ifdef CONFIG_IEEE80211BE
@@ -7351,6 +7361,28 @@ void wpa_auth_set_rsn_selection(struct wpa_state_machine *sm, const u8 *ie,
 }
 
 
+#ifdef CONFIG_ENC_ASSOC
+void wpa_auth_ap_sta_epp_flags(struct wpa_state_machine *sm, const u8 *rsnxe)
+{
+	struct wpa_auth_config *conf;
+
+	if (!sm || !rsnxe)
+		return;
+
+	conf = &sm->wpa_auth->conf;
+
+	if (conf->assoc_frame_encryption &&
+	    ieee802_11_rsnx_capab(sm->rsnxe,
+				  WLAN_RSNX_CAPAB_ASSOC_FRAME_ENCRYPTION))
+		sm->epp_flags |= WPA_EPP_ASSOC_FRAME_ENCRYPTION;
+	if (conf->eap_using_authentication_frames &&
+	    ieee802_11_rsnx_capab(sm->rsnxe,
+				  WLAN_RSNX_CAPAB_1X_UTILIZING_AUTHENTICATION_FRAMES))
+		sm->epp_flags |= WPA_EPP_1X_UTILIZING_AUTHENTICATION_FRAMES;
+}
+#endif /* CONFIG_ENC_ASSOC */
+
+
 #ifdef CONFIG_DPP2
 void wpa_auth_set_dpp_z(struct wpa_state_machine *sm, const struct wpabuf *z)
 {
diff --git a/src/ap/wpa_auth.h b/src/ap/wpa_auth.h
index 4883e2db9..9d4c9a132 100644
--- a/src/ap/wpa_auth.h
+++ b/src/ap/wpa_auth.h
@@ -507,6 +507,8 @@ int wpa_auth_sta_ft_tk_already_set(struct wpa_state_machine *sm);
 int wpa_auth_sta_fils_tk_already_set(struct wpa_state_machine *sm);
 int wpa_auth_sta_clear_pmksa(struct wpa_state_machine *sm,
 			     struct rsn_pmksa_cache_entry *entry);
+u32 wpa_auth_get_epp_flags(struct wpa_state_machine *sm);
+
 struct rsn_pmksa_cache_entry *
 wpa_auth_sta_get_pmksa(struct wpa_state_machine *sm);
 void wpa_auth_sta_local_mic_failure_report(struct wpa_state_machine *sm);
@@ -558,7 +560,7 @@ void wpa_auth_pmksa_set_to_sm(struct rsn_pmksa_cache_entry *pmksa,
 int wpa_auth_sta_set_vlan(struct wpa_state_machine *sm, int vlan_id);
 void wpa_auth_eapol_key_tx_status(struct wpa_authenticator *wpa_auth,
 				  struct wpa_state_machine *sm, int ack);
-
+void wpa_auth_ap_sta_epp_flags(struct wpa_state_machine *sm, const u8 *rsnxe);
 #ifdef CONFIG_IEEE80211R_AP
 u8 * wpa_sm_write_assoc_resp_ies(struct wpa_state_machine *sm, u8 *pos,
 				 size_t max_len, int auth_alg,
diff --git a/src/ap/wpa_auth_i.h b/src/ap/wpa_auth_i.h
index e97db8c7f..f7836cc1a 100644
--- a/src/ap/wpa_auth_i.h
+++ b/src/ap/wpa_auth_i.h
@@ -192,6 +192,9 @@ struct wpa_state_machine {
 #endif /* CONFIG_IEEE80211BE */
 
 	bool ssid_protection;
+#ifdef CONFIG_ENC_ASSOC
+	u32 epp_flags; /* See %enum epp_flags */
+#endif /* CONFIG_ENC_ASSOC */
 
 	struct wpabuf *sae_pw_id;
 	unsigned int sae_pw_id_counter;
diff --git a/src/ap/wpa_auth_ie.c b/src/ap/wpa_auth_ie.c
index 6ae1350a0..f5bbedc04 100644
--- a/src/ap/wpa_auth_ie.c
+++ b/src/ap/wpa_auth_ie.c
@@ -1388,6 +1388,9 @@ wpa_validate_wpa_ie(struct wpa_authenticator *wpa_auth,
 		}
 		os_memcpy(sm->rsnxe, rsnxe, rsnxe_len);
 		sm->rsnxe_len = rsnxe_len;
+#ifdef CONFIG_ENC_ASSOC
+		wpa_auth_ap_sta_epp_flags(sm, rsnxe);
+#endif
 	} else {
 		os_free(sm->rsnxe);
 		sm->rsnxe = NULL;
diff --git a/src/drivers/driver.h b/src/drivers/driver.h
index e727dabf9..53fb9c81f 100644
--- a/src/drivers/driver.h
+++ b/src/drivers/driver.h
@@ -2670,6 +2670,7 @@ struct hostapd_sta_add_params {
 	u32 flags_mask; /* unset bits in flags */
 #ifdef CONFIG_ENC_ASSOC
 	bool epp_sta;
+	u32 epp_flags; /* See %enum epp_flags */
 #endif
 #ifdef CONFIG_MESH
 	enum mesh_plink_state plink_state;
@@ -2738,6 +2739,13 @@ struct wpa_bss_params {
 #define WPA_STA_ASSOCIATED BIT(6)
 #define WPA_STA_SPP_AMSDU BIT(7)
 
+#ifdef CONFIG_ENC_ASSOC
+enum epp_flags {
+	WPA_EPP_ASSOC_FRAME_ENCRYPTION = BIT(0),
+	WPA_EPP_1X_UTILIZING_AUTHENTICATION_FRAMES = BIT(1)
+};
+#endif
+
 enum tdls_oper {
 	TDLS_DISCOVERY_REQ,
 	TDLS_SETUP,
diff --git a/src/drivers/driver_nl80211.c b/src/drivers/driver_nl80211.c
index 86a1d7557..3c1334cad 100644
--- a/src/drivers/driver_nl80211.c
+++ b/src/drivers/driver_nl80211.c
@@ -5900,6 +5900,19 @@ static u32 sta_flags_nl80211(int flags)
 	return f;
 }
 
+#ifdef CONFIG_ENC_ASSOC
+static u32 epp_flags_nl80211(u32 epp_flags)
+{
+	u32 f = 0;
+
+	if (epp_flags & WPA_EPP_ASSOC_FRAME_ENCRYPTION)
+		f |= BIT(NL80211_EPP_FLAG_ASSOC_FRAME_ENCRYPTION);
+	if (epp_flags & WPA_EPP_1X_UTILIZING_AUTHENTICATION_FRAMES)
+		f |= BIT(NL80211_EPP_FLAG_1X_UTILIZING_AUTHENTICATION_FRAMES);
+
+	return f;
+}
+#endif
 
 #ifdef CONFIG_MESH
 static u32 sta_plink_state_nl80211(enum mesh_plink_state state)
@@ -6115,6 +6128,12 @@ static int wpa_driver_nl80211_sta_add(void *priv,
 			goto fail;
 	}
 
+#ifdef CONFIG_ENC_ASSOC
+	if (nla_put_u32(msg, NL80211_ATTR_EPP_FLAGS,
+			epp_flags_nl80211(params->epp_flags)))
+		goto fail;
+#endif
+
 	os_memset(&upd, 0, sizeof(upd));
 	upd.set = sta_flags_nl80211(params->flags);
 	upd.mask = upd.set | sta_flags_nl80211(params->flags_mask);

From patchwork Tue Jan  6 13:45:26 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180400
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=Oehmhhrr;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=c7sMzgtg;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=Rr5+hGA2;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlst82SK7z1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:47:28 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=4lhZr6EM5aZrfo6eD8Kf/A4vSZak92yMpwNoA30uEEI=; b=OehmhhrreJigQU
	CW5g3XpsD7KE3YEDNgddm1H+Eo5YInuBSpCbePt4dxBeS3ejREr4ogQ7v565Cz41+aqpLjAkz1RD3
	ESnKGRL9A0cHWuP9Yk/feBdA16Nrx3qHC83DMIbeyt/DKV1n5bCm4rh81xR5h+5aU0v9Mi8fZOXv3
	R7V9HE4gwyd0f7HcuHMtMGgPqrCTQpUhKAyPTpiL6Wk/anuUXiL3fXEK1e8grhXSRLABC9gimWjlh
	2jTG5IpyR8Cj14xX3v/O1iABZQtpaLwJ7VlYZIC+414hI9PRf48du7OR8ggeuRzugzexnFYFNcuJq
	fmF6tRg2QNNtu0sNTvcA==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Oe-0000000D8Ic-0Lhv;
	Tue, 06 Jan 2026 13:46:52 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7OJ-0000000D7os-2oZk
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:33 +0000
Received: from pps.filterd (m0279870.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606AU9CH3052743
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:30 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=g9hfc15gPzd
	yk5piBj49M3Q737gIddbggjpv3/0uEeg=; b=c7sMzgtgrosrkG8Buq/3wzyQLM3
	6BMpBWRU5duU1p5irxoT8ZpcPgTh88rvpcT70bxCpgBMRUq/ZUdA301v9bM2reR0
	OFalq6FaKoaFp+u19z1OfavES3DiLmrYMwB3bqg8bk2s4zuSL9TT98VSLjXpaETU
	o5p+qh3ZXmp7nEJXM5RePqbCYRnsUr4EbpYRnIn88nt9Ow9Q/PJDm0+xRQl9Rs43
	y5m3Ql4Uocm3Ybq7eHs1uLTqSmkqb59M0cn6ML4dPPZfUxSIcFJaahN1qjVLK7yG
	XQHLF+MseNoSHoRdfKV/9O3Py6GI6bfGkjWgiC9QzUfgbDdNZDchu7+1Elg==
Received: from mail-pf1-f197.google.com (mail-pf1-f197.google.com
 [209.85.210.197])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgpn9t6pr-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:30 +0000 (GMT)
Received: by mail-pf1-f197.google.com with SMTP id
 d2e1a72fcca58-7ba9c366057so2466854b3a.1
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:30 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707189; x=1768311989;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=g9hfc15gPzdyk5piBj49M3Q737gIddbggjpv3/0uEeg=;
        b=Rr5+hGA2N6ZIPKPLMbgG38t3U6JOG59JSa5PRPWn+s9JKAz/drWFawz7Z08xyY8eHT
         F74qWniDc9xH2HtZkT3sIdvhJXTSdEH7tpvF3qXgdRcNs0V+p1Lb3WfkLVA4/3RIni6q
         laeidIQp5LWTcxNbAJ82NOuUJQlTyEJC9Cz4wlZ4znHkXJY+wCnd+ojbjQBE0oWnQnD0
         +Nw29CvNEwS7dek5l+CdHKX1tp2b8hLh2NyyDuO162fWPUExyoHj3HpKCeQOGKJcuY35
         NbbuKqLXFbELphsriMfMScKxtaPE3eG/VhnmTehWsYVVvFej1OXU13cmnKEj6G8NBSXY
         Dg2A==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707189; x=1768311989;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=g9hfc15gPzdyk5piBj49M3Q737gIddbggjpv3/0uEeg=;
        b=LLWZ7rj1ZoWeplr6ELPeE2S4pwKo94YW+0gw38hFQ3iAedaK5N6vHUpDUYKEUZ2+wn
         ijIIFVCxnqOng/Kwi/GQUAA4gVcgGTK33kS0VQSHO80flW/altRFXdYk7gAqtmj1zrc4
         dVO3REgqEGMBcV8vltJmF+r4mu6Q2WSFfX6UiFdWKw88/+wHiCOsxSOL7e2pyuuQGdPN
         itlF4Oo0zwiNAiGEWsqSYKzXWj8GuusmjX/Idfcgu/xOwVrDkt8+EFYYb97grYu2FfFZ
         wuqo8Tq5gudxXW/ttiwUAvz6/7aQV4j+bVnnJ/+R9VL/QNy3lewqTJaQFckIIzu6pzZB
         tnlQ==
X-Gm-Message-State: AOJu0YyloejPyNoDT8B79C9BFjvIUssRq/kE7/wYudleKAjfxx5KlFVM
	V61ibQ32pwam7RJ3V1cuflfkhIj9VY3jMQgfHGqicM4QPj46UG5IcuJxnarKGdBZVObvog6Sr+v
	KcmzuWDaIg5nz9oHg7FFFZwN1kTPpXgwD81IzUkkiewG/LPlZALWLpDyMv3AZtz4CccWiVXF6
X-Gm-Gg: AY/fxX5fxgK1oPJfTOr435PFsuI9sfqA+FnF42CEEFPud71lahVtCX/4hDcPP1DTq+M
	owPxKH0gcFg00tF96h+pl5x8lxSysCerOt1fgOYrJyPYAAHT6DY1hdnC/81HEyuH60ynMmOw2zB
	6zfmpFXW+wm537cDGQ5EJYnguyP5gaJbQ/I42V2DatwD9InM5A2aSU9V8jALVyEFGEVZjDzIgig
	tRcAExi38lcRNGlvIZ1VZHbiFPKcsgti1j1kooEYmYvWo5/mhSA8vrYLl/5/EAnWBKEDx45226e
	8zo7LSAJ82vLxsEo4Om393oRrPK8VVgxO22+UaXcMLo6WF3/a58J15diacP0d33J/AeiER0K6b+
	AVgEoOPuahQLXr2tf1g0Jk4kPUlx6dZlqz6yym/iD
X-Received: by 2002:a05:6a00:4acc:b0:7e8:450c:6199 with SMTP id
 d2e1a72fcca58-8188389ece6mr2829638b3a.48.1767707189325;
        Tue, 06 Jan 2026 05:46:29 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IHN8zqeVxwvO+Zh3hmR2cRXBt0wooCbMxa/20laIZGWkYD0rGQgc8Pd27UG9tHsl7IWW/0M2Q==
X-Received: by 2002:a05:6a00:4acc:b0:7e8:450c:6199 with SMTP id
 d2e1a72fcca58-8188389ece6mr2829621b3a.48.1767707188832;
        Tue, 06 Jan 2026 05:46:28 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.26
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:28 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 16/28] EPPKE: RSNE/Key delivery element in (Re)Association
 Response
Date: Tue,  6 Jan 2026 19:15:26 +0530
Message-Id: <20260106134538.2594232-17-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-ORIG-GUID: oYxBs15RzSjYGEIYjwG6B83ZyaB3YZbn
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfX+S59wkJPFRV3
 FWVXZaBd+WIGkFra9s2j2+zm+yM14cc/ea/NmTw7+7YO6nVmsG6kYIS2J/GftSgS+DOmyWi1yyb
 tBOMSJOnTFKkREgd82C3Te7nxNG/yW3F9U1Ubu5d6U7c5OSMRl7TeU5rB9f2KykJfrHZcI3XpqL
 fD8eio03N5Fxbgiza0Ut9uE0s25B7nuIq1yM1ZDClNIiYAlD535FF+1Nvn/JmCpH7k2ZlxMTFZV
 j5J9N7ibLvR2YXsw+71g28cBdu+HzETnYeZP+cDsajJMFZMu8o/CM6QLW7UP0JoGsaHCDJc9q7H
 4nqnnWv9L/rM95JvnLVkJXqzGK5gyBpZF/pFY2/tWxxMVk1aMbXKM3z8Hnia3ssuTwVGOijPnqA
 E68H15ErxTAcHXWk3xwntf5FVs3Yeau0dgJ3YOTM3gBT3RsoRaIiqmvpbV7Q5BOOIgCPsoBYD28
 pUVSw8E0+dug9CGABWw==
X-Proofpoint-GUID: oYxBs15RzSjYGEIYjwG6B83ZyaB3YZbn
X-Authority-Analysis: v=2.4 cv=KfnfcAYD c=1 sm=1 tr=0 ts=695d1236 cx=c_pps
 a=rEQLjTOiSrHUhVqRoksmgQ==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=Era5zkz8ZhAaHRNwK2sA:9 a=2VI0MkxyNR6bbpdq8BZq:22
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 phishscore=0 priorityscore=1501 clxscore=1015 spamscore=0 adultscore=0
 suspectscore=0 malwarescore=0 impostorscore=0 bulkscore=0 lowpriorityscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_054631_902637_BAFE8AEE 
X-CRM114-Status: GOOD (  19.40  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
 -Include
    RSN IE and Key delivery element indicating group KDEs to an EPP non-AP STA
    in (Re)Association Response frame and also set the protected bit in the
 frame
    control in 802.11 frame header as an i [...]
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

-Include RSN IE and Key delivery element indicating
group KDEs to an EPP non-AP STA in (Re)Association
Response frame and also set the protected bit in the
frame control in 802.11 frame header as an indication
to driver/firmware that this frame needs to be encrypted

Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
Signed-off-by: Rohan Dutta <drohan@qti.qualcomm.com>
---
 src/ap/ieee802_11.c |  9 +++++++
 src/ap/wpa_auth.c   | 62 +++++++++++++++++++++++++++++++++++++++++++++
 src/ap/wpa_auth.h   |  6 ++++-
 3 files changed, 76 insertions(+), 1 deletion(-)

diff --git a/src/ap/ieee802_11.c b/src/ap/ieee802_11.c
index bf81e3835..8beca257f 100644
--- a/src/ap/ieee802_11.c
+++ b/src/ap/ieee802_11.c
@@ -5776,6 +5776,15 @@ rsnxe_done:
 			  wpabuf_len(hapd->conf->assocresp_elements));
 		p += wpabuf_len(hapd->conf->assocresp_elements);
 	}
+#ifdef CONFIG_ENC_ASSOC
+	if (sta && sta->auth_alg == WLAN_AUTH_EPPKE &&
+	    status_code == WLAN_STATUS_SUCCESS) {
+		reply->frame_control |= WLAN_FC_ISWEP;
+		p = wpa_auth_write_assoc_resp_eppke(sta->wpa_sm, p,
+						    (buf + buflen - p),
+						    ap_sta_is_mld(hapd, sta));
+	}
+#endif /* CONFIG_ENC_ASSOC */
 
 	send_len += p - reply->u.assoc_resp.variable;
 
diff --git a/src/ap/wpa_auth.c b/src/ap/wpa_auth.c
index 28824438b..99d8e45c2 100644
--- a/src/ap/wpa_auth.c
+++ b/src/ap/wpa_auth.c
@@ -7868,6 +7868,68 @@ bool wpa_auth_sm_known_sta_identification(struct wpa_state_machine *sm,
 }
 
 
+#ifdef CONFIG_ENC_ASSOC
+u8 * wpa_auth_write_assoc_resp_eppke(struct wpa_state_machine *sm,
+				     u8 *pos, size_t max_len, bool is_ml)
+{
+	int res;
+
+	if (!sm)
+		return pos;
+
+	res = wpa_write_rsn_ie(&sm->wpa_auth->conf, pos, max_len, NULL);
+	if (res < 0)
+		return pos;
+	pos = wpa_auth_eid_key_delivery((pos + res), sm, is_ml);
+
+	return pos;
+}
+
+
+/*TODO Key delivery element is fragmentable*/
+u8 * wpa_auth_eid_key_delivery(u8 *eid, struct wpa_state_machine *sm,
+			       bool is_ml)
+{
+	size_t gtk_len, kde_len = 0;
+	u8 rsc[WPA_KEY_RSC_LEN] = {0}, *gtk;
+	struct wpa_group *gsm = sm->group;
+	u8 hdr[2];
+	/*
+	 *ElementID(0xff)|Length(1B)|ElementID EXtn(1B)|RSC(8B)|KDE list
+	 */
+	*eid++ = WLAN_EID_EXTENSION;
+
+	if (!is_ml) {
+		/*GTK KDE: 0xdd|len(1B)|RSN Selector(4B)|KeyID(2B)|GTK|*/
+		kde_len = 2 + RSN_SELECTOR_LEN + 2 + gsm->GTK_len +
+			  ieee80211w_kde_len(sm);
+	} else
+		kde_len = wpa_auth_ml_group_kdes_len(sm, KDE_ALL_LINKS);
+
+	*eid++ = 1 + WPA_KEY_RSC_LEN + kde_len;
+	*eid++ = WLAN_EID_EXT_KEY_DELIVERY;
+	/*RSC*/
+	if (!is_ml && sm->group->wpa_group_state == WPA_GROUP_SETKEYSDONE)
+		wpa_auth_get_seqnum(sm->wpa_auth, NULL, gsm->GN, rsc);
+	os_memcpy(eid, rsc, WPA_KEY_RSC_LEN);
+
+	eid += WPA_KEY_RSC_LEN;
+
+	if (is_ml)
+		eid = wpa_auth_ml_group_kdes(sm, eid, KDE_ALL_LINKS);
+	else {
+		gtk = gsm->GTK[gsm->GN - 1];
+		gtk_len = gsm->GTK_len;
+		hdr[0] = gsm->GN & 0x03;
+		eid = wpa_add_kde(eid, RSN_KEY_DATA_GROUPKEY, hdr, 2, gtk, gtk_len);
+		eid = ieee80211w_kde_add(sm, eid);
+	}
+
+	return eid;
+}
+#endif /* CONFIG_ENC_ASSOC */
+
+
 void wpa_reset_assoc_sm_info(struct wpa_state_machine *assoc_sm,
 			     struct wpa_authenticator *wpa_auth,
 			     u8 mld_assoc_link_id)
diff --git a/src/ap/wpa_auth.h b/src/ap/wpa_auth.h
index 9d4c9a132..8fc955434 100644
--- a/src/ap/wpa_auth.h
+++ b/src/ap/wpa_auth.h
@@ -655,7 +655,11 @@ void wpa_auth_set_dpp_z(struct wpa_state_machine *sm, const struct wpabuf *z);
 void wpa_auth_set_ssid_protection(struct wpa_state_machine *sm, bool val);
 void wpa_auth_set_transition_disable(struct wpa_authenticator *wpa_auth,
 				     u8 val);
-
+u8 * wpa_auth_eid_key_delivery(u8 *eid,
+			       struct wpa_state_machine *sm,
+			       bool is_ml);
+u8 * wpa_auth_write_assoc_resp_eppke(struct wpa_state_machine *sm,
+				     u8 *pos, size_t max_len, bool is_ml);
 int wpa_auth_resend_m1(struct wpa_state_machine *sm, int change_anonce,
 		       void (*cb)(void *ctx1, void *ctx2),
 		       void *ctx1, void *ctx2);

From patchwork Tue Jan  6 13:45:27 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180401
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=MW4WW+Pc;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=oT83V/C6;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=fqOioGiY;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlstG6NXYz1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:47:34 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=R9sORJ3iAdHqo2WPIXKrBuLvqwuuFx2f6jawl2u4tN8=; b=MW4WW+PcYq5WQJ
	/eOPNHIbRwZvHlRIAr6EwhGvdkZ1LDQyaxy4dohK9HWgqtacHAhpPxDhWaI1DcDnIJwiJPy3OgS72
	SnXw0MCXwpmkbJQTyv8W7qYqrMWErM5JNb850p6ExxyYFUopiYAQhqyKSvZyONk6b5/CqhVjyXoYX
	4RHhfpXjIfmUp7gLvJQ/p2KWx5AXDQhWl08AG18UjVrIkGQHP4Ha5eZ96mO1zx+MK60ICss6PQxMB
	uNdJsSo1wyHMhFhSUzSbJeXujl57d/zrRYyDnc+reWTXp1rK94SoexjAJTdQePmG7iV8XopzjHQsq
	/AiIElWX57p47yQjewcA==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Om-0000000D8TA-1lkv;
	Tue, 06 Jan 2026 13:47:00 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7OM-0000000D7te-2SjG
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:37 +0000
Received: from pps.filterd (m0279872.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 6069WYrr4091247
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:33 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=2FftU0NAn70
	KPD4W1483NO0EWodKYgG+8Cbn+IgsOZw=; b=oT83V/C6FoL//r7hcmCQSkJNxai
	jfDA7sRafTkBaMkiwOjvIrCrbqtKyINtpFRStxXmcoFnYVnJ2z+mLlyJkNgxITr7
	C2bLRvAPb9wUHfIqhZ+nyW1ZghxJBbHQ8TcZKIOskCe56/J04iRIE5JM48/QBmd3
	nwgdwZwh3iTRGD2EK992y4em7RcG2GuwTQhQkPHqJ4uAgR/SdW6583l/Fy0+784g
	L8OYXv3/WnZZPNWp6DUh6CBO57tRQT+FnCKizptjqOXUUa+3YIi6OOoYmc4cdMUg
	BKlRISJPW2CUyfaNTd2HvzeAp9fRA9ihmIRGFNgyD723Xa4H7D6fq+fkJOg==
Received: from mail-pf1-f197.google.com (mail-pf1-f197.google.com
 [209.85.210.197])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgyun8n7a-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:32 +0000 (GMT)
Received: by mail-pf1-f197.google.com with SMTP id
 d2e1a72fcca58-7b9321b9312so2296784b3a.1
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:32 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707192; x=1768311992;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=2FftU0NAn70KPD4W1483NO0EWodKYgG+8Cbn+IgsOZw=;
        b=fqOioGiYB4gppbsdgZj4jCz6DVJJyUQvvk45/U1jkaxUTO+wz+9vrwhZvqGvUAtLkt
         JDoRyfbnuc4nlwvoy0zTqgkksjvi9vAarAmQ6Egc1d8mc6FzOdZb2QIO5oxa5yb8YnOI
         4u3L4A1r+jMLEgkLOWRmWQHzyL8w8LODG6FcBl0ZrhWeO9kSK/KDkh1qpYtphSwxyL+n
         uWsCyJGoqcs28uwS3esXqnz2zX0LUqLLD5jzNHSVZRRx90TDqpTldHKL+4tyIpA+AaYd
         n1OOxCrxKe6++mW7nDGsQ4tscpavWfBlM4nLU2UDofqgj1PdocOKz5ju6wtHcrSvJsiP
         3PRA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707192; x=1768311992;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=2FftU0NAn70KPD4W1483NO0EWodKYgG+8Cbn+IgsOZw=;
        b=RRkatvx/JFRIUu1VPPhNXHguLjw3VtIHNsIceBDbirq8bVeiDXKNWqAj/barzAEd1V
         uOu7jxa3R+Ytvnxv72D5aZaawS9ZOPpEjwxO4m2fLWvvo1ISXPeglJ43tEtRQyAY9vX0
         e115tQOn+PA+Ox1IbAYdytqi5viQCtiD98Gxu5yXNp1IdUOaMosA2vbUUgXvweBarZaN
         U/H2Uw/zND99j7vL9cqsDbeodRtfkmYl6hLBKKuqqZ6BXWKbl9ehIla46HOZlDiWs8yJ
         FqAwn5ZT7jE/P4tJBSHfs4z0GvdAHG0EtpqTw9HN/WegSgiuQchEcbWegGzNQJqsA3rW
         mviA==
X-Gm-Message-State: AOJu0YzM3u0mRUkO7kpNz3xMLakKqnEKuwzZCurDOQM32VtN5HOJ6FXf
	eeC1gYl6yrQNIrII1SAd2Svmb8g2MJ9N/+Odv5xbL7i6+wEGQg6j4KgdvyUHVcvHctB7TYZhpNy
	61KtSg/tqTsJREIyDa6fo1A+YnaeiMDSQnM0mZJepu7r9CuXAszeRiZjrR3dGVNnMaq/cKmkL
X-Gm-Gg: AY/fxX4Eq9gATkygF9XaKQegCDK0HtymHhjavSNqQLoMSP49VtkYDNsvgQkCypihEWQ
	ZmzEnRRa38s5wFuC7t3TvP9Lz5rbTxtzWKefCTnCj5wqq10XHhPWhZioyZf6l4bIQsfjL62wAKD
	CB4aI7Ydcc/d15XUyZhsJg5Ny1YEkdHW7j9VXYP9RyFKywCpUu1PY4NYFNGJheJN2c3O+iqIe3O
	sL+o4xxNhInil4J9WYlCYRDpWutQ8aOL4q89gs98ELT2VrhS2EkI3s6+xzYjyGNVIal8HhVGBMr
	8zAVTjeO4pqziq1C0RVHxuxBbQxhuOa7INC2Toz8bjRvvx9CYQLRcljFcMkk61Ibh/Yzi0eXtjG
	65m8EIoCB5WGtf+PvSqA/nuK0FV/AjOgwxEUL3pNP
X-Received: by 2002:aa7:8893:0:b0:819:baee:ee8e with SMTP id
 d2e1a72fcca58-819baeefc82mr2386719b3a.0.1767707191606;
        Tue, 06 Jan 2026 05:46:31 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IGOSf0vC6sS98ox34qlIbqaKoHs1NP59IrruMlpW81XaNGxrGsxC2h2Y2vzV7YdFUJQwv55Ww==
X-Received: by 2002:aa7:8893:0:b0:819:baee:ee8e with SMTP id
 d2e1a72fcca58-819baeefc82mr2386691b3a.0.1767707191146;
        Tue, 06 Jan 2026 05:46:31 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.29
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:30 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 17/28] EPPKE: Skip 4WH and move PTK state directly to
 PTKINITDONE
Date: Tue,  6 Jan 2026 19:15:27 +0530
Message-Id: <20260106134538.2594232-18-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfX7yDCk5V+A5qt
 5F2sJVfmgjHnNRxo0QTTHUdG7+K4aV70T9E9i6ZwAMM5skcl+7ltwGxjKHNvkaYN7RnUf6S9Qec
 u5Wz+FdY0Ok8Z9yioMh3FAueDF1U8bP0N5Cdnbps2gqdv41Z+yGnDyJl9bpYLdvRfGjoXK+ECm2
 FUjzfrnvL8RFnQzrLX0YudnoZfsJlT0v6qdJi177jcevwvXRgOF1EZRKITgM1RgkLRkE0rZoLGL
 4cAdrY8uCK8Hh31vAkADgey1fnWNz4iJxSID0CJgf5+kc3MtzLdZ98qDazLpFMdbM4UR0hlliIj
 0DYXUQ9ozG/yXBxauwMAl29VoLRhnfCX8ikwj3dApZO228LP/9kNmyfaYA6gMCP8pUODIifB0Md
 q1HvLO+XcnUYNnF/CPE02bviyfY351nPN7bAeGFiQQQdfHUsoHm8RtlzEkChCjpa/hts5UC3iET
 473Hnj91hD2dq2dLkOw==
X-Authority-Analysis: v=2.4 cv=YqIChoYX c=1 sm=1 tr=0 ts=695d1238 cx=c_pps
 a=rEQLjTOiSrHUhVqRoksmgQ==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=udJVBnpEZGdnxNb8UCQA:9 a=2VI0MkxyNR6bbpdq8BZq:22
X-Proofpoint-GUID: aPB8pGg4ZvMiJATd_Da1xAnyuDpuupGP
X-Proofpoint-ORIG-GUID: aPB8pGg4ZvMiJATd_Da1xAnyuDpuupGP
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 priorityscore=1501 suspectscore=0 impostorscore=0 bulkscore=0 malwarescore=0
 phishscore=0 adultscore=0 clxscore=1015 lowpriorityscore=0 spamscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_054635_163196_7B524190 
X-CRM114-Status: GOOD (  17.87  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com> A
 successful
    EPPKE Authentication results in the establishment of a PTKSA. So skip
 4-way
    handshake procedure and move the PTK state directly to PTKINITDONE Also
 move
    the peer state to authorized.
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

A successful EPPKE Authentication results in the
establishment of a PTKSA. So skip 4-way handshake
procedure and move the PTK state directly to PTKINITDONE
Also move the peer state to authorized.

Signed-off-by: Rohan Dutta <drohan@qti.qualcomm.com>
Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
---
 src/ap/ap_mlme.c    |  6 ++++--
 src/ap/ieee802_11.c |  3 ++-
 src/ap/wpa_auth.c   | 16 ++++++++++++++++
 3 files changed, 22 insertions(+), 3 deletions(-)

diff --git a/src/ap/ap_mlme.c b/src/ap/ap_mlme.c
index 309e69a3f..efc214fe5 100644
--- a/src/ap/ap_mlme.c
+++ b/src/ap/ap_mlme.c
@@ -112,7 +112,8 @@ void mlme_associate_indication(struct hostapd_data *hapd, struct sta_info *sta)
 	if (sta->auth_alg != WLAN_AUTH_FT &&
 	    sta->auth_alg != WLAN_AUTH_FILS_SK &&
 	    sta->auth_alg != WLAN_AUTH_FILS_SK_PFS &&
-	    sta->auth_alg != WLAN_AUTH_FILS_PK)
+	    sta->auth_alg != WLAN_AUTH_FILS_PK &&
+	    sta->auth_alg != WLAN_AUTH_EPPKE)
 		mlme_deletekeys_request(hapd, sta);
 	ap_sta_clear_disconnect_timeouts(hapd, sta);
 }
@@ -140,7 +141,8 @@ void mlme_reassociate_indication(struct hostapd_data *hapd,
 	if (sta->auth_alg != WLAN_AUTH_FT &&
 	    sta->auth_alg != WLAN_AUTH_FILS_SK &&
 	    sta->auth_alg != WLAN_AUTH_FILS_SK_PFS &&
-	    sta->auth_alg != WLAN_AUTH_FILS_PK)
+	    sta->auth_alg != WLAN_AUTH_FILS_PK &&
+	    sta->auth_alg != WLAN_AUTH_EPPKE)
 		mlme_deletekeys_request(hapd, sta);
 	ap_sta_clear_disconnect_timeouts(hapd, sta);
 }
diff --git a/src/ap/ieee802_11.c b/src/ap/ieee802_11.c
index 8beca257f..27491a1c0 100644
--- a/src/ap/ieee802_11.c
+++ b/src/ap/ieee802_11.c
@@ -7316,7 +7316,8 @@ static void handle_assoc_cb(struct hostapd_data *hapd,
 	    sta->auth_alg == WLAN_AUTH_FILS_SK ||
 	    sta->auth_alg == WLAN_AUTH_FILS_SK_PFS ||
 	    sta->auth_alg == WLAN_AUTH_FILS_PK ||
-	    sta->auth_alg == WLAN_AUTH_FT) {
+	    sta->auth_alg == WLAN_AUTH_FT ||
+	    sta->auth_alg == WLAN_AUTH_EPPKE) {
 		/*
 		 * Open, static WEP, FT protocol, or FILS; no separate
 		 * authorization step.
diff --git a/src/ap/wpa_auth.c b/src/ap/wpa_auth.c
index 99d8e45c2..bbdf76a70 100644
--- a/src/ap/wpa_auth.c
+++ b/src/ap/wpa_auth.c
@@ -1051,6 +1051,17 @@ int wpa_auth_sta_associated(struct wpa_authenticator *wpa_auth,
 	if (!wpa_auth || !wpa_auth->conf.wpa || !sm)
 		return -1;
 
+#ifdef CONFIG_ENC_ASSOC
+	if (sm->auth_alg == WLAN_AUTH_EPPKE) {
+		wpa_auth_logger(wpa_auth, wpa_auth_get_spa(sm), LOGGER_DEBUG,
+				"EPPKE authentication already completed - do not start 4-way handshake");
+		/* Go to PTKINITDONE state to allow GTK rekeying */
+		sm->wpa_ptk_state = WPA_PTK_PTKINITDONE;
+		sm->Pair = true;
+		return 0;
+	}
+#endif /* CONFIG_ENC_ASSOC */
+
 #ifdef CONFIG_IEEE80211R_AP
 	if (sm->ft_completed) {
 		wpa_auth_logger(wpa_auth, wpa_auth_get_spa(sm), LOGGER_DEBUG,
@@ -2532,6 +2543,11 @@ int wpa_auth_sm_event(struct wpa_state_machine *sm, enum wpa_event event)
 	    (event == WPA_AUTH || event == WPA_ASSOC))
 		remove_ptk = 0;
 #endif /* CONFIG_FILS */
+#ifdef CONFIG_ENC_ASSOC
+	if (sm->auth_alg == WLAN_AUTH_EPPKE &&
+	    (event == WPA_AUTH || event == WPA_ASSOC))
+		remove_ptk = 0;
+#endif /* CONFIG_ENC_ASSOC */
 
 	if (remove_ptk) {
 		sm->PTK_valid = false;

From patchwork Tue Jan  6 13:45:28 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180402
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=I2/XDPO3;
	dkim=fail reason="signature verification failed" (2048-bit key;
 secure) header.d=infradead.org header.i=@infradead.org header.a=rsa-sha256
 header.s=desiato.20200630 header.b=IyTxnIpn;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=Sil3QGW8;
	dkim=neutral header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=EXaGs5qM;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlstQ6cWHz1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:47:42 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=2mPXbWCtSi9+oaTSC3dg1lLpPFUPglV2QWFgmLGekeI=; b=I2/XDPO33aLLcr
	KMbzwJ+Vl0IZ1Sq70emMWC89m6aFgpUYMgy+Ab0zuq4QGd5zxS3h8697MZfwdJSzhEZmMv9nBaExH
	3PRKBowzvzZs/opF9RncAmCnBwCfAP73lWWIeImwyO3/N7sEXRrQbG9k9g9Htjh/NSVgnZNjOnUjz
	is0RbRGdI/CD7LN9af3ZlvMkH4KOXs/T61tIVrFZ54l6++TYWtFaYjgXkWoc+lbQez5VhJ4sIml8l
	zgfx7857AI7xE7ErROzxi9pJie69izbrb+dicCuGrm2SOeupLuQC469sxnT9cohwylIrrnZ9yfYPL
	nNFGURhUBd7btUx3H8GA==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Or-0000000D8af-3bCv;
	Tue, 06 Jan 2026 13:47:06 +0000
Received: from desiato.infradead.org ([2001:8b0:10b:1:d65d:64ff:fe57:4e05])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7OY-0000000D8Bz-3LR2
	for hostap@bombadil.infradead.org;
	Tue, 06 Jan 2026 13:46:49 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=infradead.org; s=desiato.20200630; h=Content-Transfer-Encoding:MIME-Version
	:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender:Reply-To:
	Content-Type:Content-ID:Content-Description;
	bh=EQ55xdB7123zmeZflKvFdm7fU2l5MdE69D+YJ9aq6lo=; b=IyTxnIpnpykcoTpidHZjVC+6+j
	aECZArePsZ6MoAxPJJ8eAqe0Gy/+vAGDj+iN0mUbMJlDPjU5osnHScIoL00y8c9tq5RM4TkOUEsQ/
	8S4PUKJRRa/QKYiJVgyIy76aitpJCpy76In+PTmHwq1eCpBHAjzowC+z5LlQ+gQXMfCPou9/gZCUo
	bLgYN3NQeKEWkKUgBJsQSdl/4BuFHQAcHSA4iGvhvJF6sxWuwIwZthwAGLB6xzhIO7fmYRoXXfC3s
	4ij3qL49w4UN5zRvKeRSoR7GK/ogF0kT9DBz7n6/WQ013RcPMTA7FhZxAoLASm8bCLdbL/T0IqUGJ
	ERtTPgPQ==;
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by desiato.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7OS-00000009n1n-1DaB
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:45 +0000
Received: from pps.filterd (m0279871.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606AeoBO3213732
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:35 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=EQ55xdB7123
	zmeZflKvFdm7fU2l5MdE69D+YJ9aq6lo=; b=Sil3QGW8uZvze24KzAwVKDJwEaI
	xDBvYYzQfR67R4Us7S+Yjc0xn71Wje5bET479AE5aOv3IVWeZICXx127Z38OrdcM
	jVnGbDhPGXrFAKlYzgXPgtoR/MDakTdkC54dvDUPz7Mb/6stI/jbYOhZZJ1Jb3YV
	u6LjgqTLf5NJBN3uyNTPugzr9WXgtyEcrtUJDeeJa6VcAPkIKcFppDxfSAfKw5zn
	LK6GpDmyyHKDAnoUgFnUvyJAY43nY+qD42pkpur/ZfFjZF6ibbBR+XslzZgZyrmF
	Gwr9A/eLiTHTh8fXLuEifCr/DXSnx+FySJGIlWsOq19TpjYUqiSQmHL7D/g==
Received: from mail-pf1-f198.google.com (mail-pf1-f198.google.com
 [209.85.210.198])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgpnda7yx-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:35 +0000 (GMT)
Received: by mail-pf1-f198.google.com with SMTP id
 d2e1a72fcca58-7bad1cef9bcso2095542b3a.1
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:35 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707194; x=1768311994;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=EQ55xdB7123zmeZflKvFdm7fU2l5MdE69D+YJ9aq6lo=;
        b=EXaGs5qMpnkU+9ENWY+lJPvd9+wqeZeHLi9esZom3ZI03DpCov75KDIUMlLb4NioEB
         ldXW+1ksuw6vW9C7JR7kDiyd9xrrRb+ddPzIEJbSqWXpXO2rn0hyRoDAsAav0tcfvWbf
         iwGAqpt2M99naH9sFFuonFQu8l3rohsBYgJ5tPfzgWRkeezqAQxo3mOUasJQV13aKkdo
         6v0hbucDNaOPeDCVtlhOmjQk5+qt3DokNSXS4z+zufnO/8X9jxj2W55RvQPRMA4aOydB
         Ls1n8GExKclD/gll/ymoZIIMQvBbcSM+lSB+Y0vIy1ZXn1ugu0aE+iF3Vo4cxrenuV/j
         /ioA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707194; x=1768311994;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=EQ55xdB7123zmeZflKvFdm7fU2l5MdE69D+YJ9aq6lo=;
        b=gTLijNLfGTrVTasrm12hI9ANahHSuzfZ4czip0pjVhYsMPAA3NhHT7pbovqzcClP3H
         a5k2b9LoovNouTBMPjOJ0aXL0TOrLaymbSi5aEvoIBslLBi5hoegS2rxpD05yO/x6PmM
         6zLDFcmW+d7ZySUTcqhuRdA0b7QYDS5dgQQkt4QLmwSmK3mSsjHNtB44EoPXVtdryIZX
         J3LSDL2Mb1dwsfwrNX8DsqDIJ03xjQvmBfnZfjbtTNoxb54FLMIxlIL0UYxoiycx39au
         K3gt7ebTiwSJNrKAqhJBr+X5gl9mteP4LNhhBSZ9UZ//74db/d62BxhdQ6D9j9WNc2Tr
         dtTg==
X-Gm-Message-State: AOJu0YzFDIPN403bTqH5jeuq16Mb73WOb8GGPnmOUW6Kx8R/VQVa6Zr9
	VcU/QsDs/cYZVg1jve9D0xOoVpHq5LKD5w3z7GxRw+WAJ/aE6hM3j7ert6gH+r5WFXO2QGICHzt
	S+SDIKHMxHq7Dl/hh/ypc5mVkr5vT3JeD9ZH9pd7JdQujnf/GQ6xT7GA7OJEz88iLdY8OYn0j
X-Gm-Gg: AY/fxX4HQMX+FaI6iBvOk8i4eY91ys1lKaqbTlRh3mio6PjhwigT3R1+Kzb5pqOooHm
	qjXflsknmU5jx5ArMpQzKYd3RmJhhoO+y8s5M29cSNUW+c/JdVSze7kzyPgfcrJpDum1XChFgVj
	D8XxJBo5fFeIJzdWFzdrdrZrdrLSxn86ixl/Wa65bsovwW6FTAZ16W2SKndfMhpj1r5snaZp5RM
	yuBXSVpw0Tcaovve/cIJLzeUeRCnk5hqsfWj7s7SuH6cBWkyfQOGxwAGAXQ74IcuLsi8nXqfTbN
	sLVZn7J6cckMYFn8dqKtshZN4ZifzVy03UAFbijpR563MT4pz0pLNf4MafaW1QbMCc7pJo1XiSw
	SeyJEPCifBzQZLtV+MSWmPNK1v9iKr34KNGn88A2g
X-Received: by 2002:a05:6a00:1da9:b0:7b8:383d:870e with SMTP id
 d2e1a72fcca58-8188038c8a1mr2492366b3a.2.1767707194082;
        Tue, 06 Jan 2026 05:46:34 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IE9UbQ5TQOoSWW999loNGaW93HU2+1gezBcoywr38ieygBn7+ZpFe/cUcws+2hqUare7RrY+g==
X-Received: by 2002:a05:6a00:1da9:b0:7b8:383d:870e with SMTP id
 d2e1a72fcca58-8188038c8a1mr2492335b3a.2.1767707193505;
        Tue, 06 Jan 2026 05:46:33 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.31
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:33 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 18/28] EPPKE: Add support for EPPKE authentication for
 SME-in-Userspace case
Date: Tue,  6 Jan 2026 19:15:28 +0530
Message-Id: <20260106134538.2594232-19-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-ORIG-GUID: Stgq5DxfuK4dHnXSA4OM6inO7GXPDIS4
X-Proofpoint-GUID: Stgq5DxfuK4dHnXSA4OM6inO7GXPDIS4
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfX7MImDYacWVrJ
 PG7Q/0DdLPejgmLwKoZ0zj4QU5NxH2pGe5eJ4zNGv8XPCDO5+w/TjpGb/o4/U8aq3go/prlOgkK
 BrtLuBp/Kkc8XSLaN4m2K9IsTtIheTbw85SM5i7KVemxB9v4ebzLwx7EKbxBfymhAFfqs+wqnLW
 ezKTUiRhDoaZlS/WppEEB0ZEf4+friOT9vkT3wRJoXRJZPU0adeF3NoQ+thhiDGV6FX0C/cMcpN
 1dgw7T22Q6hi2/kbWGffAgjIEqjwZ6Gr0ybWPb0TlgpkN5CHSdHYLjVImrdOjOqEcPSPAhTFOIR
 xCujySYTODxBDlsDvXpcfzi1qsOfBxhyfVAGXOQN/tmKjH9+jAGjob2atM9gvlNHBl97rtdj82a
 hIYakhG80bb3NQKuRI7JkSKE2TCeIakr6h5t2i9DzjOtZUCU2MSL1wv5/c1GZMPMzcdYORzgWZq
 CQFqKOzqeCFuanuDowQ==
X-Authority-Analysis: v=2.4 cv=Jpz8bc4C c=1 sm=1 tr=0 ts=695d123b cx=c_pps
 a=m5Vt/hrsBiPMCU0y4gIsQw==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=sWKEhP36mHoA:10
 a=VkNPw1HP01LnGYTKEx00:22 a=EUspDBNiAAAA:8 a=xevxeqDSjUnoaC6EqPUA:9
 a=IoOABgeZipijB_acs4fv:22
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 lowpriorityscore=0 malwarescore=0 bulkscore=0 clxscore=1015 adultscore=0
 phishscore=0 suspectscore=0 impostorscore=0 spamscore=0 priorityscore=1501
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_134640_610707_978FB91A 
X-CRM114-Status: GOOD (  23.39  )
X-Spam-Score: -0.9 (/)
X-Spam-Report: Spam detection software,
 running on the system "desiato.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  Extend existing PASN Implementation for authentication
 frame
    construction and processing logic to align with IEEE 802.11bi/D2.0,
 section
    12.16.9.3.2 for EPPKE authentication support. Apply PASN logic [...]
 Content analysis details:   (-0.9 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

Extend existing PASN Implementation for authentication frame construction
and processing logic to align with IEEE 802.11bi/D2.0, section 12.16.9.3.2
for EPPKE authentication support. Apply PASN logic for EPPKE authentication
with necessary differences to support SME-in-Userspace scenarios.

Below are the Key Changes:
 1. Modify PASN Authentication request frame construction APIs:
    - Remove 'static' from M1 and M3 frame building functions to make them
      globally accessible.
    - Add 'is_sme_drv' parameter to differentiate between frames sent via
      %NL80211_CMD_AUTHENTICATE (false) and %NL80211_CMD_FRAME (true)
      interface and prepare auth_data for authentication request frames
      accordingly.
 2. Refactor PASN authentication response frame parsing API:
    - Introduce a new helper function wpas_parse_pasn_frame() to handle
      authentication response frame parsing in a modular way. This
      separates the frame parsing logic from wpa_pasn_auth_rx() and
      enables reuse for SME-in-Userspace scenarios.
    - Simplify pasn_parse_encrypted_data() by removing ieee80211_mgmt
      dependency and enables reuse for SME-in-Userspace scenarios.
 3. Update SME code to integrate EPPKE flow:
    - Add initialization, frame construction and event handling for EPPKE
      using extended PASN APIs for building authentication request frames
      and parsing the authentication response frame.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/pasn/pasn_common.c          |   9 +-
 src/pasn/pasn_common.h          |   8 ++
 src/pasn/pasn_initiator.c       | 154 +++++++++++++++++--------
 src/pasn/pasn_responder.c       |   4 +-
 wpa_supplicant/sme.c            | 196 +++++++++++++++++++++++++++++++-
 wpa_supplicant/wpa_supplicant.c |   1 +
 6 files changed, 309 insertions(+), 63 deletions(-)

diff --git a/src/pasn/pasn_common.c b/src/pasn/pasn_common.c
index f9ec5ca9c..35b91b32d 100644
--- a/src/pasn/pasn_common.c
+++ b/src/pasn/pasn_common.c
@@ -331,14 +331,7 @@ int pasn_parse_encrypted_data(struct pasn_data *pasn, const u8 *data,
 	u8 *buf;
 	u16 buf_len;
 	struct ieee802_11_elems elems;
-	const struct ieee80211_mgmt *mgmt =
-		(const struct ieee80211_mgmt *) data;
-
-	if (len < 24 + 6 ||
-	    ieee802_11_parse_elems(mgmt->u.auth.variable,
-				   len - offsetof(struct ieee80211_mgmt,
-						  u.auth.variable),
-				   &elems, 0) == ParseFailed) {
+	if (ieee802_11_parse_elems(data, len, &elems, 0) == ParseFailed) {
 		wpa_printf(MSG_DEBUG,
 			   "PASN: Failed parsing Authentication frame");
 		return -1;
diff --git a/src/pasn/pasn_common.h b/src/pasn/pasn_common.h
index 45ac3b4ce..cf9ef93b1 100644
--- a/src/pasn/pasn_common.h
+++ b/src/pasn/pasn_common.h
@@ -183,6 +183,10 @@ int wpas_pasn_start(struct pasn_data *pasn, const u8 *own_addr,
 		    int freq, const u8 *beacon_rsne, u8 beacon_rsne_len,
 		    const u8 *beacon_rsnxe, u8 beacon_rsnxe_len,
 		    const struct wpabuf *comeback);
+struct wpabuf *wpas_pasn_build_auth_1(struct pasn_data *pasn,
+				       const struct wpabuf *comeback,
+				       bool verify, bool is_sme_drv);
+struct wpabuf *wpas_pasn_build_auth_3(struct pasn_data *pasn, bool is_sme_drv);
 int wpa_pasn_verify(struct pasn_data *pasn, const u8 *own_addr,
 		    const u8 *peer_addr, const u8 *bssid,
 		    int akmp, int cipher, u16 group,
@@ -193,6 +197,10 @@ int wpa_pasn_auth_rx(struct pasn_data *pasn, const u8 *data, size_t len,
 		     struct wpa_pasn_params_data *pasn_params);
 int wpa_pasn_auth_tx_status(struct pasn_data *pasn,
 			    const u8 *data, size_t data_len, u8 acked);
+int wpas_parse_pasn_frame(struct pasn_data *pasn, u16 auth_type, u16 auth_transaction,
+			  u16 status_code, const u8 *frame_data, size_t frame_data_len,
+			  struct wpa_pasn_params_data *pasn_params);
+
 
 /* Responder */
 int handle_auth_pasn_1(struct pasn_data *pasn,
diff --git a/src/pasn/pasn_initiator.c b/src/pasn/pasn_initiator.c
index 68a4f09fa..ec356173a 100644
--- a/src/pasn/pasn_initiator.c
+++ b/src/pasn/pasn_initiator.c
@@ -582,9 +582,9 @@ static u8 wpas_pasn_get_wrapped_data_format(struct pasn_data *pasn)
 }
 
 
-static struct wpabuf * wpas_pasn_build_auth_1(struct pasn_data *pasn,
+struct wpabuf *wpas_pasn_build_auth_1(struct pasn_data *pasn,
 					      const struct wpabuf *comeback,
-					      bool verify)
+					      bool verify, bool is_sme_drv)
 {
 	struct wpabuf *buf, *pubkey = NULL, *wrapped_data_buf = NULL;
 	const u8 *pmkid;
@@ -609,10 +609,16 @@ static struct wpabuf * wpas_pasn_build_auth_1(struct pasn_data *pasn,
 
 	wrapped_data = wpas_pasn_get_wrapped_data_format(pasn);
 
-	wpa_pasn_build_auth_header(buf, pasn->bssid,
-				   pasn->own_addr, pasn->peer_addr,
-				   pasn->trans_seq + 1, WLAN_STATUS_SUCCESS,
-				   pasn->auth_alg == WLAN_AUTH_EPPKE);
+	if (!is_sme_drv) {
+		wpabuf_put_le16(buf, pasn->trans_seq + 1);
+		wpabuf_put_le16(buf, WLAN_STATUS_SUCCESS);
+	} else {
+		wpa_pasn_build_auth_header(buf, pasn->bssid,
+					   pasn->own_addr, pasn->peer_addr,
+					   pasn->trans_seq + 1,
+					   WLAN_STATUS_SUCCESS,
+					   pasn->auth_alg == WLAN_AUTH_EPPKE);
+	}
 
 	pmkid = NULL;
 	if (wpa_key_mgmt_ft(pasn->akmp)) {
@@ -682,7 +688,8 @@ fail:
 }
 
 
-static struct wpabuf * wpas_pasn_build_auth_3(struct pasn_data *pasn)
+struct wpabuf *wpas_pasn_build_auth_3(struct pasn_data *pasn,
+					      bool is_sme_drv)
 {
 	struct wpabuf *buf, *wrapped_data_buf = NULL;
 	u8 mic[WPA_PASN_MAX_MIC_LEN];
@@ -703,13 +710,18 @@ static struct wpabuf * wpas_pasn_build_auth_3(struct pasn_data *pasn)
 	if (!buf)
 		goto fail;
 
-	wrapped_data = wpas_pasn_get_wrapped_data_format(pasn);
+	if (!is_sme_drv) {
+		wpabuf_put_le16(buf, WLAN_AUTH_TR_SEQ_PASN_AUTH3);
+		wpabuf_put_le16(buf, WLAN_STATUS_SUCCESS);
+	} else {
+		wpa_pasn_build_auth_header(buf, pasn->bssid,
+					   pasn->own_addr, pasn->peer_addr,
+					   WLAN_AUTH_TR_SEQ_PASN_AUTH3,
+					   WLAN_STATUS_SUCCESS,
+					   pasn->auth_alg == WLAN_AUTH_EPPKE);
+	}
 
-	wpa_pasn_build_auth_header(buf, pasn->bssid,
-				   pasn->own_addr, pasn->peer_addr,
-				   WLAN_AUTH_TR_SEQ_PASN_AUTH3,
-				   WLAN_STATUS_SUCCESS,
-				   pasn->auth_alg == WLAN_AUTH_EPPKE);
+	wrapped_data = wpas_pasn_get_wrapped_data_format(pasn);
 
 	wrapped_data_buf = wpas_pasn_get_wrapped_data(pasn);
 
@@ -1010,7 +1022,7 @@ static int wpas_pasn_send_auth_1(struct pasn_data *pasn, const u8 *own_addr,
 		   MAC2STR(pasn->peer_addr), pasn->akmp, pasn->cipher,
 		   pasn->group);
 
-	frame = wpas_pasn_build_auth_1(pasn, comeback, verify);
+	frame = wpas_pasn_build_auth_1(pasn, comeback, verify, true);
 	if (!frame) {
 		wpa_printf(MSG_DEBUG, "PASN: Failed building 1st auth frame");
 		goto fail;
@@ -1153,36 +1165,27 @@ static bool is_pasn_auth_frame(struct pasn_data *pasn,
 }
 
 
-int wpa_pasn_auth_rx(struct pasn_data *pasn, const u8 *data, size_t len,
-		     struct wpa_pasn_params_data *pasn_params)
-
+int wpas_parse_pasn_frame(struct pasn_data *pasn, u16 auth_type,
+			  u16 auth_transaction, u16 status,
+			  const u8 *auth_data, size_t auth_data_len,
+			  struct wpa_pasn_params_data *pasn_params)
 {
 	struct ieee802_11_elems elems;
 	struct wpa_ie_data rsn_data;
-	const struct ieee80211_mgmt *mgmt =
-		(const struct ieee80211_mgmt *) data;
-	struct wpabuf *wrapped_data = NULL, *secret = NULL, *frame = NULL;
+	struct wpabuf *wrapped_data = NULL, *secret = NULL;
 	u8 mic[WPA_PASN_MAX_MIC_LEN], out_mic[WPA_PASN_MAX_MIC_LEN];
 	u8 mic_len;
-	u16 status;
 	int ret, inc_y;
 	u8 *copy = NULL;
 	size_t mic_offset, copy_len;
 
-	if (!is_pasn_auth_frame(pasn, mgmt, len, true))
-		return -2;
-
-	if (mgmt->u.auth.auth_transaction !=
-	    host_to_le16(pasn->trans_seq + 1)) {
+	if (auth_transaction != pasn->trans_seq + 1) {
 		wpa_printf(MSG_DEBUG,
 			   "PASN: RX: Invalid transaction sequence: (%u != %u)",
-			   le_to_host16(mgmt->u.auth.auth_transaction),
-			   pasn->trans_seq + 1);
+			   auth_transaction, pasn->trans_seq + 1);
 		return -3;
 	}
 
-	status = le_to_host16(mgmt->u.auth.status_code);
-
 	if (status != WLAN_STATUS_SUCCESS &&
 	    status != WLAN_STATUS_ASSOC_REJECTED_TEMPORARILY) {
 		wpa_printf(MSG_DEBUG,
@@ -1190,10 +1193,8 @@ int wpa_pasn_auth_rx(struct pasn_data *pasn, const u8 *data, size_t len,
 		goto fail;
 	}
 
-	if (ieee802_11_parse_elems(mgmt->u.auth.variable,
-				   len - offsetof(struct ieee80211_mgmt,
-						  u.auth.variable),
-				   &elems, 0) == ParseFailed) {
+	if (ieee802_11_parse_elems(auth_data, auth_data_len, &elems, 0) ==
+				   ParseFailed) {
 		wpa_printf(MSG_DEBUG,
 			   "PASN: Failed parsing Authentication frame");
 		goto fail;
@@ -1354,14 +1355,24 @@ int wpa_pasn_auth_rx(struct pasn_data *pasn, const u8 *data, size_t len,
 	/* Use a copy of the message since we need to clear the MIC field */
 	if (!elems.mic)
 		goto fail;
-	mic_offset = elems.mic - (const u8 *) &mgmt->u.auth;
-	copy_len = len - offsetof(struct ieee80211_mgmt, u.auth);
-	if (mic_offset + mic_len > copy_len)
-		goto fail;
-	copy = os_memdup(&mgmt->u.auth, copy_len);
+
+	mic_offset = elems.mic - auth_data;
+	/* 6 bytes for auth algorithm, auth transaction and status code.
+	 * 2 bytes each.
+	 */
+	copy = os_malloc(auth_data_len + 6);
 	if (!copy)
 		goto fail;
-	os_memset(copy + mic_offset, 0, mic_len);
+
+	os_memcpy(copy, &auth_type, 2);
+	os_memcpy(copy + 2, &auth_transaction, 2);
+	os_memcpy(copy + 4, &status, 2);
+	os_memcpy(copy + 6, auth_data, auth_data_len);
+	copy_len = auth_data_len + 6;
+	if (mic_offset + mic_len > auth_data_len)
+		goto fail;
+
+	os_memset(copy + mic_offset + 6, 0, mic_len);
 
 	if (pasn->beacon_rsne_rsnxe) {
 		/* Verify the MIC */
@@ -1421,12 +1432,61 @@ int wpa_pasn_auth_rx(struct pasn_data *pasn, const u8 *data, size_t len,
 
 	wpa_printf(MSG_DEBUG, "PASN: Success verifying Authentication frame");
 
-	if (pasn_parse_encrypted_data(pasn, data, len) < 0) {
+	if (pasn_parse_encrypted_data(pasn, auth_data, auth_data_len) < 0) {
 		wpa_printf(MSG_DEBUG, "PASN: Encrypted data processing failed");
 		goto fail;
 	}
 
-	frame = wpas_pasn_build_auth_3(pasn);
+	return 0;
+fail:
+	wpabuf_free(wrapped_data);
+	wpabuf_free(secret);
+	os_free(copy);
+
+	/*
+	 * TODO: In case of an error the standard allows to silently drop
+	 * the frame and terminate the authentication exchange. However, better
+	 * reply to the AP with an error status.
+	 */
+	if (status == WLAN_STATUS_SUCCESS)
+		pasn->status = WLAN_STATUS_UNSPECIFIED_FAILURE;
+	else
+		pasn->status = status;
+
+	return -1;
+
+}
+
+
+int wpa_pasn_auth_rx(struct pasn_data *pasn, const u8 *data, size_t len,
+		     struct wpa_pasn_params_data *pasn_params)
+{
+	const struct ieee80211_mgmt *mgmt =
+		(const struct ieee80211_mgmt *) data;
+	struct wpabuf *frame = NULL;
+	int ret;
+
+	if (!is_pasn_auth_frame(pasn, mgmt, len, true))
+		return -2;
+
+	ret = wpas_parse_pasn_frame(pasn, le_to_host16(mgmt->u.auth.auth_alg),
+				    le_to_host16(mgmt->u.auth.auth_transaction),
+				    le_to_host16(mgmt->u.auth.status_code),
+				    mgmt->u.auth.variable,
+				    len - offsetof(struct ieee80211_mgmt,
+				    u.auth.variable), pasn_params);
+
+	if (ret < 0) {
+		wpa_printf(MSG_DEBUG, "PASN: Failed parsing PASN M2 auth frame");
+		goto fail;
+	}
+
+	if (ret == 1) {
+		wpa_printf(MSG_DEBUG, "PASN: Temporary rejection, Retry");
+		return 1;
+	}
+
+	frame = wpas_pasn_build_auth_3(pasn, true);
 	if (!frame) {
 		wpa_printf(MSG_DEBUG, "PASN: Failed building 3rd auth frame");
 		goto fail;
@@ -1451,21 +1511,17 @@ int wpa_pasn_auth_rx(struct pasn_data *pasn, const u8 *data, size_t len,
 
 	return 0;
 fail:
-	wpa_printf(MSG_DEBUG, "PASN: Failed RX processing - terminating");
-	wpabuf_free(wrapped_data);
-	wpabuf_free(secret);
-	os_free(copy);
-
 	/*
 	 * TODO: In case of an error the standard allows to silently drop
 	 * the frame and terminate the authentication exchange. However, better
 	 * reply to the AP with an error status.
 	 */
-	if (status == WLAN_STATUS_SUCCESS)
+	if (le_to_host16(mgmt->u.auth.status_code) == WLAN_STATUS_SUCCESS)
 		pasn->status = WLAN_STATUS_UNSPECIFIED_FAILURE;
 	else
-		pasn->status = status;
+		pasn->status = le_to_host16(mgmt->u.auth.status_code);
 
+	wpa_printf(MSG_DEBUG, "PASN: Failed RX processing - terminating");
 	return -1;
 }
 
diff --git a/src/pasn/pasn_responder.c b/src/pasn/pasn_responder.c
index 1aa72de11..f7f1bc413 100644
--- a/src/pasn/pasn_responder.c
+++ b/src/pasn/pasn_responder.c
@@ -1184,7 +1184,9 @@ int handle_auth_pasn_3(struct pasn_data *pasn, const u8 *own_addr,
 		wpabuf_free(wrapped_data);
 	}
 
-	if (pasn_parse_encrypted_data(pasn, (const u8 *) mgmt, len) < 0) {
+	if (pasn_parse_encrypted_data(pasn, (const u8 *) mgmt->u.auth.variable,
+				      len - offsetof(struct ieee80211_mgmt,
+				      u.auth.variable)) < 0) {
 		wpa_printf(MSG_DEBUG, "PASN: Encrypted data processing failed");
 		goto fail;
 	}
diff --git a/wpa_supplicant/sme.c b/wpa_supplicant/sme.c
index fba6508bc..3510faf74 100644
--- a/wpa_supplicant/sme.c
+++ b/wpa_supplicant/sme.c
@@ -32,6 +32,9 @@
 #include "scan.h"
 #include "sme.h"
 #include "hs20_supplicant.h"
+#include "pasn/pasn_common.h"
+#include "common/dragonfly.h"
+#include "common/ptksa_cache.h"
 
 #define SME_AUTH_TIMEOUT 5
 #define SME_ASSOC_TIMEOUT 5
@@ -41,6 +44,7 @@ static void sme_assoc_timer(void *eloop_ctx, void *timeout_ctx);
 static void sme_obss_scan_timeout(void *eloop_ctx, void *timeout_ctx);
 static void sme_stop_sa_query(struct wpa_supplicant *wpa_s);
 
+static const int dot11RSNAConfigPMKLifetime = 43200;
 
 #ifdef CONFIG_SAE
 
@@ -597,6 +601,133 @@ static void sme_add_assoc_req_ie(struct wpa_supplicant *wpa_s,
 	}
 }
 
+#ifdef CONFIG_ENC_ASSOC
+static struct sae_pt *
+sme_eppke_sae_derive_pt(struct wpa_ssid *ssid, int group)
+{
+	const char *password = ssid->sae_password;
+	int groups[2] = { group, 0 };
+
+	if (!password)
+		password = ssid->passphrase;
+
+	if (!password) {
+		wpa_printf(MSG_DEBUG, "PASN: SAE without a password");
+		return NULL;
+	}
+
+	return sae_derive_pt(groups, ssid->ssid, ssid->ssid_len,
+			     (const u8 *) password, os_strlen(password),
+			     (const u8 *) ssid->sae_password_id,
+			     ssid->sae_password_id ?
+			     os_strlen(ssid->sae_password_id) : 0);
+}
+
+static void wpas_eppke_initialize(struct wpa_supplicant *wpa_s, struct wpa_bss *bss,
+				 struct wpa_ssid *ssid)
+{
+	struct pasn_data *pasn;
+	const u8 *beacon_rsne, *beacon_rsnxe;
+	u8 beacon_rsne_len, beacon_rsnxe_len;
+	u32 capab = 0;
+	int group;
+
+	pasn = &wpa_s->pasn;
+
+	if (sme_set_sae_group(wpa_s, 0) < 0) {
+		wpa_printf(MSG_DEBUG, "EPPKE: Failed to select group");
+		return;
+	}
+	group = wpa_s->sme.sae.group;
+
+	if (!dragonfly_suitable_group(group, 1)) {
+		wpa_printf(MSG_DEBUG,
+			"PASN: Reject unsuitable group %u", group);
+		return;
+	}
+
+	beacon_rsne = wpa_bss_get_rsne(wpa_s, bss, NULL, false);
+	if (!beacon_rsne) {
+		wpa_printf(MSG_DEBUG, "EPPKE: Can't connect without RSNE");
+		return;
+	}
+
+	beacon_rsnxe = wpa_bss_get_rsnxe(wpa_s, bss, NULL, false);
+
+	beacon_rsne_len = *(beacon_rsne + 1) + 2;
+	beacon_rsnxe_len = beacon_rsnxe ? *(beacon_rsnxe + 1) + 2 : 0;
+	if (beacon_rsne && beacon_rsne_len) {
+		wpabuf_free(pasn->beacon_rsne_rsnxe);
+		pasn->beacon_rsne_rsnxe = wpabuf_alloc(beacon_rsne_len +
+						       beacon_rsnxe_len);
+		if (!pasn->beacon_rsne_rsnxe) {
+			wpa_printf(MSG_DEBUG,
+				   "PASN: Failed storing beacon RSNE/RSNXE");
+			return;
+		}
+
+		wpabuf_put_data(pasn->beacon_rsne_rsnxe, beacon_rsne,
+				beacon_rsne_len);
+		if (beacon_rsnxe && beacon_rsnxe_len)
+			wpabuf_put_data(pasn->beacon_rsne_rsnxe,
+					beacon_rsnxe, beacon_rsnxe_len);
+	}
+	capab |= BIT(WLAN_RSNX_CAPAB_KEK_IN_PASN);
+	capab |= BIT(WLAN_RSNX_CAPAB_ASSOC_FRAME_ENCRYPTION);
+
+#ifdef CONFIG_SAE
+	if (wpa_key_mgmt_sae(ssid->key_mgmt)) {
+		capab |= BIT(WLAN_RSNX_CAPAB_SAE_H2E);
+		if (beacon_rsnxe && !ieee802_11_rsnx_capab(beacon_rsnxe,
+		    WLAN_RSNX_CAPAB_SAE_H2E)) {
+			wpa_printf(MSG_DEBUG, "PASN: AP does not support SAE H2E");
+			return;
+		}
+		if (pasn->pt)
+			sae_deinit_pt(pasn->pt);
+		pasn_set_pt(pasn, sme_eppke_sae_derive_pt(ssid, group));
+		if (!pasn->pt) {
+			wpa_printf(MSG_DEBUG, "PASN: Failed to derive PT");
+			return;
+		}
+		pasn->sae.state = SAE_NOTHING;
+		pasn->sae.send_confirm = 0;
+	} else {
+		wpa_msg(wpa_s, MSG_INFO, "Base AKM not present");
+		return;
+	}
+#endif /* CONFIG_SAE */
+
+	pasn_set_rsnxe_caps(pasn, capab);
+	pasn_set_initiator_pmksa(pasn, wpa_sm_get_pmksa_cache(wpa_s->wpa));
+
+	if (pasn->ecdh)
+		crypto_ecdh_deinit(pasn->ecdh);
+	pasn->ecdh = crypto_ecdh_init(group);
+	if (!pasn->ecdh) {
+		wpa_printf(MSG_INFO, "PASN: Failed to init ECDH");
+		return;
+	}
+	pasn->akmp = wpa_s->key_mgmt;
+	pasn->cipher = wpa_pick_pairwise_cipher(ssid->pairwise_cipher, 1);
+	pasn->group = group;
+	pasn->freq = bss->freq;
+	pasn->auth_alg = WLAN_AUTH_EPPKE;
+
+	os_memcpy(pasn->own_addr, wpa_s->own_addr, ETH_ALEN);
+	if (wpa_s->drv_flags2 & WPA_DRIVER_FLAGS2_MLO)
+		os_memcpy(pasn->peer_addr, wpa_s->ap_mld_addr, ETH_ALEN);
+	else
+		os_memcpy(pasn->peer_addr, bss->bssid, ETH_ALEN);
+	os_memcpy(pasn->bssid, bss->bssid, ETH_ALEN);
+
+	wpa_printf(MSG_DEBUG,
+		   "PASN: Init: " MACSTR " akmp=0x%x, cipher=0x%x, group=%u",
+		   MAC2STR(pasn->peer_addr), pasn->akmp,
+			   pasn->cipher, pasn->group);
+}
+#endif /* CONFIG_ENC_ASSOC */
+
 
 static void sme_send_authentication(struct wpa_supplicant *wpa_s,
 				    struct wpa_bss *bss, struct wpa_ssid *ssid,
@@ -698,14 +829,22 @@ static void sme_send_authentication(struct wpa_supplicant *wpa_s,
 		if (!rsn) {
 			wpa_dbg(wpa_s, MSG_DEBUG,
 				"SAE enabled, but target BSS does not advertise RSN");
+		}
+		if (wpa_parse_wpa_ie(rsn, 2 + rsn[1], &ied)) {
+			wpa_printf(MSG_DEBUG, "PASN: Failed parsing RSNE data");
+			return;
 #ifdef CONFIG_DPP
-		} else if (wpa_parse_wpa_ie(rsn, 2 + rsn[1], &ied) == 0 &&
-			   (ssid->key_mgmt & WPA_KEY_MGMT_DPP) &&
+		} else if ((ssid->key_mgmt & WPA_KEY_MGMT_DPP) &&
 			   (ied.key_mgmt & WPA_KEY_MGMT_DPP)) {
 			wpa_dbg(wpa_s, MSG_DEBUG, "Prefer DPP over SAE when both are enabled");
 #endif /* CONFIG_DPP */
-		} else if (wpa_parse_wpa_ie(rsn, 2 + rsn[1], &ied) == 0 &&
-			   wpa_key_mgmt_sae(ied.key_mgmt)) {
+#ifdef CONFIG_ENC_ASSOC
+		} else if (wpa_s->drv_flags2 & WPA_DRIVER_FLAGS2_EPPKE &&
+			   (ied.key_mgmt & WPA_KEY_MGMT_EPPKE)) {
+			wpa_dbg(wpa_s, MSG_DEBUG, "Prefer EPPKE over SAE when both are enabled");
+			params.auth_alg = WPA_AUTH_ALG_EPPKE;
+#endif /* CONFIG_ENC_ASSOC */
+		} else if (wpa_key_mgmt_sae(ied.key_mgmt)) {
 			if (wpas_is_sae_avoided(wpa_s, ssid, &ied)) {
 				wpa_dbg(wpa_s, MSG_DEBUG,
 					"SAE enabled, but disallowing SAE auth_alg without PMF");
@@ -1026,6 +1165,20 @@ static void sme_send_authentication(struct wpa_supplicant *wpa_s,
 	}
 #endif /* CONFIG_MBO */
 
+#ifdef CONFIG_ENC_ASSOC
+	if (!skip_auth && params.auth_alg == WPA_AUTH_ALG_EPPKE) {
+		wpas_eppke_initialize(wpa_s, bss, ssid);
+		if (start)
+			resp = wpas_pasn_build_auth_1(&wpa_s->pasn, NULL,
+							    false, 0);
+		else
+			resp = wpas_pasn_build_auth_3(&wpa_s->pasn, 0);
+
+		params.auth_data = wpabuf_head(resp);
+		params.auth_data_len = wpabuf_len(resp);
+		wpa_s->sme.auth_alg = params.auth_alg;
+	}
+#endif /* CONFIG_ENC_ASSOC */
 #ifdef CONFIG_SAE
 	if (!skip_auth && params.auth_alg == WPA_AUTH_ALG_SAE &&
 	    pmksa_cache_set_current(wpa_s->wpa, NULL,
@@ -1167,7 +1320,9 @@ no_fils:
 		wpa_ssid_txt(params.ssid, params.ssid_len), params.freq);
 
 	eapol_sm_notify_portValid(wpa_s->eapol, false);
-	wpa_clear_keys(wpa_s, bss->bssid);
+	if (wpa_s->sme.auth_alg != WPA_AUTH_ALG_EPPKE) {
+		wpa_clear_keys(wpa_s, bss->bssid);
+	}
 	wpa_supplicant_set_state(wpa_s, WPA_AUTHENTICATING);
 	if (old_ssid != wpa_s->current_ssid)
 		wpas_notify_network_changed(wpa_s);
@@ -2080,6 +2235,37 @@ void sme_event_auth(struct wpa_supplicant *wpa_s, union wpa_event_data *data)
 
 	eloop_cancel_timeout(sme_auth_timer, wpa_s, NULL);
 
+#ifdef CONFIG_ENC_ASSOC
+	if (data->auth.auth_type == WLAN_AUTH_EPPKE) {
+		struct pasn_data *pasn = &wpa_s->pasn;
+		struct wpa_pasn_params_data pasn_params;
+		int res;
+
+		res = wpas_parse_pasn_frame(pasn, data->auth.auth_type,
+					    data->auth.auth_transaction,
+					    data->auth.status_code,
+					    data->auth.ies, data->auth.ies_len,
+					    &pasn_params);
+
+		if (res < 0) {
+			wpas_connection_failed(wpa_s, wpa_s->pending_bssid,
+					       NULL);
+			wpa_supplicant_set_state(wpa_s, WPA_DISCONNECTED);
+		}
+
+		ptksa_cache_add(wpa_s->ptksa, pasn->own_addr, pasn->peer_addr,
+				pasn_get_cipher(pasn),
+				dot11RSNAConfigPMKLifetime,
+				pasn_get_ptk(pasn), NULL, NULL,
+				pasn_get_akmp(pasn));
+
+		if (pasn->pmksa_entry)
+			wpa_sm_set_cur_pmksa(wpa_s->wpa, pasn->pmksa_entry);
+
+		sme_send_authentication(wpa_s, wpa_s->current_bss,
+					wpa_s->current_ssid, 0);
+	}
+#endif /* CONFIG_ENC_ASSOC */
 #ifdef CONFIG_SAE
 	if (data->auth.auth_type == WLAN_AUTH_SAE) {
 		const u8 *addr = wpa_s->pending_bssid;
diff --git a/wpa_supplicant/wpa_supplicant.c b/wpa_supplicant/wpa_supplicant.c
index 293d4920e..70c92ea00 100644
--- a/wpa_supplicant/wpa_supplicant.c
+++ b/wpa_supplicant/wpa_supplicant.c
@@ -9476,6 +9476,7 @@ void wpas_request_connection(struct wpa_supplicant *wpa_s)
 	wpa_s->disconnected = 0;
 	wpa_s->reassociate = 1;
 	wpa_s->last_owe_group = 0;
+	wpa_pasn_reset(&wpa_s->pasn);
 
 	if (wpa_supplicant_fast_associate(wpa_s) != 1)
 		wpa_supplicant_req_scan(wpa_s, 0, 0);

From patchwork Tue Jan  6 13:45:29 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180403
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=HPEkcHxN;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=UVJyiMvn;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=Ab0/vrkL;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlsts0B6zz1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:48:05 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=Yjqj6FIn4QqJpBb9ay3GmNwgzUluTMHlEteV0R3+RPI=; b=HPEkcHxN8jnjgR
	gruJ1PnBHDlS5a6C+K+Ao3UJKQoq1o7bt5gGTr6xUt+5WF2dkY5gb1Be95wJ+3gS6Ivvo8pHdJhLU
	y2FZZnnsD1lFnO16xgYsAyncV5Wiok9u4ePNRLRsbX8GLujOJWdki8ZBEAphn8AOXRdfjvQVywPT9
	jHKnx61T67xwv98u0Ab5qH75PuD28qN7NjoyrEy5yY88/7ZHlJy2pcd7BZo+gTenMBj1RANduWS1g
	A/JIleyCe/6fkWcx/EqqJCJ5KZO12Cd1n3otxIDLd19Qhohm0uYa3vu5OCwZNwQrv8AEmyQR+9jOc
	hCo6b/7hPpQ6TxUoj1qA==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7P5-0000000D8sS-09NV;
	Tue, 06 Jan 2026 13:47:19 +0000
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7OQ-0000000D80n-3kL6
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:50 +0000
Received: from pps.filterd (m0279873.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606Ar8oS2255371
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:37 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=FQmb6m6y8pp
	b9jQdtVKNvEA3ZroABx8GJ4xY1v44CxU=; b=UVJyiMvnznZv7Y+QLxkhQ/hHwqA
	PV5Ha3a7sF0PCriwrKZr+DN+uvr1jemgxkjA4MbrfoLP48GBw7RdQ1RB0jiTIyMS
	GwTf+c0iOg3XhbhcR/VrOD5bEjgsebVhPQc/RAPzEFDGF5X5RSXwmRLJGF/W2BJF
	nH5Hyt2TORq82VLHaR7t1nqPhcSG0BY2WxuaZ+KTHdC17tNrFv3v2Rm8rxPdz7MH
	Iv5J4Zqz7eBxFCZc20o1Eu0q+H3wh7H1504rkBnwW7BrRkG/6Rb0jNO+K0uq8UNS
	wuH+hR6nwcLvno3DL3dcJQrmEKvQKVrF0dgcVpkSJH6wlBOr8XyhOIU712g==
Received: from mail-pf1-f200.google.com (mail-pf1-f200.google.com
 [209.85.210.200])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgu421jm4-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:37 +0000 (GMT)
Received: by mail-pf1-f200.google.com with SMTP id
 d2e1a72fcca58-7d481452732so1803180b3a.1
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:37 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707196; x=1768311996;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=FQmb6m6y8ppb9jQdtVKNvEA3ZroABx8GJ4xY1v44CxU=;
        b=Ab0/vrkLo3qY+K6nGiWp8EbowLia9Ww2cUusLOFmyvGDGGYud5LDIaCO39HwtAWWp6
         9rA0XwpxoLtR0fFzKPOV2Ut0jVlF6nDJXMEuUYTq5XHyD9tlgoS0IcIo7uaNwzVTVKVY
         DSwl1yYlCO6w6nWbN19D3IkudTk6AYz3xdWM9FwOkXzHHUYmQ5emXc3lfwVyfDEMga2r
         +ZZO/rGFv3nF7IXA1aEtG8HBzAlThKVX6S33QooRPQiLiVvzmUtoPWGOukjuH/RBboWO
         ZOa57Sjs4m5Vkb+X/Bn6r7+5noIyG77z9WCSeQoAlog3O0YUum5QsYgZ4uS7vH9gMgpZ
         OwZg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707196; x=1768311996;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=FQmb6m6y8ppb9jQdtVKNvEA3ZroABx8GJ4xY1v44CxU=;
        b=EYM0OBm43a5mRDPqE1aWebSLDLjNjo74gZal+94iNcmMLZNDTga4zFvAosEtOOLH/j
         bsNU+48j4AHCin/wLGm490Lg4X9kW1S11Zqbf/afUSE8IThVh2HIzqR4JAWreYrDPFt/
         ys/P23O+tG00XK9u67zOha81QpHGC7eZRxRl612MVUjNr8CpbJPhjdUz7vcAxlDX+q0N
         vnUMmINNO/qP9mweT2Vl3Tr/exDq/jIgvHeW2CllR1/yiehT72dgVfEiUGphPWhXYBeN
         GHHonQq9OdulkeFAHwixJcEJdxmRTa9JAhEa2eoRXlXjBAurIrVENEr5lKqIphU50VVA
         /cxw==
X-Gm-Message-State: AOJu0YzCYYA4bOx2xwKL3ShdftLXmkNbrKUjXVuwzyCUaw0ngBaJDAyD
	vYRpiB3EVoj1ldrHuN6YjLvMX+tTBnWdVs3qswevvJK1DDIvNEYwASo/o75F4xZ5ZlBpD2H5jW2
	EEnONUWEAkAAjC63MRjyjETS/ELTK+PLZp4fVpa54COWeiILKHPsxoeNpr66Tns4QYdDaS12G
X-Gm-Gg: AY/fxX73GjAzaD5ANiosROlwkmjN442bdlfeUo5YQrsDZ9YD4HuwCfOh3EU8JgymrOZ
	tzGWykHd2xyQoYkY8UoTwn4kCrh4nynYN6VRPAYdeRcBirAit6AehOF6C40FrQ/Ri/x7AjX7xIn
	5A3fZmHYGs606HSN77T8PJHTXVarLFBrrUgt/5IqhBpT8x2LAp1rQp69ZVmRWbG/PrGggF37wAe
	3yjmhHbgQ86J4t1LmkgiAcJvp/6tidkYRNGoRHeToc4LeSsjjZgAd3VYDyluKQg7CzvOlO5yLhK
	tfZR9nFZEX76N/HDpfJnY5Z7P/6A4zZfX3qEL8MkhV48rGSq5qJyof0r/Vpq/v8HVg6NGNaHaC7
	Qa43j/LRrKMlJ29fgotBXlD9koN+3Y4aiKYcy3sC1
X-Received: by 2002:a05:6a00:4482:b0:7e8:450c:61d6 with SMTP id
 d2e1a72fcca58-81882ed5244mr2663494b3a.70.1767707196276;
        Tue, 06 Jan 2026 05:46:36 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IEt/VOygogbHe+0MkGPls+v2F4jn8ba+W+l5+GufV66au0R5i4Rz0WMyb3NVvA0KjIKLh5P4g==
X-Received: by 2002:a05:6a00:4482:b0:7e8:450c:61d6 with SMTP id
 d2e1a72fcca58-81882ed5244mr2663475b3a.70.1767707195824;
        Tue, 06 Jan 2026 05:46:35 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.33
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:35 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 19/28] EPPKE: Add Multi-Link support in Authentication
 frames
Date: Tue,  6 Jan 2026 19:15:29 +0530
Message-Id: <20260106134538.2594232-20-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Authority-Analysis: v=2.4 cv=dYuNHHXe c=1 sm=1 tr=0 ts=695d123d cx=c_pps
 a=mDZGXZTwRPZaeRUbqKGCBw==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=fVceUa6IFZthgqk8aiAA:9 a=zc0IvFSfCIW2DFIPzwfm:22
X-Proofpoint-GUID: ngwtEy_1W2WW2nY5r8hl4n04UiWzkP8N
X-Proofpoint-ORIG-GUID: ngwtEy_1W2WW2nY5r8hl4n04UiWzkP8N
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfX+9lE761go2qg
 dkOR11kW+5WywXnMrYU/aj7BG2l/rfNuEoZ4xVprp7nmcpwrYLPWT/uaKmBqGAHvPXOaMpNMSp+
 guNNg/16KKaYbF5tUUaPigkII1mmUUpMcLfQkCDcs89gIdP8HnFDYIduLwfQgtCi+m7elE0CjXs
 ncDXXtLenQx7fSQf7FsF/h+fS9SsbQfiBMTkilCdkR6hYDUQwSV+Cy9hX09FBVnW4lK5E7weklN
 rK+WarUNI0eFacolBf9HwJNUM8SJQ0I2Zee+WtuW2GJbEgrblJhIpakG3aJ6iuSn6y/xmte9vqS
 apSkCeues+EgjXhHZ0EkDbyCkT6qnmGdqMJXRjm7QMo5fTsg8jvsJtEOLz66rr/yQe3z+Ldb8sS
 iOlaIfXbt8Hb13x3rhrSw4LQ1tCH447LZpMsDkE4m714xjnR26KezAq9Q5ctFKhtOqlAm1See0d
 yPX8eYFLJhCv2IwU5FQ==
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 priorityscore=1501 adultscore=0 malwarescore=0 impostorscore=0 phishscore=0
 clxscore=1015 spamscore=0 lowpriorityscore=0 suspectscore=0 bulkscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_054640_873111_EB2EA20D 
X-CRM114-Status: GOOD (  16.93  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: Spam detection software,
 running on the system "bombadil.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  Enhance EPPKE authentication to include Multi-Link Element
    (MLE) for MLO-capable stations. The MLE is added to authentication request
    frames when the station supports Multi-Link operation, ensuring pr [...]
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

Enhance EPPKE authentication to include Multi-Link Element (MLE) for
MLO-capable stations. The MLE is added to authentication request frames
when the station supports Multi-Link operation, ensuring proper handling
of MLO connections during EPPKE authentication.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/pasn/pasn_initiator.c | 24 ++++++++++++++++++++++++
 wpa_supplicant/sme.c      |  6 ++++--
 2 files changed, 28 insertions(+), 2 deletions(-)

diff --git a/src/pasn/pasn_initiator.c b/src/pasn/pasn_initiator.c
index ec356173a..30f42fb65 100644
--- a/src/pasn/pasn_initiator.c
+++ b/src/pasn/pasn_initiator.c
@@ -664,6 +664,18 @@ struct wpabuf *wpas_pasn_build_auth_1(struct pasn_data *pasn,
 
 	wpa_pasn_add_extra_ies(buf, pasn->extra_ies, pasn->extra_ies_len);
 
+#ifdef CONFIG_ENC_ASSOC
+	if (pasn->auth_alg == WLAN_AUTH_EPPKE && pasn->is_ml_peer) {
+		wpa_printf(MSG_DEBUG, "EPPKE: Include Multi Link Element");
+		wpabuf_put_u8(buf, WLAN_EID_EXTENSION);
+		wpabuf_put_u8(buf, 10);
+		wpabuf_put_u8(buf, WLAN_EID_EXT_MULTI_LINK);
+		wpabuf_put_le16(buf, MULTI_LINK_CONTROL_TYPE_BASIC);
+		wpabuf_put_u8(buf, ETH_ALEN + 1);
+		wpabuf_put_data(buf, pasn->own_addr, ETH_ALEN);
+	}
+#endif /* CONFIG_ENC_ASSOC */
+
 	wpabuf_free(pasn->auth1);
 	pasn->auth1 = wpabuf_alloc_copy(wpabuf_head_u8(buf) + IEEE80211_HDRLEN,
 					wpabuf_len(buf) - IEEE80211_HDRLEN);
@@ -741,6 +753,18 @@ struct wpabuf *wpas_pasn_build_auth_3(struct pasn_data *pasn,
 
 	wpa_pasn_add_extra_ies(buf, pasn->extra_ies, pasn->extra_ies_len);
 
+#ifdef CONFIG_ENC_ASSOC
+	if (pasn->auth_alg == WLAN_AUTH_EPPKE && pasn->is_ml_peer) {
+		wpa_printf(MSG_DEBUG, "EPPKE: Include Multi Link Element");
+		wpabuf_put_u8(buf, WLAN_EID_EXTENSION);
+		wpabuf_put_u8(buf, 10);
+		wpabuf_put_u8(buf, WLAN_EID_EXT_MULTI_LINK);
+		wpabuf_put_le16(buf, MULTI_LINK_CONTROL_TYPE_BASIC);
+		wpabuf_put_u8(buf, ETH_ALEN + 1);
+		wpabuf_put_data(buf, pasn->own_addr, ETH_ALEN);
+	}
+#endif /* CONFIG_ENC_ASSOC */
+
 	/* Add the MIC */
 	mic_len = pasn_mic_len(pasn->hash_alg);
 	wpabuf_put_u8(buf, WLAN_EID_MIC);
diff --git a/wpa_supplicant/sme.c b/wpa_supplicant/sme.c
index 3510faf74..107fd2d15 100644
--- a/wpa_supplicant/sme.c
+++ b/wpa_supplicant/sme.c
@@ -715,10 +715,12 @@ static void wpas_eppke_initialize(struct wpa_supplicant *wpa_s, struct wpa_bss *
 	pasn->auth_alg = WLAN_AUTH_EPPKE;
 
 	os_memcpy(pasn->own_addr, wpa_s->own_addr, ETH_ALEN);
-	if (wpa_s->drv_flags2 & WPA_DRIVER_FLAGS2_MLO)
+	if (wpa_s->drv_flags2 & WPA_DRIVER_FLAGS2_MLO) {
+		pasn->is_ml_peer = true;
 		os_memcpy(pasn->peer_addr, wpa_s->ap_mld_addr, ETH_ALEN);
-	else
+	} else {
 		os_memcpy(pasn->peer_addr, bss->bssid, ETH_ALEN);
+	}
 	os_memcpy(pasn->bssid, bss->bssid, ETH_ALEN);
 
 	wpa_printf(MSG_DEBUG,

From patchwork Tue Jan  6 13:45:30 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180404
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=ZfM1Dxyb;
	dkim=fail reason="signature verification failed" (2048-bit key;
 secure) header.d=infradead.org header.i=@infradead.org header.a=rsa-sha256
 header.s=desiato.20200630 header.b=Oz1Zfe94;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=W0YsBehm;
	dkim=neutral header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=RBiAlkgo;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlsty3jBBz1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:48:10 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=ZY1/tumOGXjewwoOdjtDK+rXLxb4x4Oo3ZgcuQlZK08=; b=ZfM1DxybmHnsNi
	u0QZ4OYqccHc8dmwg/Hs98fP6ZeCK3+hkaSDicVImhBLhrvHcxKPdEzifR19dZoYAveFoM6pRWc+A
	UPJRPidgy7wjcPUedNUikpIbI7kuWj4XKNpZEzb21ifnK8IMS0owSJn3jnHY1gvmQoMsdz/iFe2Wp
	w5OGRKJRh4ancaq1BUQUezW6wkRBE3nz5MXoJo66LVpM90SeU9WDmrbe/404JQZC9NX/I7/Dz0NU/
	8sepg1ti/1yivg7Cf4wxFPQK8wR/624rTw+66bU/WjNOO2nibuQ1SHQVvBNVrG/NYl1UZYzURQJFP
	ClVQpv0v046esxFtx3iA==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7PA-0000000D8zs-1wwU;
	Tue, 06 Jan 2026 13:47:24 +0000
Received: from desiato.infradead.org ([2001:8b0:10b:1:d65d:64ff:fe57:4e05])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Of-0000000D8J0-089d
	for hostap@bombadil.infradead.org;
	Tue, 06 Jan 2026 13:46:53 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=infradead.org; s=desiato.20200630; h=Content-Transfer-Encoding:MIME-Version
	:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender:Reply-To:
	Content-Type:Content-ID:Content-Description;
	bh=Q4vpB/mwFWRbMO69xkkrO1NQmTUUoOFOyjBcG0DJ3bE=; b=Oz1Zfe94F7FM1uHZ7bdwiNcJSU
	DhdxDds33y/RHVZqmIXVICD+B7AnMQTg7Q6sIH3Omo5WZDbjv3cHHabHJ9Q14USPd8mLZk9nQGtyZ
	TG+Gef0j7NbnXhmfdmPwxRIvVDvjO3cjyfarE06pblqALl7ZjcsqyxqxQNw21LtM4Mh8XbWgV6snS
	+PXA/EYcQtNYh0CzxkYtnTLLes9OTq1/8MzcWTueqH8xls8yGSq8g+9pJO0WWL8ya7WRvm9GkYWbP
	ssrWdDTy65uI2Jn0iSbCFDMSG9P0W5R1D3uXstOrU9r64llTao0f8jWtWWAtB/7oaVqOdlG+YBO+D
	5tZHoJtA==;
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by desiato.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7OT-00000009n49-2CRk
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:49 +0000
Received: from pps.filterd (m0279872.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 6069WYrs4091247
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:40 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=Q4vpB/mwFWR
	bMO69xkkrO1NQmTUUoOFOyjBcG0DJ3bE=; b=W0YsBehmVIvWuL3IY9RL6GDlNeF
	/kO9yY7C+OLuYCg2+3b4Vd68bDoAgSiIoQJg2GiK1boULo8v3XLlnacI4XMSwEOY
	blXTRMAcfIao7dU/614to4s17iG7Q8dT5TNMT3NnNCIsirCq09k5EvX2Q8Ce5gtB
	ZOj+IGYEYQGRhNAtUcIgbfM5t7GSZeYipfTQPowvpjxqSAQFdBLtepCRFYKahsES
	T72pX7NfoSrxZCeY4hvJWD/CnvGQMhufqRH6vNlCcvzufH8dg0JRfpCblXUSg7zR
	H6edPush75REqk6/ALoqcq1Vb24yrrv1fbdHt9/wHVxBgu4iRSFoFeolL0A==
Received: from mail-pl1-f198.google.com (mail-pl1-f198.google.com
 [209.85.214.198])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgyun8n7n-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:39 +0000 (GMT)
Received: by mail-pl1-f198.google.com with SMTP id
 d9443c01a7336-29f25e494c2so11184485ad.0
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:39 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707199; x=1768311999;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=Q4vpB/mwFWRbMO69xkkrO1NQmTUUoOFOyjBcG0DJ3bE=;
        b=RBiAlkgoGqhDYuZi0o3TnqkgBZpo2p9ECLoki6vaXBVZIaZakeHd0pnVtwHUG4+GJr
         jD8BdLc8qftKimVV//DCNn040GNPQS+cO/BpotGI3KAvO67Fhx6NjSxj+zgXkcH8bh39
         7n0p8/lb+kLoDeGo6aPePc9J11lx2Mb7pRJQBz0D3yOIB7zZ34gomBJibyNoUCmVkG7D
         1W0E20p3WKZ5wwlwfNFTlmL4FVLDUDnhTVA8Z7DNMavHTgcUFy0+ZwfNHTL5bHk7+Uf5
         ghsihNPwtLO63G+vYmMY1qYfJt07uA4dsbV6OjIXlxkriXRH7NqwT/X34oVd+LULCOQQ
         G9NA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707199; x=1768311999;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=Q4vpB/mwFWRbMO69xkkrO1NQmTUUoOFOyjBcG0DJ3bE=;
        b=rVDCLjhj+j12Z0yliYzkuznOxKD0DmbxD6F4hecBgduv/zn2wfc+MN5khEQdmppjYC
         0Meu5i6xDoWW9HRbjhBvzL/mnpP/9PV7DzhUrN+xEIfTBkT+ztfzqVplYsX6kr2aVEAZ
         EWQd3eVaROK/7yuRBlwMG9ImtQfJf+wc8U6pcVHzwIUVvDM0l1Yzn0hmnWb4nEPjTpzQ
         W95wzfepRRt3nLY9fpEG3jPhEKenReKSscFnc0UGQNfsukMCvVhKaOJnNAwd4vO5RiYm
         2+CJTLqNTh4SusXwdaVW3qK5ipw90KqX/k5XahRKUngN2KEJZ3d7tIZAM6ULCOE78MaB
         n21g==
X-Gm-Message-State: AOJu0YwI9iYHygebvLzzqPusaQIAOFRAwOsve5/HUzOceGSDHw7Y/6d+
	WEiWap2r7mbgmnrBe5Kd5lXFkiC8hGDA+sPfNeLwLHBLeNePstiEsXaZOtVcOWorssosiVnyDsE
	M3X10VtOMgo8IxrJdhxteDSSNDs4XLnefEP9HCajF9GInCTYoPeu8nfdWocdP90uHXHj+6cD8
X-Gm-Gg: AY/fxX5IE7C8eYkQ15YxYwzSz2UsEZjJriwWSpTBHNS9OBcfjyq2zGLZ+GhlBwVZT2y
	SBlx+9W531BtXORp46aVBsHRYjQxVUKxFHtddJutxeoIRQAr8fW1p13A2r1AT8KR7dIfosHy49U
	IY1OSC1b1Hjf/zhQf7dcQb46JoEBjDuKj7XxlgUtJp8fHj+2reuaSNlMPVzNisN0BJWa0BwzX0E
	LYahsxmtAvqPepACDQ8bETOUsaWRWHr98OIQX3MkkoXc+b7CFY9ANpkc5tk3s8Th9sTf1Y6/Bb+
	Nb5dKojtj5ZFTCWduGLAsXpPHd9uByECrZQid8x6p/4TcXzkJA9oB9f+nuc8UjuYRKBEOxogyKS
	EUf/k8upXbI48tpKVw0a3U0/7zLPr0+ZcSBVI3CKF
X-Received: by 2002:a17:903:3d0c:b0:298:639b:a64f with SMTP id
 d9443c01a7336-2a3e398ea53mr29223365ad.6.1767707198650;
        Tue, 06 Jan 2026 05:46:38 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IFFTSF7vZPFjYkXD4KDIwLPJtMV+xD3ZJXEH/TKNoJfzZbSgF67rZ/aHMs49LGHk7wpc2TqFA==
X-Received: by 2002:a17:903:3d0c:b0:298:639b:a64f with SMTP id
 d9443c01a7336-2a3e398ea53mr29223055ad.6.1767707198170;
        Tue, 06 Jan 2026 05:46:38 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.36
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:37 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 20/28] PASN: Add support for MIC computation for M3 frame
 for SME-in-Userspace
Date: Tue,  6 Jan 2026 19:15:30 +0530
Message-Id: <20260106134538.2594232-21-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfX3m3MgjS5RLaN
 pSl7Zk64SWS96NTcdNnk3lOYJTOoUemdhvdK8FGC/p0MyriJmMuvb2Mk5bnxa/TKogsIn8QB/zi
 XRqRuet5pSsZvu5UCd85clG3532gMk1psmUHC5i9f2FoLNIRJKwgzPENl5BxYfJ5NVdUbY2UtTz
 a3dDwbj1E5BcKp6KnqiUOe8nWusjVXbpusEVdj/bZVnQZt4JEbtQXXG+1Qly7QjyhKgk0FBX/XB
 FtejoXmdBVaKgk++n2upwtfeEV2Oez4o5Qp4/2EKv4EhVaonJ5JvwxkDG0s0WZtgil2WDXfQ1Yo
 mj4YRVbRjvHM2Tol+JSeRrgE8mD8WovZfhBq3aAmMnu5pmDR9n5/Q79ISUM7d5FjXQSj6KINeqf
 GLyi8Jt3j/VTYV1fE2w1wHN3ln/jv9FvBZuZh+KUO/Y/UTCrmTsS+sCldnFz8SZgbXKrwnYlErQ
 U2MhteEgATGxCFVGfSg==
X-Authority-Analysis: v=2.4 cv=YqIChoYX c=1 sm=1 tr=0 ts=695d1240 cx=c_pps
 a=MTSHoo12Qbhz2p7MsH1ifg==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=_ZxDteGZkJ4JSaPUSXwA:9 a=GvdueXVYPmCkWapjIL-Q:22
X-Proofpoint-GUID: V_JQzSyN_UVX9Jr2wajInsHl_DsxOENF
X-Proofpoint-ORIG-GUID: V_JQzSyN_UVX9Jr2wajInsHl_DsxOENF
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 priorityscore=1501 suspectscore=0 impostorscore=0 bulkscore=0 malwarescore=0
 phishscore=0 adultscore=0 clxscore=1015 lowpriorityscore=0 spamscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_134641_856229_64E43C20 
X-CRM114-Status: GOOD (  17.30  )
X-Spam-Score: -0.9 (/)
X-Spam-Report: Spam detection software,
 running on the system "desiato.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  For SME-in-Userspace scenarios, MIC is computed on frame3
   body, hash of frame1 body, but frame1 and frame3 contain auth_data starting
    from transaction number to comply with mac80211 requirement, hence [...]
 Content analysis details:   (-0.9 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

For SME-in-Userspace scenarios, MIC is computed on frame3 body,
hash of frame1 body, but frame1 and frame3 contain auth_data starting
from transaction number to comply with mac80211 requirement, hence
prepend auth algorithm to frame body for preparing MIC.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/pasn/pasn_initiator.c | 53 ++++++++++++++++++++++++++++++++++-----
 1 file changed, 47 insertions(+), 6 deletions(-)

diff --git a/src/pasn/pasn_initiator.c b/src/pasn/pasn_initiator.c
index 30f42fb65..b7ed5ee9d 100644
--- a/src/pasn/pasn_initiator.c
+++ b/src/pasn/pasn_initiator.c
@@ -582,6 +582,18 @@ static u8 wpas_pasn_get_wrapped_data_format(struct pasn_data *pasn)
 }
 
 
+static u8 * pasn_prepend_auth_alg(u16 auth_alg, const u8 *buf, size_t len)
+{
+	u8 *new_buf = os_malloc(len + 2);
+	if (!new_buf)
+		return NULL;
+
+	os_memcpy(new_buf, &auth_alg, 2);
+	os_memcpy(new_buf + 2, buf, len);
+	return new_buf;
+}
+
+
 struct wpabuf *wpas_pasn_build_auth_1(struct pasn_data *pasn,
 					      const struct wpabuf *comeback,
 					      bool verify, bool is_sme_drv)
@@ -589,6 +601,9 @@ struct wpabuf *wpas_pasn_build_auth_1(struct pasn_data *pasn,
 	struct wpabuf *buf, *pubkey = NULL, *wrapped_data_buf = NULL;
 	const u8 *pmkid;
 	u8 wrapped_data;
+	const u8 *data;
+	size_t data_len;
+	u8 *copy = NULL;
 
 	wpa_printf(MSG_DEBUG, "PASN: Building frame 1");
 
@@ -676,9 +691,23 @@ struct wpabuf *wpas_pasn_build_auth_1(struct pasn_data *pasn,
 	}
 #endif /* CONFIG_ENC_ASSOC */
 
+	if (!is_sme_drv) {
+		copy = pasn_prepend_auth_alg(pasn->auth_alg,
+					     wpabuf_head_u8(buf),
+					     wpabuf_len(buf));
+		if (!copy)
+			goto fail;
+		data = copy;
+		data_len = wpabuf_len(buf) + 2;
+		os_free(copy);
+	} else {
+		data = wpabuf_head_u8(buf) + IEEE80211_HDRLEN;
+		data_len = wpabuf_len(buf) - IEEE80211_HDRLEN;
+	}
+
 	wpabuf_free(pasn->auth1);
-	pasn->auth1 = wpabuf_alloc_copy(wpabuf_head_u8(buf) + IEEE80211_HDRLEN,
-					wpabuf_len(buf) - IEEE80211_HDRLEN);
+	pasn->auth1 = wpabuf_alloc_copy(data, data_len);
+
 	if (!pasn->auth1) {
 		wpa_printf(MSG_DEBUG, "PASN: Failed to store a copy of Auth1");
 		goto fail;
@@ -696,6 +725,7 @@ fail:
 	wpabuf_free(wrapped_data_buf);
 	wpabuf_free(pubkey);
 	wpabuf_free(buf);
+	os_free(copy);
 	return NULL;
 }
 
@@ -708,7 +738,7 @@ struct wpabuf *wpas_pasn_build_auth_3(struct pasn_data *pasn,
 	u8 mic_len;
 	size_t data_len;
 	const u8 *data;
-	u8 *ptr;
+	u8 *ptr, *copy = NULL;
 	u8 wrapped_data;
 	int ret;
 	u8 hash[SHA512_MAC_LEN];
@@ -770,11 +800,21 @@ struct wpabuf *wpas_pasn_build_auth_3(struct pasn_data *pasn,
 	wpabuf_put_u8(buf, WLAN_EID_MIC);
 	wpabuf_put_u8(buf, mic_len);
 	ptr = wpabuf_put(buf, mic_len);
-
 	os_memset(ptr, 0, mic_len);
 
-	data = wpabuf_head_u8(buf) + IEEE80211_HDRLEN;
-	data_len = wpabuf_len(buf) - IEEE80211_HDRLEN;
+	if (!is_sme_drv) {
+		copy = pasn_prepend_auth_alg(pasn->auth_alg,
+					     wpabuf_head_u8(buf), wpabuf_len(buf));
+		if (!copy)
+			goto fail;
+		data = copy;
+		data_len = wpabuf_len(buf) + 2;
+		os_free(copy);
+	} else {
+		data = wpabuf_head_u8(buf) + IEEE80211_HDRLEN;
+		data_len = wpabuf_len(buf) - IEEE80211_HDRLEN;
+	}
+
 
 	if (!pasn->auth1 ||
 	    pasn_auth_frame_hash(pasn->hash_alg, wpabuf_head(pasn->auth1),
@@ -808,6 +848,7 @@ fail:
 	pasn->status = WLAN_STATUS_UNSPECIFIED_FAILURE;
 	wpabuf_free(wrapped_data_buf);
 	wpabuf_free(buf);
+	os_free(copy);
 	return NULL;
 }
 

From patchwork Tue Jan  6 13:45:31 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180409
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=qfNLMBar;
	dkim=fail reason="signature verification failed" (2048-bit key;
 secure) header.d=infradead.org header.i=@infradead.org header.a=rsa-sha256
 header.s=casper.20170209 header.b=Ra2++rdp;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=AHbYfMtZ;
	dkim=neutral header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=jrJiGF8u;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlsvh0vTRz1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:48:48 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=XRKWF6mPN+cvvyQ2lJwaG0k5aNrOfVqaCZxQFUGARDw=; b=qfNLMBarVpEzbm
	C97GZypB5bvnG6ckHB3qr2NF4gkfMpoEqJVbTUsDI8Osm8R1ETqXFHeIexzvDhy/Q9WSPD+FmAOqg
	lDJy9L9XULYPOsX2epWk0TOIIZ4OJ2tVgmcBeHmmgLuWkJWMHbKxJy5WoX8x8JYb25fN3Rd0+yfdh
	AZdCvJhXrPgIGhJmeBzEPylGPRvsB1zH23/bBy99Umq1nmil53zNCHN75zH/f7Nj4kZtkrbdS4+ok
	OUoKJenr82I+RDBSyp1hL3JXmUUyqc24J9g1S2DRxer6XqELCGKPdRK8cBcKgWpf259FluTgAKWGu
	K7AnEiCtImDvWosCRGzA==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Po-0000000D9qp-40Mu;
	Tue, 06 Jan 2026 13:48:05 +0000
Received: from casper.infradead.org ([2001:8b0:10b:1236::1])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Oi-0000000D8NA-1Hi7
	for hostap@bombadil.infradead.org;
	Tue, 06 Jan 2026 13:46:56 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=infradead.org; s=casper.20170209; h=Content-Transfer-Encoding:MIME-Version:
	References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender:Reply-To:
	Content-Type:Content-ID:Content-Description;
	bh=74gzejEijRGW60jjP1/JkFFOuryZjLEFMMkeOPCCD8k=; b=Ra2++rdpy/sQ8Ccp+nEk7eLc1U
	v974ddqIsTnu7M57Lz+usVAP/UVpbnkzx2OF0uRQXKPQU6BPMDA9/QOXZprFN0yMnNuQ5D29JOE19
	Y/esvy/pAy38aFQklipFXZrDqxfywCxt+BiJ2dt/YjEGgU0n8VR/ZR4c20UpGX8T1yrkoJjM2RebB
	psy0MzjgOPAreZyoc8xV8ylMLW9cRbsD+ebHXQ00S5JchPNuRWjyUcG10gtUoaGEWqBHL6FlapA33
	azfQYStGBPtGrNk0r7pSw5ocj450H6KQwc1IviTTtx+81Bhz22d0DKYLa82R9w13K3wrxqv80D4Ml
	tK+lL7IQ==;
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by casper.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Oe-0000000BqPy-02HR
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:54 +0000
Received: from pps.filterd (m0279868.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606BF24H2684152
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:42 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=74gzejEijRG
	W60jjP1/JkFFOuryZjLEFMMkeOPCCD8k=; b=AHbYfMtZV2JLz9aZ5sPqqDlN+Hd
	syoJgugBjL9QFFV/ynYhIgvYfnFElx8AEVpAXsayOFS8xUl3J6y/NnCCo4dZQFh5
	yxdX+Lsoqv+jQ3EruyPPI7CF4A0wV7MIINDByJqNvFSLtZCzycy0o3Yk7cbI/tck
	77YjwUCsvgRa9Zbs9vA3MVgJw2Mbb8NbaASm3v1ALQu2BEMmh8IPsJ5+bIRtdyW+
	mfu5OYWkxfagm7pqofe6jI7QfgPWBzWaKe8Qp1XK5ba8mWP4AKKBtaT65B8EUR7D
	fct/cfDNLUNCQ466YbNn+e6FljmwsM8qnM20gnlF/bHF+KOfyeWG89rkvKg==
Received: from mail-pg1-f198.google.com (mail-pg1-f198.google.com
 [209.85.215.198])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgty5hjyk-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:42 +0000 (GMT)
Received: by mail-pg1-f198.google.com with SMTP id
 41be03b00d2f7-b993eb2701bso1002449a12.0
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:42 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707201; x=1768312001;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=74gzejEijRGW60jjP1/JkFFOuryZjLEFMMkeOPCCD8k=;
        b=jrJiGF8ulIBqY24FXbo1FRQdDLV5OfZFM0vRyCOtSS8xYKB2GguZuUKyUB/DmqIU42
         jrpwo1BEKDV8Uud+0OJRa0MDujxKkTjj5W8vDZgL/0Qt3Q/dcXdM6mld78/J9xX7jHWi
         xP9vlybR74b8zGJpojEHPoaQWf1YJOtrgR7TgzO8KEaNW9tUcL7IAtiIhPFUsrbxAC+2
         TmaUcXNk0XsA7Z6Bf3TZcnu7qoPkQ2li9Kp/zXXAEXxCqQn5DBGUbPh+1H8pNXsgnHGD
         VrsjjFNVRWDauNAXFHkGLjX00f9dLOq7HmoZFlX2wSKVQaXjrIGO2LAsoX4ud2AdikP5
         cVNQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707201; x=1768312001;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=74gzejEijRGW60jjP1/JkFFOuryZjLEFMMkeOPCCD8k=;
        b=htT3j77VlYK1HgsqViQkZLjjHAqVvZ/imbf4ewfdw9gEQa83xl0gj0Sqy7XBCUs/75
         bTCv+EqWeU1Pr87Hw/GWCrF2nFFc4ojPw17h0RW+i0Thn/QXYcLbsdWp4BBnyU9MIiKv
         ThYMmCynyusZ/nrgbkhdf1B4cQSUUBn5dUL7hKZzAmEtWGv8fQ/WcG52zQEDHx/myY+j
         Z0Eay3cHr2yWdr4xcopmpYZ8J1+qsPlEf0ok0Z1AI7pAwUiJPnrcSwqSvs5ENBmCJpbV
         DFatrIbUMrWmUhKwh68/odLjNqcR9BKbN/tUwFeG05bgl52qDLGbY1ndIRQLSEaDwkz5
         Qdww==
X-Gm-Message-State: AOJu0YwWfdyau9mft10siDLc3F7Wx0JofJhyJwq58Bo7qambABaevoZP
	B+Pa9MSxmSe7Z6LW+OmrHYcxM10CjEB8bAPMg2G7ttV6/9PEzas0WlARutcUP0tPOnilpCEkBG5
	MrWWxlVkKa1exhU7jW85JP26OW3oIUCsTtWm3CsTDRXsjYtnY6wXIAL/ljipJT04hm+lfEjM3
X-Gm-Gg: AY/fxX4LC+alEmlvSUEJNLiWgj1gvmo45zPlmSqOwnx2UJk8pz+t9QS+kdYlP8c5tOz
	0kNUtSA6TSSH3VDETZTyT+kkTwKGkCDtorytfH09tV7rYMkxjr5T+lLJcWE+x1bfkfvGhYnHl6f
	94pzG3te8n3cWw+it+dqFyfMeFcJJAbd9RF2QJvvM9qW5nio3kf2Wjia6Sdgj7Rogd3TC9O3iE+
	7gYjeO1cixx/pvpCvOEot/ilkpufYlqehP3uFv9qBI3qI5c4q6zFaZeIUIiYkdfNJ/LWP9Qbz3v
	8P7Q5xJZkVDf1at/M4IbaTZCOiX0zXVJ7pJMzX99T+TbgF80N3HgGUH7lm7S3e4SuwNBFavzme4
	KAE/kXH6b90QZwCNb+cXthBLK72qMDJsnpfh+Jhm0
X-Received: by 2002:a17:903:94f:b0:2a0:c5b8:24b0 with SMTP id
 d9443c01a7336-2a3e2d1256fmr31086825ad.46.1767707200970;
        Tue, 06 Jan 2026 05:46:40 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IF346sUsEvjlNuwiWs0/H4idlPYboxlY+323VYPdZW39OjqyQJNitf54nAX41emISnMCHIpEg==
X-Received: by 2002:a17:903:94f:b0:2a0:c5b8:24b0 with SMTP id
 d9443c01a7336-2a3e2d1256fmr31086645ad.46.1767707200447;
        Tue, 06 Jan 2026 05:46:40 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.38
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:40 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 21/28] sme: Add support to install temporal key for EPPKE
 Authentication Protocol
Date: Tue,  6 Jan 2026 19:15:31 +0530
Message-Id: <20260106134538.2594232-22-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfX+tYiC9PeTfaW
 y+isWmyzHGZ8hwOVlS2mJiQy3zpkO/BpTfQiyDstMCU0HNuXyXYn2MzMzzAzsfLu9S1Li8fWl/r
 Znf516BqFunncMIcQYTztbLYnD5f3TmBGmIx0pTbF/ZaWtgBdpHmZV3NEptdqQ8iVHtRDqaB91U
 hHIXJwECjnnSaBEa/5cZZzcUUzHSmsaBiIfnAc+AErZI1PNfmWQqxkZMwHeTOKo53pyDAQggr9r
 P7Ddx3d5zT9KUaU0cudNnzlw9vLJEafdR++M0M5VZ1t9ByeUd96a/LRslDlDmxxq9YGJyOrKg12
 FZfYupBO8aKzBGmdLntXzAmtUX7N8f4wrQCGopPkG0WU4RaEQ1YRJovTAIZXRW3QU0B6BkjVm2m
 VpwC/UtHwclhCNSXMwOTyjRM/+spSfPBc7K60ODny+4/x60jRKiPDAzz61y09OFr7fiGNhLMNuD
 g1Ax1ocpfIALvwYeylg==
X-Authority-Analysis: v=2.4 cv=Rfidyltv c=1 sm=1 tr=0 ts=695d1242 cx=c_pps
 a=Qgeoaf8Lrialg5Z894R3/Q==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=WGb3iPcmAAAA:8 a=h52FGU5zhrQ_ahV0zzcA:9
 a=x9snwWr2DeNwDh03kgHS:22 a=9JPlHzl_CvN4BZy81pxD:22
X-Proofpoint-GUID: C7uuxxEmiFfEjN1vrFAPPfRygUCQsN8b
X-Proofpoint-ORIG-GUID: C7uuxxEmiFfEjN1vrFAPPfRygUCQsN8b
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 malwarescore=0 lowpriorityscore=0 priorityscore=1501 clxscore=1015
 suspectscore=0 adultscore=0 bulkscore=0 spamscore=0 impostorscore=0
 phishscore=0 classifier=typeunknown authscore=0 authtc= authcc=
 route=outbound adjust=0 reason=mlx scancount=1 engine=8.22.0-2512120000
 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_134652_280143_67846EC4 
X-CRM114-Status: GOOD (  14.58  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: SpamAssassin version 4.0.1 on casper.infradead.org summary:
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Kavita Kavita <kavita.kavita@oss.qualcomm.com>

Add support to install the temporal key for Enhanced Privacy Protection
Key Exchange (EPPKE) as specified in section 12.16.9 of
IEEE P802.11bi/D2.0 after authentication completes.

This commit add support to configure temporal key TK with the driver
immediately after authentication completes.

Signed-off-by: Kavita Kavita <kavita.kavita@oss.qualcomm.com>
Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 wpa_supplicant/sme.c | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/wpa_supplicant/sme.c b/wpa_supplicant/sme.c
index 107fd2d15..eaed91c1c 100644
--- a/wpa_supplicant/sme.c
+++ b/wpa_supplicant/sme.c
@@ -2242,6 +2242,9 @@ void sme_event_auth(struct wpa_supplicant *wpa_s, union wpa_event_data *data)
 		struct pasn_data *pasn = &wpa_s->pasn;
 		struct wpa_pasn_params_data pasn_params;
 		int res;
+		enum wpa_alg alg;
+		u8 zero[WPA_TK_MAX_LEN] = {0};
+		struct ptksa_cache_entry *entry;
 
 		res = wpas_parse_pasn_frame(pasn, data->auth.auth_type,
 					    data->auth.auth_transaction,
@@ -2266,6 +2269,14 @@ void sme_event_auth(struct wpa_supplicant *wpa_s, union wpa_event_data *data)
 
 		sme_send_authentication(wpa_s, wpa_s->current_bss,
 					wpa_s->current_ssid, 0);
+
+		alg = wpa_cipher_to_alg(pasn_get_cipher(pasn));
+		entry = ptksa_cache_get(wpa_s->ptksa, pasn->peer_addr,
+					pasn_get_cipher(pasn));
+
+		wpa_drv_set_key(wpa_s, -1, alg, pasn->peer_addr, 0, 1,
+				zero, 6, entry->ptk.tk, entry->ptk.tk_len,
+				KEY_FLAG_PAIRWISE_RX_TX);
 	}
 #endif /* CONFIG_ENC_ASSOC */
 #ifdef CONFIG_SAE

From patchwork Tue Jan  6 13:45:32 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180408
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=BxmBHgV0;
	dkim=fail reason="signature verification failed" (2048-bit key;
 secure) header.d=infradead.org header.i=@infradead.org header.a=rsa-sha256
 header.s=casper.20170209 header.b=d9XRpCKC;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=ToT0Dct9;
	dkim=neutral header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=ebYasgrx;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlsvM3fFTz1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:48:31 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=LgQXIR/3DyHtGazRUisEXyS5cCHaM0Cq/dv6N7hY+oM=; b=BxmBHgV04n2vs6
	uordLExRDXryZRhcESfhic8Cmp58fH5sXpqwA002C7UqHC7HsC2RMobjapPmXFjAp6agU8pXxYaxW
	6u3dzBVauONSCTE4MwZB38PuWXkr2Ouorbh1a+EMV2l/e2Su7uGbhH59fnKDwgA+yB6l9JJbl3oel
	6b/O+eQ6Z5bRMO+FSmKetAhRpHo5X5qMQtM7QXTOGn9imV4ooPerl/PNrEBBTlv/pPQRVOXgTqUkH
	YEUq2e3+asvlFP9B8l+98BzR171ju5ZTsg5cv8I56hkwBETxyrUQMcleYhfLUkds/RdyfwaUg8cqG
	HqxW+bhIvoK+01K48Nbw==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Pe-0000000D9bA-1UuG;
	Tue, 06 Jan 2026 13:47:54 +0000
Received: from casper.infradead.org ([2001:8b0:10b:1236::1])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Oi-0000000D8Mj-0C40
	for hostap@bombadil.infradead.org;
	Tue, 06 Jan 2026 13:46:56 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=infradead.org; s=casper.20170209; h=Content-Transfer-Encoding:MIME-Version:
	References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender:Reply-To:
	Content-Type:Content-ID:Content-Description;
	bh=/E/FR90Hppvxtu/nHxH8IndZSibGSS9L8K0SZQI6fP0=; b=d9XRpCKCjTxxetIMlQgTavCFU3
	eTeBGi0cI0D65HhrjnfGx/PBXrmQp2S9H9RVLyS0AGqwZxrhDht+++gVMZ48D4Sl22rQnUhWqB/Gu
	kaRzFyI+pbZu0MuFmpmAAmQfWeszYFQipmSsMBWxqKe6sIEuWeTl4NGKIn9Da1QDZ0D4qgT4Dvw1F
	xy8PUzoFydlHoC1Fq252XZIyApOKkZoWEYG28q8enY1vgJKoKryX/p1cHm+74OIT+QUkiBZEfR17V
	TPJZulZu4YG87c/3VCiFEcSwYxbH4LGGDEyAt6495rJyy4BK00wX1TiNvOrFKbEFHxAUg6Vgw8yLG
	jzWEP/yA==;
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by casper.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Od-0000000BqQ0-26Hq
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:54 +0000
Received: from pps.filterd (m0279868.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606B5P3I2684065
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:44 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=/E/FR90Hppv
	xtu/nHxH8IndZSibGSS9L8K0SZQI6fP0=; b=ToT0Dct9xCSYz5cUgLeRunanArE
	oIZQfXlWFWoHphfx65fPgr1RRmzLx3wPygzvoRZUAclReUrBk5KyF5krSe6OjnXL
	xr9N59Gg8b5ANwGU1HJxH+gJMeiuZ273mLSIZDXUZU9PIZ11hGd0oH87KDBYaOWA
	eBMNlSFw69ySU6w1NreQ+tV0OsCOzjLdqz1J1jLb59O4XtGImyUxUcXYmP5Mnk5S
	1MgT/Dguhfy+dQhvrkCUoFF124DvCtTUJtr3uaeu9oOV82JR6GKhoSLckRAkD3Hb
	UZf2Arv46Pxmf2u/WKP+7a0snScJOTV0ibx4ZhiXUNAXWLlv17NN46aS3xw==
Received: from mail-pj1-f72.google.com (mail-pj1-f72.google.com
 [209.85.216.72])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgty5hjyr-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:44 +0000 (GMT)
Received: by mail-pj1-f72.google.com with SMTP id
 98e67ed59e1d1-34eb6589ed2so1412498a91.2
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:44 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707203; x=1768312003;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=/E/FR90Hppvxtu/nHxH8IndZSibGSS9L8K0SZQI6fP0=;
        b=ebYasgrxgwGn8pXCx5gjOPcVZOycmjZ981N2g4i1WKyze/l0H98fpBH7Txm1owMi9r
         puhYHLEpS8tUtLSI7xkSkd7kZqOV7QKV4cY6qHxiyHb2b0/4xfAyJh7Qagw+OszragIg
         31FW6/KEctn1QytPBmY5ZOUZmxTQ3d+T/VKqH/DP/1Jf1v6O2Yqqf/yx9slillMhADD9
         XtLSLktIHch8MKF+u+q+fbaThe/w6jwTxK+r3ubotgTtip4SZE/d3w97NFBeLboGKoH0
         dK3I0pFrbQSUqeUi/a91Cnhs5ZxklLOX2Kr5NNh3MS5HAAvsFc51sudhFMgn3h3rXNfo
         DB0A==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707203; x=1768312003;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=/E/FR90Hppvxtu/nHxH8IndZSibGSS9L8K0SZQI6fP0=;
        b=DPtdmkXPMwlkw0EXDZMzUlbPmfNITh5y1JGFiJdx/enC0AGxGRKKQ5l1M3FFEzDzxM
         kO8L5Tw6E0BEKnlytBtz+8yfWJIm7BVW4E2icy1VrpxehjKSuTZBUzy/cxGgueUVx4YQ
         4YblS+o3uvTSrZ0R7zMMLoV5m+NsmTE2PEGxTJpvc+exlzdKFsLmvmhBPMYP9bzjvYaE
         2mksEJntf8ancTTFfjVUlrSXFPd6ycgKeJSp9Jbe+KT7PdiJzulgzZhLxWNvZfdpGCEe
         uG7Jz/KPmLokrXr0KRc928Yw5RxfeqStNSjmPpJDYFRVWsHrFuvsIuc743pcoVBO8P5n
         /Eag==
X-Gm-Message-State: AOJu0YyA4pBRH2EXnOiCVxduE5eWYwtpi/CwYNuy+Cz9TWvVIUc4B6aF
	mE0YAWz8Vfat4DoXF6wTdxGZEwbrhutw1rOtCJkwP3fv411eJfGA7qVSvm0AKjK9YtXOE1KyYIB
	p0wa6dqO3MibYVRATgkVqhgRvpJEZgGhyAs9rRmWzRet4vfoSEPsqz6jMQrLnbXME+6o2SeSt
X-Gm-Gg: AY/fxX6r9xs74L0oBfmcIcBsrffaGmr/Z5M6P/nx3CodjinAVziuLpNIImnK5vwz7Bc
	VRXHF/EitwLoY9uv98UKJufJ99mldobfCaJVIRaYt6Vn9HnWhU8kee1UBxofm9n5ash6/KppEHL
	swzowR2rxh0wFpLE8jMdzFmAo+fKxp5V8lgQLe5PdxK6RrAZ2dIj8FLsVQBJhiLvcfhKRa4Lmmi
	NasV6teaHHPE+5mHALe/ErvPTQ/VyGGX2vUUsHJcQUahvj0sJmdeKs9mT6X6lvgFbZVlRBznDb4
	zqvJCzBs6BHGVV8oZUM0fSkAxc323+e8TqUQ7IrBQqC34D3JtJe/gyVPP0Oe9g9RSJFPvMFybzf
	Zh8MLrfWshlE50NT1qBLtwj9usmcayiqM7etmfK6u
X-Received: by 2002:a17:90b:4e8e:b0:336:b60f:3936 with SMTP id
 98e67ed59e1d1-34f5f28310cmr2622888a91.12.1767707203290;
        Tue, 06 Jan 2026 05:46:43 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IELW8S/GdcfUw7AWHqncCXgxDpCbBDU2eyf2jwGmyBrPj7gEvMaCnFv4k1DVI89bYUTd5Koog==
X-Received: by 2002:a17:90b:4e8e:b0:336:b60f:3936 with SMTP id
 98e67ed59e1d1-34f5f28310cmr2622870a91.12.1767707202809;
        Tue, 06 Jan 2026 05:46:42 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.40
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:42 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 22/28] Add support for temporal key removal on association
 failure
Date: Tue,  6 Jan 2026 19:15:32 +0530
Message-Id: <20260106134538.2594232-23-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfXwx0O+TrXtpJ1
 Ojwy4xfip69f4WA7sFA7JPez4SozTlp2nSXujG5cU4tAew2mRx4G16Sw66bGcliGzX1zJwcg8y+
 c8gaLr+d3lds67xlHWoRjgWraibLMpAdu0h1VC6yVnNMW6HnxIXjYfmRETHCi1K2L+9tUqssHOi
 bNZtdZCQf6XGA2YkiramxZEZoJFIE2puU4hqD8VhjhH9HlnLof49bYfEWFM3meZmnp+bb6COOK1
 gUwu6qSsvcPeA3KR71IbfWKcao+VLu0CzrkIEJ29qkETQPZKVo+HYVPR9tWU2mgQbxwa/kCj8Ce
 u2Qhoc76lkvMX513faqXmRpUeXsWflDvuE2pm+1lJmCulfco3lKNYJoXhcMZeOjZJkaxrlGWsSd
 B5IO4GJOOt6PjS6X89IOqZeverXqhNpkAZxJn+siKsXbaMI8OWT979v4nl+5ywvPzNlgJ42FCWD
 RZuWcxEzradiZg8FhJQ==
X-Authority-Analysis: v=2.4 cv=Rfidyltv c=1 sm=1 tr=0 ts=695d1244 cx=c_pps
 a=RP+M6JBNLl+fLTcSJhASfg==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=93F2k_ZiEV6NZnqzGGkA:9 a=iS9zxrgQBfv6-_F4QbHw:22
X-Proofpoint-GUID: lCxHHYUYZMfSvGVfQcYfr7ix2VugpTN1
X-Proofpoint-ORIG-GUID: lCxHHYUYZMfSvGVfQcYfr7ix2VugpTN1
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 malwarescore=0 lowpriorityscore=0 priorityscore=1501 clxscore=1015
 suspectscore=0 adultscore=0 bulkscore=0 spamscore=0 impostorscore=0
 phishscore=0 classifier=typeunknown authscore=0 authtc= authcc=
 route=outbound adjust=0 reason=mlx scancount=1 engine=8.22.0-2512120000
 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_134651_762422_E003D13E 
X-CRM114-Status: GOOD (  14.49  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: SpamAssassin version 4.0.1 on casper.infradead.org summary:
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Kavita Kavita <kavita.kavita@oss.qualcomm.com>

This change adds logic to remove the configured temporal key (TK) for
Enhanced Privacy Protection Key Exchange (EPPKE) in the event of an
association request and/or response failure.

The removal is triggered immediately upon detection of association
request/response failure.

Signed-off-by: Kavita Kavita <kavita.kavita@oss.qualcomm.com>
---
 wpa_supplicant/events.c | 10 ++++++++++
 wpa_supplicant/sme.c    | 20 ++++++++++++++++++++
 2 files changed, 30 insertions(+)

diff --git a/wpa_supplicant/events.c b/wpa_supplicant/events.c
index d831557b3..3083271f8 100644
--- a/wpa_supplicant/events.c
+++ b/wpa_supplicant/events.c
@@ -390,6 +390,16 @@ void wpa_supplicant_mark_disassoc(struct wpa_supplicant *wpa_s)
 	}
 
 	wpa_supplicant_set_state(wpa_s, WPA_DISCONNECTED);
+
+#ifdef CONFIG_ENC_ASSOC
+	/* Clear configured keys and PTKSA */
+
+	if (wpa_s->ptksa &&
+	    ptksa_cache_get(wpa_s->ptksa, wpa_s->bssid, WPA_CIPHER_NONE)) {
+		wpa_clear_keys(wpa_s, wpa_s->bssid);
+		ptksa_cache_flush(wpa_s->ptksa, wpa_s->bssid, WPA_CIPHER_NONE);
+	}
+#endif
 	bssid_changed = !is_zero_ether_addr(wpa_s->bssid);
 	os_memset(wpa_s->bssid, 0, ETH_ALEN);
 	os_memset(wpa_s->pending_bssid, 0, ETH_ALEN);
diff --git a/wpa_supplicant/sme.c b/wpa_supplicant/sme.c
index eaed91c1c..092ad6ff5 100644
--- a/wpa_supplicant/sme.c
+++ b/wpa_supplicant/sme.c
@@ -2997,6 +2997,17 @@ mscs_fail:
 			wpas_connection_failed(wpa_s, wpa_s->pending_bssid,
 					       NULL);
 			wpa_supplicant_set_state(wpa_s, WPA_DISCONNECTED);
+#ifdef CONFIG_ENC_ASSOC
+			/* Clear configured keys and PTKSA */
+
+			if (wpa_s->ptksa && ptksa_cache_get(wpa_s->ptksa,
+							    wpa_s->bssid,
+							    WPA_CIPHER_NONE)) {
+				wpa_clear_keys(wpa_s, wpa_s->bssid);
+				ptksa_cache_flush(wpa_s->ptksa, wpa_s->bssid,
+						  WPA_CIPHER_NONE);
+			}
+#endif
 			os_memset(wpa_s->pending_bssid, 0, ETH_ALEN);
 		}
 		return;
@@ -3059,6 +3070,15 @@ static void sme_deauth(struct wpa_supplicant *wpa_s, const u8 **link_bssids)
 
 	wpas_connection_failed(wpa_s, wpa_s->pending_bssid, link_bssids);
 	wpa_supplicant_set_state(wpa_s, WPA_DISCONNECTED);
+#ifdef CONFIG_ENC_ASSOC
+	/* Clear configured keys and PTKSA */
+
+	if (wpa_s->ptksa &&
+		ptksa_cache_get(wpa_s->ptksa, wpa_s->bssid, WPA_CIPHER_NONE)) {
+		wpa_clear_keys(wpa_s, wpa_s->bssid);
+		ptksa_cache_flush(wpa_s->ptksa, wpa_s->bssid, WPA_CIPHER_NONE);
+	}
+#endif
 	os_memset(wpa_s->bssid, 0, ETH_ALEN);
 	os_memset(wpa_s->pending_bssid, 0, ETH_ALEN);
 	if (bssid_changed)

From patchwork Tue Jan  6 13:45:33 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180407
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=Wf8wccn4;
	dkim=fail reason="signature verification failed" (2048-bit key;
 secure) header.d=infradead.org header.i=@infradead.org header.a=rsa-sha256
 header.s=casper.20170209 header.b=emr6C2lE;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=mESTgYM4;
	dkim=neutral header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=RAtUcii2;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlsvD50plz1xrJ
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:48:24 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=yYh35oh6P6KjP2rjJhV5zAqKU3YpOe9cjWtTihMEJik=; b=Wf8wccn4hBdMus
	x36fBr9LVEf0K3g8h8n9PjlWOqAodep2bt4JmtqdwSZjsoJQF2EKSTW0uoWMhOqmcNxmiJaOlHrFL
	uwKae4eIH/cYaI6xFlkKTzeIZD8ceB+TGBUoCNJekXEmSRoHz3BD3EClHSzUCnVHrn5BovAjq5gZ2
	myk06K4xsfS6wJl+WUy06aNo3VYeK4Jq8U654Fda4o7JSUHWFNn4BM9h7QyjSBtNTjF6kJefN+C1M
	eHigNq5vql9efkb5nntPeUF3l5jlaGWJp6oxJU5OrgZDz4BxCeGANT8xql0jWRErUT8dOW83sXQTA
	i7J+9jdEuArUzF8z2bSw==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7PV-0000000D9Qr-0kFN;
	Tue, 06 Jan 2026 13:47:45 +0000
Received: from casper.infradead.org ([2001:8b0:10b:1236::1])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Oi-0000000D8NM-3UZX
	for hostap@bombadil.infradead.org;
	Tue, 06 Jan 2026 13:46:57 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=infradead.org; s=casper.20170209; h=Content-Transfer-Encoding:MIME-Version:
	References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender:Reply-To:
	Content-Type:Content-ID:Content-Description;
	bh=T2MG5hcIbi0mWNXTz7VdAlWBzHGzjCvPYYMWH18GECs=; b=emr6C2lEmm6yOpW/aov0u9Ad8o
	1LqUCSxjI08lTyZ3p1uejD9/6VRRzIU7RIJ+faHWQcSoGQ3Uxa+4/2XptrxuPR3dS+/LQA17820SG
	aIkT7BE/05dqlCa893A3AcI/k2nm66CEgUkYhiNoo0zxYqQWwhpFLSggSPqefhlXhG4y8FEOu+CAK
	5TQSGVLd/PDy+JtV+9NuvmmFw+v0XmSc9M7gsNRJB4PdwHgubPoTMO39hKE8Npj6gblIFH/Sei+7K
	Urtz9ReJNT/BurvW+t3z6d4NgvDucnMb2W/c3dmmC38q6XtC1YNWX3pblrQWAsERLkeNYCUirGSOo
	qzYHe6cA==;
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by casper.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Od-0000000BqQ1-43m8
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:55 +0000
Received: from pps.filterd (m0279868.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606BSdHj2684117
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:47 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=T2MG5hcIbi0
	mWNXTz7VdAlWBzHGzjCvPYYMWH18GECs=; b=mESTgYM4hWgQTVtth7+CQcEfK0l
	Q3DXrk5bvesXSiwgy6udFlap5LTtxm0/wDMvkPVJBUtjFMasJzhQCAVb7HjlCWAR
	Zxn7Yl9x2/irnpNdW99ESzHdzMvHtmV2Ypc5i4qtr6bOC2OEVULFKLtmkQAfG5iv
	wPLc9m/InyVVVKtadaeBOvrVUvY86TXqsPR8dqbIzRGINNSa1iqfj0RKUQ8Fx97m
	ySUwyo77kAaTNosTKcchOjVOQ6jA3pG63EIxaHRQ5winyaUqkNxAdcq4SmVGkqCh
	9VBM3+2Ueh5fMZ1qJ77jV0Tk9n7gkUJc7Miyod/uwXto2mxJNgCjxTYgJ8w==
Received: from mail-pf1-f198.google.com (mail-pf1-f198.google.com
 [209.85.210.198])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgty5hk0c-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:47 +0000 (GMT)
Received: by mail-pf1-f198.google.com with SMTP id
 d2e1a72fcca58-7b89ee2c1a4so1990456b3a.2
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:46 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707206; x=1768312006;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=T2MG5hcIbi0mWNXTz7VdAlWBzHGzjCvPYYMWH18GECs=;
        b=RAtUcii2WDgbyD8uulxPvFNoTHWKQC3a4EdU4SU9V31UuyraoEoxurihjmVtU5LfZc
         U41DG2avT8SAgbbw78jSLTFeLl1PbnP6xdQlAq9QYdAqsBgfk7+JQmGvyn2iH0oPBcOJ
         FPcGuX696tWN6v7Q8dAOA08ceSFSZzH69T+2ZOCZlBoK8DbjFkMcog+0grhjWf53wtaH
         yaPsR036oMMhWPtJzi5/YWldot3f14Gj3xwQ1dYPISCWtj3F+OwGZwrKko0dCSaRlnJt
         vNKTBV0A43tkoqLVIgpM/TA9omcp0tRCxIhxI2qNpLiLrsZFE34CsuP1j3CsWdxC54xE
         dXlA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707206; x=1768312006;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=T2MG5hcIbi0mWNXTz7VdAlWBzHGzjCvPYYMWH18GECs=;
        b=D++kQ5DuzJNDk4lVQh7yh75NSm601w/3F8ZiQlrwWTJ2v0cFtwKnnzjWO0Dop5in1Q
         dK4xqrZbmh1LaD5Zgt6l+QtpOX3G7+V8byN4TIhhlCESlFJd43n0460RKSN3M1hquW+I
         Q+XY8xMZzI6JW5LZBDndpBjH/OFb0wsGqAIXAkVodO7KWOkugtVC4tu6njXUe/yJEOpu
         JvYl7CTeKoC6+uHsWdX4Z6G6cC1UQNKuUSpDcrv0M5MChsftUtabcvMmJDYAvA4Y+5VL
         ds19yXg6sspKXERRjWMD+asPMr6AC1d5Cg61PlnWhHriNIwJ+nkZr58JZf5fUhN0FHgj
         yBug==
X-Gm-Message-State: AOJu0Yyi+kVF+FpT/C1QHERefodSHEB5uHlBBeXCeuFBNLSORq287Wle
	HMlRd37m0htvquc3fKf48INky1QyIT+/M2nIfKeV0loKF36bojYaQsI94gxzNXTn0u99wzvabsB
	oyIdvju5zU+XrjUfyveuRaRtZEE6fyRenbH867SHIFRZgAykxyUd73BGPvlw6c6GXnCzubgyx
X-Gm-Gg: AY/fxX76hXd9cTFYIKg5NBwLoKUCzqV0vuX8vl8Y9Ow5nheB2HA4m4KjzPkbO/JuhlR
	iuScGFfMdDVrIdC0VjKKCkKIMSfLdwRaY94zsJG6tixfD7YIGNDUz/7zgaM637tlcdXGAri4NRy
	wUXxOPFVb9jlBQu8z7JSwGtlWmSgdeoUinYe0Oqihh40CykXsnHJhtS6ohcmcj9sUM8d2q0F0nD
	topL4XhBzybLN3dYPAGKgboGq5Aw+CRW2AvFbJvTdVMGXEqzJrJDA1KFEoMHJc2eHcH6PWodEzN
	hk1bB9JUw5n83o7IdSoEe1k8kmgkE0YYk9tK1JD3hocgGrMgJHi295ALqTgMtHDDb0LtDx63v6l
	cBHnm3MvHmugxaf5X6J1eqTeUBat2Rnm6LgnA8v+9
X-Received: by 2002:aa7:8883:0:b0:81a:7c82:757 with SMTP id
 d2e1a72fcca58-81a7c82085bmr1560960b3a.41.1767707205736;
        Tue, 06 Jan 2026 05:46:45 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IH9j9QjS/dvK2yWioJXHRPNol+bkGMXfiVjFQiowq2hbweGRhOmETQXdk+b+ulAHlREapk2Zw==
X-Received: by 2002:aa7:8883:0:b0:81a:7c82:757 with SMTP id
 d2e1a72fcca58-81a7c82085bmr1560939b3a.41.1767707205205;
        Tue, 06 Jan 2026 05:46:45 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.43
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:44 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 23/28] EPPKE: Update RSNE construction and validation per
 IEEE P802.11bi/D2.0
Date: Tue,  6 Jan 2026 19:15:33 +0530
Message-Id: <20260106134538.2594232-24-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfXwrIyJqVyze8K
 P4ydVBssOOdhzVIpzQnqMWnnqTPOBXMmhXTZdIKedGHngsb/Yjv99wVV11M+CGJDDHbWfPS2mfS
 p4yL/fqGQUrUGpEB//crCTsw/TiXd+Jy2g+7FCQPSS9sZn0uzVyxSR/VL5JcREIx5b8b1KpIqsP
 maMsNBfnUq2uKgBI9fN7xS5MMKmzeeKYj3mP7Tqiv9CLIHv337Md8IwV4XpRWnm+BoeeYXCezeM
 4nB5Wfsc6mhqwQ5PdHheYOevfphKUSADayMCEMR5RSmMz86nWkQ+/qIoe8/R/OB6JK40PEyP2rW
 jfCuYRHqE9IMctMejLeTYc1Ni/G3jlGax4T7lRZVfvbJF4H4nUNULMxTO1UWRZl6gzEZpJNe5j0
 H7drCHXgp8HytAB7pujJwwrAnfstBimxBdFvbfqon0pQgMu2AX5TNhczi+jcAlQ+xzpDl2eZWTS
 IOQS0wWogjLgC8jtQ7w==
X-Authority-Analysis: v=2.4 cv=Rfidyltv c=1 sm=1 tr=0 ts=695d1247 cx=c_pps
 a=m5Vt/hrsBiPMCU0y4gIsQw==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=xcmWd_6MeBnLkgOKCPIA:9 a=IoOABgeZipijB_acs4fv:22
X-Proofpoint-GUID: yoOXz-K6fsN2IHxjyKOCVUlOtwvtaBQO
X-Proofpoint-ORIG-GUID: yoOXz-K6fsN2IHxjyKOCVUlOtwvtaBQO
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 malwarescore=0 lowpriorityscore=0 priorityscore=1501 clxscore=1015
 suspectscore=0 adultscore=0 bulkscore=0 spamscore=0 impostorscore=0
 phishscore=0 classifier=typeunknown authscore=0 authtc= authcc=
 route=outbound adjust=0 reason=mlx scancount=1 engine=8.22.0-2512120000
 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_134652_247694_70F4D70C 
X-CRM114-Status: GOOD (  20.58  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: SpamAssassin version 4.0.1 on casper.infradead.org summary:
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

Update existing PASN APIs for RSNE generation and validation logic to
align with IEEE 802.11bi/D2.0, section 12.16.9.3.2 to support EPPKE
authentication.

Below are the key changes:
- Add wpa_pick_group_mgmt_cipher() to select group management cipher.
- Extend wpa_pasn_add_rsne() and wpa_pasn_validate_rsne() to support
  Group Data and Group Management Cipher Suites inclusion for EPPKE.
- Pass group cipher parameters in PASN initiator/responder mode.
- Skip MFPR bit setting in RSN Capabilities for EPPKE.
- Ensure RSNE reflects correct capabilities and cipher suites based
  on auth type

Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/ap/ieee802_11.c       |  2 +-
 src/common/wpa_common.c   | 70 +++++++++++++++++++++++++++++----------
 src/common/wpa_common.h   |  7 ++--
 src/pasn/pasn_common.h    |  2 ++
 src/pasn/pasn_initiator.c | 14 +++++---
 src/pasn/pasn_responder.c | 22 ++++++++----
 wpa_supplicant/sme.c      |  7 ++++
 7 files changed, 93 insertions(+), 31 deletions(-)

diff --git a/src/ap/ieee802_11.c b/src/ap/ieee802_11.c
index 27491a1c0..ec65700ec 100644
--- a/src/ap/ieee802_11.c
+++ b/src/ap/ieee802_11.c
@@ -2927,7 +2927,7 @@ static int pasn_wd_handle_fils(struct hostapd_data *hapd, struct sta_info *sta,
 		return -1;
 	}
 
-	ret = wpa_pasn_validate_rsne(&rsne_data);
+	ret = wpa_pasn_validate_rsne(&rsne_data, false);
 	if (ret) {
 		wpa_printf(MSG_DEBUG, "PASN: FILS: Failed validating RSNE");
 		return -1;
diff --git a/src/common/wpa_common.c b/src/common/wpa_common.c
index 5effba077..cdde7ec02 100644
--- a/src/common/wpa_common.c
+++ b/src/common/wpa_common.c
@@ -3327,6 +3327,20 @@ int wpa_pick_group_cipher(int ciphers)
 }
 
 
+int wpa_pick_group_mgmt_cipher(int ciphers)
+{
+	if (ciphers & WPA_CIPHER_AES_128_CMAC)
+		return WPA_CIPHER_AES_128_CMAC;
+	if (ciphers & WPA_CIPHER_BIP_GMAC_128)
+		return WPA_CIPHER_BIP_GMAC_128;
+	if (ciphers & WPA_CIPHER_BIP_GMAC_256)
+		return WPA_CIPHER_BIP_GMAC_256;
+	if (ciphers & WPA_CIPHER_BIP_CMAC_256)
+		return WPA_CIPHER_BIP_CMAC_256;
+	return -1;
+}
+
+
 int wpa_parse_cipher(const char *value)
 {
 	int val = 0, last;
@@ -4002,13 +4016,15 @@ void wpa_pasn_build_auth_header(struct wpabuf *buf, const u8 *bssid,
 
 
 /*
- * wpa_pasn_add_rsne - Add an RSNE for PASN authentication
+ * wpa_pasn_add_rsne - Add an RSNE for PASN/EPPKE authentication
  * @buf: Buffer in which the IE will be added
  * @pmkid: Optional PMKID. Can be NULL.
  * @akmp: Authentication and key management protocol
  * @cipher: The cipher suite
+ * @is_eppke: EPPKE Authentication
  */
-int wpa_pasn_add_rsne(struct wpabuf *buf, const u8 *pmkid, int akmp, int cipher)
+int wpa_pasn_add_rsne(struct wpabuf *buf, const u8 *pmkid, int akmp, int cipher,
+		      bool is_eppke, int group_cipher, int group_mgmt_cipher)
 {
 	struct rsn_ie_hdr *hdr;
 	u32 suite;
@@ -4030,8 +4046,13 @@ int wpa_pasn_add_rsne(struct wpabuf *buf, const u8 *pmkid, int akmp, int cipher)
 	WPA_PUT_LE16(hdr->version, RSN_VERSION);
 	pos = (u8 *) (hdr + 1);
 
-	/* Group addressed data is not allowed */
-	RSN_SELECTOR_PUT(pos, RSN_CIPHER_SUITE_NO_GROUP_ADDRESSED);
+	if (is_eppke) {
+		/* EPPKE: Group addressed data is allowed */
+		RSN_SELECTOR_PUT(pos, wpa_cipher_to_suite(WPA_PROTO_RSN, group_cipher));
+	} else {
+		/* PASN: Group addressed data is not allowed */
+		RSN_SELECTOR_PUT(pos, RSN_CIPHER_SUITE_NO_GROUP_ADDRESSED);
+	}
 	pos += RSN_SELECTOR_LEN;
 
 	/* Add the pairwise cipher */
@@ -4082,8 +4103,13 @@ int wpa_pasn_add_rsne(struct wpabuf *buf, const u8 *pmkid, int akmp, int cipher)
 	}
 	pos += RSN_SELECTOR_LEN;
 
-	/* RSN Capabilities: PASN mandates both MFP capable and required */
-	capab = WPA_CAPABILITY_MFPC | WPA_CAPABILITY_MFPR;
+	if (is_eppke) {
+		/* RSN Capabilities: EPPKE does not mandate setting MFPR to 1 */
+		capab = WPA_CAPABILITY_MFPC;
+	} else {
+		/* RSN Capabilities: PASN mandates both MFP capable and required */
+		capab = WPA_CAPABILITY_MFPC | WPA_CAPABILITY_MFPR;
+	}
 	WPA_PUT_LE16(pos, capab);
 	pos += 2;
 
@@ -4099,9 +4125,13 @@ int wpa_pasn_add_rsne(struct wpabuf *buf, const u8 *pmkid, int akmp, int cipher)
 		pos += 2;
 	}
 
-	/* Group addressed management is not allowed */
-	RSN_SELECTOR_PUT(pos, RSN_CIPHER_SUITE_NO_GROUP_ADDRESSED);
-
+	if (is_eppke) {
+		/* EPPKE: Group addressed management is allowed */
+		RSN_SELECTOR_PUT(pos, wpa_cipher_to_suite(WPA_PROTO_RSN, group_mgmt_cipher));
+	} else {
+		/* PASN: Group addressed management is not allowed */
+		RSN_SELECTOR_PUT(pos, RSN_CIPHER_SUITE_NO_GROUP_ADDRESSED);
+	}
 	return 0;
 }
 
@@ -4239,23 +4269,29 @@ int wpa_pasn_add_wrapped_data(struct wpabuf *buf,
 
 
 /*
- * wpa_pasn_validate_rsne - Validate PSAN specific data of RSNE
+ * wpa_pasn_validate_rsne - Validate PASN/EPPKE specific data of RSNE
  * @data: Parsed representation of an RSNE
+ * @is_eppke: EPPKE Authentication
  * Returns -1 for invalid data; otherwise 0
  */
-int wpa_pasn_validate_rsne(const struct wpa_ie_data *data)
+int wpa_pasn_validate_rsne(const struct wpa_ie_data *data, bool is_eppke)
 {
-	u16 capab = WPA_CAPABILITY_MFPC | WPA_CAPABILITY_MFPR;
+	u16 capab = WPA_CAPABILITY_MFPC;
+
+	if (!is_eppke)
+		capab |= WPA_CAPABILITY_MFPR;
 
 	if (data->proto != WPA_PROTO_RSN)
 		return -1;
 
 	if ((data->capabilities & capab) != capab) {
-		wpa_printf(MSG_DEBUG, "PASN: Invalid RSNE capabilities");
+		wpa_printf(MSG_DEBUG, "%s: Invalid RSNE capabilities",
+			   is_eppke ? "EPPKE" : "PASN");
 		return -1;
 	}
 
-	if (!data->has_group || data->group_cipher != WPA_CIPHER_GTK_NOT_USED) {
+	if (!data->has_group ||
+	    (!is_eppke && data->group_cipher != WPA_CIPHER_GTK_NOT_USED)) {
 		wpa_printf(MSG_DEBUG, "PASN: Invalid group data cipher");
 		return -1;
 	}
@@ -4286,12 +4322,12 @@ int wpa_pasn_validate_rsne(const struct wpa_ie_data *data)
 	case WPA_KEY_MGMT_PASN:
 		break;
 	default:
-		wpa_printf(MSG_ERROR, "PASN: invalid key_mgmt: 0x%0x",
-			   data->key_mgmt);
+		wpa_printf(MSG_ERROR, "%s: invalid key_mgmt: 0x%0x",
+			   is_eppke ? "EPPKE" : "PASN", data->key_mgmt);
 		return -1;
 	}
 
-	if (data->mgmt_group_cipher != WPA_CIPHER_GTK_NOT_USED) {
+	if (!is_eppke && (data->mgmt_group_cipher != WPA_CIPHER_GTK_NOT_USED)) {
 		wpa_printf(MSG_DEBUG, "PASN: Invalid group mgmt cipher");
 		return -1;
 	}
diff --git a/src/common/wpa_common.h b/src/common/wpa_common.h
index fcd7168e2..1419dced2 100644
--- a/src/common/wpa_common.h
+++ b/src/common/wpa_common.h
@@ -767,6 +767,7 @@ int rsn_cipher_put_suites(u8 *pos, int ciphers);
 int wpa_cipher_put_suites(u8 *pos, int ciphers);
 int wpa_pick_pairwise_cipher(int ciphers, int none_allowed);
 int wpa_pick_group_cipher(int ciphers);
+int wpa_pick_group_mgmt_cipher(int ciphers);
 int wpa_parse_cipher(const char *value);
 int wpa_write_ciphers(char *start, char *end, int ciphers, const char *delim);
 int wpa_select_ap_group_cipher(int wpa, int wpa_pairwise, int rsn_pairwise);
@@ -799,8 +800,8 @@ void wpa_pasn_build_auth_header(struct wpabuf *buf, const u8 *bssid,
 				const u8 *src, const u8 *dst,
 				u8 trans_seq, u16 status, bool is_eppke);
 
-int wpa_pasn_add_rsne(struct wpabuf *buf, const u8 *pmkid,
-		      int akmp, int cipher);
+int wpa_pasn_add_rsne(struct wpabuf *buf, const u8 *pmkid, int akmp, int cipher,
+		      bool is_eppke, int group_cipher, int group_mgmt_cipher);
 
 void wpa_pasn_add_parameter_ie(struct wpabuf *buf, u16 pasn_group,
 			       u8 wrapped_data_format,
@@ -810,7 +811,7 @@ void wpa_pasn_add_parameter_ie(struct wpabuf *buf, u16 pasn_group,
 int wpa_pasn_add_wrapped_data(struct wpabuf *buf,
 			      struct wpabuf *wrapped_data_buf);
 
-int wpa_pasn_validate_rsne(const struct wpa_ie_data *data);
+int wpa_pasn_validate_rsne(const struct wpa_ie_data *data, bool is_eppke);
 int wpa_pasn_parse_parameter_ie(const u8 *data, u8 len, bool from_ap,
 				struct wpa_pasn_params_data *pasn_params);
 
diff --git a/src/pasn/pasn_common.h b/src/pasn/pasn_common.h
index cf9ef93b1..09b1fb717 100644
--- a/src/pasn/pasn_common.h
+++ b/src/pasn/pasn_common.h
@@ -52,6 +52,8 @@ struct pasn_data {
 	unsigned int auth_alg;
 	u8 mld_addr[ETH_ALEN];
 	bool is_ml_peer;
+	int group_cipher;
+	int group_mgmt_cipher;
 
 #ifdef CONFIG_SAE
 	struct sae_pt *pt;
diff --git a/src/pasn/pasn_initiator.c b/src/pasn/pasn_initiator.c
index b7ed5ee9d..9253db943 100644
--- a/src/pasn/pasn_initiator.c
+++ b/src/pasn/pasn_initiator.c
@@ -297,7 +297,9 @@ static struct wpabuf * wpas_pasn_fils_build_auth(struct pasn_data *pasn)
 	wpabuf_put_le16(buf, WLAN_STATUS_SUCCESS);
 
 	/* Own RSNE */
-	wpa_pasn_add_rsne(buf, NULL, pasn->akmp, pasn->cipher);
+	wpa_pasn_add_rsne(buf, NULL, pasn->akmp, pasn->cipher,
+			  pasn->auth_alg == WLAN_AUTH_EPPKE,
+			  pasn->group_cipher, pasn->group_mgmt_cipher);
 
 	/* FILS Nonce */
 	wpabuf_put_u8(buf, WLAN_EID_EXTENSION);
@@ -423,7 +425,8 @@ static int wpas_pasn_wd_fils_rx(struct pasn_data *pasn, struct wpabuf *wd)
 		return -1;
 	}
 
-	ret = wpa_pasn_validate_rsne(&rsne_data);
+	ret = wpa_pasn_validate_rsne(&rsne_data,
+				     pasn->auth_alg == WLAN_AUTH_EPPKE);
 	if (ret) {
 		wpa_printf(MSG_DEBUG, "PASN: FILS: Failed validating RSNE");
 		return -1;
@@ -660,7 +663,9 @@ struct wpabuf *wpas_pasn_build_auth_1(struct pasn_data *pasn,
 			wrapped_data_buf = wpas_pasn_get_wrapped_data(pasn);
 	}
 
-	if (wpa_pasn_add_rsne(buf, pmkid, pasn->akmp, pasn->cipher) < 0)
+	if (wpa_pasn_add_rsne(buf, pmkid, pasn->akmp, pasn->cipher,
+			      pasn->auth_alg == WLAN_AUTH_EPPKE,
+			      pasn->group_cipher, pasn->group_mgmt_cipher) < 0)
 		goto fail;
 
 	if (!wrapped_data_buf)
@@ -1320,7 +1325,8 @@ int wpas_parse_pasn_frame(struct pasn_data *pasn, u16 auth_type,
 		goto fail;
 	}
 
-	ret = wpa_pasn_validate_rsne(&rsn_data);
+	ret = wpa_pasn_validate_rsne(&rsn_data,
+				     pasn->auth_alg == WLAN_AUTH_EPPKE);
 	if (ret) {
 		wpa_printf(MSG_DEBUG, "PASN: Failed validating RSNE");
 		goto fail;
diff --git a/src/pasn/pasn_responder.c b/src/pasn/pasn_responder.c
index f7f1bc413..aebee493f 100644
--- a/src/pasn/pasn_responder.c
+++ b/src/pasn/pasn_responder.c
@@ -304,7 +304,9 @@ static struct wpabuf * pasn_get_fils_wd(struct pasn_data *pasn)
 	wpabuf_put_le16(buf, WLAN_STATUS_SUCCESS);
 
 	/* Own RSNE */
-	wpa_pasn_add_rsne(buf, NULL, pasn->akmp, pasn->cipher);
+	wpa_pasn_add_rsne(buf, NULL, pasn->akmp, pasn->cipher,
+			  pasn->auth_alg == WLAN_AUTH_EPPKE,
+			  pasn->group_cipher, pasn->group_mgmt_cipher);
 
 	/* FILS Nonce */
 	wpabuf_put_u8(buf, WLAN_EID_EXTENSION);
@@ -544,8 +546,9 @@ int handle_auth_pasn_resp(struct pasn_data *pasn, const u8 *own_addr,
 #endif /* CONFIG_FILS */
 	}
 
-	if (wpa_pasn_add_rsne(buf, pmkid,
-			      pasn->akmp, pasn->cipher) < 0)
+	if (wpa_pasn_add_rsne(buf, pmkid, pasn->akmp, pasn->cipher,
+			      pasn->auth_alg == WLAN_AUTH_EPPKE,
+			      pasn->group_cipher, pasn->group_mgmt_cipher) < 0)
 		goto fail;
 
 	/* No need to derive PMK if PMKSA is given */
@@ -622,8 +625,10 @@ int handle_auth_pasn_resp(struct pasn_data *pasn, const u8 *own_addr,
 		if (!rsn_buf)
 			goto fail;
 
-		if (wpa_pasn_add_rsne(rsn_buf, pmkid,
-				      pasn->akmp, pasn->cipher) < 0)
+		if (wpa_pasn_add_rsne(rsn_buf, pmkid, pasn->akmp, pasn->cipher,
+				      pasn->auth_alg == WLAN_AUTH_EPPKE,
+				      pasn->group_cipher,
+				      pasn->group_mgmt_cipher) < 0)
 			goto fail;
 
 		rsn_ie = wpabuf_head_u8(rsn_buf);
@@ -748,7 +753,8 @@ int handle_auth_pasn_1(struct pasn_data *pasn,
 		goto send_resp;
 	}
 
-	ret = wpa_pasn_validate_rsne(&rsn_data);
+	ret = wpa_pasn_validate_rsne(&rsn_data,
+				     pasn->auth_alg == WLAN_AUTH_EPPKE);
 	if (ret) {
 		wpa_printf(MSG_DEBUG, "PASN: Failed validating RSNE");
 		status = WLAN_STATUS_INVALID_RSNIE;
@@ -776,6 +782,10 @@ int handle_auth_pasn_1(struct pasn_data *pasn,
 
 	pasn->akmp = rsn_data.key_mgmt;
 	pasn->cipher = rsn_data.pairwise_cipher;
+#ifdef CONFIG_ENC_ASSOC
+	pasn->group_cipher = rsn_data.group_cipher;
+	pasn->group_mgmt_cipher = rsn_data.mgmt_group_cipher;
+#endif /* CONFIG_ENC_ASSOC */
 
 	if (pasn->derive_kdk &&
 	    ieee802_11_rsnx_capab_len(elems.rsnxe, elems.rsnxe_len,
diff --git a/wpa_supplicant/sme.c b/wpa_supplicant/sme.c
index 092ad6ff5..f1db461d2 100644
--- a/wpa_supplicant/sme.c
+++ b/wpa_supplicant/sme.c
@@ -631,6 +631,7 @@ static void wpas_eppke_initialize(struct wpa_supplicant *wpa_s, struct wpa_bss *
 	u8 beacon_rsne_len, beacon_rsnxe_len;
 	u32 capab = 0;
 	int group;
+	int group_mgmt_cipher;
 
 	pasn = &wpa_s->pasn;
 
@@ -710,6 +711,12 @@ static void wpas_eppke_initialize(struct wpa_supplicant *wpa_s, struct wpa_bss *
 	}
 	pasn->akmp = wpa_s->key_mgmt;
 	pasn->cipher = wpa_pick_pairwise_cipher(ssid->pairwise_cipher, 1);
+	pasn->group_cipher = wpa_pick_group_cipher(ssid->group_cipher);
+	if (ssid->group_mgmt_cipher != 0)
+		group_mgmt_cipher = ssid->group_mgmt_cipher;
+	else
+		group_mgmt_cipher = WPA_CIPHER_AES_128_CMAC;
+	pasn->group_mgmt_cipher = wpa_pick_group_mgmt_cipher(group_mgmt_cipher);
 	pasn->group = group;
 	pasn->freq = bss->freq;
 	pasn->auth_alg = WLAN_AUTH_EPPKE;

From patchwork Tue Jan  6 13:45:34 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180405
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=kIYa+Zcz;
	dkim=fail reason="signature verification failed" (2048-bit key;
 secure) header.d=infradead.org header.i=@infradead.org header.a=rsa-sha256
 header.s=desiato.20200630 header.b=FaclyoEJ;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=eixe/ESa;
	dkim=neutral header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=jWz2o1QY;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlsv44ZgHz1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:48:16 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=GEw/70Rs/WEpU9cBZOewETgFnDWmhIJ0yll+k+vGWSQ=; b=kIYa+ZczcYdmhP
	ReEmo2eleY3b8DShuX0Du0i/1R8PbMLAp11ZBUVyryi/PcOJivHj3Gekao34qRwzfcB5bxcnpv89T
	VvtiNaMVqvvYvtk5jsJhw759v9Cm/u8jcDG3X1Jk8X4sNzEfjPxWZHw5T+qonZ4sC288QwvN/XwRI
	fRTUGpDXjB3IjjFjVMwSZ4GqKRH65zLZ5409cjVRIocSJRITkLxEhP/HIpOcy08uZurN2J6OB4GN8
	3m0zmHRkZAFHdKAzO0NO7r4m8/UUTwqz5WdjIXTV9l3OTvn27vtUFpkJwxNK8RYHJRu6wSFRl8kw6
	Dglra0agNQdP4sYmG4wg==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7PJ-0000000D98k-1C1K;
	Tue, 06 Jan 2026 13:47:33 +0000
Received: from desiato.infradead.org ([2001:8b0:10b:1:d65d:64ff:fe57:4e05])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Oi-0000000D8NN-3Lhy
	for hostap@bombadil.infradead.org;
	Tue, 06 Jan 2026 13:46:57 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=infradead.org; s=desiato.20200630; h=Content-Transfer-Encoding:MIME-Version
	:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender:Reply-To:
	Content-Type:Content-ID:Content-Description;
	bh=KQJwvawjTQLV56cIKW9ZUrT0eJ1+BW6rKfYtysvgz1o=; b=FaclyoEJtMbJqoJEmVpbhyfIxn
	Fcu1NN6MMsGLFq0jmRn9lfe6yefU+xYXrm7KUD25NHIYmIjCZ4BlxGahRoCyCOE02sJa4tDphPAtH
	bVNea5wxusa1ptGei+xc9Yy5oL0KtfL/HIK7TioBuWb5bb31EjLan/OvIV11f2pId4BcrtQQsxUXg
	wAGT2FYRDOHNSvtzd4E0le9DUgD13PNbOaXR9QP30bPnFID+BbmtOXCUhcegIYMTvnB9jhcvecckh
	OtLLPKvr9E4d4HpoAtnSlaIlyyRH4HoHldCMIdc503pejtKJGidbMSXmWRx1HsVClkCTIsWkL45px
	GOx4j2qA==;
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by desiato.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Od-00000009n8X-0zW5
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:54 +0000
Received: from pps.filterd (m0279869.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606BfMeI307826
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:49 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=KQJwvawjTQL
	V56cIKW9ZUrT0eJ1+BW6rKfYtysvgz1o=; b=eixe/ESaT/Y+4EI0pQuvrtqpbVE
	v/03w5dITlgWln6eGKkQ2l24ZtC8io+5TGwArpX0rf7DtWvfeGULSyZdBa7Wu+h1
	ZVFFtSHIbuTr88ZsIOCd0LrWgMJ2Ft9aCaJbRxD5P/NdWcOcWRfexisOkdkwRGaC
	nOFlxKA4GqsjDS+83CocNsix6b96jX8y5cUcwux9SjGpjEJBAUJahS9ty+pr2539
	IU4SKwxWbISoBf/rgVaLxF8Z+UIn8ikbRG7LkrHXhSaP5HSsbeTruMBen8FEMoQu
	y0D4wxDFHofULupDDxhqqEnate7v4b2Si0Ky7nauOXIpN9bZ5gHBnE5ziQQ==
Received: from mail-pf1-f199.google.com (mail-pf1-f199.google.com
 [209.85.210.199])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bh1r6gb2q-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:49 +0000 (GMT)
Received: by mail-pf1-f199.google.com with SMTP id
 d2e1a72fcca58-7bb2303fe94so1163243b3a.3
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:49 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707208; x=1768312008;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=KQJwvawjTQLV56cIKW9ZUrT0eJ1+BW6rKfYtysvgz1o=;
        b=jWz2o1QYeozuReMqmPNjhxb8Fl+Tj9VWddad/KQP7M9EHiCx3+uSnxlO4T/uHykRjO
         imNs9j0IO2qZ7KTBER3pW3Sk8Imz+kl9s8xzyepnwedDBeBJKSYMOTW1zAE+rTXPVbTE
         mgLf77N9rHO1Pgizba7nlRd347VlHDhATGbMJmTE1aJotGLwD6TUxW5Jyq8IbpiMRaME
         UnlKmxBWnS8CODbFynxembRiTskzBqGTRy8j6UnKp+LkGmMJFQ4bKnfRcmiljSLcUDnR
         ePq5JsUgW6LZkbgWif7Df38jQLuU+ibsOhfclEGvshHHHu8563ePS2QrDTO//AmBeIsf
         8qkQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707208; x=1768312008;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=KQJwvawjTQLV56cIKW9ZUrT0eJ1+BW6rKfYtysvgz1o=;
        b=r0oeE1dzRDhDLy0s5FATZdeHSloZZEyU25DTlAJhE9gRZ/sIaN0Lbqv4pbsghHpRv7
         DVUlX19KpFvnhIbcDbFzlvSS7Ng7A1RWefz3GkG38/m0NLRcrVOdFySdrnqerWjc0ALs
         JrZs38NJ1JEuKtVyvLisQCWiwzX2Mjp1BKCr5e3pqIjvWvLpDZzn95YQqMthkabJfQKx
         oZmYdb6IFWUFO4wbwQ5NKlxzntxJVn29f+/Wj05Bra9By59C9Ux4mGnwdAiz/ciGrbMh
         lmrPZovWbTff5rlpN70mFOBCJlA96ZWrQ16u7lmcHuQOGkOhd+RJ/eWfNrOU5wKNIbBl
         N9XQ==
X-Gm-Message-State: AOJu0Yz2/HsAdZ4sALCMHsghE4S8OI5zvrEoD2tFHLATOAGgtkUT3CpC
	VT0BFdfj+bUC+Md7YEkybEV0AoEkVsVcOp9DSlqMpyaU4gNs+UUnK2XgkciqzWoKZsIMZF6/5Gf
	pFnaamZG1yV5BMQZUyWoRLRLnnfiQSA8OdaqLGutbLai4vZ3vl0m4p6J1wCtthn6SXMHXeqLg
X-Gm-Gg: AY/fxX7+Nxg2npwLahXZsogFdVrlhz47brl87VS0KeabsBNXqmaBF7cc8YJMuZF5ZTU
	cAO/VEzSUKmGYIMqPdr8W7+lN+IhiWYTL9H/a4oPaeLuuQrCkEzQV3AioQhLWY6Rovcx+mw0iO3
	i5XvpE16SxOTjzcu0xuVEdeAgqEBePSm3ntnT49vWqMeUj9Q3yPgNQvwRChQ4kFEFTfqCmk+hGg
	Jn+c5nqP+BGb4mA7m25psfAYHjctPVdTZSEMn+cZLA546FZpvk47kAP2whGpXky+nVBUGpLlGnT
	1qmkukDwGKSPRaK23xtuqMe5nN8yTNjUp2VCbEcroGu8jnfDmTNmS+U3R/Vyf8wefHTXSvxupvF
	jYeqqboE9+7cz9VLOmG4EopLk8WiFgiBO5izqe++3
X-Received: by 2002:a05:6a00:3386:b0:7e8:4471:8e2 with SMTP id
 d2e1a72fcca58-81882ddf073mr2522362b3a.67.1767707208064;
        Tue, 06 Jan 2026 05:46:48 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IHTRy8Pw5FfTCFPQmuLEaT3+WzoLGMnS77ACuSG02nXiWFXPp8XMHGn3ZzNE/6EqfPpsl3Uiw==
X-Received: by 2002:a05:6a00:3386:b0:7e8:4471:8e2 with SMTP id
 d2e1a72fcca58-81882ddf073mr2522343b3a.67.1767707207598;
        Tue, 06 Jan 2026 05:46:47 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.45
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:47 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 24/28] EPPKE: Skip 4-Way handshake and authorize supplicant
 port on association
Date: Tue,  6 Jan 2026 19:15:34 +0530
Message-Id: <20260106134538.2594232-25-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-GUID: r44prYtfgV7DdgWWXssiGr0qppkop3ow
X-Proofpoint-ORIG-GUID: r44prYtfgV7DdgWWXssiGr0qppkop3ow
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfXzrF4A238V01m
 N4qVAiGv2c4B794DpVs8aK2Bqemmm+M9LL02oIvWxwSd9btPyX1akqGvWHQPMcuymWisuyp5jP9
 ax9FCTT0ZCAO0yvNz2Xl2jhbkP1ivwHT4KapqsWmWvwG8hFu8TZ3DpvP/k5wKL+a6Sxe6HGIr0K
 9OLbVm5aS4p5iup3i+VGUNhdnk+WWaHBDxd+TrtG1POQ9qHcI5cnn3D0UoWjM8Qp4CXzm7M70rC
 dLoTiSv8M+o2P8HX1BtAaLfakSedJe8Ncw6dv1gjzTankQ8pMFTRjQzZD5E9NJILZUmPfO1v7er
 +spHNVN2v4YHbJwQzGnsTsaRkOtPm8q0NNqOaVa6wtLHAz9J63tiqAjIxCZo93aCb1DTqo2U6Bw
 /OmCneMYapD8++WZ1sCrp978WlLo6vHAqGJ/ukD6r/AWXl43KssNSkrxna0H1UCUDKiJorzQSMe
 aD5kO2aTThtMa5wYxTQ==
X-Authority-Analysis: v=2.4 cv=Ctuys34D c=1 sm=1 tr=0 ts=695d1249 cx=c_pps
 a=WW5sKcV1LcKqjgzy2JUPuA==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=GNlDLKQ8XaKaA97bf_kA:9 a=OpyuDcXvxspvyRM73sMx:22
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 clxscore=1015 suspectscore=0 lowpriorityscore=0 spamscore=0
 priorityscore=1501 malwarescore=0 bulkscore=0 impostorscore=0 phishscore=0
 adultscore=0 classifier=typeunknown authscore=0 authtc= authcc=
 route=outbound adjust=0 reason=mlx scancount=1 engine=8.22.0-2512120000
 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_134651_521664_3520D592 
X-CRM114-Status: GOOD (  18.97  )
X-Spam-Score: -0.9 (/)
X-Spam-Report: Spam detection software,
 running on the system "desiato.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  For EPPKE authentication,
 PTK is derived during authentication
    frame exchange. Skip EAPOL 4-Way handshake and move supplicant state to
 WPA_CONNECTED
    after association. Update state handling to authori [...]
 Content analysis details:   (-0.9 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

For EPPKE authentication, PTK is derived during authentication frame
exchange. Skip EAPOL 4-Way handshake and move supplicant state to
WPA_CONNECTED after association. Update state handling to authorize
the port and ensure proper control for SME-in-Userspace scenarios.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/rsn_supp/wpa.c              | 10 ++++++++++
 src/rsn_supp/wpa.h              |  6 ++++++
 src/rsn_supp/wpa_i.h            |  3 +++
 wpa_supplicant/events.c         | 12 ++++++++++++
 wpa_supplicant/wpa_supplicant.c |  5 +++++
 5 files changed, 36 insertions(+)

diff --git a/src/rsn_supp/wpa.c b/src/rsn_supp/wpa.c
index 01ca1679d..5f0b0e3d8 100644
--- a/src/rsn_supp/wpa.c
+++ b/src/rsn_supp/wpa.c
@@ -7076,6 +7076,16 @@ int wpa_fils_is_completed(struct wpa_sm *sm)
 }
 
 
+int wpa_eppke_is_completed(struct wpa_sm *sm)
+{
+#ifdef CONFIG_ENC_ASSOC
+	return sm && sm->eppke_completed;
+#else /* CONFIG_ENC_ASSOC */
+	return 0;
+#endif /* CONFIG_ENC_ASSOC */
+}
+
+
 #ifdef CONFIG_OWE
 
 struct wpabuf * owe_build_assoc_req(struct wpa_sm *sm, u16 group)
diff --git a/src/rsn_supp/wpa.h b/src/rsn_supp/wpa.h
index acd905b71..46e03ad99 100644
--- a/src/rsn_supp/wpa.h
+++ b/src/rsn_supp/wpa.h
@@ -280,6 +280,7 @@ void wpa_sm_set_ptk_kck_kek(struct wpa_sm *sm,
 			    const u8 *ptk_kck, size_t ptk_kck_len,
 			    const u8 *ptk_kek, size_t ptk_kek_len);
 int wpa_fils_is_completed(struct wpa_sm *sm);
+int wpa_eppke_is_completed(struct wpa_sm *sm);
 void wpa_sm_pmksa_cache_reconfig(struct wpa_sm *sm);
 int wpa_sm_set_mlo_params(struct wpa_sm *sm, const struct wpa_sm_mlo *mlo);
 void wpa_sm_set_driver_bss_selection(struct wpa_sm *sm,
@@ -518,6 +519,11 @@ static inline int wpa_fils_is_completed(struct wpa_sm *sm)
 	return 0;
 }
 
+static inline int wpa_eppke_is_completed(struct wpa_sm *sm)
+{
+	return 0;
+}
+
 static inline void wpa_sm_pmksa_cache_reconfig(struct wpa_sm *sm)
 {
 }
diff --git a/src/rsn_supp/wpa_i.h b/src/rsn_supp/wpa_i.h
index d0c3541b5..c36a1f3ae 100644
--- a/src/rsn_supp/wpa_i.h
+++ b/src/rsn_supp/wpa_i.h
@@ -223,6 +223,9 @@ struct wpa_sm {
 	u8 fils_ft[FILS_FT_MAX_LEN];
 	size_t fils_ft_len;
 #endif /* CONFIG_FILS */
+#ifdef CONFIG_ENC_ASSOC
+	unsigned int eppke_completed:1;
+#endif /* CONFIG_ENC_ASSOC */
 
 #ifdef CONFIG_OWE
 	struct crypto_ecdh *owe_ecdh;
diff --git a/wpa_supplicant/events.c b/wpa_supplicant/events.c
index 3083271f8..ba79f7f6d 100644
--- a/wpa_supplicant/events.c
+++ b/wpa_supplicant/events.c
@@ -4409,6 +4409,9 @@ static void wpa_supplicant_event_assoc(struct wpa_supplicant *wpa_s,
 	if (!ft_completed)
 		ft_completed = wpa_fils_is_completed(wpa_s->wpa);
 
+	if (!ft_completed)
+		ft_completed = wpa_eppke_is_completed(wpa_s->wpa);
+
 	wpa_supplicant_set_state(wpa_s, WPA_ASSOCIATED);
 	if (!ether_addr_equal(bssid, wpa_s->bssid)) {
 		if (os_reltime_initialized(&wpa_s->session_start)) {
@@ -4432,6 +4435,7 @@ static void wpa_supplicant_event_assoc(struct wpa_supplicant *wpa_s,
 		if (wpa_supplicant_dynamic_keys(wpa_s) && !ft_completed) {
 			wpa_clear_keys(wpa_s, bssid);
 		}
+
 		if (wpa_supplicant_select_config(wpa_s, data) < 0) {
 			wpa_supplicant_deauthenticate(
 				wpa_s, WLAN_REASON_DEAUTH_LEAVING);
@@ -4467,6 +4471,14 @@ static void wpa_supplicant_event_assoc(struct wpa_supplicant *wpa_s,
 #endif /* CONFIG_SME */
 
 	wpa_msg(wpa_s, MSG_INFO, "Associated with " MACSTR, MAC2STR(bssid));
+#ifdef CONFIG_SME
+#ifdef CONFIG_ENC_ASSOC
+	if (wpa_s->sme.auth_alg == WPA_AUTH_ALG_EPPKE) {
+		data->assoc_info.authorized = true;
+		wpa_supplicant_set_state(wpa_s, WPA_COMPLETED);
+	}
+#endif /* CONFIG_ENC_ASSOC */
+#endif
 	if (wpa_s->current_ssid) {
 		/* When using scanning (ap_scan=1), SIM PC/SC interface can be
 		 * initialized before association, but for other modes,
diff --git a/wpa_supplicant/wpa_supplicant.c b/wpa_supplicant/wpa_supplicant.c
index 70c92ea00..1bd43a0bf 100644
--- a/wpa_supplicant/wpa_supplicant.c
+++ b/wpa_supplicant/wpa_supplicant.c
@@ -1216,6 +1216,11 @@ void wpa_supplicant_set_state(struct wpa_supplicant *wpa_s,
 				    MAC2STR(wpa_s->ap_mld_addr));
 
 #ifdef CONFIG_SME
+#ifdef CONFIG_ENC_ASSOC
+		if ((wpa_s->drv_flags & WPA_DRIVER_FLAGS_SME) &&
+		    wpa_auth_alg_eppke(wpa_s->sme.auth_alg))
+			wpa_drv_set_supp_port(wpa_s, 1);
+#endif /* CONFIG_ENC_ASSOC */
 		if ((wpa_s->drv_flags & WPA_DRIVER_FLAGS_SME) &&
 		    wpa_auth_alg_fils(wpa_s->sme.auth_alg))
 			fils_hlp_sent = 1;

From patchwork Tue Jan  6 13:45:35 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180410
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=bIRQZNOi;
	dkim=fail reason="signature verification failed" (2048-bit key;
 secure) header.d=infradead.org header.i=@infradead.org header.a=rsa-sha256
 header.s=casper.20170209 header.b=HH8UZ+fd;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=C8F3ZDcM;
	dkim=neutral header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=Woc0klYi;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlsvp6PxZz1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:48:54 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=Z1OjlCmpKlUqcQ5vnloYAtSyV2MmntETluaJb9vdbt4=; b=bIRQZNOigq3jmS
	Bd/O8Ru8cGn6f+19m28NMjQgjqwWQ9WIsDBqHtcf0UgmW/gIhGeC6giwELl3w5Q49Zhr4xGDV/avc
	BgJQSy4Km6mAElgsNo2jHuqy9Atm4u2mt5Y7UUDck7A/xVB12lMmSPfAVRsaaFy0CnFo77h/hqe3w
	/6SZLTO8F/qMZJ4vNfdosOPyZSP8xgf6INZf48D0y4dFSryGPg2A+SBSfqnGbVoMNGFHfEseWLsGP
	FWIBBQOqjkakQqYbCWmkYpMEbjUWXBbLNROG6zHbPoe/PhcXtFlwbgZux2Wiso5gZk2TeymQxtNld
	i/ZmPsD2OvpS8pj6JHHQ==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Pu-0000000D9xn-1vvl;
	Tue, 06 Jan 2026 13:48:14 +0000
Received: from casper.infradead.org ([2001:8b0:10b:1236::1])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Oj-0000000D8Ob-3Dpc
	for hostap@bombadil.infradead.org;
	Tue, 06 Jan 2026 13:46:58 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=infradead.org; s=casper.20170209; h=Content-Transfer-Encoding:MIME-Version:
	References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender:Reply-To:
	Content-Type:Content-ID:Content-Description;
	bh=2NZMo80ldAuQeO3nMENtuyOFEOnGWWNd9w+3Wa01j8Q=; b=HH8UZ+fdQfKOTHT43B5Ca0auFG
	6dGkaEQrjWt2wfd6fWaGxObFA2CjBm0a6M4LFQvS7m0Ws9yp52TP6pcJaOrEKWFWJglDR3nGoDqNP
	+Xr67M+KFzrBv/D9Xs5/gm3YwjolwbR4Lc0v0yU9CT/cbGXpvhdgCimIavWTPGGEXVvblIVVU4f8p
	A6DT8qxqDrubE8N3IVnad9EQJAAg5ARF9+XnzxFkcuSlbAXTP548XRjlU3gI/mM3k9De7IxvVH0rZ
	fM+YblCPZRuZjY/rn5dNfZhyzrGU0xNLLIB1oL+UXy3Kv+u3KTov/joSUIf/zneO87Ce3JlzCIlEv
	Kj6ok9WQ==;
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by casper.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Of-0000000BqS0-3WBU
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:46:56 +0000
Received: from pps.filterd (m0279873.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606BCCRo2253758
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:52 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=2NZMo80ldAu
	QeO3nMENtuyOFEOnGWWNd9w+3Wa01j8Q=; b=C8F3ZDcM4IR7D+OOsWfJsfoHp63
	Sz49755IuhUuNY886Oxh9TRz4d0GXmoA5QrW2ZXtfM/lK/OuYQ1ASq3bzGTwuHhK
	9yClCGqj1eP0NjBsTzg30LZCDRPl8MJHZ2rrIG6tT7OwskL1P96sgsuMRQ6nZ+AU
	9KiagiJ8+78Zwnl4oiaOiT3ujXp6WsSyNhHefGst14gfnHQjqfftMPeTLkLMXhTy
	QItbaQOZdGLNCNV4CReqTjUjwVNmbRHwy6bMBONvrrQORs1gtLAsHR+BqNlHXTlL
	h1aD8BBRaQuVeXM0i5ZF4C5D72uIWvbWz+Fd3gBPmCM24CquIY31Pqm0oow==
Received: from mail-pf1-f198.google.com (mail-pf1-f198.google.com
 [209.85.210.198])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgu421jn8-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:51 +0000 (GMT)
Received: by mail-pf1-f198.google.com with SMTP id
 d2e1a72fcca58-7bad1cef9bcso2095945b3a.1
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:51 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707211; x=1768312011;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=2NZMo80ldAuQeO3nMENtuyOFEOnGWWNd9w+3Wa01j8Q=;
        b=Woc0klYi4zlIhQIo8hpmuGbIOLVAt/O2+sgQOwrlQ7YFo11pvSviL8YJD2U7zZ7/t+
         xSQp3EPPwd7VxCd6Z7k7lF8ws3kNi9j+H5fDp7tROxcSFyUDtH0+wf2FQQWzF8ZRRyP7
         d8xm48YydpDKm1Ryjmn1lNrh1iRrP4ZSV+BPM02J7Ourol4WmA5ibXOBltHSlocBi5fI
         sdNEZ04XBypLAqsHvjmAbNpAjwbmIpBvl+EeCXZ+gTVrFYESx07ZNbw2KcfDNotDV/ln
         /qCvNoY9lef3KFKeCC13cvSsj1wOfnGbCrFSpbpJ1BCcg/NbeRDC/28gmrsOsKDADRLA
         cTxw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707211; x=1768312011;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=2NZMo80ldAuQeO3nMENtuyOFEOnGWWNd9w+3Wa01j8Q=;
        b=kDo9TmVlFP6aCt6HEkDi+kk8FndRdCxbaWKnJIqe+4ADgHY0NVwhIj9E8dvElP+FqL
         hRHKvOTokRvss1oVIW5v1+vn6giMhsNbUquzk/B1Ry+gE4Nyu44bgxlWVh6xbisVhMz/
         RP3eQnTkMuBdSuJqClPhJ3edf0JZmRXFaPRcfqyAPxSfrNMOlcf5EsMAj5f8/rh0guVG
         HTct0qaQY8jdhYcR7pQE6bRmz7RBOSQRRVh9lJ0oshi84jVIp2EKJKg07qGCtxFoiiyX
         gHq5EiSqP/4iHJwMz3VnjUL/bEV/SA5TpOGv19gR4/U9jbI3kEIft05emZfA5uV/OPzK
         qgUA==
X-Gm-Message-State: AOJu0Yx4WiftfHrAKtDI7jJm5sAeOu+G/VkW9fTJQ59ML9EGy181PKFp
	bB+IxDUaHBgm5/QyghZsrpFdod1Q4oxg9kAKWuo1BNv0hPSaUenuaxrCJYfef0rGfcACX+kNmeU
	vp16+7gd05ZJ4ISQyI6SY//B+HrUqDhdJyqCmqqZmFPxXNaPyybe4EY5Fu+4mDrik/hFnrh26
X-Gm-Gg: AY/fxX7wcgDNkvAO4Ouhc1V4rQTXlNFr5nodMgTFUSBdd9ENeU8P2ADmkCPds3oAcPS
	6sAKoDXGYtuU8xUSmxkzSKlzdJo3Y149l36e1H5zO6nRFMBymX/eYXNz/Qj+q4+yw608l2au5yk
	ooW9q5+ZgBP5UVZgvO1iDRFXJe+tCYLD35bDQhlzn7tRXxAhOGC1LCU+DJ3Fzy0GouwdmjIV++h
	i0AIy4vW7elPsG/Crs5smt3s0rIHhl123y9/mPf6MhTmKf3e3UGHhJ6yHN3AAkojERf+MtI4VEJ
	oqbtrsPfdPHrLWKSY4DLPVl9FUcN2cq5OMy05CJeY3YXHpNLCuG50o0KPPqjvHerC1FKNWXFbA7
	wRnJsYU5tcSWW1G3Bd8Y56ghqOxtuLbcExM/JUjOb
X-Received: by 2002:a05:6a00:4c0c:b0:7f7:1857:8456 with SMTP id
 d2e1a72fcca58-81882bed424mr2911734b3a.55.1767707210481;
        Tue, 06 Jan 2026 05:46:50 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IHW344jDMa+55uYaXe8cF8EPcL7RwgNaexEkfK8jPJtAir9YpyIqz7FYzxcIvmmf5rI9aJSTg==
X-Received: by 2002:a05:6a00:4c0c:b0:7f7:1857:8456 with SMTP id
 d2e1a72fcca58-81882bed424mr2911707b3a.55.1767707209910;
        Tue, 06 Jan 2026 05:46:49 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.47
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:49 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 25/28] EPPKE: Retrieve KCK/KEK from PTKSA and install group
 keys for GTK rekey
Date: Tue,  6 Jan 2026 19:15:35 +0530
Message-Id: <20260106134538.2594232-26-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Authority-Analysis: v=2.4 cv=dYuNHHXe c=1 sm=1 tr=0 ts=695d124b cx=c_pps
 a=m5Vt/hrsBiPMCU0y4gIsQw==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=F70eIcKuNTPglzr01acA:9 a=IoOABgeZipijB_acs4fv:22
X-Proofpoint-GUID: kN42usp756rnzMCFw7My2mEOnVHdXEh8
X-Proofpoint-ORIG-GUID: kN42usp756rnzMCFw7My2mEOnVHdXEh8
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfX6kwHL9qS8Bj8
 S7i/ocvIIgRS5fw/17VqY0nS4yURfnpvMlkOAB5wHeu5B2k3UAqw/vBSZNWFkI/Shp2b2ok33BJ
 OWJrdsZZ6VBgdjVL+bQGe/L7XXKpJg5i2ITtLk//eXcBgG1O10ipdL3X7s3HPTsrx+YYADJjn3M
 EsfYnVsdKj5H0wQR0rrsLsLU4/bRbwK2GyAndTE1Kmk/1hcQseMBZtJQxm+yoPs9XKTnX95wEZE
 Y//A/ebU3ynOOZgIX7A9Er34c8dQFCJa+CbR1dMq4IED6Z8IO7vCun09OM2A0Bd4MUQ/KOZ21zv
 oOqks18hsxlGAXLaEEirRZ1JJ/E94+VEeqjLohDNn5qh24kMdyE1/MZZMIJDJxzFJLWe0T9BZJe
 DW88dnyl6aosjoNJ5stOe58JeWjEZbd+ycm69Thqow5e80/U6jfoEpkfBkwxlt/Jy1M6wPHI1xu
 zwpGsvu877kpbs49/WA==
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 priorityscore=1501 adultscore=0 malwarescore=0 impostorscore=0 phishscore=0
 clxscore=1015 spamscore=0 lowpriorityscore=0 suspectscore=0 bulkscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_134654_128504_C652EABE 
X-CRM114-Status: GOOD (  23.52  )
X-Spam-Score: -2.8 (--)
X-Spam-Report: SpamAssassin version 4.0.1 on casper.infradead.org summary:
 Content analysis details:   (-2.8 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

This change adds support for:
- Retrieving KCK (Key Confirmation Key) and KEK (Key Encryption Key) from
  PTKSA cache and storing them in wpa_sm for use during GTK rekey operations.
- Installing GTK and related group keys to the driver as part of EPPKE-based
  association flow.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
---
 src/rsn_supp/wpa.c      | 169 +++++++++++++++++++++++++++++++++++++++-
 src/rsn_supp/wpa.h      |   2 +
 wpa_supplicant/events.c |  32 ++++++++
 3 files changed, 201 insertions(+), 2 deletions(-)

diff --git a/src/rsn_supp/wpa.c b/src/rsn_supp/wpa.c
index 5f0b0e3d8..865432545 100644
--- a/src/rsn_supp/wpa.c
+++ b/src/rsn_supp/wpa.c
@@ -3155,7 +3155,8 @@ static void wpa_supplicant_process_mlo_1_of_2(struct wpa_sm *sm,
 	u8 i;
 	struct wpa_eapol_ie_parse ie;
 
-	if (!sm->msg_3_of_4_ok && !wpa_fils_is_completed(sm)) {
+	if (!sm->msg_3_of_4_ok && !wpa_fils_is_completed(sm) &&
+	    !wpa_eppke_is_completed(sm)) {
 		wpa_msg(sm->ctx->msg_ctx, MSG_INFO,
 			"MLO RSN: Group Key Handshake started prior to completion of 4-way handshake");
 		goto failed;
@@ -3391,7 +3392,8 @@ static void wpa_supplicant_process_1_of_2(struct wpa_sm *sm,
 	struct wpa_eapol_ie_parse ie;
 	u16 gtk_len;
 
-	if (!sm->msg_3_of_4_ok && !wpa_fils_is_completed(sm)) {
+	if (!sm->msg_3_of_4_ok && !wpa_fils_is_completed(sm) &&
+	    !wpa_eppke_is_completed(sm)) {
 		wpa_msg(sm->ctx->msg_ctx, MSG_INFO,
 			"RSN: Group Key Handshake started prior to completion of 4-way handshake");
 		goto failed;
@@ -7086,6 +7088,169 @@ int wpa_eppke_is_completed(struct wpa_sm *sm)
 }
 
 
+#ifdef CONFIG_ENC_ASSOC
+int eppke_process_assoc_resp(struct wpa_sm *sm, u64 flags, int link_id,
+			     const u8 *resp, size_t len)
+{
+	struct ieee802_11_elems elems;
+	struct wpa_gtk_data gd;
+	int maxkeylen;
+	struct wpa_eapol_ie_parse kde;
+
+	if (!sm || !sm->ptk_set) {
+		wpa_printf(MSG_DEBUG, "EPPKE: No KEK available");
+		return -1;
+	}
+
+	wpa_hexdump(MSG_DEBUG, "EPPKE: (Re)Association Response frame",
+		    resp, len);
+
+	if (ieee802_11_parse_elems(resp, len, &elems, 1) == ParseFailed) {
+		wpa_printf(MSG_DEBUG,
+			   "EPPKE: Failed to parse decrypted elements");
+		goto fail;
+	}
+
+	if (!elems.rsn_ie) {
+		wpa_printf(MSG_DEBUG,
+			   "EPPKE: No RSNE in (Re)Association Response");
+	} else if (wpa_compare_rsn_ie(wpa_key_mgmt_sae(sm->key_mgmt),
+				      sm->ap_rsn_ie, sm->ap_rsn_ie_len,
+				      elems.rsn_ie - 2, elems.rsn_ie_len + 2)) {
+		wpa_msg(sm->ctx->msg_ctx, MSG_INFO,
+			"EPPKE: RSNE mismatch between Beacon/Probe Response and (Re)Association Response");
+		wpa_hexdump(MSG_DEBUG, "EPPKE: RSNE in Beacon/Probe Response",
+			    sm->ap_rsn_ie, sm->ap_rsn_ie_len);
+		wpa_hexdump(MSG_DEBUG, "EPPKE: RSNE in (Re)Association Response",
+			    elems.rsn_ie, elems.rsn_ie_len);
+		goto fail;
+	}
+
+	if ((sm->ap_rsnxe && !elems.rsnxe) ||
+	    (!sm->ap_rsnxe && elems.rsnxe) ||
+	    (sm->ap_rsnxe && elems.rsnxe && sm->ap_rsnxe_len >= 2 &&
+	     (sm->ap_rsnxe_len != 2U + elems.rsnxe_len ||
+	      os_memcmp(sm->ap_rsnxe + 2, elems.rsnxe, sm->ap_rsnxe_len - 2) !=
+	      0))) {
+		wpa_msg(sm->ctx->msg_ctx, MSG_INFO,
+			"EPPKE: RSNXE mismatch between Beacon/Probe Response and (Re)Association Response");
+		wpa_hexdump(MSG_INFO, "EPPKE: RSNXE in Beacon/Probe Response",
+			    sm->ap_rsnxe, sm->ap_rsnxe_len);
+		wpa_hexdump(MSG_INFO, "EPPKE: RSNXE in (Re)Association Response",
+			    elems.rsnxe, elems.rsnxe_len);
+		if (sm->assoc_rsnxe && sm->assoc_rsnxe_len)
+			goto fail;
+	}
+
+	/* Key Delivery */
+	if (!elems.key_delivery) {
+		wpa_printf(MSG_DEBUG, "EPPKE: No Key Delivery element");
+		goto fail;
+	}
+
+	/* Parse GTK and set the key to the driver */
+	os_memset(&gd, 0, sizeof(gd));
+	if (wpa_supplicant_parse_ies(elems.key_delivery + WPA_KEY_RSC_LEN,
+				     elems.key_delivery_len - WPA_KEY_RSC_LEN,
+				     &kde) < 0) {
+		wpa_printf(MSG_DEBUG, "EPPKE: Failed to parse KDEs");
+		goto fail;
+	}
+
+	if ((flags & WPA_DRIVER_FLAGS2_MLO) && link_id != -1) {
+		if (!kde.mlo_gtk[link_id]) {
+			wpa_printf(MSG_DEBUG, "EPPKE: No MLO GTK KDE");
+			goto fail;
+		}
+
+		maxkeylen = gd.gtk_len = kde.mlo_gtk_len[link_id] - 7;
+
+		if (wpa_supplicant_check_group_cipher(sm, sm->group_cipher,
+						      gd.gtk_len, maxkeylen,
+						      &gd.key_rsc_len, &gd.alg))
+			goto fail;
+
+
+		wpa_hexdump_key(MSG_DEBUG, "EPPKE: Received MLO GTK",
+				kde.mlo_gtk[link_id], kde.mlo_gtk_len[link_id]);
+
+		gd.keyidx = kde.mlo_gtk[link_id][0] & 0x3;
+		gd.tx = wpa_supplicant_gtk_tx_bit_workaround(sm,
+							     !!(kde.mlo_gtk[link_id][0] & BIT(2)));
+
+		if (kde.mlo_gtk_len[link_id] - 7 > sizeof(gd.gtk)) {
+			wpa_printf(MSG_DEBUG, "EPPKE: Too long GTK in GTK KDE (len=%lu)",
+				   (unsigned long) kde.mlo_gtk_len[link_id] - 2);
+			goto fail;
+		}
+		os_memcpy(gd.gtk, kde.mlo_gtk[link_id] + 7, kde.mlo_gtk_len[link_id] - 7);
+
+		wpa_printf(MSG_DEBUG, "EPPKE: Set MLO GTK to driver");
+		if (wpa_supplicant_install_mlo_gtk(sm, link_id, &gd, elems.key_delivery, 0) < 0) {
+			wpa_printf(MSG_DEBUG, "EPPKE: Failed to set MLO GTK");
+			goto fail;
+		}
+
+		if (_mlo_ieee80211w_set_keys(sm, link_id, &kde) < 0) {
+			wpa_printf(MSG_DEBUG, "EPPKE: Failed to set MLO IGTK");
+			goto fail;
+		}
+	} else {
+		if (!kde.gtk) {
+			wpa_printf(MSG_DEBUG, "EPPKE: No GTK KDE");
+			goto fail;
+		}
+		maxkeylen = gd.gtk_len = kde.gtk_len - 2;
+		if (wpa_supplicant_check_group_cipher(sm, sm->group_cipher,
+						      gd.gtk_len, maxkeylen,
+						      &gd.key_rsc_len, &gd.alg))
+			goto fail;
+
+		wpa_hexdump_key(MSG_DEBUG, "EPPKE: Received GTK", kde.gtk, kde.gtk_len);
+		gd.keyidx = kde.gtk[0] & 0x3;
+		gd.tx = wpa_supplicant_gtk_tx_bit_workaround(sm,
+							     !!(kde.gtk[0] & BIT(2)));
+		if (kde.gtk_len - 2 > sizeof(gd.gtk)) {
+			wpa_printf(MSG_DEBUG, "EPPKE: Too long GTK in GTK KDE (len=%lu)",
+				   (unsigned long) kde.gtk_len - 2);
+			goto fail;
+		}
+		os_memcpy(gd.gtk, kde.gtk + 2, kde.gtk_len - 2);
+
+		wpa_printf(MSG_DEBUG, "EPPKE: Set GTK to driver");
+		if (wpa_supplicant_install_gtk(sm, &gd, elems.key_delivery, 0) < 0) {
+			wpa_printf(MSG_DEBUG, "EPPKE: Failed to set GTK");
+			goto fail;
+		}
+
+		if (ieee80211w_set_keys(sm, &kde) < 0) {
+			wpa_printf(MSG_DEBUG, "EPPKE: Failed to set IGTK");
+			goto fail;
+		}
+	}
+
+	wpa_sm_store_ptk(sm, sm->bssid, sm->pairwise_cipher,
+			 sm->dot11RSNAConfigPMKLifetime, &sm->ptk);
+
+	wpa_sm_set_rekey_offload(sm);
+
+	wpa_printf(MSG_DEBUG, "EPPKE: Auth+Assoc completed successfully");
+	sm->eppke_completed = 1;
+	forced_memzero(&gd, sizeof(gd));
+
+	return 0;
+fail:
+	forced_memzero(&gd, sizeof(gd));
+	return -1;
+}
+
+
+void wpa_sm_set_reset_eppke_completed(struct wpa_sm *sm, int set)
+{
+	if (sm)
+		sm->eppke_completed = !!set;
+}
+#endif /* CONFIG_ENC_ASSOC */
 #ifdef CONFIG_OWE
 
 struct wpabuf * owe_build_assoc_req(struct wpa_sm *sm, u16 group)
diff --git a/src/rsn_supp/wpa.h b/src/rsn_supp/wpa.h
index 46e03ad99..06c84fc88 100644
--- a/src/rsn_supp/wpa.h
+++ b/src/rsn_supp/wpa.h
@@ -670,6 +670,8 @@ struct wpabuf * fils_build_assoc_req(struct wpa_sm *sm, const u8 **kek,
 				     const struct wpabuf **hlp,
 				     unsigned int num_hlp);
 int fils_process_assoc_resp(struct wpa_sm *sm, const u8 *resp, size_t len);
+int eppke_process_assoc_resp(struct wpa_sm *sm, u64 flags, int link_id,
+			     const u8 *resp, size_t len);
 
 struct wpabuf * owe_build_assoc_req(struct wpa_sm *sm, u16 group);
 int owe_process_assoc_resp(struct wpa_sm *sm, const u8 *bssid,
diff --git a/wpa_supplicant/events.c b/wpa_supplicant/events.c
index ba79f7f6d..1899ea2ac 100644
--- a/wpa_supplicant/events.c
+++ b/wpa_supplicant/events.c
@@ -3660,7 +3660,39 @@ static int wpa_supplicant_event_associnfo(struct wpa_supplicant *wpa_s,
 	    !(wpa_s->drv_flags & WPA_DRIVER_FLAGS_SME))
 		wpa_sm_set_reset_fils_completed(wpa_s->wpa, 1);
 #endif /* CONFIG_FILS */
+#ifdef CONFIG_ENC_ASSOC
+#ifdef CONFIG_SME
+	if (wpa_s->sme.auth_alg == WPA_AUTH_ALG_EPPKE) {
+		struct ptksa_cache_entry *entry;
 
+		if (wpa_s->ptksa == NULL) {
+			wpa_printf(MSG_DEBUG, "EPPKE: PTKSA not cached");
+			return -1;
+		}
+
+		entry = ptksa_cache_get(wpa_s->ptksa, wpa_s->valid_links ?
+					wpa_s->ap_mld_addr : bssid,
+					wpa_s->pairwise_cipher);
+
+		wpa_sm_set_ptk_kck_kek(wpa_s->wpa, entry->ptk.kck,
+				       entry->ptk.kck_len, entry->ptk.kek,
+				       entry->ptk.kek_len);
+
+		if (!data->assoc_info.resp_ies ||
+		    eppke_process_assoc_resp(wpa_s->wpa,
+					    wpa_s->drv_flags2,
+					    wpa_s->valid_links ?
+					    wpa_s->mlo_assoc_link_id : -1,
+					    data->assoc_info.resp_ies,
+					    data->assoc_info.resp_ies_len) <
+		    0) {
+			wpa_supplicant_deauthenticate(wpa_s,
+						      WLAN_REASON_UNSPECIFIED);
+			return -1;
+		}
+	}
+#endif /* CONFIG_SME */
+#endif /* CONFIG_ENC_ASSOC */
 #ifdef CONFIG_OWE
 	if (wpa_s->key_mgmt == WPA_KEY_MGMT_OWE &&
 	    !(wpa_s->drv_flags2 & WPA_DRIVER_FLAGS2_OWE_OFFLOAD_STA) &&

From patchwork Tue Jan  6 13:45:36 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180411
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=kDyK6KvL;
	dkim=fail reason="signature verification failed" (2048-bit key;
 secure) header.d=infradead.org header.i=@infradead.org header.a=rsa-sha256
 header.s=desiato.20200630 header.b=D1vX39E+;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=fC2WHEJZ;
	dkim=neutral header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=SCqJ96ss;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlswD0Y6Dz1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:49:16 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=4LBZY8/7IyMdaHux2N3ItRDH/au3wKhY59M7BTpU19k=; b=kDyK6KvL5AVY1N
	VPI/oQkj9vLQ3L2+Sa4Dqy5FQ7cZOXIwYU5bRd/QtaDKrMQUsAwMiXVEoBYKT6wEFS0pRLAZ9FChJ
	nKSnVv4G+fN6jYD7Cuztd13bsao7/dCZXlcyjeP98OwdB5iuSH6UTtVusiYS46MdNa4WagpI5mDjE
	H87dT3r/B/zAKdoneCNzuLeEX412hxH8uMp5H8cmyIUXju8rF+S/S2z2JNBPIpQiqih6avwGvQjN4
	h6UacFG6VOZvGwdFdI3vWejFNoKftr1UC8trE12PFHtiwt7/1xrLgGbxjbfqAha8XYEtHFreXZOHB
	q10wrHkugIY4iAF4LSMA==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7QK-0000000DASl-3119;
	Tue, 06 Jan 2026 13:48:39 +0000
Received: from desiato.infradead.org ([2001:8b0:10b:1:d65d:64ff:fe57:4e05])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Op-0000000D8WZ-1DWo
	for hostap@bombadil.infradead.org;
	Tue, 06 Jan 2026 13:47:03 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=infradead.org; s=desiato.20200630; h=Content-Transfer-Encoding:MIME-Version
	:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender:Reply-To:
	Content-Type:Content-ID:Content-Description;
	bh=FGA2brcTKWiaOjP8IguHHs5SrSDESR0YsbA95PoMiRk=; b=D1vX39E+82S9Jw1I1MfZ7zIfXI
	VccIqDSRrv76kGhTljWVbpRqwnrMcDWEaXIuWNshlhUUyh4hdZQNs7bjJkBo9wwxoOHMrLmOxB1yP
	PpHvRQjJQlO10z65r1tPRk69Jlrc/YiRALFLN9ORHLn4xm/zj/grOeDeh+krjA1sCALtqystRSPCX
	qssRUPR9OodMNBGcoaIWZUatAPUTdXWmpZN0Pf/uyDqk5H4Gw+9DKRKRxFa3U2i/qX4AKbRC4bGAZ
	v1b7KuTKkq2U39paYt0JVQcKUD8w7t10G7ZleTTtb4oFAcbA6Ugmi9HdJcVyC8KNQnS4cW6si6YPK
	DSoiBesA==;
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by desiato.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Oh-00000009nB1-2vQE
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:47:01 +0000
Received: from pps.filterd (m0279868.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606B3otL2684965
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:54 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=FGA2brcTKWi
	aOjP8IguHHs5SrSDESR0YsbA95PoMiRk=; b=fC2WHEJZpkuR5PxL/0BA69LLS/Q
	j4lQMjPlN0x9Z72Ci+HtLjuO9hMtGSCqTViktGRkc3QuT/0A044lt9y7iOtl77+j
	M8i+jq+/LQuczGkq82l8qarfAUJWLcvTXKUcntu59oovaupPMzRnmmZtUGse2qmK
	+Q6qwLOIeP6J9KWigi6N5Rp0LPGh0UCB1jKWP7srvLC8rPSrfnsbpaSEPJejS6MW
	EplG1bXWWTY/qzj+DMJiUY6M1tk3EzllOGsUg2RVNxrorrUMATF3Tdcmvhq1nVK9
	yBphsXj28GRbp6686HcoJ/7WJ9BNmsvgi2xYc/fEyu/jsx7hK+Hbb98ME0Q==
Received: from mail-pg1-f198.google.com (mail-pg1-f198.google.com
 [209.85.215.198])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgty5hk0w-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:53 +0000 (GMT)
Received: by mail-pg1-f198.google.com with SMTP id
 41be03b00d2f7-b6097ca315bso1582077a12.3
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:53 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707213; x=1768312013;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=FGA2brcTKWiaOjP8IguHHs5SrSDESR0YsbA95PoMiRk=;
        b=SCqJ96ssEQp5z9Ay0wmDaXBkFJa+Jqrsl8rCnV3hnWoF8ldXa+fhi0sWuurTyznFMf
         T4hk7epfe3wWWu8DMOjgrU1CQtwL0+Okr50RgoirTwos75OLkzqVka+BIeKbmfv9RtDY
         wXgfzKd38T7jlIaMrUsv5ADe9cxQ6x+QQ3tqWhFSqJ3w/b7ERGUYoWSIjA8ePMOMd0GR
         jB3QD+f9wGf9pgXeamOdF1sEbW0t6RXVKfEFNzrRkPwXl8FApk8ndF17XKMf1JwVKB6Q
         dQDV7kDU270kn00msoaWmy3WcaSzqR2zFMtbMQXtEVwO6dIxXsEWn6C0boWu4SxRdBUK
         Xi/A==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707213; x=1768312013;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=FGA2brcTKWiaOjP8IguHHs5SrSDESR0YsbA95PoMiRk=;
        b=mpozXRAF5nu7jl8jehGyNGSkZvF9ivBZwoT57KSsUyHro9HRX1upJKx94AGG6XyKzE
         SnOFJVn5+Mosp/GKpL9+KSxw/68zO8mWW+xS1GU8bo/20XygKHKkM685AJQHuet4+rJB
         5xJcMHoDiOON3FLbl9vIVixTiLxBL5CX5E5AaMqKtCUQiHDgvJQpQKDDWlnK9OXujqWh
         4u78P7YvMXGRQ4pOXRMbqv9B6pHFRt4ZKIZs7xQX3NqQiCIESaxvOexZ2JTXD3M7C0Aw
         fOBiA4SamhZ3aaI+ISu0u15ntKJW/TxaXdGzdQPbDTJ0GLIDnqXYfP+zEbdsatWMfXyt
         kWPQ==
X-Gm-Message-State: AOJu0YwHZVRZ9nesOFM+05ppR1cZL0EwY1uHzo99niqoEX3/NMuTSz8b
	0qylk701vdxWqCw5NWRXi9MCy45NglbMvB41jsBjC1K3YnfqTF1xGRXG60WmgwHbRr2ZJ+52ala
	2Ger/2iqf3Mw9aE22GibPfi1R1ILozQBN4L2IUvWrg7/gpqRLfigbEAiTmAKejXYy6Yjf6T/R
X-Gm-Gg: AY/fxX5sZ3MdoORITzWps6+y6igYq5v55/PhO2nUqAiPiMKjkZxIIgJNLT1kUW9dhWf
	zemsrByUjNkDfhrXGR39h4nk8hJvx+ucp+o/cDyb0bGqcOTeeBydupIxvOgFmh82BOzExgw+HAl
	0kl12wxB2J6lemeUIFr15Bz8PmEcNhIysf3a4TuhBmk2mNMSzz5sJ4orXfOKreErw3tzb6osy/k
	LsZWZbhC+/kJ/6twqB4CbouPyL2vTmZJS0WxOUGtTfvpNqM9MrTmg6s2jLHtyBaAcJwy+dagh/9
	T1WjnHtBJe/hmVJLr0HSXeQJI+vNCNNT/RDQHMshnaIgRpyExwkQdyLv13OU5WhzX+nN+5KBZE+
	rzuLf4RnECOUYICb/LNOwBNXTRsdaEE911//hYk3k
X-Received: by 2002:a05:6a00:1d23:b0:7aa:9ca5:da9c with SMTP id
 d2e1a72fcca58-81880b7097cmr2946363b3a.22.1767707212591;
        Tue, 06 Jan 2026 05:46:52 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IG4fmDvQYMoOv8ZGsHS8oaPBabjGU0JYLxFaGRRP0jdmTtgr5rijeQfhM22DhNfEl33gLL1Kw==
X-Received: by 2002:a05:6a00:1d23:b0:7aa:9ca5:da9c with SMTP id
 d2e1a72fcca58-81880b7097cmr2946339b3a.22.1767707212181;
        Tue, 06 Jan 2026 05:46:52 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.50
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:51 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 26/28] tests: Enable CONFIG_ENC_ASSOC for hwsim
 wpa_supplicant
Date: Tue,  6 Jan 2026 19:15:36 +0530
Message-Id: <20260106134538.2594232-27-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfX0NtvtLoijoNO
 OChMvlbxAVEPCN1d1Ya7+rBrwuhEjnOA1paZAnQkRHokqUe/cDQvf8lHVbJUSBaEckrhgiliN7w
 k6JXqiEimzN8255A0Dab24X61WvhwaqHSRnqCb7SsMt8hVtCLV30o+vkkvEEurkXcjUcWVf7fsI
 STF39jBbagVkbhV/oh+ldpsC5hX1eKYYKPPe4ukwjfy7VQq6M6kbfiy3OE6qBQ6VZfKDCvURWp9
 Xj+zS16It2aHvNmu+ycqDoGXuHKirxYpYnDT/A/GmHZGiufofnxOvuuUiLm0LJyZhkg5dso1G53
 H5QMPXezaBL8Wr3vYFlAjt4u9DRb9etbmf5eRgWqNzf1BavTmS8D791r5MGI2ia2iDF5XE6ZlGn
 7v7t7jO66KcAAsUsEyarbJedkZSfm9vTpX2K3/DX7mqwLtRLkvb3lkX3+rYODa923HOfCVxxuSG
 s/Hja7vIdWWm8IRSfKw==
X-Authority-Analysis: v=2.4 cv=Rfidyltv c=1 sm=1 tr=0 ts=695d124d cx=c_pps
 a=Qgeoaf8Lrialg5Z894R3/Q==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=idPbxda75d4-GageoJcA:9 a=x9snwWr2DeNwDh03kgHS:22
X-Proofpoint-GUID: 7_SgbNjGFURtVNi8itvLvze_d9G2dDC3
X-Proofpoint-ORIG-GUID: 7_SgbNjGFURtVNi8itvLvze_d9G2dDC3
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 malwarescore=0 lowpriorityscore=0 priorityscore=1501 clxscore=1015
 suspectscore=0 adultscore=0 bulkscore=0 spamscore=0 impostorscore=0
 phishscore=0 classifier=typeunknown authscore=0 authtc= authcc=
 route=outbound adjust=0 reason=mlx scancount=1 engine=8.22.0-2512120000
 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_134656_000668_CD1CD408 
X-CRM114-Status: GOOD (  11.43  )
X-Spam-Score: -0.9 (/)
X-Spam-Report: Spam detection software,
 running on the system "desiato.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Kavita Kavita <kavita.kavita@oss.qualcomm.com> Enable
    CONFIG_ENC_ASSOC option for wpa_supplicant in hwsim to run EPPKE related
   tests. Signed-off-by: Kavita Kavita <kavita.kavita@oss.qualcomm.com> ---
 tests/hwsim/example-wpa_supplicant.config
    | 1 + 1 file changed, 1 insertion(+)
 Content analysis details:   (-0.9 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Kavita Kavita <kavita.kavita@oss.qualcomm.com>

Enable CONFIG_ENC_ASSOC option for wpa_supplicant in hwsim to run EPPKE
related tests.

Signed-off-by: Kavita Kavita <kavita.kavita@oss.qualcomm.com>
---
 tests/hwsim/example-wpa_supplicant.config | 1 +
 1 file changed, 1 insertion(+)

diff --git a/tests/hwsim/example-wpa_supplicant.config b/tests/hwsim/example-wpa_supplicant.config
index d9b26464c..9343ce32e 100644
--- a/tests/hwsim/example-wpa_supplicant.config
+++ b/tests/hwsim/example-wpa_supplicant.config
@@ -170,3 +170,4 @@ CONFIG_NAN_USD=y
 
 CONFIG_IEEE80211BE=y
 CONFIG_PROCESS_COORDINATION=y
+CONFIG_ENC_ASSOC=y

From patchwork Tue Jan  6 13:45:37 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180412
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=j04Nn8yE;
	dkim=fail reason="signature verification failed" (2048-bit key;
 secure) header.d=infradead.org header.i=@infradead.org header.a=rsa-sha256
 header.s=desiato.20200630 header.b=SMvZzWkN;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=jpoat860;
	dkim=neutral header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=HtnV0WI1;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlswH5M0zz1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:49:19 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=e2BSCQMTSLc1+UH1z8gC7G2HeN/n6CZ3S+EoC4nLtro=; b=j04Nn8yEehTi7O
	5e0FNPnZrIyxWJBJ+Jt6x1Bl7VCNsnhTogVTYWmiROuxWO/7YXzX7frqz9oNgG498k5USWxCy2xnb
	sXa0rfvDFqCqCtRS2zaxmOkMRhM0by+Uq87aVMBDnWzORN2N4YKHOwHqQAxNzHSkAykadsglbmi4M
	cJI4M9pS5eBSfIuIthZajFYnNJeDUSAjNg5ufvaBLMR/FtdBfA41JZ4fuAV9D8jUIBfygKM06VHUP
	o9vmifqgJpXnhNsE/8lPHLpx2HTg2aLeK24UGSlT8gYyrLCw1qbF9bjo+XQsb6gbOURjAtI1bIhp6
	Xo2wgEMw1n+DoofpRKbQ==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7QS-0000000DAeU-3plB;
	Tue, 06 Jan 2026 13:48:45 +0000
Received: from desiato.infradead.org ([2001:8b0:10b:1:d65d:64ff:fe57:4e05])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Or-0000000D8a7-2j45
	for hostap@bombadil.infradead.org;
	Tue, 06 Jan 2026 13:47:05 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=infradead.org; s=desiato.20200630; h=Content-Transfer-Encoding:MIME-Version
	:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender:Reply-To:
	Content-Type:Content-ID:Content-Description;
	bh=PpenlMDgtKah0Yf3wS2h6rAVaTMppWpiW9jMnRv/PeE=; b=SMvZzWkNhGX6x6pkH0+TTlFal9
	oXHsiIqsmZfolwd6H/LvnFJa90TLmrUX0O/0C+1D4AGexQbWoEmwBSIz/CfSxirlKNKraxUW/Tqb/
	neGWa6/GXRguMarb1bCNBsZu6WHQeKBIufrZJrfwxEnOPjypG5xjLGo6AEBFtTkVU4NqlfXu4edI7
	yqnxpZC4qG7sM++/uXr+8+7/FvUXxFA7406KBLdbbRPLY/ayWT4QkOkDvClq8KvT/oPFxXOb3ePGX
	jfqgLxx79Nhsb8pqPIuy3PqQJWF8C42qmlvaVEYHH2//jpM7NslDJzWLvAzMPEfSuGXq3BtoWx8bY
	yQrCBJ9w==;
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by desiato.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Ol-00000009nC9-00q2
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:47:04 +0000
Received: from pps.filterd (m0279873.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606B0ZCC2254441
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:56 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=PpenlMDgtKa
	h0Yf3wS2h6rAVaTMppWpiW9jMnRv/PeE=; b=jpoat860EM1lgazZFMzLrw2kX4+
	+stqF+rZSFl55wQePkycVEbNwCwNZz953+0ANXN7FF67j2C+40AKUix7s9gV8M5I
	Pn1puUs0XUz4uWegMU/iyGi6IlpNInvOZiBSriWdDSA7/V4WCTmYFoHg6ocnFv+g
	X87D2fbYTvzQo1iRtgyzBeT1mDVnKCKfNm9sl3RwWt8YBUuZyTvRAVmcMyCKRXea
	6LTpinjeMAfweMD2cZtjXiy8pc7gUWJXW3prKiP1tUhfKuAY1odUXR7bdxiEcv/R
	QDg57opPjhiNJNg3/p0kjTYixStyukgZGW1yTqQfH4OlmPwsHBvGRutpc2g==
Received: from mail-pf1-f200.google.com (mail-pf1-f200.google.com
 [209.85.210.200])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgu421jnh-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:56 +0000 (GMT)
Received: by mail-pf1-f200.google.com with SMTP id
 d2e1a72fcca58-7b4933bc4aeso1245754b3a.2
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:56 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707215; x=1768312015;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=PpenlMDgtKah0Yf3wS2h6rAVaTMppWpiW9jMnRv/PeE=;
        b=HtnV0WI1XUb6Po4B/zTkG1Uh+gxtK+otXeG6BrEFaOMXxQSVqS6Bw9A7EiIq9WOfZQ
         OMV3cLMzFfzXnsh11cCae/8wWUGRJf7eMEXQAJK0rwI41HffJxQpZ8EIThyAnlduFUfA
         wq7CBOMsk5y1be7ABNIr0MhBrHwKMNA6cWFJtodWiW1S143+xIXqpMJeVzL/6eAxQTbu
         9EMEtBaCFj+2PAPCT768t117/BCn/Y01Fmq9mERtK/sbViblMCzh4to3WhXJ4hP0mWOx
         NYgrNRsnOvdXDnjQKJvQkMMkL4sQn3z0tDhZTI9n7oW0R1binHz1HmkSR3/eSHsDqeQP
         6mRA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707215; x=1768312015;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=PpenlMDgtKah0Yf3wS2h6rAVaTMppWpiW9jMnRv/PeE=;
        b=HGC1JsV/UILFoyKbzTnc5zOFceaAiYpU8m780rQ+WYojT3uCLruKRnxjj97ou5F1H3
         zrJyT34c6eVRHsfiMn8c5usK+lLCHO4I/WMmNoQB82UCNP0oVyKzaxAVfbgc6JcotcsA
         kboImORLvjNyFKz2ZUTfNZGsQ2v5yLH+mkdkGCdL5H4ElltgDDcywT3YmOuAMXJBgxlK
         nC/79pkrIfq4nJiEl1pkrx/++MqAF0KcL6UeJxOWcOYUuOmFFWbIeit1urALe55PkKu2
         HpgfCeKeydDQQjAQdwqxnTBJ+xYAvyRNmWwh76IgvKpK1Ln0hB9yNQkCPHPTCoIqvdUs
         VO5A==
X-Gm-Message-State: AOJu0Yxl0Id2wGpHDvqZmvOl7aJ7MaJerBCrlSNf8rT4ku6tkgC8sS5N
	qESwn8zN6pGzN1XOBtgaCqi2yqfuURls5M71buB4K9AmXRBfOWlbz7NHqy6MXRySlcyFhc8sLOJ
	eBEsO7ec3a5vJa+zB56tOdYpbA47tmk+PTfU6p3AQHPWYZmqDY2Z7Wl7whkI47v86iZNPnzzx
X-Gm-Gg: AY/fxX4yeT3R4iE+fYzRaXFD0z2UUJFGx0yUmPVn8cFdUtWO7QpqOosMT/rd7weXUnp
	YqNQ7txMYpBVeWUeKxUcy50YD1GYa5sNGLHIz/wmFwjtw9Gkj5PoLriFXgcP7J2pyPvs0IdT4V2
	VyfGZaHlu7f9MRXbLpLqSoEZo04XlxVf7XzxVpwfu3U0rSpwinirC12zeSpZ2LyBAdv/EruII07
	2K6psR9LD39KupxF01qfmE9IkaOtcB2Uay3ff/5G6tkpl3wldkfadChxdCFQtEv0GmGVK9AKzFT
	a6Qr2Lwc3r8QLya1aQTG79I1/TKb7Zif6BSwoOcWvOZ+gOaUiQWDXN724YhRSh3G7tWyEUk5ocQ
	FW5B7Ni2vz07uT7OiVUcKr2wrEyZIFzs4abXy3h/y
X-Received: by 2002:aa7:9a82:0:b0:7f7:58cf:404a with SMTP id
 d2e1a72fcca58-8187d7eacecmr2848075b3a.13.1767707214923;
        Tue, 06 Jan 2026 05:46:54 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IHoGb20wEmEzXtL9UwA2b/pDtQAJd26ZxKyeY0hG7DH1CIEtIngM+iFzxX8OZBH970VksJp9g==
X-Received: by 2002:aa7:9a82:0:b0:7f7:58cf:404a with SMTP id
 d2e1a72fcca58-8187d7eacecmr2848053b3a.13.1767707214437;
        Tue, 06 Jan 2026 05:46:54 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.52
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:54 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 27/28] tests: Enable CONFIG_ENC_ASSOC for hwsim hostapd
Date: Tue,  6 Jan 2026 19:15:37 +0530
Message-Id: <20260106134538.2594232-28-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Authority-Analysis: v=2.4 cv=dYuNHHXe c=1 sm=1 tr=0 ts=695d1250 cx=c_pps
 a=mDZGXZTwRPZaeRUbqKGCBw==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=EfQgyAHBdYhmdkLjkZoA:9 a=zc0IvFSfCIW2DFIPzwfm:22
X-Proofpoint-GUID: KpR6ZYNEP7cZmAICuKbTDE5N_zefIygX
X-Proofpoint-ORIG-GUID: KpR6ZYNEP7cZmAICuKbTDE5N_zefIygX
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfX26KxZuPg22Dk
 b558huD8ISzokaMoRDvb/ZRoCgynJbNsRmh28CZZAIAlWUArC30XFpd6sZFgIpmqmcdTcTMltcl
 Iw2mLcXvNreadcPUyxebz8xZZ0ifvi2oX702fo1hklqnBCc8BVTLWfyoPyuxAycyqLd2ayapCop
 /MF2SgfIpZckAHHcoKvXAfNSt5rihGAdpt4Aar9iulEbeQjIR8cfXkujRIgEatabCtZxdaEReJ0
 Jh1Pi8odnrB7F8ZKsCsTLVxykPWSPQHxbcTozQuCwzOp1+CcKmVDGayC3iPzne2sILl4foJ0kdo
 Qln8W6X/t6J8lNpk/nxV+sBIh2Rr7QWb34VhTgmfFLkWyxv4LDSx5uT/Beln/YpS+5mVhQU5xS8
 lwi12Fb0bO91eCZtVF7owcv2NX6467vOaH8KMxJF50o174G8wBC8OKDBMyb3wppCaHLn+qTJBij
 f3rJOINSZLe6QhnNmbA==
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 priorityscore=1501 adultscore=0 malwarescore=0 impostorscore=0 phishscore=0
 clxscore=1015 spamscore=0 lowpriorityscore=0 suspectscore=0 bulkscore=0
 classifier=typeunknown authscore=0 authtc= authcc= route=outbound adjust=0
 reason=mlx scancount=1 engine=8.22.0-2512120000 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_134659_314805_6C9A530F 
X-CRM114-Status: GOOD (  11.99  )
X-Spam-Score: -0.9 (/)
X-Spam-Report: Spam detection software,
 running on the system "desiato.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com> Enable
    CONFIG_ENC_ASSOC option for hostapd in hwsim to run EPPKE related tests.
   Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com> Signed-off-by:
 Sai
    Pratyusha Magam <smagam@qti.qualcomm.com> ---
 tests/hwsim/example-hostapd.config
    | 1 + 1 file changed, 1 insertion(+)
 Content analysis details:   (-0.9 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

Enable CONFIG_ENC_ASSOC option for hostapd in hwsim
to run EPPKE related tests.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
---
 tests/hwsim/example-hostapd.config | 1 +
 1 file changed, 1 insertion(+)

diff --git a/tests/hwsim/example-hostapd.config b/tests/hwsim/example-hostapd.config
index 65e6d7e5e..cd2696b74 100644
--- a/tests/hwsim/example-hostapd.config
+++ b/tests/hwsim/example-hostapd.config
@@ -125,3 +125,4 @@ CONFIG_AIRTIME_POLICY=y
 CONFIG_IEEE80211BE=y
 CONFIG_NAN_USD=y
 CONFIG_PROCESS_COORDINATION=y
+CONFIG_ENC_ASSOC=y

From patchwork Tue Jan  6 13:45:38 2026
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
X-Patchwork-Id: 2180413
Return-Path: 
 <hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 secure) header.d=lists.infradead.org header.i=@lists.infradead.org
 header.a=rsa-sha256 header.s=bombadil.20210309 header.b=kF50PiXd;
	dkim=fail reason="signature verification failed" (2048-bit key;
 secure) header.d=infradead.org header.i=@infradead.org header.a=rsa-sha256
 header.s=desiato.20200630 header.b=YNIQa5i1;
	dkim=fail reason="signature verification failed" (2048-bit key;
 unprotected) header.d=qualcomm.com header.i=@qualcomm.com header.a=rsa-sha256
 header.s=qcppdkim1 header.b=VY2w8pPl;
	dkim=neutral header.d=oss.qualcomm.com header.i=@oss.qualcomm.com
 header.a=rsa-sha256 header.s=google header.b=fEEVXoTH;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=none (no SPF record) smtp.mailfrom=lists.infradead.org
 (client-ip=2607:7c80:54:3::133; helo=bombadil.infradead.org;
 envelope-from=hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org;
 receiver=patchwork.ozlabs.org)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [IPv6:2607:7c80:54:3::133])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange x25519 server-signature ECDSA (secp384r1) server-digest SHA384)
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4dlswR6l9fz1xpc
	for <incoming@patchwork.ozlabs.org>; Wed, 07 Jan 2026 00:49:27 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20210309; h=Sender:
	Content-Transfer-Encoding:Content-Type:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:MIME-Version:References:In-Reply-To:
	Message-Id:Date:Subject:Cc:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=EYlfwY3zBguV2BUsP/P+8hKzsbQbMVnAZMhGxWhj0bQ=; b=kF50PiXdEPSUSi
	/TNW04T6WSGayCgXGyAUyzmvX38MSAA3659T6iaqOt3YVf9vN+FuUZC/QsahSgJQ7Co6duk1SLdhW
	t0TNH5hgcoadh27DZ+hAML9PHhVadNdqQN+e8kWKz5I4Rf+uLFjh+9JAwHr+ot8DDqdSnEf4RcYGk
	Oc2u4g0V4p/PW24oFZHoUSpVngBMk4SOJQb4Tt7jkuJnCVl9CAu5jG5fjhBDZR1AaoLOOcENJDerO
	tlU2EXacw0uyrTHUT4q4LwwvpEACE2A/tuI0OlAX1WTgHjfx83CIfClmXj+2geQIVzK/0DTjE68U0
	K5+soH5jMMwVoEIdk17w==;
Received: from localhost ([::1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7QY-0000000DAlY-2QEB;
	Tue, 06 Jan 2026 13:48:50 +0000
Received: from desiato.infradead.org ([2001:8b0:10b:1:d65d:64ff:fe57:4e05])
	by bombadil.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7Ov-0000000D8ec-0V4F
	for hostap@bombadil.infradead.org;
	Tue, 06 Jan 2026 13:47:11 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=infradead.org; s=desiato.20200630; h=Content-Transfer-Encoding:MIME-Version
	:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender:Reply-To:
	Content-Type:Content-ID:Content-Description;
	bh=62cJ8o8txACwp5QsfehAYtdJF2LD3TPPC3Pk5ktS+Kc=; b=YNIQa5i13cFo5GyJMZFHoqvSoB
	FlIFMjNhOoFFVv11ABzdsfgpW93rc7ju59ZWK7dKxboXXvf8xz0qEFWiLswx4ELw5w9SLsUp27Pdf
	Tb9Kfj+E+Qamn8TdHO9kQgYqo0p80HKTXvn056qVZWklHSQpqrwteVmoywqInD6l3ajnV7s5IyAyM
	c1IBCPlL44vcCh+y/nBmg7CfqCmG6YVB9eSUHGLnTilBI/163Pglsmf8e7IuU/8PV8eVwAY52Smw8
	Gs8WQ215KwXrJkRl2Yp943nP/8RLddRhxi/5EQl6zCFXakbGER77aJsWmzXtOE/1mbiF/vtIw17ru
	L0T3DKUA==;
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
	by desiato.infradead.org with esmtps (Exim 4.98.2 #2 (Red Hat Linux))
	id 1vd7On-00000009nDb-47Bx
	for hostap@lists.infradead.org;
	Tue, 06 Jan 2026 13:47:07 +0000
Received: from pps.filterd (m0279868.ppops.net [127.0.0.1])
	by mx0a-0031df01.pphosted.com (8.18.1.11/8.18.1.11) with ESMTP id
 606BFBAo2684702
	for <hostap@lists.infradead.org>; Tue, 6 Jan 2026 13:46:59 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=qualcomm.com; h=
	cc:content-transfer-encoding:date:from:in-reply-to:message-id
	:mime-version:references:subject:to; s=qcppdkim1; bh=62cJ8o8txAC
	wp5QsfehAYtdJF2LD3TPPC3Pk5ktS+Kc=; b=VY2w8pPlS0SORRcy36A6vHY6AvB
	a8gWBJwb1LSTHdsfM+mtqHOgBjCM9bhTSD0j16Q2hwBHSF9zN6vPg8C0BdrffR0B
	kOGJJK3l/hFN2x0HthszYGi0Mev+Ut5LNyy/ldvrrVnnYHdJOqEJmForqr/ti+fH
	SiYzcnTOardbeZKrmNkVebD7y5hhymuhJgrgMfE3horJpXNXzmUG0KRUz8XNpSka
	GXW69zoGUGLBcTiqcBa+U4jC9l//lCkca7XGdziro6axZflul2P3qvQdQ6YyrQzm
	Xxij3d5DpAue11tzV6RZLU6ajFtCYEzFZfspA7jAwSyIU8QOjIxKz5NAeDg==
Received: from mail-pf1-f198.google.com (mail-pf1-f198.google.com
 [209.85.210.198])
	by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 4bgty5hk13-1
	(version=TLSv1.3 cipher=TLS_AES_128_GCM_SHA256 bits=128 verify=NOT)
	for <hostap@lists.infradead.org>; Tue, 06 Jan 2026 13:46:59 +0000 (GMT)
Received: by mail-pf1-f198.google.com with SMTP id
 d2e1a72fcca58-7d5564057d0so2800252b3a.0
        for <hostap@lists.infradead.org>;
 Tue, 06 Jan 2026 05:46:59 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=oss.qualcomm.com; s=google; t=1767707218; x=1768312018;
 darn=lists.infradead.org;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date
         :message-id:reply-to;
        bh=62cJ8o8txACwp5QsfehAYtdJF2LD3TPPC3Pk5ktS+Kc=;
        b=fEEVXoTH/zq7VQ0anQyXg7FGTOrYPRT+KqQE/lsblGC7JSheY//mhx1Oebz/abStao
         y4KyvRsrTjYJkoCFTgD9K9rHsdB8fKkCVHxYT3bsPmiwbVoMahzGTgmRdlUyBp2VSCe2
         /cjQSRmvsIntfB0wdLwucS6fz+iiR50cjKQ4eOT2ZqhA9M46hjNbMe5Ob0T3Ah7l6udV
         QN02J1+muKRX7gZVzLQyt1fmKF2d7DF6Ora+DSVo6gugLWDCJ6xtpuLh6Sswa9jZVhFV
         PPrZktqlc1YqXuFTpqOa9zzGBxp0F08xnLF/oK3xvRz1Il7uvp4R8fFE542APT0ys1Xr
         JFvQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1767707218; x=1768312018;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-gg:x-gm-message-state:from
         :to:cc:subject:date:message-id:reply-to;
        bh=62cJ8o8txACwp5QsfehAYtdJF2LD3TPPC3Pk5ktS+Kc=;
        b=vE0QPyYi6UVXn3NtIbQIyO4hj/ARLWFbqDplamo1RsRT1CA1l2q7XQRkpVb1awMfsE
         8IwdSSVKbXuWToVJLRphANgzUpnOuQUHvdUTglbWk4iP+SFFoGpL/MsYO7g+8OwAvNg/
         LxOBrQ9mr48yH4qfwyLYDgSXo0v7zQMObb7D8jbM4eHDqVRdeVIIKgHogy2bZfJJFQ2R
         c8azzNagEiXi9CQqr6/MeJrtlW1bmzbHQZliBQ5IF0vL1oASC2AhLz5WNlcEjWlxLTo2
         P6V2htk4rrIU7Nj7tZZ9RSAdHpdH5HThEkLc21Z6olorYOYB/YCQmsCCanIvOdNgk6P4
         4rZQ==
X-Gm-Message-State: AOJu0YwxXZyWQv5facvkMTbvAr0PLJkLYiEPIMRM0DdOGwj64i2HpVB1
	wg959BQ6Mda6d7aZvYRn4xvItp1FFgQphTTflXCQjmjPmJyAV3t8YmgUJ0Z9SMKbWwNKYHB3p1Q
	IS8NYX39zcT2I3HaMjPQxva6AQd57SdDhnxAFtPLHWbcdTHkNPmH1N/B6d1iNpvrv8zWhwofQ
X-Gm-Gg: AY/fxX6Eynd2eoZY0im+YoJLgkimFiFtQQQhkSK1ECpf8nZHdEwd+NyFQrhAaU8eIw7
	cu2mgb+Ia5Hl1aVZl4gsrg+pjSNf3GrTlVDYsSw3gMZPFuPnfKiqrcnqf0dNviGyfOZOV8uUhY/
	Req25rLtI9QdFyLr7bHNHlgUEkUq1fUoit+RSJwCB2UjSyhzlfjVSyli+y262lloamLBPg5NEd1
	gIaW9SeiTnwIT6MToydAnrHWF5EIih7ArGQ8k9lHJZC3SnueEHxHLn/3BxTFCusW07V/mTsHRKV
	wFb5yYs6mJpvDwHXAW5xvrVKLbNLwdVnuJAGfGkvk72qpRPQevPBDTXexLkzECXu73mJo8eTi4c
	sVjB1b2diGlAH9TXnXaqESlxz4P/ApxmsAyD+8uoL
X-Received: by 2002:a05:6a00:4acc:b0:7e8:450c:6199 with SMTP id
 d2e1a72fcca58-8188389ece6mr2830683b3a.48.1767707217621;
        Tue, 06 Jan 2026 05:46:57 -0800 (PST)
X-Google-Smtp-Source: 
 AGHT+IFASeMDWBYnq48sLn+5GxZKambUSFfyVhor48g8MZkyRhmHVY1+IT+qaxJpbJyJYRcEPpPznw==
X-Received: by 2002:a05:6a00:4acc:b0:7e8:450c:6199 with SMTP id
 d2e1a72fcca58-8188389ece6mr2830649b3a.48.1767707216890;
        Tue, 06 Jan 2026 05:46:56 -0800 (PST)
Received: from hu-ainykuma-hyd.qualcomm.com ([202.46.22.19])
        by smtp.gmail.com with ESMTPSA id
 d2e1a72fcca58-819c59e8010sm2369221b3a.52.2026.01.06.05.46.54
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 06 Jan 2026 05:46:56 -0800 (PST)
From: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
To: hostap@lists.infradead.org
Cc: sai.magam@oss.qualcomm.com, quic_drohan@quicinc.com,
        kavita.kavita@oss.qualcomm.com, ainykuma@qti.qualcomm.com
Subject: [PATCH v2 28/28] tests: Add EPPKE authentication test cases
Date: Tue,  6 Jan 2026 19:15:38 +0530
Message-Id: <20260106134538.2594232-29-ainy.kumari@oss.qualcomm.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
References: <20260106134538.2594232-1-ainy.kumari@oss.qualcomm.com>
MIME-Version: 1.0
X-Proofpoint-Spam-Details-Enc: AW1haW4tMjYwMTA2MDEyMCBTYWx0ZWRfX85hBs3+MTmcS
 IsL05CYEiAPEfcD8gzATR057DjlWCBCrS/X8MYaMZRSeL8r4/jyFrhpLjAXS4Pniewx/N/SqGKg
 yB4+ggBmWCdiIy4JLy3LS6cnrl9Gp9fp2+B4h2ee9TKtUd+umDnmB8077km1O86e1FytPbmzSxS
 mbOwWb2mG4hgEtQ6BhhHjfNOBGVH6llTbEyCCDWLu4NB+XStymxcdiRsxaLfQ/ISQf7g61arEKG
 GbYKY8a39jDWmDLnKB/YVzN02fa3WloDh/8JxJNdsQmK1JQhSIW8wLVL2K2gRkp8TYvO61SEXx2
 flt4bweDVF62oR23NLB/82HTjBc2+G4JDxcx8p1cv04i5+q/0n60C4GjODb1aoPV+c8B6VIvxop
 lPFcP7XRf+ZXlxfyvYDAHNEKyGwc59CRV834DlzC40LPWI/efBcjI+FqdD6z7UUEyXEwrUEXwCa
 0Haigpiax4yCgM9om/Q==
X-Authority-Analysis: v=2.4 cv=Rfidyltv c=1 sm=1 tr=0 ts=695d1253 cx=c_pps
 a=m5Vt/hrsBiPMCU0y4gIsQw==:117 a=fChuTYTh2wq5r3m49p7fHw==:17
 a=vUbySO9Y5rIA:10 a=s4-Qcg_JpJYA:10 a=VkNPw1HP01LnGYTKEx00:22
 a=EUspDBNiAAAA:8 a=4PXqi06CiKVc9LbKRlQA:9 a=R0S_DgVp-jkT2kb-:21
 a=IoOABgeZipijB_acs4fv:22
X-Proofpoint-GUID: hI62qwJqGVYips5ZsNKU2UJ5-IaUddCQ
X-Proofpoint-ORIG-GUID: hI62qwJqGVYips5ZsNKU2UJ5-IaUddCQ
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1121,Hydra:6.1.9,FMLib:17.12.100.49
 definitions=2026-01-06_01,2026-01-06_01,2025-10-01_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 malwarescore=0 lowpriorityscore=0 priorityscore=1501 clxscore=1015
 suspectscore=0 adultscore=0 bulkscore=0 spamscore=0 impostorscore=0
 phishscore=0 classifier=typeunknown authscore=0 authtc= authcc=
 route=outbound adjust=0 reason=mlx scancount=1 engine=8.22.0-2512120000
 definitions=main-2601060120
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20260106_134702_409919_50499048 
X-CRM114-Status: GOOD (  16.41  )
X-Spam-Score: -0.9 (/)
X-Spam-Report: Spam detection software,
 running on the system "desiato.infradead.org",
 has NOT identified this incoming email as spam.  The original
 message has been attached to this so you can view it or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 Content preview:  From: Sai Pratyusha Magam <smagam@qti.qualcomm.com> Add
 hwsim
    test cases to verify EPPKE authentication, including (Re)Association frame
    encryption in multi-link and legacy 11ax scenarios. Tests cover AP and MLD
    configurations with SAE and SAE-EXT-KEY [...]
 Content analysis details:   (-0.9 points, 5.0 required)
  pts rule name              description
 ---- ----------------------
 --------------------------------------------------
  0.0 RCVD_IN_VALIDITY_SAFE_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                             [205.220.180.131 listed in
 sa-accredit.habeas.com]
  0.0 RCVD_IN_VALIDITY_RPBL_BLOCKED RBL: ADMINISTRATOR NOTICE: The query to
                              Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                           [205.220.180.131 listed in
 bl.score.senderscore.com]
 -0.7 RCVD_IN_DNSWL_LOW      RBL: Sender listed at https://www.dnswl.org/, low
                             trust
                             [205.220.180.131 listed in list.dnswl.org]
  0.0 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED RBL: ADMINISTRATOR NOTICE: The
                             query to Validity was blocked.  See
                             https://knowledge.validity.com/hc/en-us/articles/20961730681243
                              for more information.
                        [205.220.180.131 listed in
 sa-trusted.bondedsender.org]
 -0.0 SPF_PASS               SPF: sender matches SPF record
  0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
  0.1 DKIM_SIGNED            Message has a DKIM or DK signature,
 not necessarily valid
 -0.1 DKIM_VALID_EF          Message has a valid DKIM or DK signature from
                             envelope-from domain
 -0.1 DKIM_VALID             Message has at least one valid DKIM or DK
 signature
 -0.1 DKIM_VALID_AU          Message has a valid DKIM or DK signature from
 author's
                             domain
X-BeenThere: hostap@lists.infradead.org
X-Mailman-Version: 2.1.34
Precedence: list
List-Id: <hostap.lists.infradead.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/hostap/>
List-Post: <mailto:hostap@lists.infradead.org>
List-Help: <mailto:hostap-request@lists.infradead.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/hostap>,
 <mailto:hostap-request@lists.infradead.org?subject=subscribe>
Sender: "Hostap" <hostap-bounces@lists.infradead.org>
Errors-To: hostap-bounces+incoming=patchwork.ozlabs.org@lists.infradead.org

From: Sai Pratyusha Magam <smagam@qti.qualcomm.com>

Add hwsim test cases to verify EPPKE authentication,
including (Re)Association frame encryption in
multi-link and legacy 11ax scenarios. Tests cover AP and
MLD configurations with SAE and SAE-EXT-KEY base AKMs,
SAE-EXT-KEY AKM with different groups, PMKSA Caching,
validating RSNXE flags, AKM suite selection, and
authentication algorithm handling.

Signed-off-by: Ainy Kumari <ainy.kumari@oss.qualcomm.com>
Signed-off-by: Sai Pratyusha Magam <smagam@qti.qualcomm.com>
---
 tests/hwsim/test_eppke.py | 614 ++++++++++++++++++++++++++++++++++++++
 1 file changed, 614 insertions(+)
 create mode 100644 tests/hwsim/test_eppke.py

diff --git a/tests/hwsim/test_eppke.py b/tests/hwsim/test_eppke.py
new file mode 100644
index 000000000..a29babc76
--- /dev/null
+++ b/tests/hwsim/test_eppke.py
@@ -0,0 +1,614 @@
+# Test cases for Enhanced Privacy Protection Key Exchange(EPPKE)
+# Copyright (c) 2025, Qualcomm Innovation Center, Inc.
+#
+# This software may be distributed under the terms of the BSD license.
+# See README for more details.
+
+import time
+
+import hostapd
+from wpasupplicant import WpaSupplicant
+from utils import *
+from hwsim import HWSimRadio
+from test_eht import eht_mld_ap_wpa2_params, eht_mld_enable_ap, traffic_test, eht_verify_status
+
+def test_eppke_akm_suite_and_rsnxe_feature_flags(dev, apdev):
+    """AP EPPKE AKM Advertisement with SAE base AKM and EPPKE related feature flags"""
+    ssid = "test-eppke-authentication"
+    params = hostapd.wpa3_params(ssid=ssid,
+                                 password = "1234567890")
+    params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+    params['assoc_frame_encryption'] = '1'
+    params['pmksa_caching_privacy'] = '1'
+    params['eap_using_authentication_frames'] = '1'
+    params['sae_pwe'] = '2'
+
+    hapd = hostapd.add_ap(apdev[0], params)
+    time.sleep(2)
+    #TODO: Add pcap file checks to validate correct
+    #RSNXE bits and AKM suite presence in Beacon frames
+
+    #Disable all EPPKE related RSNXE flags and test
+    params['assoc_frame_encryption'] = '0'
+    params['pmksa_caching_privacy'] = '0'
+    params['eap_using_authentication_frames'] = '0'
+    hapd = hostapd.add_ap(apdev[0], params)
+    time.sleep(2)
+
+def test_eppke_ap_with_base_akm_sae_legacy_client(dev, apdev):
+    """EPPKE authentication with a Non-MLO AP with base AKM SAE and legacy client"""
+    ssid = "test-eppke-authentication"
+    passphrase = '1234567890'
+    params = hostapd.wpa3_params(ssid=ssid,
+				 password = passphrase)
+    params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+    params['assoc_frame_encryption'] = '1'
+    params['pmksa_caching_privacy'] = '1'
+    params['eap_using_authentication_frames'] = '1'
+    params['sae_pwe'] = '2'
+    hapd = hostapd.add_ap(apdev[0], params)
+
+    try:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "1")
+        dev[0].connect(ssid, sae_password=passphrase, scan_freq="2412",
+                       key_mgmt="SAE", ieee80211w="2", beacon_prot="1",
+                       pairwise="CCMP")
+        hapd.wait_sta();
+        sta = hapd.get_sta(dev[0].own_addr())
+        if sta["AKMSuiteSelector"] != '00-0f-ac-8' or sta["auth_alg"] != '9':
+            raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+
+    finally:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "0")
+
+def run_eppke_sae_ext_key(dev, apdev, group):
+    """EPPKE authentication with a Non-MLO AP with base AKM SAE-EXT-KEY and legacy client"""
+    ssid = "test-eppke-authentication"
+    passphrase = '1234567890'
+    params = hostapd.wpa3_params(ssid=ssid,
+				 password = passphrase)
+    params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'SAE-EXT-KEY EPPKE'
+    params['assoc_frame_encryption'] = '1'
+    params['pmksa_caching_privacy'] = '1'
+    params['eap_using_authentication_frames'] = '1'
+    params['sae_pwe'] = '2'
+    params['pasn_groups'] = str(group)
+    params['sae_groups'] = str(group)
+    hapd = hostapd.add_ap(apdev[0], params)
+
+    try:
+        dev[0].set("sae_groups", str(group))
+        dev[0].set("sae_pwe", "1")
+        dev[0].connect(ssid, sae_password=passphrase, scan_freq="2412",
+                       key_mgmt="SAE-EXT-KEY", ieee80211w="2", beacon_prot="1",
+                       pairwise="CCMP")
+        hapd.wait_sta();
+        sta = hapd.get_sta(dev[0].own_addr())
+        if sta["AKMSuiteSelector"] != '00-0f-ac-24' or sta["auth_alg"] != '9':
+            raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+
+    finally:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "0")
+
+def test_eppke_ap_with_base_akm_sae_ext_legacy_client_19(dev, apdev):
+    """EPPKE authentication with a Non-MLO AP with base AKM SAE-EXT-KEY and legacy client, group 19"""
+    run_eppke_sae_ext_key(dev, apdev, 19)
+
+def test_eppke_ap_with_base_akm_sae_ext_legacy_client_20(dev, apdev):
+    """EPPKE authentication with a Non-MLO AP with base AKM SAE-EXT-KEY and legacy client, group 20"""
+    run_eppke_sae_ext_key(dev, apdev, 20)
+
+def test_eppke_ap_with_base_akm_sae_ext_legacy_client_21(dev, apdev):
+    """EPPKE authentication with a Non-MLO AP with base AKM SAE-EXT-KEY and legacy client, group 21"""
+    run_eppke_sae_ext_key(dev, apdev, 21)
+
+def test_eppke_mld_ap_with_base_akm_sae_legacy_client(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE and legacy client"""
+    with HWSimRadio(use_mlo=True) as (hapd_radio, hapd_iface):
+        passphrase = '1234567890'
+        ssid = "test-eppke-authentication"
+        params = eht_mld_ap_wpa2_params(ssid, passphrase,
+                                        key_mgmt="SAE", mfp="2", pwe='1')
+        params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+        params['assoc_frame_encryption'] = '1'
+        params['pmksa_caching_privacy'] = '1'
+        params['eap_using_authentication_frames'] = '1'
+        params['rsn_pairwise'] = "CCMP GCMP-256"
+
+        hapd0 = eht_mld_enable_ap(hapd_iface, 0, params)
+
+        params['channel'] = '6'
+        hapd1 = eht_mld_enable_ap(hapd_iface, 1, params)
+
+        try:
+            dev[0].set("sae_groups", "")
+            dev[0].set("sae_pwe", "1")
+            dev[0].connect(ssid, sae_password=passphrase, scan_freq="2412",
+                           key_mgmt="SAE", ieee80211w="2", beacon_prot="1",
+                           pairwise="CCMP GCMP-256")
+            bssid = dev[0].get_status_field("bssid")
+            if hapd0.own_addr() == bssid:
+                hapd0.wait_sta();
+                sta = hapd0.get_sta(dev[0].own_addr())
+                if sta["AKMSuiteSelector"] != '00-0f-ac-8' or sta["auth_alg"] != '9':
+                    raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+            elif hapd1.own_addr() == bssid:
+                hapd1.wait_sta();
+                sta = hapd1.get_sta(dev[0].own_addr())
+                if sta["AKMSuiteSelector"] != '00-0f-ac-8' or sta["auth_alg"] != '9':
+                    raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+            else:
+                raise Exception("Unknown BSSID: " + bssid)
+        finally:
+            dev[0].set("sae_groups", "")
+            dev[0].set("sae_pwe", "0")
+
+def test_eppke_mld_ap_with_base_akm_sae_ext_legacy_client(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE-EXT and legacy client"""
+    with HWSimRadio(use_mlo=True) as (hapd_radio, hapd_iface):
+        passphrase = '1234567890'
+        ssid = "test-eppke-authentication"
+        params = eht_mld_ap_wpa2_params(ssid, passphrase,
+                                        key_mgmt="SAE-EXT-KEY", mfp="2", pwe='1')
+        params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+        params['assoc_frame_encryption'] = '1'
+        params['pmksa_caching_privacy'] = '1'
+        params['eap_using_authentication_frames'] = '1'
+        params['rsn_pairwise'] = "CCMP GCMP-256"
+        hapd0 = eht_mld_enable_ap(hapd_iface, 0, params)
+
+        params['channel'] = '6'
+        hapd1 = eht_mld_enable_ap(hapd_iface, 1, params)
+
+        try:
+            dev[0].set("sae_groups", "")
+            dev[0].set("sae_pwe", "1")
+            dev[0].connect(ssid, sae_password=passphrase, scan_freq="2412",
+                           key_mgmt="SAE-EXT-KEY", ieee80211w="2", beacon_prot="1",
+                           pairwise="CCMP GCMP-256")
+            bssid = dev[0].get_status_field("bssid")
+            if hapd0.own_addr() == bssid:
+                hapd0.wait_sta();
+                sta = hapd0.get_sta(dev[0].own_addr())
+                if sta["AKMSuiteSelector"] != '00-0f-ac-24' or sta["auth_alg"] != '9':
+                    raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+            elif hapd1.own_addr() == bssid:
+                hapd1.wait_sta();
+                sta = hapd1.get_sta(dev[0].own_addr())
+                if sta["AKMSuiteSelector"] != '00-0f-ac-24' or sta["auth_alg"] != '9':
+                    raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+            else:
+                raise Exception("Unknown BSSID: " + bssid)
+        finally:
+            dev[0].set("sae_groups", "")
+            dev[0].set("sae_pwe", "0")
+
+def run_eppke_mld_two_links(dev, apdev, key_mgmt):
+    with HWSimRadio(use_mlo=True) as (hapd_radio, hapd_iface), \
+        HWSimRadio(use_mlo=True) as (wpas_radio, wpas_iface):
+
+        wpas = WpaSupplicant(global_iface='/tmp/wpas-wlan5')
+        wpas.interface_add(wpas_iface)
+
+        passphrase = '1234567890'
+        ssid = "test-eppke-authentication"
+        params = eht_mld_ap_wpa2_params(ssid, passphrase,
+                                        key_mgmt=key_mgmt, mfp="2", pwe='1',
+                                        beacon_prot=1)
+        params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+        params['assoc_frame_encryption'] = '1'
+        params['pmksa_caching_privacy'] = '1'
+        params['eap_using_authentication_frames'] = '1'
+        params['rsn_pairwise'] = "CCMP GCMP-256"
+        hapd0 = eht_mld_enable_ap(hapd_iface, 0, params)
+
+        params['channel'] = '6'
+        hapd1 = eht_mld_enable_ap(hapd_iface, 1, params)
+
+        wpas.set("sae_groups", "")
+        wpas.set("sae_pwe", "1")
+        wpas.connect(ssid, sae_password=passphrase, scan_freq="2412 2437",
+                     key_mgmt=key_mgmt, ieee80211w="2", beacon_prot="1",
+                     pairwise="CCMP GCMP-256")
+        eht_verify_status(wpas, hapd0, 2412, 20, is_ht=True, mld=True,
+                          valid_links=3, active_links=3)
+
+def run_eppke_mld_one_link(dev, apdev, key_mgmt):
+    with HWSimRadio(use_mlo=True) as (hapd_radio, hapd_iface), \
+        HWSimRadio(use_mlo=True) as (wpas_radio, wpas_iface):
+
+        wpas = WpaSupplicant(global_iface='/tmp/wpas-wlan5')
+        wpas.interface_add(wpas_iface)
+
+        passphrase = '1234567890'
+        ssid = "test-eppke-authentication"
+        params = eht_mld_ap_wpa2_params(ssid, passphrase,
+                                        key_mgmt=key_mgmt, mfp="2", pwe='1',
+                                        beacon_prot=1)
+        params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+        params['assoc_frame_encryption'] = '1'
+        params['pmksa_caching_privacy'] = '1'
+        params['eap_using_authentication_frames'] = '1'
+        params['rsn_pairwise'] = "CCMP GCMP-256"
+        hapd0 = eht_mld_enable_ap(hapd_iface, 0, params)
+
+        wpas.set("sae_groups", "")
+        wpas.set("sae_pwe", "1")
+        wpas.connect(ssid, sae_password=passphrase, scan_freq="2412",
+                     key_mgmt=key_mgmt, ieee80211w="2", beacon_prot="1",
+                     pairwise="CCMP GCMP-256")
+        eht_verify_status(wpas, hapd0, 2412, 20, is_ht=True, mld=True,
+                          valid_links=1, active_links=1)
+
+def test_eppke_with_base_akm_sae_single_link(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE and MLD client using single link"""
+    run_eppke_mld_one_link(dev, apdev, key_mgmt="SAE")
+
+def test_eppke_with_base_akm_sae_ext_single_link(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE-EXT and MLD client using single link"""
+    run_eppke_mld_one_link(dev, apdev, key_mgmt="SAE-EXT-KEY")
+
+def test_eppke_with_base_akm_sae_two_link(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE and MLD client using two links"""
+    run_eppke_mld_two_links(dev, apdev, key_mgmt="SAE")
+
+def test_eppke_with_base_akm_sae_ext_two_link(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE-EXT and MLD client using two links"""
+    run_eppke_mld_two_links(dev, apdev, key_mgmt="SAE-EXT-KEY")
+
+def test_eppke_ap_with_base_akm_sae_legacy_client_pmksa_cached(dev, apdev):
+    """EPPKE authentication with a Non-MLO AP with base AKM SAE and legacy client with PMKSA Caching"""
+    ssid = "test-eppke-authentication"
+    passphrase = '1234567890'
+    params = hostapd.wpa3_params(ssid=ssid,
+            password = passphrase)
+    params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+    params['assoc_frame_encryption'] = '1'
+    params['pmksa_caching_privacy'] = '1'
+    params['eap_using_authentication_frames'] = '1'
+    params['sae_pwe'] = '2'
+    hapd = hostapd.add_ap(apdev[0], params)
+
+    try:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "1")
+        dev[0].connect(ssid, sae_password=passphrase, scan_freq="2412",
+                key_mgmt="SAE", ieee80211w="2", beacon_prot="1",
+                pairwise="CCMP")
+        hapd.wait_sta();
+        sta = hapd.get_sta(dev[0].own_addr())
+        if sta["AKMSuiteSelector"] != '00-0f-ac-8' or sta["auth_alg"] != '9':
+            raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+
+        dev[0].request("DISCONNECT")
+        dev[0].wait_disconnected()
+        dev[0].request("RECONNECT")
+        dev[0].wait_connected(timeout=15, error="Reconnect timed out")
+        val = dev[0].get_status_field('sae_group')
+        if val is not None:
+            raise Exception("SAE group claimed to have been used: " + val)
+        sta = hapd.get_sta(dev[0].own_addr())
+        if sta['auth_alg'] != '9' or sta['AKMSuiteSelector'] != '00-0f-ac-8':
+            raise Exception("Incorrect Auth Algo/AKMSuiteSelector value after PMKSA caching")
+
+    finally:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "0")
+
+def test_eppke_ap_with_base_akm_sae_ext_legacy_client_pmksa_cached(dev, apdev):
+    """EPPKE authentication with a Non-MLO AP with base AKM SAE-EXT-KEY and legacy client"""
+    ssid = "test-eppke-authentication"
+    passphrase = '1234567890'
+    params = hostapd.wpa3_params(ssid=ssid,
+				 password = passphrase)
+    params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'SAE-EXT-KEY EPPKE'
+    params['assoc_frame_encryption'] = '1'
+    params['pmksa_caching_privacy'] = '1'
+    params['eap_using_authentication_frames'] = '1'
+    params['sae_pwe'] = '2'
+    hapd = hostapd.add_ap(apdev[0], params)
+
+    try:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "1")
+        dev[0].connect(ssid, sae_password=passphrase, scan_freq="2412",
+                       key_mgmt="SAE-EXT-KEY", ieee80211w="2", beacon_prot="1",
+                       pairwise="CCMP")
+        hapd.wait_sta();
+        sta = hapd.get_sta(dev[0].own_addr())
+        if sta["AKMSuiteSelector"] != '00-0f-ac-24' or sta["auth_alg"] != '9':
+            raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+
+        dev[0].request("DISCONNECT")
+        dev[0].wait_disconnected()
+        dev[0].request("RECONNECT")
+        dev[0].wait_connected(timeout=15, error="Reconnect timed out")
+        val = dev[0].get_status_field('sae_group')
+        if val is not None:
+            raise Exception("SAE group claimed to have been used: " + val)
+        sta = hapd.get_sta(dev[0].own_addr())
+        if sta['auth_alg'] != '9' or sta['AKMSuiteSelector'] != '00-0f-ac-24':
+            raise Exception("Incorrect Auth Algo/AKMSuiteSelector value after PMKSA caching")
+
+    finally:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "0")
+
+def test_eppke_mld_ap_with_base_akm_sae_legacy_client_pmksa_cached(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE and legacy client"""
+    with HWSimRadio(use_mlo=True) as (hapd_radio, hapd_iface):
+        passphrase = '1234567890'
+        ssid = "test-eppke-authentication"
+        params = eht_mld_ap_wpa2_params(ssid, passphrase,
+                                        key_mgmt="SAE", mfp="2", pwe='1')
+        params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+        params['assoc_frame_encryption'] = '1'
+        params['pmksa_caching_privacy'] = '1'
+        params['eap_using_authentication_frames'] = '1'
+        params['rsn_pairwise'] = "CCMP GCMP-256"
+
+        hapd0 = eht_mld_enable_ap(hapd_iface, 0, params)
+
+        params['channel'] = '6'
+        hapd1 = eht_mld_enable_ap(hapd_iface, 1, params)
+
+        try:
+            dev[0].set("sae_groups", "")
+            dev[0].set("sae_pwe", "1")
+            dev[0].connect(ssid, sae_password=passphrase, scan_freq="2412",
+                           key_mgmt="SAE", ieee80211w="2", beacon_prot="1",
+                           pairwise="CCMP GCMP-256")
+            bssid = dev[0].get_status_field("bssid")
+            if hapd0.own_addr() == bssid:
+                hapd0.wait_sta();
+                sta = hapd0.get_sta(dev[0].own_addr())
+                if sta["AKMSuiteSelector"] != '00-0f-ac-8' or sta["auth_alg"] != '9':
+                    raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+            elif hapd1.own_addr() == bssid:
+                hapd1.wait_sta();
+                sta = hapd1.get_sta(dev[0].own_addr())
+                if sta["AKMSuiteSelector"] != '00-0f-ac-8' or sta["auth_alg"] != '9':
+                    raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+            else:
+                raise Exception("Unknown BSSID: " + bssid)
+
+            dev[0].request("DISCONNECT")
+            dev[0].wait_disconnected()
+            dev[0].request("RECONNECT")
+            dev[0].wait_connected(timeout=15, error="Reconnect timed out")
+            val = dev[0].get_status_field('sae_group')
+            if val is not None:
+                raise Exception("SAE group claimed to have been used: " + val)
+
+            bssid = dev[0].get_status_field("bssid")
+            if hapd0.own_addr() == bssid:
+                hapd0.wait_sta();
+                sta = hapd0.get_sta(dev[0].own_addr())
+            elif hapd1.own_addr() == bssid:
+                hapd1.wait_sta();
+                sta = hapd1.get_sta(dev[0].own_addr())
+            else:
+                raise Exception("Unknown BSSID: " + bssid)
+
+            if sta['auth_alg'] != '9' or sta['AKMSuiteSelector'] != '00-0f-ac-8':
+                raise Exception("Incorrect Auth Algo/AKMSuiteSelector value after PMKSA caching")
+
+        finally:
+            dev[0].set("sae_groups", "")
+            dev[0].set("sae_pwe", "0")
+
+def test_eppke_mld_ap_with_base_akm_sae_ext_legacy_client_pmksa_cached(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE-EXT and legacy client"""
+    with HWSimRadio(use_mlo=True) as (hapd_radio, hapd_iface):
+        passphrase = '1234567890'
+        ssid = "test-eppke-authentication"
+        params = eht_mld_ap_wpa2_params(ssid, passphrase,
+                                        key_mgmt="SAE-EXT-KEY", mfp="2", pwe='1')
+        params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+        params['assoc_frame_encryption'] = '1'
+        params['pmksa_caching_privacy'] = '1'
+        params['eap_using_authentication_frames'] = '1'
+        params['rsn_pairwise'] = "CCMP GCMP-256"
+        hapd0 = eht_mld_enable_ap(hapd_iface, 0, params)
+
+        params['channel'] = '6'
+        hapd1 = eht_mld_enable_ap(hapd_iface, 1, params)
+
+        try:
+            dev[0].set("sae_groups", "")
+            dev[0].set("sae_pwe", "1")
+            dev[0].connect(ssid, sae_password=passphrase, scan_freq="2412",
+                           key_mgmt="SAE-EXT-KEY", ieee80211w="2", beacon_prot="1",
+                           pairwise="CCMP GCMP-256")
+            bssid = dev[0].get_status_field("bssid")
+            if hapd0.own_addr() == bssid:
+                hapd0.wait_sta();
+                sta = hapd0.get_sta(dev[0].own_addr())
+                if sta["AKMSuiteSelector"] != '00-0f-ac-24' or sta["auth_alg"] != '9':
+                    raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+            elif hapd1.own_addr() == bssid:
+                hapd1.wait_sta();
+                sta = hapd1.get_sta(dev[0].own_addr())
+                if sta["AKMSuiteSelector"] != '00-0f-ac-24' or sta["auth_alg"] != '9':
+                    raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+            else:
+                raise Exception("Unknown BSSID: " + bssid)
+
+            dev[0].request("DISCONNECT")
+            dev[0].wait_disconnected()
+            dev[0].request("RECONNECT")
+            dev[0].wait_connected(timeout=15, error="Reconnect timed out")
+            val = dev[0].get_status_field('sae_group')
+            if val is not None:
+                raise Exception("SAE group claimed to have been used: " + val)
+
+            bssid = dev[0].get_status_field("bssid")
+            if hapd0.own_addr() == bssid:
+                hapd0.wait_sta();
+                sta = hapd0.get_sta(dev[0].own_addr())
+            elif hapd1.own_addr() == bssid:
+                hapd1.wait_sta();
+                sta = hapd1.get_sta(dev[0].own_addr())
+            else:
+                raise Exception("Unknown BSSID: " + bssid)
+
+            if sta['auth_alg'] != '9' or sta['AKMSuiteSelector'] != '00-0f-ac-24':
+                raise Exception("Incorrect Auth Algo/AKMSuiteSelector value after PMKSA caching")
+
+        finally:
+            dev[0].set("sae_groups", "")
+            dev[0].set("sae_pwe", "0")
+
+def run_eppke_mld_one_link_pmksa_cached(dev, apdev, key_mgmt):
+    with HWSimRadio(use_mlo=True) as (hapd_radio, hapd_iface), \
+        HWSimRadio(use_mlo=True) as (wpas_radio, wpas_iface):
+
+        wpas = WpaSupplicant(global_iface='/tmp/wpas-wlan5')
+        wpas.interface_add(wpas_iface)
+
+        passphrase = '1234567890'
+        ssid = "test-eppke-authentication"
+        params = eht_mld_ap_wpa2_params(ssid, passphrase,
+                                        key_mgmt=key_mgmt, mfp="2", pwe='1',
+                                        beacon_prot=1)
+        params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+        params['assoc_frame_encryption'] = '1'
+        params['pmksa_caching_privacy'] = '1'
+        params['eap_using_authentication_frames'] = '1'
+        params['rsn_pairwise'] = "CCMP GCMP-256"
+        hapd0 = eht_mld_enable_ap(hapd_iface, 0, params)
+
+        wpas.set("sae_groups", "")
+        wpas.set("sae_pwe", "1")
+        wpas.connect(ssid, sae_password=passphrase, scan_freq="2412",
+                     key_mgmt=key_mgmt, ieee80211w="2", beacon_prot="1",
+                     pairwise="CCMP GCMP-256")
+        eht_verify_status(wpas, hapd0, 2412, 20, is_ht=True, mld=True,
+                          valid_links=1, active_links=1)
+
+        wpas.request("DISCONNECT")
+        wpas.wait_disconnected()
+        wpas.request("RECONNECT")
+        wpas.wait_connected(timeout=15, error="Reconnect timed out")
+        val = wpas.get_status_field('sae_group')
+        if val is not None:
+            raise Exception("SAE group claimed to have been used: " + val)
+        eht_verify_status(wpas, hapd0, 2412, 20, is_ht=True, mld=True,
+                          valid_links=1, active_links=1)
+
+def test_eppke_with_base_akm_sae_single_link_pmksa_cached(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE and MLD client using single link"""
+    run_eppke_mld_one_link_pmksa_cached(dev, apdev, key_mgmt="SAE")
+
+def test_eppke_with_base_akm_sae_ext_single_link_pmksa_cached(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE-EXT and MLD client using single link"""
+    run_eppke_mld_one_link_pmksa_cached(dev, apdev, key_mgmt="SAE-EXT-KEY")
+
+def run_eppke_mld_two_links_pmksa_cached(dev, apdev, key_mgmt):
+    with HWSimRadio(use_mlo=True) as (hapd_radio, hapd_iface), \
+        HWSimRadio(use_mlo=True) as (wpas_radio, wpas_iface):
+
+        wpas = WpaSupplicant(global_iface='/tmp/wpas-wlan5')
+        wpas.interface_add(wpas_iface)
+
+        passphrase = '1234567890'
+        ssid = "test-eppke-authentication"
+        params = eht_mld_ap_wpa2_params(ssid, passphrase,
+                                        key_mgmt=key_mgmt, mfp="2", pwe='1',
+                                        beacon_prot=1)
+        params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'EPPKE'
+        params['assoc_frame_encryption'] = '1'
+        params['pmksa_caching_privacy'] = '1'
+        params['eap_using_authentication_frames'] = '1'
+        params['rsn_pairwise'] = "CCMP GCMP-256"
+        hapd0 = eht_mld_enable_ap(hapd_iface, 0, params)
+
+        params['channel'] = '6'
+        hapd1 = eht_mld_enable_ap(hapd_iface, 1, params)
+
+        wpas.set("sae_groups", "")
+        wpas.set("sae_pwe", "1")
+        wpas.connect(ssid, sae_password=passphrase, scan_freq="2412 2437",
+                     key_mgmt=key_mgmt, ieee80211w="2", beacon_prot="1",
+                     pairwise="CCMP GCMP-256")
+        eht_verify_status(wpas, hapd0, 2412, 20, is_ht=True, mld=True,
+                          valid_links=3, active_links=3)
+
+        wpas.request("DISCONNECT")
+        wpas.wait_disconnected()
+        wpas.request("RECONNECT")
+        wpas.wait_connected(timeout=15, error="Reconnect timed out")
+        val = wpas.get_status_field('sae_group')
+        if val is not None:
+            raise Exception("SAE group claimed to have been used: " + val)
+        eht_verify_status(wpas, hapd0, 2412, 20, is_ht=True, mld=True,
+                          valid_links=3, active_links=3)
+
+def test_eppke_with_base_akm_sae_two_link_pmksa_cached(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE and MLD client using two links"""
+    run_eppke_mld_two_links_pmksa_cached(dev, apdev, key_mgmt="SAE")
+
+def test_eppke_with_base_akm_sae_ext_two_link_pmksa_cached(dev, apdev):
+    """EPPKE authentication with an MLD AP with base AKM SAE-EXT and MLD client using two links"""
+    run_eppke_mld_two_links_pmksa_cached(dev, apdev, key_mgmt="SAE-EXT-KEY")
+
+def test_eppke_ap_gtk_rekey_with_base_akm_sae_ext_legacy_client(dev, apdev):
+    """EPPKE AP and GTK rekey"""
+    ssid = "test-eppke-authentication"
+    passphrase = '1234567890'
+    params = hostapd.wpa3_params(ssid=ssid,
+				 password = passphrase)
+    params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'SAE-EXT-KEY EPPKE'
+    params['assoc_frame_encryption'] = '1'
+    params['pmksa_caching_privacy'] = '1'
+    params['eap_using_authentication_frames'] = '1'
+    params['sae_pwe'] = '2'
+    params['wpa_group_rekey'] = '1'
+    hapd = hostapd.add_ap(apdev[0], params)
+
+    try:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "1")
+        dev[0].connect(ssid, sae_password=passphrase, scan_freq="2412",
+                       key_mgmt="SAE-EXT-KEY", ieee80211w="2", beacon_prot="1",
+                       pairwise="CCMP")
+        hapd.wait_sta();
+        sta = hapd.get_sta(dev[0].own_addr())
+        if sta["AKMSuiteSelector"] != '00-0f-ac-24' or sta["auth_alg"] != '9':
+            raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+
+    finally:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "0")
+
+def test_eppke_ap_ptk_rekey_with_base_akm_sae_ext_legacy_client(dev, apdev):
+    """EPPKE AP and PTK rekey"""
+    ssid = "test-eppke-authentication"
+    passphrase = '1234567890'
+    params = hostapd.wpa3_params(ssid=ssid,
+				 password = passphrase)
+    params['wpa_key_mgmt'] = params['wpa_key_mgmt'] + ' ' + 'SAE-EXT-KEY EPPKE'
+    params['assoc_frame_encryption'] = '1'
+    params['pmksa_caching_privacy'] = '1'
+    params['eap_using_authentication_frames'] = '1'
+    params['sae_pwe'] = '2'
+    params['wpa_ptk_rekey'] = '2'
+    hapd = hostapd.add_ap(apdev[0], params)
+
+    try:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "1")
+        dev[0].connect(ssid, sae_password=passphrase, scan_freq="2412",
+                       key_mgmt="SAE-EXT-KEY", ieee80211w="2", beacon_prot="1",
+                       pairwise="CCMP")
+        hapd.wait_sta();
+        sta = hapd.get_sta(dev[0].own_addr())
+        if sta["AKMSuiteSelector"] != '00-0f-ac-24' or sta["auth_alg"] != '9':
+            raise Exception("Incorrect Auth Algo/AKMSuiteSelector value")
+
+    finally:
+        dev[0].set("sae_groups", "")
+        dev[0].set("sae_pwe", "0")
